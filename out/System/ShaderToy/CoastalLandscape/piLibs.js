"use strict";function piCamera(){var e=setIdentity(),t=setIdentity(),r=[0,0,0],n=0,m=0,E=[0,0,0],i=0,T=0,a={SetPos:function(e){r=e},LocalMove:function(e){e=matMulvec(setRotationY(-m),e),E=sub(E,e)},RotateXY:function(e,t){i-=e,T-=t,i=Math.min(Math.max(i,-Math.PI/2),Math.PI/2)},CameraExectue:function(a){n+=12*(i-n)*a,m+=12*(T-m)*a,r=add(r,mul(sub(E,r),12*a)),e=matMul(matMul(setRotationX(n),setRotationY(m)),setTranslation(r)),t=invertFast(e)},GetMatrix:function(){return e},GetMatrixInverse:function(){return t},SetMatrix:function(n){t=invertFast(e=n),r=getXYZ(matMulpoint(n,[0,0,0])),E=r},GetPos:function(){return getXYZ(matMulpoint(t,[0,0,0]))},GetDir:function(){return getXYZ(normalize(matMulvec(t,[0,0,-1])))}};return a}function piFile(e){var t=e,r=0,n={mDummy:0,Seek:function(e){r=e},ReadUInt8:function(){var e=new Uint8Array(t,r)[0];return r+=1,e},ReadUInt16:function(){var e=new Uint16Array(t,r)[0];return r+=2,e},ReadUInt32:function(){var e=new Uint32Array(t,r)[0];return r+=4,e},ReadUInt64:function(){return n.ReadUInt32()+(n.ReadUInt32()<<32)},ReadFloat32:function(){var e=new Float32Array(t,r)[0];return r+=4,e},ReadFloat32Array:function(e){for(var n=new Float32Array(t,r),m=[],E=0;E<e;E++)m[E]=n[E];return r+=4*e,m},ReadFloat32ArrayNative:function(e){var n=new Float32Array(t,r);return r+=4*e,n}};return n}function piMesh(){this.mChunks=[],this.mPrimitiveType=0,this.mVertexFormat=null}function piRenderer(){var e,t,r,n,m,E,i,T,a,R,o=null,u=null,U=!1,s=null,_=null,l=null,f=null,A=["",""],x=[0,0],F={CLEAR:{Color:1,Zbuffer:2,Stencil:4},TEXFMT:{C4I8:0,C1I8:1,C1F16:2,C4F16:3,C1F32:4,C4F32:5,Z16:6,Z24:7,Z32:8,C3F32:9},TEXWRP:{CLAMP:0,REPEAT:1},BUFTYPE:{STATIC:0,DYNAMIC:1},PRIMTYPE:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5},RENDSTGATE:{WIREFRAME:0,FRONT_FACE:1,CULL_FACE:2,DEPTH_TEST:3,ALPHA_TO_COVERAGE:4},TEXTYPE:{T2D:0,T3D:1,CUBEMAP:2},FILTER:{NONE:0,LINEAR:1,MIPMAP:2,NONE_MIPMAP:3},TYPE:{UINT8:0,UINT16:1,UINT32:2,FLOAT16:3,FLOAT32:4,FLOAT64:5}},I=function(e){if(U){if(e===F.TEXFMT.C4I8)return{mGLFormat:o.RGBA8,mGLExternal:o.RGBA,mGLType:o.UNSIGNED_BYTE};if(e===F.TEXFMT.C1I8)return{mGLFormat:o.R8,mGLExternal:o.RED,mGLType:o.UNSIGNED_BYTE};if(e===F.TEXFMT.C1F16)return{mGLFormat:o.R16F,mGLExternal:o.RED,mGLType:o.FLOAT};if(e===F.TEXFMT.C4F16)return{mGLFormat:o.RGBA16F,mGLExternal:o.RGBA,mGLType:o.FLOAT};if(e===F.TEXFMT.C1F32)return{mGLFormat:o.R32F,mGLExternal:o.RED,mGLType:o.FLOAT};if(e===F.TEXFMT.C4F32)return{mGLFormat:o.RGBA32F,mGLExternal:o.RGBA,mGLType:o.FLOAT};if(e===F.TEXFMT.C3F32)return{mGLFormat:o.RGB32F,mGLExternal:o.RGB,mGLType:o.FLOAT};if(e===F.TEXFMT.Z16)return{mGLFormat:o.DEPTH_COMPONENT16,mGLExternal:o.DEPTH_COMPONENT,mGLType:o.UNSIGNED_SHORT};if(e===F.TEXFMT.Z24)return{mGLFormat:o.DEPTH_COMPONENT24,mGLExternal:o.DEPTH_COMPONENT,mGLType:o.UNSIGNED_SHORT};if(e===F.TEXFMT.Z32)return{mGLFormat:o.DEPTH_COMPONENT32F,mGLExternal:o.DEPTH_COMPONENT,mGLType:o.UNSIGNED_SHORT}}else{if(e===F.TEXFMT.C4I8)return{mGLFormat:o.RGBA,mGLExternal:o.RGBA,mGLType:o.UNSIGNED_BYTE};if(e===F.TEXFMT.C1I8)return{mGLFormat:o.LUMINANCE,mGLExternal:o.LUMINANCE,mGLType:o.UNSIGNED_BYTE};if(e===F.TEXFMT.C1F16)return{mGLFormat:o.LUMINANCE,mGLExternal:o.LUMINANCE,mGLType:o.FLOAT};if(e===F.TEXFMT.C4F16)return{mGLFormat:o.RGBA,mGLExternal:o.RGBA,mGLType:o.FLOAT};if(e===F.TEXFMT.C1F32)return{mGLFormat:o.LUMINANCE,mGLExternal:o.RED,mGLType:o.FLOAT};if(e===F.TEXFMT.C4F32)return{mGLFormat:o.RGBA,mGLExternal:o.RGBA,mGLType:o.FLOAT};if(e===F.TEXFMT.Z16)return{mGLFormat:o.DEPTH_COMPONENT,mGLExternal:o.DEPTH_COMPONENT,mGLType:o.UNSIGNED_SHORT}}return null};return F.Initialize=function(u){o=u,(U=!(u instanceof WebGLRenderingContext))?(e=!0,o.getExtension("OES_texture_float_linear"),t=!0,o.getExtension("OES_texture_half_float_linear"),m=!0,r=!0,n=!0,E=!0,i=o.getExtension("EXT_texture_filter_anisotropic"),T=o.getExtension("EXT_color_buffer_float"),a=o.getExtension("WEBGL_debug_shaders"),R=o.getExtension("KHR_parallel_shader_compile"),o.hint(o.FRAGMENT_SHADER_DERIVATIVE_HINT,o.NICEST)):(e=o.getExtension("OES_texture_float"),o.getExtension("OES_texture_float_linear"),t=o.getExtension("OES_texture_half_float"),o.getExtension("OES_texture_half_float_linear"),m=o.getExtension("OES_standard_derivatives"),r=o.getExtension("WEBGL_draw_buffers"),n=o.getExtension("WEBGL_depth_texture"),E=o.getExtension("EXT_shader_texture_lod"),i=o.getExtension("EXT_texture_filter_anisotropic"),T=e,a=null,R=null,null!==m&&o.hint(m.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,o.NICEST));var F=o.getParameter(o.MAX_TEXTURE_SIZE),I=o.getParameter(o.MAX_CUBE_MAP_TEXTURE_SIZE),P=o.getParameter(o.MAX_RENDERBUFFER_SIZE),c=(o.getSupportedExtensions(),o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS));console.log("WebGL (2.0="+U+"): Asynch Compile: "+(null!==R?"yes":"no")+", Textures: F32 ["+(null!==e?"yes":"no")+"], F16 ["+(null!==t?"yes":"no")+"], Depth ["+(null!==n?"yes":"no")+"], LOD ["+(null!==E?"yes":"no")+"], Aniso ["+(null!==i?"yes":"no")+"], Units ["+c+"], Max Size ["+F+"], Cube Max Size ["+I+"], Targets: MRT ["+(null!==r?"yes":"no")+"], F32 ["+(null!==T?"yes":"no")+"], Max Size ["+P+"]");var L=new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]);return s=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,L,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),_=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,_),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),l=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,l),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0,0,-1,1,1,-1,0,0,1,1,-1,1,0,0,1,1,1,1,0,0,1,-1,-1,1,0,0,1,-1,1,1,0,0,1,1,1,0,1,0,1,1,-1,0,1,0,-1,1,1,0,1,0,-1,1,-1,0,1,0,1,-1,-1,0,-1,0,1,-1,1,0,-1,0,-1,-1,-1,0,-1,0,-1,-1,1,0,-1,0,-1,1,1,0,0,1,-1,-1,1,0,0,1,1,1,1,0,0,1,1,-1,1,0,0,1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0,0,-1,1,1,-1,0,0,-1]),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),f=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,f),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1]),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),A[0]="",x[0]=0,U?(A[0]+="#version 300 es\n#ifdef GL_ES\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\n#endif\n",x[0]+=6):(A[0]+="#ifdef GL_ES\nprecision highp float;\nprecision highp int;\n#endif\nfloat round( float x ) { return floor(x+0.5); }\nvec2 round(vec2 x) { return floor(x + 0.5); }\nvec3 round(vec3 x) { return floor(x + 0.5); }\nvec4 round(vec4 x) { return floor(x + 0.5); }\nfloat trunc( float x, float n ) { return floor(x*n)/n; }\nmat3 transpose(mat3 m) { return mat3(m[0].x, m[1].x, m[2].x, m[0].y, m[1].y, m[2].y, m[0].z, m[1].z, m[2].z); }\nfloat determinant( in mat2 m ) { return m[0][0]*m[1][1] - m[0][1]*m[1][0]; }\nfloat determinant( mat4 m ) { float b00 = m[0][0] * m[1][1] - m[0][1] * m[1][0], b01 = m[0][0] * m[1][2] - m[0][2] * m[1][0], b02 = m[0][0] * m[1][3] - m[0][3] * m[1][0], b03 = m[0][1] * m[1][2] - m[0][2] * m[1][1], b04 = m[0][1] * m[1][3] - m[0][3] * m[1][1], b05 = m[0][2] * m[1][3] - m[0][3] * m[1][2], b06 = m[2][0] * m[3][1] - m[2][1] * m[3][0], b07 = m[2][0] * m[3][2] - m[2][2] * m[3][0], b08 = m[2][0] * m[3][3] - m[2][3] * m[3][0], b09 = m[2][1] * m[3][2] - m[2][2] * m[3][1], b10 = m[2][1] * m[3][3] - m[2][3] * m[3][1], b11 = m[2][2] * m[3][3] - m[2][3] * m[3][2];  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;}\nmat2 inverse(mat2 m) { float det = determinant(m); return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / det; }\nmat4 inverse(mat4 m ) { float inv0 = m[1].y*m[2].z*m[3].w - m[1].y*m[2].w*m[3].z - m[2].y*m[1].z*m[3].w + m[2].y*m[1].w*m[3].z + m[3].y*m[1].z*m[2].w - m[3].y*m[1].w*m[2].z; float inv4 = -m[1].x*m[2].z*m[3].w + m[1].x*m[2].w*m[3].z + m[2].x*m[1].z*m[3].w - m[2].x*m[1].w*m[3].z - m[3].x*m[1].z*m[2].w + m[3].x*m[1].w*m[2].z; float inv8 = m[1].x*m[2].y*m[3].w - m[1].x*m[2].w*m[3].y - m[2].x  * m[1].y * m[3].w + m[2].x  * m[1].w * m[3].y + m[3].x * m[1].y * m[2].w - m[3].x * m[1].w * m[2].y; float inv12 = -m[1].x  * m[2].y * m[3].z + m[1].x  * m[2].z * m[3].y +m[2].x  * m[1].y * m[3].z - m[2].x  * m[1].z * m[3].y - m[3].x * m[1].y * m[2].z + m[3].x * m[1].z * m[2].y; float inv1 = -m[0].y*m[2].z * m[3].w + m[0].y*m[2].w * m[3].z + m[2].y  * m[0].z * m[3].w - m[2].y  * m[0].w * m[3].z - m[3].y * m[0].z * m[2].w + m[3].y * m[0].w * m[2].z; float inv5 = m[0].x  * m[2].z * m[3].w - m[0].x  * m[2].w * m[3].z - m[2].x  * m[0].z * m[3].w + m[2].x  * m[0].w * m[3].z + m[3].x * m[0].z * m[2].w - m[3].x * m[0].w * m[2].z; float inv9 = -m[0].x  * m[2].y * m[3].w +  m[0].x  * m[2].w * m[3].y + m[2].x  * m[0].y * m[3].w - m[2].x  * m[0].w * m[3].y - m[3].x * m[0].y * m[2].w + m[3].x * m[0].w * m[2].y; float inv13 = m[0].x  * m[2].y * m[3].z - m[0].x  * m[2].z * m[3].y - m[2].x  * m[0].y * m[3].z + m[2].x  * m[0].z * m[3].y + m[3].x * m[0].y * m[2].z - m[3].x * m[0].z * m[2].y; float inv2 = m[0].y  * m[1].z * m[3].w - m[0].y  * m[1].w * m[3].z - m[1].y  * m[0].z * m[3].w + m[1].y  * m[0].w * m[3].z + m[3].y * m[0].z * m[1].w - m[3].y * m[0].w * m[1].z; float inv6 = -m[0].x  * m[1].z * m[3].w + m[0].x  * m[1].w * m[3].z + m[1].x  * m[0].z * m[3].w - m[1].x  * m[0].w * m[3].z - m[3].x * m[0].z * m[1].w + m[3].x * m[0].w * m[1].z; float inv10 = m[0].x  * m[1].y * m[3].w - m[0].x  * m[1].w * m[3].y - m[1].x  * m[0].y * m[3].w + m[1].x  * m[0].w * m[3].y + m[3].x * m[0].y * m[1].w - m[3].x * m[0].w * m[1].y; float inv14 = -m[0].x  * m[1].y * m[3].z + m[0].x  * m[1].z * m[3].y + m[1].x  * m[0].y * m[3].z - m[1].x  * m[0].z * m[3].y - m[3].x * m[0].y * m[1].z + m[3].x * m[0].z * m[1].y; float inv3 = -m[0].y * m[1].z * m[2].w + m[0].y * m[1].w * m[2].z + m[1].y * m[0].z * m[2].w - m[1].y * m[0].w * m[2].z - m[2].y * m[0].z * m[1].w + m[2].y * m[0].w * m[1].z; float inv7 = m[0].x * m[1].z * m[2].w - m[0].x * m[1].w * m[2].z - m[1].x * m[0].z * m[2].w + m[1].x * m[0].w * m[2].z + m[2].x * m[0].z * m[1].w - m[2].x * m[0].w * m[1].z; float inv11 = -m[0].x * m[1].y * m[2].w + m[0].x * m[1].w * m[2].y + m[1].x * m[0].y * m[2].w - m[1].x * m[0].w * m[2].y - m[2].x * m[0].y * m[1].w + m[2].x * m[0].w * m[1].y; float inv15 = m[0].x * m[1].y * m[2].z - m[0].x * m[1].z * m[2].y - m[1].x * m[0].y * m[2].z + m[1].x * m[0].z * m[2].y + m[2].x * m[0].y * m[1].z - m[2].x * m[0].z * m[1].y; float det = m[0].x * inv0 + m[0].y * inv4 + m[0].z * inv8 + m[0].w * inv12; det = 1.0 / det; return det*mat4( inv0, inv1, inv2, inv3,inv4, inv5, inv6, inv7,inv8, inv9, inv10, inv11,inv12, inv13, inv14, inv15);}\nfloat sinh(float x)  { return (exp(x)-exp(-x))/2.; }\nfloat cosh(float x)  { return (exp(x)+exp(-x))/2.; }\nfloat tanh(float x)  { return sinh(x)/cosh(x); }\nfloat coth(float x)  { return cosh(x)/sinh(x); }\nfloat sech(float x)  { return 1./cosh(x); }\nfloat csch(float x)  { return 1./sinh(x); }\nfloat asinh(float x) { return    log(x+sqrt(x*x+1.)); }\nfloat acosh(float x) { return    log(x+sqrt(x*x-1.)); }\nfloat atanh(float x) { return .5*log((1.+x)/(1.-x)); }\nfloat acoth(float x) { return .5*log((x+1.)/(x-1.)); }\nfloat asech(float x) { return    log((1.+sqrt(1.-x*x))/x); }\nfloat acsch(float x) { return    log((1.+sqrt(1.+x*x))/x); }\n",x[0]+=26),A[1]="",x[1]=0,U?(A[1]+="#version 300 es\n#ifdef GL_ES\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\n#endif\n",x[1]+=6):(m&&(A[1]+="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n",x[1]+=3),E&&(A[1]+="#extension GL_EXT_shader_texture_lod : enable\n",x[1]++),A[1]+="#ifdef GL_ES\nprecision highp float;\nprecision highp int;\n#endif\nvec4 texture(     sampler2D   s, vec2 c)                   { return texture2D(s,c); }\nvec4 texture(     sampler2D   s, vec2 c, float b)          { return texture2D(s,c,b); }\nvec4 texture(     samplerCube s, vec3 c )                  { return textureCube(s,c); }\nvec4 texture(     samplerCube s, vec3 c, float b)          { return textureCube(s,c,b); }\nfloat round( float x ) { return floor(x+0.5); }\nvec2 round(vec2 x) { return floor(x + 0.5); }\nvec3 round(vec3 x) { return floor(x + 0.5); }\nvec4 round(vec4 x) { return floor(x + 0.5); }\nfloat trunc( float x, float n ) { return floor(x*n)/n; }\nmat3 transpose(mat3 m) { return mat3(m[0].x, m[1].x, m[2].x, m[0].y, m[1].y, m[2].y, m[0].z, m[1].z, m[2].z); }\nfloat determinant( in mat2 m ) { return m[0][0]*m[1][1] - m[0][1]*m[1][0]; }\nfloat determinant( mat4 m ) { float b00 = m[0][0] * m[1][1] - m[0][1] * m[1][0], b01 = m[0][0] * m[1][2] - m[0][2] * m[1][0], b02 = m[0][0] * m[1][3] - m[0][3] * m[1][0], b03 = m[0][1] * m[1][2] - m[0][2] * m[1][1], b04 = m[0][1] * m[1][3] - m[0][3] * m[1][1], b05 = m[0][2] * m[1][3] - m[0][3] * m[1][2], b06 = m[2][0] * m[3][1] - m[2][1] * m[3][0], b07 = m[2][0] * m[3][2] - m[2][2] * m[3][0], b08 = m[2][0] * m[3][3] - m[2][3] * m[3][0], b09 = m[2][1] * m[3][2] - m[2][2] * m[3][1], b10 = m[2][1] * m[3][3] - m[2][3] * m[3][1], b11 = m[2][2] * m[3][3] - m[2][3] * m[3][2];  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;}\nmat2 inverse(mat2 m) { float det = determinant(m); return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / det; }\nmat4 inverse(mat4 m ) { float inv0 = m[1].y*m[2].z*m[3].w - m[1].y*m[2].w*m[3].z - m[2].y*m[1].z*m[3].w + m[2].y*m[1].w*m[3].z + m[3].y*m[1].z*m[2].w - m[3].y*m[1].w*m[2].z; float inv4 = -m[1].x*m[2].z*m[3].w + m[1].x*m[2].w*m[3].z + m[2].x*m[1].z*m[3].w - m[2].x*m[1].w*m[3].z - m[3].x*m[1].z*m[2].w + m[3].x*m[1].w*m[2].z; float inv8 = m[1].x*m[2].y*m[3].w - m[1].x*m[2].w*m[3].y - m[2].x  * m[1].y * m[3].w + m[2].x  * m[1].w * m[3].y + m[3].x * m[1].y * m[2].w - m[3].x * m[1].w * m[2].y; float inv12 = -m[1].x  * m[2].y * m[3].z + m[1].x  * m[2].z * m[3].y +m[2].x  * m[1].y * m[3].z - m[2].x  * m[1].z * m[3].y - m[3].x * m[1].y * m[2].z + m[3].x * m[1].z * m[2].y; float inv1 = -m[0].y*m[2].z * m[3].w + m[0].y*m[2].w * m[3].z + m[2].y  * m[0].z * m[3].w - m[2].y  * m[0].w * m[3].z - m[3].y * m[0].z * m[2].w + m[3].y * m[0].w * m[2].z; float inv5 = m[0].x  * m[2].z * m[3].w - m[0].x  * m[2].w * m[3].z - m[2].x  * m[0].z * m[3].w + m[2].x  * m[0].w * m[3].z + m[3].x * m[0].z * m[2].w - m[3].x * m[0].w * m[2].z; float inv9 = -m[0].x  * m[2].y * m[3].w +  m[0].x  * m[2].w * m[3].y + m[2].x  * m[0].y * m[3].w - m[2].x  * m[0].w * m[3].y - m[3].x * m[0].y * m[2].w + m[3].x * m[0].w * m[2].y; float inv13 = m[0].x  * m[2].y * m[3].z - m[0].x  * m[2].z * m[3].y - m[2].x  * m[0].y * m[3].z + m[2].x  * m[0].z * m[3].y + m[3].x * m[0].y * m[2].z - m[3].x * m[0].z * m[2].y; float inv2 = m[0].y  * m[1].z * m[3].w - m[0].y  * m[1].w * m[3].z - m[1].y  * m[0].z * m[3].w + m[1].y  * m[0].w * m[3].z + m[3].y * m[0].z * m[1].w - m[3].y * m[0].w * m[1].z; float inv6 = -m[0].x  * m[1].z * m[3].w + m[0].x  * m[1].w * m[3].z + m[1].x  * m[0].z * m[3].w - m[1].x  * m[0].w * m[3].z - m[3].x * m[0].z * m[1].w + m[3].x * m[0].w * m[1].z; float inv10 = m[0].x  * m[1].y * m[3].w - m[0].x  * m[1].w * m[3].y - m[1].x  * m[0].y * m[3].w + m[1].x  * m[0].w * m[3].y + m[3].x * m[0].y * m[1].w - m[3].x * m[0].w * m[1].y; float inv14 = -m[0].x  * m[1].y * m[3].z + m[0].x  * m[1].z * m[3].y + m[1].x  * m[0].y * m[3].z - m[1].x  * m[0].z * m[3].y - m[3].x * m[0].y * m[1].z + m[3].x * m[0].z * m[1].y; float inv3 = -m[0].y * m[1].z * m[2].w + m[0].y * m[1].w * m[2].z + m[1].y * m[0].z * m[2].w - m[1].y * m[0].w * m[2].z - m[2].y * m[0].z * m[1].w + m[2].y * m[0].w * m[1].z; float inv7 = m[0].x * m[1].z * m[2].w - m[0].x * m[1].w * m[2].z - m[1].x * m[0].z * m[2].w + m[1].x * m[0].w * m[2].z + m[2].x * m[0].z * m[1].w - m[2].x * m[0].w * m[1].z; float inv11 = -m[0].x * m[1].y * m[2].w + m[0].x * m[1].w * m[2].y + m[1].x * m[0].y * m[2].w - m[1].x * m[0].w * m[2].y - m[2].x * m[0].y * m[1].w + m[2].x * m[0].w * m[1].y; float inv15 = m[0].x * m[1].y * m[2].z - m[0].x * m[1].z * m[2].y - m[1].x * m[0].y * m[2].z + m[1].x * m[0].z * m[2].y + m[2].x * m[0].y * m[1].z - m[2].x * m[0].z * m[1].y; float det = m[0].x * inv0 + m[0].y * inv4 + m[0].z * inv8 + m[0].w * inv12; det = 1.0 / det; return det*mat4( inv0, inv1, inv2, inv3,inv4, inv5, inv6, inv7,inv8, inv9, inv10, inv11,inv12, inv13, inv14, inv15);}\nfloat sinh(float x)  { return (exp(x)-exp(-x))/2.; }\nfloat cosh(float x)  { return (exp(x)+exp(-x))/2.; }\nfloat tanh(float x)  { return sinh(x)/cosh(x); }\nfloat coth(float x)  { return cosh(x)/sinh(x); }\nfloat sech(float x)  { return 1./cosh(x); }\nfloat csch(float x)  { return 1./sinh(x); }\nfloat asinh(float x) { return    log(x+sqrt(x*x+1.)); }\nfloat acosh(float x) { return    log(x+sqrt(x*x-1.)); }\nfloat atanh(float x) { return .5*log((1.+x)/(1.-x)); }\nfloat acoth(float x) { return .5*log((x+1.)/(x-1.)); }\nfloat asech(float x) { return    log((1.+sqrt(1.-x*x))/x); }\nfloat acsch(float x) { return    log((1.+sqrt(1.+x*x))/x); }\n",x[1]+=30,E&&(A[1]+="vec4 textureLod(  sampler2D   s, vec2 c, float b)          { return texture2DLodEXT(s,c,b); }\n",A[1]+="vec4 textureGrad( sampler2D   s, vec2 c, vec2 dx, vec2 dy) { return texture2DGradEXT(s,c,dx,dy); }\n",x[1]+=2)),!0},F.GetCaps=function(){return{mIsGL20:U,mFloat32Textures:null!=e,mFloat16Textures:null!=t,mDrawBuffers:null!=r,mDepthTextures:null!=n,mDerivatives:null!=m,mShaderTextureLOD:null!=E}},F.GetShaderHeaderLines=function(e){return x[e]},F.CheckErrors=function(){var e=o.getError();if(e!=o.NO_ERROR)for(var t in o)if("number"==typeof o[t]&&o[t]==e){console.log("GL Error "+e+": "+t);break}},F.Clear=function(e,t,r,n){var m=0;1&e&&(m|=o.COLOR_BUFFER_BIT,o.clearColor(t[0],t[1],t[2],t[3])),2&e&&(m|=o.DEPTH_BUFFER_BIT,o.clearDepth(r)),4&e&&(m|=o.STENCIL_BUFFER_BIT,o.clearStencil(n)),o.clear(m)},F.CreateTexture=function(e,t,r,n,m,E,i){if(null===o)return null;var T=o.createTexture(),a=I(n),R=o.REPEAT;if(E===F.TEXWRP.CLAMP&&(R=o.CLAMP_TO_EDGE),e===F.TEXTYPE.T2D)o.bindTexture(o.TEXTURE_2D,T),o.texImage2D(o.TEXTURE_2D,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,R),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,R),m===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST)):m===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)):m===F.FILTER.MIPMAP?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),o.generateMipmap(o.TEXTURE_2D)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST_MIPMAP_LINEAR),o.generateMipmap(o.TEXTURE_2D)),o.bindTexture(o.TEXTURE_2D,null);else if(e===F.TEXTYPE.T3D){if(!U)return null;o.bindTexture(o.TEXTURE_3D,T),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_BASE_LEVEL,0),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAX_LEVEL,Math.log2(t)),m===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.NEAREST)):m===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.LINEAR)):m===F.FILTER.MIPMAP?(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR)):(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.NEAREST_MIPMAP_LINEAR),o.generateMipmap(o.TEXTURE_3D)),o.texImage3D(o.TEXTURE_3D,0,a.mGLFormat,t,r,r,0,a.mGLExternal,a.mGLType,i),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_R,R),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,R),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,R),m===F.FILTER.MIPMAP&&o.generateMipmap(o.TEXTURE_3D),o.bindTexture(o.TEXTURE_3D,null)}else o.bindTexture(o.TEXTURE_CUBE_MAP,T),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_X,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Y,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Z,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,a.mGLFormat,t,r,0,a.mGLExternal,a.mGLType,i),m===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.NEAREST)):m===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR)):m===F.FILTER.MIPMAP&&(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR)),m===F.FILTER.MIPMAP&&o.generateMipmap(o.TEXTURE_CUBE_MAP),o.bindTexture(o.TEXTURE_CUBE_MAP,null);return{mObjectID:T,mXres:t,mYres:r,mFormat:n,mType:e,mFilter:m,mWrap:E,mVFlip:!1}},F.CreateTextureFromImage=function(e,t,r,n,m,E){if(null===o)return null;var i=o.createTexture(),T=I(r),a=o.REPEAT;if(m===F.TEXWRP.CLAMP&&(a=o.CLAMP_TO_EDGE),e===F.TEXTYPE.T2D)o.bindTexture(o.TEXTURE_2D,i),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,E),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),U&&o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.NONE),o.texImage2D(o.TEXTURE_2D,0,T.mGLFormat,T.mGLExternal,T.mGLType,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,a),n===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST)):n===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)):n===F.FILTER.MIPMAP?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),o.generateMipmap(o.TEXTURE_2D)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST_MIPMAP_LINEAR),o.generateMipmap(o.TEXTURE_2D)),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.bindTexture(o.TEXTURE_2D,null);else{if(e===F.TEXTYPE.T3D)return null;o.bindTexture(o.TEXTURE_CUBE_MAP,i),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,E),o.activeTexture(o.TEXTURE0),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X,0,T.mGLFormat,T.mGLExternal,T.mGLType,t[0]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_X,0,T.mGLFormat,T.mGLExternal,T.mGLType,t[1]),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Y,0,T.mGLFormat,T.mGLExternal,T.mGLType,E?t[3]:t[2]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,T.mGLFormat,T.mGLExternal,T.mGLType,E?t[2]:t[3]),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Z,0,T.mGLFormat,T.mGLExternal,T.mGLType,t[4]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,T.mGLFormat,T.mGLExternal,T.mGLType,t[5]),n===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.NEAREST)):n===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR)):n===F.FILTER.MIPMAP&&(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),o.generateMipmap(o.TEXTURE_CUBE_MAP)),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.bindTexture(o.TEXTURE_CUBE_MAP,null)}return{mObjectID:i,mXres:t.width,mYres:t.height,mFormat:r,mType:e,mFilter:n,mWrap:m,mVFlip:E}},F.SetSamplerFilter=function(e,t,r){e.mFilter!==t&&(e.mType===F.TEXTYPE.T2D?(o.bindTexture(o.TEXTURE_2D,e.mObjectID),t===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST)):t===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)):t===F.FILTER.MIPMAP?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),r&&o.generateMipmap(o.TEXTURE_2D)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST_MIPMAP_LINEAR),r&&o.generateMipmap(o.TEXTURE_2D)),o.bindTexture(o.TEXTURE_2D,null)):e.mType===F.TEXTYPE.T3D?(o.bindTexture(o.TEXTURE_3D,e.mObjectID),t===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.NEAREST)):t===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.LINEAR)):t===F.FILTER.MIPMAP?(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),r&&o.generateMipmap(o.TEXTURE_3D)):(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,o.NEAREST_MIPMAP_LINEAR),r&&o.generateMipmap(o.TEXTURE_3D)),o.bindTexture(o.TEXTURE_3D,null)):(o.bindTexture(o.TEXTURE_CUBE_MAP,e.mObjectID),t===F.FILTER.NONE?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.NEAREST)):t===F.FILTER.LINEAR?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR)):t===F.FILTER.MIPMAP?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),r&&o.generateMipmap(o.TEXTURE_CUBE_MAP)):(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.NEAREST_MIPMAP_LINEAR),r&&o.generateMipmap(o.TEXTURE_CUBE_MAP)),o.bindTexture(o.TEXTURE_CUBE_MAP,null)),e.mFilter=t)},F.SetSamplerWrap=function(e,t){if(e.mWrap!==t){var r=o.REPEAT;t===F.TEXWRP.CLAMP&&(r=o.CLAMP_TO_EDGE);var n=e.mObjectID;e.mType===F.TEXTYPE.T2D?(o.bindTexture(o.TEXTURE_2D,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r),o.bindTexture(o.TEXTURE_2D,null)):e.mType===F.TEXTYPE.T3D&&(o.bindTexture(o.TEXTURE_3D,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_R,r),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,r),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,r),o.bindTexture(o.TEXTURE_3D,null)),e.mWrap=t}},F.SetSamplerVFlip=function(e,t,r){if(e.mVFlip!==t){var n=e.mObjectID;if(e.mType===F.TEXTYPE.T2D){if(null!=r){o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,n),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t);var m=I(e.mFormat);o.texImage2D(o.TEXTURE_2D,0,m.mGLFormat,m.mGLExternal,m.mGLType,r),o.bindTexture(o.TEXTURE_2D,null),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1)}}else if(e.mType===F.TEXTYPE.CUBEMAP&&null!=r){m=I(e.mFormat);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_CUBE_MAP,n),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X,0,m.mGLFormat,m.mGLExternal,m.mGLType,r[0]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_X,0,m.mGLFormat,m.mGLExternal,m.mGLType,r[1]),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Y,0,m.mGLFormat,m.mGLExternal,m.mGLType,t?r[3]:r[2]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,m.mGLFormat,m.mGLExternal,m.mGLType,t?r[2]:r[3]),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Z,0,m.mGLFormat,m.mGLExternal,m.mGLType,r[4]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,m.mGLFormat,m.mGLExternal,m.mGLType,r[5]),o.bindTexture(o.TEXTURE_CUBE_MAP,null),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1)}e.mVFlip=t}},F.CreateMipmaps=function(e){e.mType===F.TEXTYPE.T2D?(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.mObjectID),o.generateMipmap(o.TEXTURE_2D),o.bindTexture(o.TEXTURE_2D,null)):e.mType===F.TEXTYPE.CUBEMAP&&(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_CUBE_MAP,e.mObjectID),o.generateMipmap(o.TEXTURE_CUBE_MAP),o.bindTexture(o.TEXTURE_CUBE_MAP,null))},F.UpdateTexture=function(e,t,r,n,m,E){var i=I(e.mFormat);e.mType===F.TEXTYPE.T2D&&(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.mObjectID),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e.mVFlip),o.texSubImage2D(o.TEXTURE_2D,0,t,r,n,m,i.mGLExternal,i.mGLType,E),o.bindTexture(o.TEXTURE_2D,null),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1))},F.UpdateTextureFromImage=function(e,t){var r=I(e.mFormat);e.mType===F.TEXTYPE.T2D&&(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.mObjectID),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e.mVFlip),o.texImage2D(o.TEXTURE_2D,0,r.mGLFormat,r.mGLExternal,r.mGLType,t),o.bindTexture(o.TEXTURE_2D,null),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1))},F.DestroyTexture=function(e){o.deleteTexture(e.mObjectID)},F.AttachTextures=function(e,t,r,n,m){e>0&&null!=t&&(o.activeTexture(o.TEXTURE0),t.mType===F.TEXTYPE.T2D?o.bindTexture(o.TEXTURE_2D,t.mObjectID):t.mType===F.TEXTYPE.T3D?o.bindTexture(o.TEXTURE_3D,t.mObjectID):t.mType===F.TEXTYPE.CUBEMAP&&o.bindTexture(o.TEXTURE_CUBE_MAP,t.mObjectID)),e>1&&null!=r&&(o.activeTexture(o.TEXTURE1),r.mType===F.TEXTYPE.T2D?o.bindTexture(o.TEXTURE_2D,r.mObjectID):r.mType===F.TEXTYPE.T3D?o.bindTexture(o.TEXTURE_3D,r.mObjectID):r.mType===F.TEXTYPE.CUBEMAP&&o.bindTexture(o.TEXTURE_CUBE_MAP,r.mObjectID)),e>2&&null!=n&&(o.activeTexture(o.TEXTURE2),n.mType===F.TEXTYPE.T2D?o.bindTexture(o.TEXTURE_2D,n.mObjectID):n.mType===F.TEXTYPE.T3D?o.bindTexture(o.TEXTURE_3D,n.mObjectID):n.mType===F.TEXTYPE.CUBEMAP&&o.bindTexture(o.TEXTURE_CUBE_MAP,n.mObjectID)),e>3&&null!=m&&(o.activeTexture(o.TEXTURE3),m.mType===F.TEXTYPE.T2D?o.bindTexture(o.TEXTURE_2D,m.mObjectID):m.mType===F.TEXTYPE.T3D?o.bindTexture(o.TEXTURE_3D,m.mObjectID):m.mType===F.TEXTYPE.CUBEMAP&&o.bindTexture(o.TEXTURE_CUBE_MAP,m.mObjectID))},F.DettachTextures=function(){o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,null),o.bindTexture(o.TEXTURE_CUBE_MAP,null),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,null),o.bindTexture(o.TEXTURE_CUBE_MAP,null),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,null),o.bindTexture(o.TEXTURE_CUBE_MAP,null),o.activeTexture(o.TEXTURE3),o.bindTexture(o.TEXTURE_2D,null),o.bindTexture(o.TEXTURE_CUBE_MAP,null)},F.CreateRenderTarget=function(e,t,r,n,m,E){var i=o.createFramebuffer();if(o.bindFramebuffer(o.FRAMEBUFFER,i),null===m){if(!0===E){var T=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,T),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,e.mXres,e.mYres),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,T)}}else o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,m.mObjectID,0);return null!=e&&o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e.mObjectID,0),o.checkFramebufferStatus(o.FRAMEBUFFER)!=o.FRAMEBUFFER_COMPLETE?null:(o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),{mObjectID:i,mTex0:e})},F.DestroyRenderTarget=function(e){o.deleteFramebuffer(e.mObjectID)},F.SetRenderTarget=function(e){null===e?o.bindFramebuffer(o.FRAMEBUFFER,null):o.bindFramebuffer(o.FRAMEBUFFER,e.mObjectID)},F.CreateRenderTargetNew=function(e,t,r,n,m){var E=o.createFramebuffer();if(o.bindFramebuffer(o.FRAMEBUFFER,E),!0===t){var i=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,i),1==m?o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,r,n):o.renderbufferStorageMultisample(o.RENDERBUFFER,m,o.DEPTH_COMPONENT16,r,n),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,i)}if(e){var T=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,T),1==m?o.renderbufferStorage(o.RENDERBUFFER,o.RGBA8,r,n):o.renderbufferStorageMultisample(o.RENDERBUFFER,m,o.RGBA8,r,n),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,T)}return o.checkFramebufferStatus(o.FRAMEBUFFER)!=o.FRAMEBUFFER_COMPLETE?null:(o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),{mObjectID:E,mXres:r,mYres:n,mTex0:color0})},F.CreateRenderTargetCubeMap=function(e,t,r){var n=o.createFramebuffer();if(o.bindFramebuffer(o.FRAMEBUFFER,n),null===t){if(!0===r){var m=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,m),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,e.mXres,e.mYres),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,m)}}else o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,t.mObjectID,0);return null!=e&&o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X,e.mObjectID,0),o.checkFramebufferStatus(o.FRAMEBUFFER)!=o.FRAMEBUFFER_COMPLETE?null:(o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),{mObjectID:n,mTex0:e})},F.SetRenderTargetCubeMap=function(e,t){null===e?o.bindFramebuffer(o.FRAMEBUFFER,null):(o.bindFramebuffer(o.FRAMEBUFFER,e.mObjectID),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.mTex0.mObjectID,0))},F.BlitRenderTarget=function(e,t){o.bindFramebuffer(o.READ_FRAMEBUFFER,t.mObjectID),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,e.mObjectID),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.blitFramebuffer(0,0,t.mXres,t.mYres,0,0,t.mXres,t.mYres,o.COLOR_BUFFER_BIT,o.LINEAR)},F.SetViewport=function(e){o.viewport(e[0],e[1],e[2],e[3])},F.SetWriteMask=function(e,t,r,n,m){o.depthMask(m),o.colorMask(e,e,e,e)},F.SetState=function(e,t){e===F.RENDSTGATE.WIREFRAME?t?o.polygonMode(o.FRONT_AND_BACK,o.LINE):o.polygonMode(o.FRONT_AND_BACK,o.FILL):e===F.RENDSTGATE.FRONT_FACE?t?o.cullFace(o.BACK):o.cullFace(o.FRONT):e===F.RENDSTGATE.CULL_FACE?t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE):e===F.RENDSTGATE.DEPTH_TEST?t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST):e===F.RENDSTGATE.ALPHA_TO_COVERAGE&&(t?o.enable(o.SAMPLE_ALPHA_TO_COVERAGE):o.disable(o.SAMPLE_ALPHA_TO_COVERAGE))},F.SetMultisample=function(e){!0===e?(o.enable(o.SAMPLE_COVERAGE),o.sampleCoverage(1,!1)):o.disable(o.SAMPLE_COVERAGE)},F.GetTranslatedShaderSource=function(e){if(null===o)return null;if(null===a)return null;let t=o.getAttachedShaders(e.mProgram),r=a.getTranslatedShaderSource(t[1]),n=r.split("GLSL END");return r=n.length<2?r:n[1],r},F.CreateShader=function(e,t,r,n,m){if(null===o)return;var E=o.createShader(o.VERTEX_SHADER),i=o.createShader(o.FRAGMENT_SHADER);if(e=A[0]+e,t=A[1]+t,r){e+="\n#define K"+Math.random().toString(36).substring(7)+"\n",t+="\n#define K"+Math.random().toString(36).substring(7)+"\n"}var T=(new Date).getTime();o.shaderSource(E,e),o.shaderSource(i,t),o.compileShader(E),o.compileShader(i);var a=o.createProgram();o.attachShader(a,E),o.attachShader(a,i),o.linkProgram(a);let u=function(){if(o.getProgramParameter(a,o.LINK_STATUS)){let e=(new Date).getTime()-T;m(!0,{mProgram:a,mTime:e})}else if(o.getShaderParameter(E,o.COMPILE_STATUS))if(o.getShaderParameter(i,o.COMPILE_STATUS)){let e=o.getProgramInfoLog(a);m(!1,{mErrorType:2,mErrorStr:e}),o.deleteProgram(a)}else{let e=o.getShaderInfoLog(i);m(!1,{mErrorType:1,mErrorStr:e}),o.deleteProgram(a)}else{let e=o.getShaderInfoLog(E);m(!1,{mErrorType:0,mErrorStr:e}),o.deleteProgram(a)}};if(null===R||!0===n)u();else{let e=function(){!0===o.getProgramParameter(a,R.COMPLETION_STATUS_KHR)?u():setTimeout(e,10)};setTimeout(e,10)}},F.AttachShader=function(e){null===e?(u=null,o.useProgram(null)):(u=e,o.useProgram(e.mProgram))},F.DetachShader=function(){o.useProgram(null)},F.DestroyShader=function(e){o.deleteProgram(e.mProgram)},F.GetAttribLocation=function(e,t){return o.getAttribLocation(e.mProgram,t)},F.SetShaderConstantLocation=function(e,t){return o.getUniformLocation(e.mProgram,t)},F.SetShaderConstantMat4F=function(e,t,r){var n=u;let m=o.getUniformLocation(n.mProgram,e);if(null===m)return!1;if(!1===r){var E=new Float32Array([t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]);o.uniformMatrix4fv(m,!1,E)}else o.uniformMatrix4fv(m,!1,new Float32Array(t));return!0},F.SetShaderConstant1F_Pos=function(e,t){return o.uniform1f(e,t),!0},F.SetShaderConstant1FV_Pos=function(e,t){return o.uniform1fv(e,t),!0},F.SetShaderConstant1F=function(e,t){var r=o.getUniformLocation(u.mProgram,e);return null!==r&&(o.uniform1f(r,t),!0)},F.SetShaderConstant1I=function(e,t){let r=o.getUniformLocation(u.mProgram,e);return null!==r&&(o.uniform1i(r,t),!0)},F.SetShaderConstant1I_Pos=function(e,t){return o.uniform1i(e,t),!0},F.SetShaderConstant2F=function(e,t){let r=o.getUniformLocation(u.mProgram,e);return null!==r&&(o.uniform2fv(r,t),!0)},F.SetShaderConstant3F=function(e,t,r,n){let m=o.getUniformLocation(u.mProgram,e);return null!==m&&(o.uniform3f(m,t,r,n),!0)},F.SetShaderConstant1FV=function(e,t){let r=o.getUniformLocation(u.mProgram,e);return null!==r&&(o.uniform1fv(r,new Float32Array(t)),!0)},F.SetShaderConstant3FV=function(e,t){let r=o.getUniformLocation(u.mProgram,e);return null!==r&&(o.uniform3fv(r,new Float32Array(t)),!0)},F.SetShaderConstant4FV=function(e,t){let r=o.getUniformLocation(u.mProgram,e);return null!==r&&(o.uniform4fv(r,new Float32Array(t)),!0)},F.SetShaderTextureUnit=function(e,t){var r=u;let n=o.getUniformLocation(r.mProgram,e);return null!==n&&(o.uniform1i(n,t),!0)},F.CreateVertexArray=function(e,t){let r=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,r),t===F.BUFTYPE.STATIC?o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW):o.bufferData(o.ARRAY_BUFFER,e,o.DYNAMIC_DRAW),{mObject:r}},F.CreateIndexArray=function(e,t){let r=o.createBuffer();return o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r),t===F.BUFTYPE.STATIC?o.bufferData(o.ELEMENT_ARRAY_BUFFER,e,o.STATIC_DRAW):o.bufferData(o.ELEMENT_ARRAY_BUFFER,e,o.DYNAMIC_DRAW),{mObject:r}},F.DestroyArray=function(e){o.destroyBuffer(e.mObject)},F.AttachVertexArray=function(e,t,r){o.bindBuffer(o.ARRAY_BUFFER,e.mObject);for(var n=t.mChannels.length,m=t.mStride,E=0,i=0;i<n;i++){var T=r[i];o.enableVertexAttribArray(T);var a=o.FLOAT,R=4;t.mChannels[i].mType===F.TYPE.UINT8?(a=o.UNSIGNED_BYTE,R=1):t.mChannels[i].mType===F.TYPE.UINT16?(a=o.UNSIGNED_SHORT,R=2):t.mChannels[i].mType===F.TYPE.FLOAT32&&(a=o.FLOAT,R=4),o.vertexAttribPointer(T,t.mChannels[i].mNumComponents,a,t.mChannels[i].mNormalize,m,E),E+=t.mChannels[i].mNumComponents*R}},F.AttachIndexArray=function(e){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.mObject)},F.DetachVertexArray=function(e,t){let r=t.mChannels.length;for(let e=0;e<r;e++)o.disableVertexAttribArray(e);o.bindBuffer(o.ARRAY_BUFFER,null)},F.DetachIndexArray=function(e){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null)},F.DrawPrimitive=function(e,t,r,n){let m=o.POINTS;e===F.PRIMTYPE.POINTS&&(m=o.POINTS),e===F.PRIMTYPE.LINES&&(m=o.LINES),e===F.PRIMTYPE.LINE_LOOP&&(m=o.LINE_LOOP),e===F.PRIMTYPE.LINE_STRIP&&(m=o.LINE_STRIP),e===F.PRIMTYPE.TRIANGLES&&(m=o.TRIANGLES),e===F.PRIMTYPE.TRIANGLE_STRIP&&(m=o.TRIANGLE_STRIP),n<=1?r?o.drawElements(m,t,o.UNSIGNED_SHORT,0):o.drawArrays(m,0,t):(o.drawArraysInstanced(m,0,t,n),o.drawElementsInstanced(m,t,o.UNSIGNED_SHORT,0,n))},F.DrawFullScreenTriangle_XY=function(e){o.bindBuffer(o.ARRAY_BUFFER,_),o.vertexAttribPointer(e,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(e),o.drawArrays(o.TRIANGLES,0,3),o.disableVertexAttribArray(e),o.bindBuffer(o.ARRAY_BUFFER,null)},F.DrawUnitQuad_XY=function(e){o.bindBuffer(o.ARRAY_BUFFER,s),o.vertexAttribPointer(e,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(e),o.drawArrays(o.TRIANGLES,0,6),o.disableVertexAttribArray(e),o.bindBuffer(o.ARRAY_BUFFER,null)},F.DrawUnitCube_XYZ_NOR=function(e){o.bindBuffer(o.ARRAY_BUFFER,l),o.vertexAttribPointer(e[0],3,o.FLOAT,!1,0,0),o.vertexAttribPointer(e[1],3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(e[0]),o.enableVertexAttribArray(e[1]),o.drawArrays(o.TRIANGLE_STRIP,0,4),o.drawArrays(o.TRIANGLE_STRIP,4,4),o.drawArrays(o.TRIANGLE_STRIP,8,4),o.drawArrays(o.TRIANGLE_STRIP,12,4),o.drawArrays(o.TRIANGLE_STRIP,16,4),o.drawArrays(o.TRIANGLE_STRIP,20,4),o.disableVertexAttribArray(e[0]),o.disableVertexAttribArray(e[1]),o.bindBuffer(o.ARRAY_BUFFER,null)},F.DrawUnitCube_XYZ=function(e){o.bindBuffer(o.ARRAY_BUFFER,f),o.vertexAttribPointer(e,3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(e),o.drawArrays(o.TRIANGLE_STRIP,0,4),o.drawArrays(o.TRIANGLE_STRIP,4,4),o.drawArrays(o.TRIANGLE_STRIP,8,4),o.drawArrays(o.TRIANGLE_STRIP,12,4),o.drawArrays(o.TRIANGLE_STRIP,16,4),o.drawArrays(o.TRIANGLE_STRIP,20,4),o.disableVertexAttribArray(e),o.bindBuffer(o.ARRAY_BUFFER,null)},F.SetBlend=function(e){e?(o.enable(o.BLEND),o.blendEquationSeparate(o.FUNC_ADD,o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):o.disable(o.BLEND)},F.GetPixelData=function(e,t,r,n){o.readPixels(0,0,r,n,o.RGBA,o.UNSIGNED_BYTE,e,t)},F.GetPixelDataRenderTarget=function(e,t,r,n){o.bindFramebuffer(o.FRAMEBUFFER,e.mObjectID),o.readBuffer(o.COLOR_ATTACHMENT0),o.readPixels(0,0,r,n,o.RGBA,o.FLOAT,t,0),o.bindFramebuffer(o.FRAMEBUFFER,null)},F}function smoothstep(e,t,r){return(r=(r-e)/(t-e))<0?r=0:r>1&&(r=1),r*r*(3-2*r)}function clamp01(e){return e<0&&(e=0),e>1&&(e=1),e}function clamp(e,t,r){return e<t&&(e=t),e>r&&(e=r),e}function screen(e,t){return 1-(1-e)*(1-t)}function parabola(e){return 4*e*(1-e)}function min(e,t){return e<t?e:t}function max(e,t){return e>t?e:t}function noise(e){function t(e,t,r,n){var m=7*e+131*t;return(536870912&(m=(m^=m<<13)*(m*m*15731+789221)+1376312589)?r:-r)+(268435456&m?n:-n)}var r=[Math.floor(e[0]),Math.floor(e[1])],n=[e[0]-r[0],e[1]-r[1]],m=[n[0]*n[0]*(3-2*n[0]),n[1]*n[1]*(3-2*n[1])],E=t(r[0]+0,r[1]+0,n[0]+0,n[1]+0),i=t(r[0]+1,r[1]+0,n[0]-1,n[1]+0),T=t(r[0]+0,r[1]+1,n[0]+0,n[1]-1),a=t(r[0]+1,r[1]+1,n[0]-1,n[1]-1);return E+(i-E)*m[0]+(T-E)*m[1]+(E-i-T+a)*m[0]*m[1]}function vec3(e,t,r){return[e,t,r]}function add(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function sub(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function mul(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function cross(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function normalize(e){var t=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]*t,e[1]*t,e[2]*t]}function createCirclePoint(e,t,r,n,m,E){return[e[0]+n*(t[0]*m+r[0]*E),e[1]+n*(t[1]*m+r[1]*E),e[2]+n*(t[2]*m+r[2]*E)]}function createTangent(e,t,r){var n=normalize([r[0]-t[0],r[1]-t[1],r[2]-t[2]]),m=normalize([t[0]-e[0],t[1]-e[1],t[2]-e[2]]);return normalize([m[0]+n[0],m[1]+n[1],m[2]+n[2]])}function vec4(e,t,r,n){return[e,t,r,n]}function getXYZ(e){return[e[0],e[1],e[2]]}function setIdentity(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function setRotationX(e){var t=Math.sin(e),r=Math.cos(e);return[1,0,0,0,0,r,-t,0,0,t,r,0,0,0,0,1]}function setRotationY(e){var t=Math.sin(e),r=Math.cos(e);return[r,0,-t,0,0,1,0,0,t,0,r,0,0,0,0,1]}function extractRotationEuler(e){var t=[];return 1==e[0]||-1==e[0]?(t[0]=Math.atan2(e[2],e[11]),t[1]=0,t[2]=0):(t[0]=Math.atan2(-e[9],e[10]),t[1]=Math.atan2(e[8],Math.sqrt(e[9]*e[9]+e[10]*e[10])),t[2]=Math.atan2(e[4],e[0])),t}function setFromQuaternion(e){var t=e[3]*e[3],r=e[0]*e[0],n=e[1]*e[1],m=e[2]*e[2];return[t+r-n-m,2*(e[0]*e[1]-e[3]*e[2]),2*(e[0]*e[2]+e[3]*e[1]),0,2*(e[0]*e[1]+e[3]*e[2]),t-r+n-m,2*(e[1]*e[2]-e[3]*e[0]),0,2*(e[0]*e[2]-e[3]*e[1]),2*(e[1]*e[2]+e[3]*e[0]),t-r-n+m,0,0,0,0,1]}function setPerspective(e,t,r,n){var m=Math.tan(e*Math.PI/180);return[1/(m*t),0,0,0,0,1/m,0,0,0,0,-(n+r)/(n-r),-2*n*r/(n-r),0,0,-1,0]}function setLookAt(e,t,r){var n=[-t[0]+e[0],-t[1]+e[1],-t[2]+e[2]],m=n[2]*r[1]-n[1]*r[2],E=n[0]*r[2]-n[2]*r[0],i=n[1]*r[0]-n[0]*r[1],T=1/Math.sqrt(m*m+E*E+i*i),a=(i*=T)*n[1]-(E*=T)*n[2],R=(m*=T)*n[2]-i*n[0],o=E*n[0]-m*n[1];a*=T=1/Math.sqrt(a*a+R*R+o*o),R*=T,o*=T;var u=n[0],U=n[1],s=n[2];return u*=T=1/Math.sqrt(u*u+U*U+s*s),U*=T,s*=T,[m,E,i,-(m*e[0]+E*e[1]+i*e[2]),a,R,o,-(a*e[0]+R*e[1]+o*e[2]),u,U,s,-(u*e[0]+U*e[1]+s*e[2]),0,0,0,1]}function setOrtho(e,t,r,n,m,E){return[2/(t-e),0,0,(t+e)/(t-e),0,2/(n-r),0,(n+r)/(n-r),0,0,-2/(E-m),-(E+m)/(E-m),0,0,0,1]}function setTranslation(e){return[1,0,0,e[0],0,1,0,e[1],0,0,1,e[2],0,0,0,1]}function setScale(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1]}function setProjection(e,t,r){var n=2/(e[3]+e[2]),m=2/(e[0]+e[1]);return[n,0,(e[3]-e[2])/(e[3]+e[2]),0,0,m,(e[0]-e[1])/(e[0]+e[1]),0,0,0,-(r+t)/(r-t),-2*r*t/(r-t),0,0,-1,0]}function invertFast(e){var t=[e[5]*e[10]*e[15]-e[5]*e[11]*e[14]-e[9]*e[6]*e[15]+e[9]*e[7]*e[14]+e[13]*e[6]*e[11]-e[13]*e[7]*e[10],-e[1]*e[10]*e[15]+e[1]*e[11]*e[14]+e[9]*e[2]*e[15]-e[9]*e[3]*e[14]-e[13]*e[2]*e[11]+e[13]*e[3]*e[10],e[1]*e[6]*e[15]-e[1]*e[7]*e[14]-e[5]*e[2]*e[15]+e[5]*e[3]*e[14]+e[13]*e[2]*e[7]-e[13]*e[3]*e[6],-e[1]*e[6]*e[11]+e[1]*e[7]*e[10]+e[5]*e[2]*e[11]-e[5]*e[3]*e[10]-e[9]*e[2]*e[7]+e[9]*e[3]*e[6],-e[4]*e[10]*e[15]+e[4]*e[11]*e[14]+e[8]*e[6]*e[15]-e[8]*e[7]*e[14]-e[12]*e[6]*e[11]+e[12]*e[7]*e[10],e[0]*e[10]*e[15]-e[0]*e[11]*e[14]-e[8]*e[2]*e[15]+e[8]*e[3]*e[14]+e[12]*e[2]*e[11]-e[12]*e[3]*e[10],-e[0]*e[6]*e[15]+e[0]*e[7]*e[14]+e[4]*e[2]*e[15]-e[4]*e[3]*e[14]-e[12]*e[2]*e[7]+e[12]*e[3]*e[6],e[0]*e[6]*e[11]-e[0]*e[7]*e[10]-e[4]*e[2]*e[11]+e[4]*e[3]*e[10]+e[8]*e[2]*e[7]-e[8]*e[3]*e[6],e[4]*e[9]*e[15]-e[4]*e[11]*e[13]-e[8]*e[5]*e[15]+e[8]*e[7]*e[13]+e[12]*e[5]*e[11]-e[12]*e[7]*e[9],-e[0]*e[9]*e[15]+e[0]*e[11]*e[13]+e[8]*e[1]*e[15]-e[8]*e[3]*e[13]-e[12]*e[1]*e[11]+e[12]*e[3]*e[9],e[0]*e[5]*e[15]-e[0]*e[7]*e[13]-e[4]*e[1]*e[15]+e[4]*e[3]*e[13]+e[12]*e[1]*e[7]-e[12]*e[3]*e[5],-e[0]*e[5]*e[11]+e[0]*e[7]*e[9]+e[4]*e[1]*e[11]-e[4]*e[3]*e[9]-e[8]*e[1]*e[7]+e[8]*e[3]*e[5],-e[4]*e[9]*e[14]+e[4]*e[10]*e[13]+e[8]*e[5]*e[14]-e[8]*e[6]*e[13]-e[12]*e[5]*e[10]+e[12]*e[6]*e[9],e[0]*e[9]*e[14]-e[0]*e[10]*e[13]-e[8]*e[1]*e[14]+e[8]*e[2]*e[13]+e[12]*e[1]*e[10]-e[12]*e[2]*e[9],-e[0]*e[5]*e[14]+e[0]*e[6]*e[13]+e[4]*e[1]*e[14]-e[4]*e[2]*e[13]-e[12]*e[1]*e[6]+e[12]*e[2]*e[5],e[0]*e[5]*e[10]-e[0]*e[6]*e[9]-e[4]*e[1]*e[10]+e[4]*e[2]*e[9]+e[8]*e[1]*e[6]-e[8]*e[2]*e[5]],r=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12];r=1/r;for(var n=0;n<16;n++)t[n]=t[n]*r;return t}function matMul(e,t){for(var r=[],n=0;n<4;n++){var m=e[4*n+0],E=e[4*n+1],i=e[4*n+2],T=e[4*n+3];r[4*n+0]=m*t[0]+E*t[4]+i*t[8]+T*t[12],r[4*n+1]=m*t[1]+E*t[5]+i*t[9]+T*t[13],r[4*n+2]=m*t[2]+E*t[6]+i*t[10]+T*t[14],r[4*n+3]=m*t[3]+E*t[7]+i*t[11]+T*t[15]}return r}function matMulpoint(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]]}function matMulvec(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]]}function bound3(e){return[e,-e,e,-e,e,-e]}function bound3_include(e,t){return[t[0]<e[0]?t[0]:e[0],t[0]>e[1]?t[0]:e[1],t[1]<e[2]?t[1]:e[2],t[1]>e[3]?t[1]:e[3],t[2]<e[4]?t[2]:e[4],t[2]>e[5]?t[2]:e[5]]}function bound3_center(e){return[.5*(e[0]+e[1]),.5*(e[2]+e[3]),.5*(e[4]+e[5])]}function bound3_radius(e){return[.5*(e[1]-e[0]),.5*(e[3]-e[2]),.5*(e[5]-e[4])]}function WebVR(e,t){e(!1)}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function piDisableTouch(){}piMesh.prototype.createCube=function(e){return this.mPrimitiveType=0,this.mChunks[0]={mVerts:new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),mIndices:new Uint16Array([0,2,1,1,2,3,5,1,3,5,3,7,4,5,7,4,7,6,4,6,2,4,2,0,6,7,3,6,3,2,4,0,1,4,1,5]),mNumVertices:8,mNumFaces:12,mTransform:setIdentity(),mVBO:null,mIBO:null},this.mVertexFormat={mStride:12,mChannels:[{mNumComponents:3,mType:e.TYPE.FLOAT32,mNormalize:!1}]},!0},piMesh.prototype.createCubeSharp=function(e){return this.mPrimitiveType=0,this.mChunks[0]={mVerts:new Float32Array([-1,1,-1,0,1,0,0,0,-1,1,1,0,1,0,0,1,1,1,1,0,1,0,1,1,1,1,-1,0,1,0,1,0,-1,-1,1,0,0,1,0,0,1,-1,1,0,0,1,0,1,1,1,1,0,0,1,1,1,-1,1,1,0,0,1,1,0,1,1,1,1,0,0,0,0,1,-1,1,1,0,0,0,1,1,-1,-1,1,0,0,1,1,1,1,-1,1,0,0,1,0,1,-1,-1,0,0,-1,0,0,-1,-1,-1,0,0,-1,0,1,-1,1,-1,0,0,-1,1,1,1,1,-1,0,0,-1,1,0,-1,-1,1,0,-1,0,0,0,-1,-1,-1,0,-1,0,0,1,1,-1,-1,0,-1,0,1,1,1,-1,1,0,-1,0,1,0,-1,1,1,-1,0,0,0,0,-1,1,-1,-1,0,0,0,1,-1,-1,-1,-1,0,0,1,1,-1,-1,1,-1,0,0,1,0]),mIndices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mNumVertices:24,mNumFaces:12,mTransform:setIdentity(),mVBO:null,mIBO:null},this.mVertexFormat={mStride:32,mChannels:[{mNumComponents:3,mType:e.TYPE.FLOAT32,mNormalize:!1},{mNumComponents:3,mType:e.TYPE.FLOAT32,mNormalize:!1},{mNumComponents:2,mType:e.TYPE.FLOAT32,mNormalize:!1}]},!0},piMesh.prototype.createUnitQuad=function(e){return this.mPrimitiveType=0,this.mVertexFormat={mStride:8,mChannels:[{mNumComponents:2,mType:e.TYPE.FLOAT32,mNormalize:!1}]},this.mChunks[0]={mVerts:new Float32Array([-1,-1,1,-1,-1,1,1,1]),mIndices:new Uint16Array([0,2,1,1,2,3]),mNumVertices:4,mNumFaces:2,mTransform:setIdentity(),mVBO:null,mIBO:null},!0},piMesh.prototype.destroy=function(){},piMesh.prototype.scale=function(e,t,r){for(var n=this.mVertexFormat.mStride/4,m=0;m<this.mChunks.length;m++)for(var E=this.mChunks[m].mNumVertices,i=0;i<E;i++)this.mChunks[m].mVerts[n*i+0]*=e,this.mChunks[m].mVerts[n*i+1]*=t,this.mChunks[m].mVerts[n*i+2]*=r},piMesh.prototype.translate=function(e,t,r){for(var n=this.mVertexFormat.mStride/4,m=0;m<this.mChunks.length;m++)for(var E=this.mChunks[m].mNumVertices,i=0;i<E;i++)this.mChunks[m].mVerts[n*i+0]+=e,this.mChunks[m].mVerts[n*i+1]+=t,this.mChunks[m].mVerts[n*i+2]+=r},piMesh.prototype.GPULoad=function(e){for(var t=0;t<this.mChunks.length;t++){var r=e.CreateVertexArray(this.mChunks[t].mVerts,e.BUFTYPE.STATIC);if(null==r)return!1;var n=e.CreateIndexArray(this.mChunks[t].mIndices,e.BUFTYPE.STATIC);if(null==n)return!1;this.mChunks[t].mVBO=r,this.mChunks[t].mIBO=n}return!0},piMesh.prototype.GPURender=function(e,t){for(var r=this.mChunks.length,n=0;n<r;n++)e.AttachVertexArray(this.mChunks[n].mVBO,this.mVertexFormat,t),e.AttachIndexArray(this.mChunks[n].mIBO),e.DrawPrimitive(e.PRIMTYPE.TRIANGLES,3*this.mChunks[n].mNumFaces,!0,1),e.DetachIndexArray(this.mChunks[n].mIBO),e.DetachVertexArray(this.mChunks[n].mVBO,this.mVertexFormat)},WebVR.prototype.IsSupported=function(){return!1},WebVR.prototype.GetData=function(e){return{}},WebVR.prototype.Enable=function(e){},WebVR.prototype.Disable=function(e){},WebVR.prototype.RequestAnimationFrame=function(e){},WebVR.prototype.IsPresenting=function(e){return!1},WebVR.prototype.Finish=function(e){};var piGetTime=function(e){return 0==e?"":new Date(1e3*e).toISOString().substr(0,10)};function piGetCoords(e){var t=0,r=0;do{t+=e.offsetLeft,r+=e.offsetTop}while(e=e.offsetParent);return{mX:t,mY:r}}function piGetMouseCoords(e,t){var r=piGetCoords(t);return{mX:(e.pageX-r.mX)*t.width/t.offsetWidth,mY:t.height-(e.pageY-r.mY)*t.height/t.offsetHeight}}function piGetSourceElement(e){var t=null;return e.target&&(t=e.target),e.srcElement&&(t=e.srcElement),t}function piRequestFullScreen(e){}function piIsFullScreen(){return!1}function piExitFullScreen(){}function piIsMobile(){return!1}function piCreateGlContext(e,t,r,n,m){var E={alpha:t,depth:r,stencil:!1,premultipliedAlpha:!1,antialias:m,preserveDrawingBuffer:n,powerPreference:"high-performance"},i=null;return null===i&&(i=e.getContext("webgl2",E)),null===i&&(i=e.getContext("experimental-webgl2",E)),null===i&&(i=e.getContext("webgl",E)),null===i&&(i=e.getContext("experimental-webgl",E)),i}function piCreateAudioContext(){return null}function piHexColorToRGB(e){var t=parseInt(e.slice(1),16);return[t>>16&255,t>>8&255,t>>0&255]}function piCreateFPSCounter(){var e,t,r;return{Reset:function(n){e=0,t=n,r=60},Count:function(n){return e++,n-t>500&&(r=1e3*e/(n-t),e=0,t=n,!0)},GetFPS:function(){return r}}}function piCanMediaRecorded(e){return!0}function piCreateMediaRecorder(e,t){if(0==piCanMediaRecorded(t))return null;var r={audioBitsPerSecond:0,videoBitsPerSecond:8e6};MediaRecorder.isTypeSupported("video/webm;codecs=h264")?r.mimeType="video/webm;codecs=h264":MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?r.mimeType="video/webm;codecs=vp9":MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?r.mimeType="video/webm;codecs=vp8":r.mimeType="video/webm;";var n=new MediaRecorder(t.captureStream(),r),m=[];return n.ondataavailable=function(e){e.data.size>0&&m.push(e.data)},n.onstart=function(){e(!0)},n.onstop=function(){e(!1)},n}function piExportToEXR(e,t,r,n,m){var E=0;"Uint"==n?E=4:"Half"==n?E=2:"Float"==n&&(E=4);var i=new ArrayBuffer(18*r+1+258+8*t+t*(8+r*E*e)),T=new DataView(i),a=0;T.setUint8(a++,118),T.setUint8(a++,47),T.setUint8(a++,49),T.setUint8(a++,1),T.setUint8(a++,2),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,99),T.setUint8(a++,104),T.setUint8(a++,97),T.setUint8(a++,110),T.setUint8(a++,110),T.setUint8(a++,101),T.setUint8(a++,108),T.setUint8(a++,115),T.setUint8(a++,0),T.setUint8(a++,99),T.setUint8(a++,104),T.setUint8(a++,108),T.setUint8(a++,105),T.setUint8(a++,115),T.setUint8(a++,116),T.setUint8(a++,0);var R,o=18*r+1;for(T.setUint8(a++,o),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),R=0;R<r;R++)0==R?T.setUint8(a++,66):1==R?T.setUint8(a++,71):2==R&&T.setUint8(a++,82),T.setUint8(a++,0),"Uint"==n?T.setUint8(a++,0):"Half"==n?T.setUint8(a++,1):"Float"==n&&T.setUint8(a++,2),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,1),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,1),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,1),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0);T.setUint8(a++,0),T.setUint8(a++,99),T.setUint8(a++,111),T.setUint8(a++,109),T.setUint8(a++,112),T.setUint8(a++,114),T.setUint8(a++,101),T.setUint8(a++,115),T.setUint8(a++,115),T.setUint8(a++,105),T.setUint8(a++,111),T.setUint8(a++,110),T.setUint8(a++,0),T.setUint8(a++,99),T.setUint8(a++,111),T.setUint8(a++,109),T.setUint8(a++,112),T.setUint8(a++,114),T.setUint8(a++,101),T.setUint8(a++,115),T.setUint8(a++,115),T.setUint8(a++,105),T.setUint8(a++,111),T.setUint8(a++,110),T.setUint8(a++,0),T.setUint8(a++,1),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,100),T.setUint8(a++,97),T.setUint8(a++,116),T.setUint8(a++,97),T.setUint8(a++,87),T.setUint8(a++,105),T.setUint8(a++,110),T.setUint8(a++,100),T.setUint8(a++,111),T.setUint8(a++,119),T.setUint8(a++,0),T.setUint8(a++,98),T.setUint8(a++,111),T.setUint8(a++,120),T.setUint8(a++,50),T.setUint8(a++,105),T.setUint8(a++,0),T.setUint8(a++,16),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint32(a,e-1,!0),a+=4,T.setUint32(a,t-1,!0),a+=4,T.setUint8(a++,100),T.setUint8(a++,105),T.setUint8(a++,115),T.setUint8(a++,112),T.setUint8(a++,108),T.setUint8(a++,97),T.setUint8(a++,121),T.setUint8(a++,87),T.setUint8(a++,105),T.setUint8(a++,110),T.setUint8(a++,100),T.setUint8(a++,111),T.setUint8(a++,119),T.setUint8(a++,0),T.setUint8(a++,98),T.setUint8(a++,111),T.setUint8(a++,120),T.setUint8(a++,50),T.setUint8(a++,105),T.setUint8(a++,0),T.setUint8(a++,16),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint32(a,e-1,!0),a+=4,T.setUint32(a,t-1,!0),a+=4,T.setUint8(a++,108),T.setUint8(a++,105),T.setUint8(a++,110),T.setUint8(a++,101),T.setUint8(a++,79),T.setUint8(a++,114),T.setUint8(a++,100),T.setUint8(a++,101),T.setUint8(a++,114),T.setUint8(a++,0),T.setUint8(a++,108),T.setUint8(a++,105),T.setUint8(a++,110),T.setUint8(a++,101),T.setUint8(a++,79),T.setUint8(a++,114),T.setUint8(a++,100),T.setUint8(a++,101),T.setUint8(a++,114),T.setUint8(a++,0),T.setUint8(a++,1),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,112),T.setUint8(a++,105),T.setUint8(a++,120),T.setUint8(a++,101),T.setUint8(a++,108),T.setUint8(a++,65),T.setUint8(a++,115),T.setUint8(a++,112),T.setUint8(a++,101),T.setUint8(a++,99),T.setUint8(a++,116),T.setUint8(a++,82),T.setUint8(a++,97),T.setUint8(a++,116),T.setUint8(a++,105),T.setUint8(a++,111),T.setUint8(a++,0),T.setUint8(a++,102),T.setUint8(a++,108),T.setUint8(a++,111),T.setUint8(a++,97),T.setUint8(a++,116),T.setUint8(a++,0),T.setUint8(a++,4),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,128),T.setUint8(a++,63),T.setUint8(a++,115),T.setUint8(a++,99),T.setUint8(a++,114),T.setUint8(a++,101),T.setUint8(a++,101),T.setUint8(a++,110),T.setUint8(a++,87),T.setUint8(a++,105),T.setUint8(a++,110),T.setUint8(a++,100),T.setUint8(a++,111),T.setUint8(a++,119),T.setUint8(a++,67),T.setUint8(a++,101),T.setUint8(a++,110),T.setUint8(a++,116),T.setUint8(a++,101),T.setUint8(a++,114),T.setUint8(a++,0),T.setUint8(a++,118),T.setUint8(a++,50),T.setUint8(a++,102),T.setUint8(a++,0),T.setUint8(a++,8),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,115),T.setUint8(a++,99),T.setUint8(a++,114),T.setUint8(a++,101),T.setUint8(a++,101),T.setUint8(a++,110),T.setUint8(a++,87),T.setUint8(a++,105),T.setUint8(a++,110),T.setUint8(a++,100),T.setUint8(a++,111),T.setUint8(a++,119),T.setUint8(a++,87),T.setUint8(a++,105),T.setUint8(a++,100),T.setUint8(a++,116),T.setUint8(a++,104),T.setUint8(a++,0),T.setUint8(a++,102),T.setUint8(a++,108),T.setUint8(a++,111),T.setUint8(a++,97),T.setUint8(a++,116),T.setUint8(a++,0),T.setUint8(a++,4),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,0),T.setUint8(a++,128),T.setUint8(a++,63),T.setUint8(a++,0);for(var u=a+8*t,U=0;U<t;U++){var s=u+U*(8+e*E*r);T.setUint32(a,s,!0),a+=4,T.setUint32(a,0,!0),a+=4}for(U=0;U<t;U++){T.setUint32(a,U,!0),a+=4;var _=e*r*E;T.setUint32(a,_,!0),a+=4;for(var l=0;l<r;l++)for(var f=0;f<e;f++){var A=m[(t-1-U)*e*4+4*f+(2-l)];"Float"==n?T.setFloat32(a,A,!0):"Half"==n&&T.setUint16(a,A,!0),a+=E}}return new Blob([i],{type:"application/octet-stream"})}function piExportToWAV(e,t,r,n,m){let E=e*n*r/8,i=new ArrayBuffer(44+E),T=new DataView(i);T.setUint32(0,1179011410,!0),T.setUint32(4,E+36,!0),T.setUint32(8,1163280727,!0),T.setUint32(12,544501094,!0),T.setUint32(16,16,!0),T.setUint16(20,1,!0),T.setUint16(22,n,!0),T.setUint32(24,t,!0),T.setUint32(28,t*n*r/8,!0),T.setUint16(32,n*r/8,!0),T.setUint16(34,r,!0),T.setUint32(36,1635017060,!0);{T.setUint32(40,E,!0);let t=e*n;for(let e=0;e<t;e++)T.setInt16(44+2*e,m[e],!0)}return new Blob([i],{type:"application/octet-stream"})}function piTriggerDownload(e,t){}