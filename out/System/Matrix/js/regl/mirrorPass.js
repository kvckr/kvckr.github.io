import{loadImage,loadText,makePassFBO,makePass}from"./utils.js";let start;const numClicks=5,clicks=Array(5).fill([0,0,-1/0]).flat();let aspectRatio=1,index=0;window.onclick=e=>{clicks[3*index+0]=0+e.clientX/e.srcElement.clientWidth,clicks[3*index+1]=1-e.clientY/e.srcElement.clientHeight,clicks[3*index+2]=(Date.now()-start)/1e3,index=(index+1)%5};export default({regl:e,config:a,cameraTex:t,cameraAspectRatio:s},i)=>{const l=makePassFBO(e,a.useHalfFloat),c=loadText("shaders/glsl/mirrorPass.frag.glsl"),r=e({frag:e.prop("frag"),uniforms:{time:e.context("time"),tex:i.primary,bloomTex:i.bloom,cameraTex:t,clicks:()=>clicks,aspectRatio:()=>aspectRatio,cameraAspectRatio:s},framebuffer:l});return start=Date.now(),makePass({primary:l},Promise.all([c.loaded]),((e,a)=>{l.resize(e,a),aspectRatio=e/a}),(()=>r({frag:c.text()})))};