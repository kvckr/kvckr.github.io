(e=>{let t;window.show_imgur_uploader=function(e){t&&t.close(),t=$DialogWindow().title("Upload To Imgur").addClass("horizontal-buttons");const a=$(E("div")).appendTo(t.$main).addClass("inset-deep"),o=$(E("div")).appendTo(t.$main),n=$(E("div")).appendTo(t.$main),s=$(E("img")).appendTo(a).css({display:"block"}),d=URL.createObjectURL(e);s.attr({src:d}),a.css({maxWidth:"90vw",maxHeight:"70vh",overflow:"auto",marginBottom:"0.5em"}),s.on("load",(()=>{t.css({width:"auto"}),t.center()})),t.on("close",(()=>{URL.revokeObjectURL(d)}));const i=t.$Button("Upload",(()=>{URL.revokeObjectURL(d),a.remove(),i.remove(),r.remove(),t.$content.width(300),t.center();const s=$(E("progress")).appendTo(t.$main).addClass("inset-deep"),l=$(E("span")).appendTo(t.$main).css({width:"2.3em",display:"inline-block",textAlign:"center"}),c=e=>{try{return JSON.parse(e)}catch(a){n.text("Received an invalid JSON response from Imgur: "),$(E("pre")).appendTo(n).text(e).css({background:"white",color:"#333",fontFamily:"monospace",width:"500px",overflow:"auto"}),$(E("pre")).appendTo(n).text(a.toString()).css({background:"white",color:"#333",fontFamily:"monospace",width:"500px",overflow:"auto"}),t.css({width:"auto"}),t.center()}},p=new XMLHttpRequest;p.upload&&p.upload.addEventListener("progress",(e=>{if(e.lengthComputable){const t=e.loaded/e.total,a=`${Math.floor(100*t)}%`;s.val(t),l.text(a)}}),!1),p.addEventListener("readystatechange",(()=>{if(4==p.readyState&&200==p.status){s.add(l).remove();const e=c(p.responseText);if(!e)return;if(!e.success)return void n.text("Failed to upload image :(");const a=e.data.link;n.text("");const d=$(E("a")).attr({id:"imgur-url",target:"_blank"});let i;d.text(a),d.attr("href",a),o.append("<label>URL: </label>").append(d);const r=t.$Button("Delete",(()=>{const t=new XMLHttpRequest;r[0].disabled=!0,t.addEventListener("readystatechange",(()=>{if(4==t.readyState&&200==t.status){r.remove(),i.focus();const e=c(t.responseText);if(!e)return;e.success?(o.remove(),n.text("Deleted successfully")):n.text("Failed to delete image :(")}else 4==t.readyState&&(n.text("Error deleting image :("),r[0].disabled=!1,r.focus())})),t.open("DELETE",`https://api.imgur.com/3/image/${e.data.deletehash}`,!0),t.setRequestHeader("Authorization","Client-ID 203da2f300125a1"),t.setRequestHeader("Accept","application/json"),t.send(null),n.text("Deleting...")}));i=t.$Button(localize("OK"),(()=>{t.close()})).focus()}else 4==p.readyState&&(s.add(l).remove(),n.text("Error uploading image :("))})),p.open("POST","https://api.imgur.com/3/image",!0);const u=new FormData;u.append("image",e),p.setRequestHeader("Authorization","Client-ID 203da2f300125a1"),p.setRequestHeader("Accept","application/json"),p.send(u),n.text("Uploading...")})).focus(),r=t.$Button(localize("Cancel"),(()=>{t.close()}));t.$content.css({width:"min(1000px, 80vw)"}),t.center()}})();