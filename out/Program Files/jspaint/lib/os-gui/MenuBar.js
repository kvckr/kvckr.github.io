(e=>{function t(e,t){const n=document.createElement(e);if(t)for(const e in t)"class"===e?n.className=t[e]:n.setAttribute(e,t[e]);return n}let n=0;function i(){return(n++).toString(36)+Math.random().toString(36).slice(2)}function s(e){return e.replace(/([^&]|^)&([^&\s])/,"$1<span class='menu-hotkey'>$2</span>").replace(/&&/g,"&")}const o="MENU_DIVIDER",l=1e3;let a=1;function r(){return"undefined"!=typeof $Window?$Window.Z_INDEX+++l:++a+l}e.MenuBar=function e(n){if(!(this instanceof e))return new e(n);const l=t("div",{class:"menus",role:"menubar","aria-label":"Application Menu"});function a(){return window.get_direction?window.get_direction():getComputedStyle(l).direction}l.style.touchAction="none";let d=!1;const u=[];let c,p=-1;const h=new WeakMap,m=new WeakMap,f=new WeakMap,b=()=>{for(const{menu_button_el:e}of u)"true"===e.getAttribute("aria-expanded")&&e.dispatchEvent(new CustomEvent("release"),{})},v=()=>{const e=l.closest(".window");e&&e.dispatchEvent(new CustomEvent("refocus-window"))},w=e=>{const t="string"==typeof e?Object.keys(n).indexOf(e):e;-1!==p&&p!==t&&u[p].menu_button_el.classList.remove("highlight"),-1!==t&&u[t].menu_button_el.classList.add("highlight"),p=t};l.addEventListener("pointerleave",(()=>{-1!==p&&"none"===u[p].menu_popup_el.style.display&&w(-1)}));const y=e=>"function"==typeof e.enabled?!e.enabled():"boolean"==typeof e.enabled&&!e.enabled;function g(e){const t=e?.description||"";if(window.jQuery){const e=new window.jQuery.Event("info",{detail:{description:t}}),n={toString:()=>(console.warn("jQuery extra parameter for info event is deprecated, use event.detail instead"),t)};window.jQuery(l).trigger(e,n)}else l.dispatchEvent(new CustomEvent("info",{detail:{description:t}}))}function E(e){if(e.defaultPrevented)return;const t=c?.element,n=u[p],{menu_button_el:i,open_top_level_menu:s}=n||{},o=t||n?.menu_popup_el,r=f.get(t),d=o?.querySelector(".menu-item.highlight");switch(e.key){case"ArrowLeft":case"ArrowRight":const t="ArrowRight"===e.key;if(d?.matches(".has-submenu:not([aria-disabled='true'])")&&"ltr"===a()===t)d.click(),e.preventDefault();else if(c&&c.parentMenuPopup&&"ltr"===a()!==t)c.close(!0),r.setAttribute("aria-expanded","false"),g(c.menuItems[c.itemElements.indexOf(r)]),e.preventDefault();else if(d||!c||!c.parentMenuPopup){const n=o&&"none"!==o.style.display,s="ltr"===a()===t?1:-1;let l;l=-1===p?1===s?0:u.length-1:(p+s+u.length)%u.length;const r=u[l],d=r.menu_button_el;n?r.open_top_level_menu("keydown"):(i?.dispatchEvent(new CustomEvent("release"),{}),d.focus({preventScroll:!0}),w(l)),e.preventDefault()}break;case"ArrowUp":case"ArrowDown":const n="ArrowDown"===e.key;if(c){const t=n?1:-1,i=[...o.querySelectorAll(".menu-item")],s=i.indexOf(d);let l=(s+t+i.length)%i.length;-1===s&&(l=n?0:i.length-1);const a=i[l];c.highlight(a),g(c.menuItems[c.itemElements.indexOf(a)]),e.preventDefault()}else s?.("keydown");e.preventDefault();break;case"Escape":if(c)r&&r!==i?(c.close(!0),r.setAttribute("aria-expanded","false"),g(c.menuItems[c.itemElements.indexOf(r)])):(b(),i.focus({preventScroll:!0})),e.preventDefault();else{const t=l.closest(".window");t&&(t.dispatchEvent(new CustomEvent("refocus-window")),e.preventDefault())}break;case"Alt":b(),v(),e.preventDefault();break;case"Space":break;case"Enter":i===document.activeElement?(s("keydown"),e.preventDefault()):(d?.click(),e.preventDefault());break;default:if(e.ctrlKey||e.metaKey)break;const h=e.key.toLowerCase(),m=c?[...o.querySelectorAll(".menu-item")]:u.map((e=>e.menu_button_el)),f={};for(const e of m){const t=e.querySelector(".menu-hotkey"),n=(t?t.textContent:(e.querySelector(".menu-item-label")??e).textContent[0]).toLowerCase();f[n]=f[n]||[],f[n].push(e)}const y=f[h]||[];if(y.length)if(1===y.length){const t=y[0],n=u.find((e=>e.menu_button_el===t));n?n.open_top_level_menu("keydown"):t.click(),e.preventDefault()}else{let t=y.indexOf(d);t=-1===t?0:(t+1)%y.length;const n=y[t];c.highlight(n),e.preventDefault()}}}function k(e,{parentMenuPopup:n}={}){this.parentMenuPopup=n,this.menuItems=e,this.itemElements=[];const l=t("div",{class:"menu-popup",id:`menu-popup-${i()}`,tabIndex:"-1",role:"menu"});l.style.touchAction="pan-y",l.style.outline="none";const d=t("table",{class:"menu-popup-table",role:"presentation"});l.appendChild(d),this.element=l,h.set(l,this);let u,p=[];l.addEventListener("keydown",E),l.addEventListener("pointerleave",(()=>{for(const e of p)if("none"!==e.submenu_popup_el.style.display)return void this.highlight(e.item_el);this.highlight(-1)})),l.addEventListener("focusin",(e=>{l.focus({preventScroll:!0})})),this.highlight=e=>{let t=e;"number"==typeof e&&(t=this.itemElements[e]),u&&u!==t&&u.classList.remove("highlight"),t?(t.classList.add("highlight"),l.setAttribute("aria-activedescendant",t.id),u=t):(l.removeAttribute("aria-activedescendant"),u=null)},this.close=(e=!0)=>{for(const e of p)e.submenu_popup.close(!1);e&&this.parentMenuPopup?.element.focus({preventScroll:!0}),l.style.display="none",this.highlight(-1),c===this&&(c=this.parentMenuPopup)};const w=(e,n,d)=>{const u=t("tr",{class:"menu-row"});if(this.itemElements.push(u),e.appendChild(u),n===o){const w=t("td",{colspan:4}),E=t("hr",{class:"menu-hr"});w.appendChild(E),u.appendChild(w),E.addEventListener("pointerenter",(()=>{this.highlight(-1)}))}else{const _=u;_.classList.add("menu-item"),_.id=`menu-item-${i()}`,_.tabIndex=-1,_.setAttribute("role",n.checkbox?"radio"===n.checkbox.type?"menuitemradio":"menuitemcheckbox":"menuitem"),_.setAttribute("aria-label",(n.label||n.item).replace(/\s?\(&.\)/,"").replace(/([^&]|^)&([^&\s])/,"$1$2")),_.setAttribute("aria-keyshortcuts",n.ariaKeyShortcuts||n.shortcut||n.shortcutLabel),n.description&&_.setAttribute("aria-description",n.description);const L=t("td",{class:"menu-item-checkbox-area"}),x=t("td",{class:"menu-item-label"}),A=t("td",{class:"menu-item-shortcut"}),C=t("td",{class:"menu-item-submenu-area"});let M,D;if(_.appendChild(L),_.appendChild(x),_.appendChild(A),_.appendChild(C),x.innerHTML=s(n.label||n.item),A.textContent=n.shortcut,l.addEventListener("update",(()=>{if(y(n)?(_.setAttribute("disabled",""),_.setAttribute("aria-disabled","true")):(_.removeAttribute("disabled"),_.removeAttribute("aria-disabled")),n.checkbox&&n.checkbox.check){const e=n.checkbox.check();_.setAttribute("aria-checked",e?"true":"false")}})),_.addEventListener("pointerenter",(()=>{this.highlight(d),g(n)})),_.addEventListener("pointerleave",(e=>{"none"!==l.style.display&&"touch"!==e.pointerType&&g()})),"radio"===n.checkbox?.type?L.classList.add("radio"):n.checkbox&&L.classList.add("checkbox"),n.submenu){_.classList.add("has-submenu"),C.classList.toggle("point-right","rtl"===a());const I=new k(n.submenu,{parentMenuPopup:this});function h(){for(const{submenu_popup:e,item_el:t}of p)e.close(!1),t.setAttribute("aria-expanded","false");l.focus({preventScroll:!0})}let S,K;D=I.element,document.body?.appendChild(D),D.style.display="none",_.setAttribute("aria-haspopup","true"),_.setAttribute("aria-expanded","false"),_.setAttribute("aria-controls",D.id),m.set(_,I),f.set(D,_),D.dataset.semanticParent=l.id,l.setAttribute("aria-owns",`${l.getAttribute("aria-owns")||""} ${D.id}`),D.setAttribute("aria-labelledby",_.id),M=(e=!0)=>{if("none"!==D.style.display)return;if("true"===_.getAttribute("aria-disabled"))return;h(),_.setAttribute("aria-expanded","true"),D.style.display="",D.style.zIndex=r(),D.setAttribute("dir",a()),window.inheritTheme&&window.inheritTheme(D,l),D.parentElement||document.body.appendChild(D),D.dispatchEvent(new CustomEvent("update"),{}),e?(I.highlight(0),g(I.menuItems[0])):I.highlight(-1);const t=_.getBoundingClientRect();let n=D.getBoundingClientRect();D.style.position="absolute",D.style.left=`${("rtl"===a()?t.left-n.width:t.right)+window.scrollX}px`,D.style.top=`${t.top+window.scrollY}px`,n=D.getBoundingClientRect(),"rtl"===a()?n.left<0&&(D.style.left=`${t.right}px`,n=D.getBoundingClientRect(),n.right>innerWidth&&(D.style.left=innerWidth-n.width+"px")):n.right>innerWidth&&(D.style.left=t.left-n.width+"px",n=D.getBoundingClientRect(),n.left<0&&(D.style.left="0")),D.focus({preventScroll:!0}),c=I},p.push({item_el:_,submenu_popup_el:D,submenu_popup:I}),D.addEventListener("pointerenter",(()=>{S&&(clearTimeout(S),S=null),K&&(clearTimeout(K),K=null)})),_.addEventListener("pointerenter",(()=>{S&&(clearTimeout(S),S=null),K&&(clearTimeout(K),K=null),S=setTimeout((()=>{M(!1)}),501)})),_.addEventListener("pointerleave",(()=>{S&&(clearTimeout(S),S=null)})),l.addEventListener("pointerenter",(e=>{e.target.closest(".menu-item")!==_&&(K||"none"!==D.style.display&&(K=setTimeout((()=>{window.debugKeepMenusOpen||h()}),500)))})),l.addEventListener("pointerleave",(()=>{K&&(clearTimeout(K),K=null)})),_.addEventListener("pointerdown",(()=>{M(!1)}))}let T=!1;const $=()=>{T||(T=!0,setTimeout((()=>{T=!1}),10),n.checkbox?(n.checkbox.toggle&&n.checkbox.toggle(),l.dispatchEvent(new CustomEvent("update"),{})):n.action&&(b(),v(),n.action()))};_.addEventListener("pointerup",(e=>{"mouse"===e.pointerType&&0!==e.button||"touch"!==e.pointerType&&_.click()})),_.addEventListener("click",(e=>{n.submenu?M(!0):$()}))}};0===e.length&&(e=[{label:"(Empty)",enabled:!1}]);let _=0;for(const n of e)if(n.radioItems){const e=t("tbody",{role:"group"});n.ariaLabel&&e.setAttribute("aria-label",n.ariaLabel);for(const t of n.radioItems)t.checkbox={type:"radio",check:()=>t.value===n.getValue(),toggle:()=>{n.setValue(t.value)}},w(e,t,_++);d.appendChild(e)}else w(d,n,_++)}l.addEventListener("keydown",E);const _=(e,o)=>{const h=t("div",{class:"menu-button","aria-expanded":"false","aria-haspopup":"true",role:"menuitem"});l.appendChild(h);const y=new k(o),E=y.element;document.body?.appendChild(E),m.set(h,y),f.set(E,h),h.id=`menu-button-${e}-${i()}`,E.dataset.semanticParent=h.id,h.setAttribute("aria-controls",E.id),E.setAttribute("aria-labelledby",h.id),l.setAttribute("aria-owns",`${l.getAttribute("aria-owns")||""} ${E.id}`);const _=()=>{const e=h.getBoundingClientRect();let t=E.getBoundingClientRect();E.style.position="absolute",E.style.left=`${("rtl"===a()?e.right-t.width:e.left)+window.scrollX}px`,E.style.top=`${e.bottom+window.scrollY}px`;const n=E.getBoundingClientRect();Math.floor(n.right)>innerWidth&&(E.style.left=innerWidth-n.width+"px"),Math.ceil(n.left)<0&&(E.style.left="0px")};window.addEventListener("resize",_),E.addEventListener("update",_);const L=e.replace("&","").replace(/ /g,"-").toLowerCase();function x(t="other"){Object.keys(n).indexOf(e)===p&&"true"===h.getAttribute("aria-expanded")||(b(),h.classList.add("active"),h.setAttribute("aria-expanded","true"),E.style.display="",E.style.zIndex=r(),E.setAttribute("dir",a()),window.inheritTheme&&window.inheritTheme(E,l),E.parentElement||document.body.appendChild(E),w(e),E.dispatchEvent(new CustomEvent("update"),{}),d=!0,E.focus({preventScroll:!0}),c=y,"keydown"===t?(y.highlight(0),g(y.menuItems[0])):g())}var A;h.classList.add(`${L}-menu-button`),E.style.display="none",h.innerHTML=s(e),h.tabIndex=-1,h.setAttribute("aria-haspopup","true"),h.setAttribute("aria-controls",E.id),h.addEventListener("focus",(()=>{w(e)})),h.addEventListener("pointerdown",(e=>{h.classList.contains("active")?(h.dispatchEvent(new CustomEvent("release",{})),v(),e.preventDefault()):x(e.type)})),h.addEventListener("pointermove",(t=>{w(e),"touch"!==t.pointerType&&d&&x(t.type)})),h.addEventListener("release",(()=>{d=!1,h.classList.remove("active"),window.debugKeepMenusOpen||(y.close(!0),h.setAttribute("aria-expanded","false")),l.dispatchEvent(new CustomEvent("default-info",{}))})),u.push({menu_button_el:h,menu_popup_el:E,menus_key:e,hotkey:(A=e,A[function(e){return` ${e}`.search(/[^&]&[^&\s]/)}(A)+1].toUpperCase()),open_top_level_menu:x})};for(const e in n)_(e,n[e]);function L(e){e.target?.closest?.(".menus")===l||e.target?.closest?.(".menu-popup")||(b(),w(-1))}window.addEventListener("keydown",(e=>{document.activeElement&&document.activeElement.closest&&document.activeElement.closest(".menus, .menu-popup")||"Escape"===e.key&&c&&(b(),e.preventDefault())})),window.addEventListener("blur",(e=>{e.isTrusted&&b()})),window.addEventListener("pointerdown",L),window.addEventListener("pointerup",L),window.addEventListener("focusout",(e=>{e.relatedTarget?.closest?.(".menus")===l||e.relatedTarget?.closest?.(".menu-popup")||(b(),w(u.findIndex((({menu_button_el:e})=>e.matches(":hover")))))}));let x=[];function A(...e){for(const e of x)e.removeEventListener("keydown",C);x=e;for(const e of x)e.addEventListener("keydown",C)}function C(e){if(!e.ctrlKey&&!e.metaKey||"Control"===e.key||"Meta"===e.key){if(!e.defaultPrevented&&e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){const t=u.find((t=>t.hotkey.toLowerCase()===e.key.toLowerCase()));t&&(e.preventDefault(),t.open_top_level_menu("keydown"))}}else b()}A(window),this.element=l,this.closeMenus=b,this.setKeyboardScope=A},e.MENU_DIVIDER=o})(window);