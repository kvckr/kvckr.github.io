(t=>{function e(t){return document.createElement(t)}function n(t){return"object"==typeof t&&"tagName"in t?t.tagName.toLowerCase()+(t.id?"#"+t.id:"")+(t.className?"."+t.className.split(" ").join("."):"")+(t.src?`[src="${t.src}"]`:"")+(t.srcdoc?"[srcdoc]":"")+(t.href?`[href="${t.href}"]`:""):t?t.constructor.name:`${t}`}function i(t){let e=$(t).find("\n\t\tinput:enabled,\n\t\ttextarea:enabled,\n\t\tselect:enabled,\n\t\tbutton:enabled,\n\t\ta[href],\n\t\t[tabIndex='0'],\n\t\tdetails summary,\n\t\tiframe,\n\t\tobject,\n\t\tembed,\n\t\tvideo[controls],\n\t\taudio[controls],\n\t\t[contenteditable]:not([contenteditable='false'])\n\t").filter(":visible");const n={},i=[];for(const t of e.toArray())"input"===t.nodeName.toLowerCase()&&"radio"===t.type&&(n[t.name]?t.checked?(i.push(n[t.name]),n[t.name]=t):i.push(t):n[t.name]=t);return e.not(i)}var o=$(window);a.Z_INDEX=5;var s=[];function a(t){t=t||{};var r=$(e("div")).addClass("window os-window").appendTo("body");r[0].$window=r,r.element=r[0],r[0].id=`os-window-${Math.random().toString(36).substr(2,9)}`,r.$titlebar=$(e("div")).addClass("window-titlebar").appendTo(r),r.$title_area=$(e("div")).addClass("window-title-area").appendTo(r.$titlebar),r.$title=$(e("span")).addClass("window-title").appendTo(r.$title_area),t.toolWindow&&(t.minimizeButton=!1,t.maximizeButton=!1),!1!==t.minimizeButton&&(r.$minimize=$(e("button")).addClass("window-minimize-button window-action-minimize window-button").appendTo(r.$titlebar),r.$minimize.attr("aria-label","Minimize window"),r.$minimize.append("<span class='window-button-icon'></span>")),!1!==t.maximizeButton&&(r.$maximize=$(e("button")).addClass("window-maximize-button window-action-maximize window-button").appendTo(r.$titlebar),r.$maximize.attr("aria-label","Maximize or restore window"),t.resizable||r.$maximize.attr("disabled",!0),r.$maximize.append("<span class='window-button-icon'></span>")),!1!==t.closeButton&&(r.$x=$(e("button")).addClass("window-close-button window-action-close window-button").appendTo(r.$titlebar),r.$x.attr("aria-label","Close window"),r.$x.append("<span class='window-button-icon'></span>")),r.$content=$(e("div")).addClass("window-content").appendTo(r),r.$content.attr("tabIndex","-1"),r.$content.css("outline","none"),t.toolWindow&&r.addClass("tool-window"),t.parentWindow&&(t.parentWindow.addChildWindow(r),t.toolWindow&&(r[0].dataset.semanticParent=t.parentWindow[0].id));var c=t.$component;if("object"==typeof t.icon&&"tagName"in t.icon)t.icons={any:t.icon};else if(t.icon){if(console.warn("DEPRECATED: use options.icons instead of options.icon, e.g. new $Window({icons: {16: 'app-16x16.png', any: 'app-icon.svg'}})"),"undefined"==typeof $Icon||"undefined"==typeof TITLEBAR_ICON_SIZE)throw new Error("Use {icon: img_element} or {icons: {16: url_or_img_element}} options");r.icon_name=t.icon,r.$icon=$Icon(t.icon,TITLEBAR_ICON_SIZE).prependTo(r.$titlebar)}r.icons=t.icons||{};let d=16;r.setTitlebarIconSize=function(t){r.icons&&(r.$icon?.remove(),r.$icon=$(r.getIconAtSize(t)),r.$icon.prependTo(r.$titlebar)),d=t,r.trigger("icon-change")},r.getTitlebarIconSize=function(){return d},r.getIconAtSize=function(t){let n;if(r.icons[t])n=t;else if(r.icons.any)n="any";else{const e=Object.keys(r.icons).filter((t=>isFinite(t)&&isFinite(parseFloat(t))));e.sort(((e,n)=>Math.abs(e-t)-Math.abs(n-t))),n=e[0]}if(n){const i=r.icons[n];let o;if(void 0!==i.nodeType)o=i.cloneNode(!0);else{o=e("img");const s=$(o);i.srcset?s.attr("srcset",i.srcset):s.attr("src",i.src||i),s.attr({width:n,height:n,draggable:!1}),s.css({width:t,height:t})}return o}return null},r.setTitlebarIconSize(d),r.getIconName=()=>(console.warn("DEPRECATED: use $w.icons object instead of $w.icon_name"),r.icon_name),r.setIconByID=t=>{console.warn("DEPRECATED: use $w.setIcons(icons) instead of $w.setIconByID(icon_name)");var e=r.$icon;return r.$icon=$Icon(t,TITLEBAR_ICON_SIZE),e.replaceWith(r.$icon),r.icon_name=t,r.task?.updateIcon(),r.trigger("icon-change"),r},r.setIcons=t=>{r.icons=t,r.setTitlebarIconSize(d),r.task?.updateIcon()},c&&r.addClass("component-window"),setTimeout((()=>{"rtl"==(window.get_direction?window.get_direction():getComputedStyle(r[0]).direction)&&r.addClass("rtl")}),0);const l=$({}),m=t=>e=>{const n=()=>{e()};l.on(t,n);return()=>{l.off(t,n)}};r.onFocus=m("focus"),r.onBlur=m("blur"),r.onClosed=m("closed"),r.setDimensions=({innerWidth:t,innerHeight:e,outerWidth:n,outerHeight:i})=>{let o,s;if(t&&(o=r.outerWidth()-r.$content.outerWidth()),e){s=r.outerHeight()-r.$content.outerHeight();const t=r.$content.find(".menus");t.length&&(s+=t.outerHeight())}n&&r.outerWidth(n),i&&r.outerHeight(i),t&&r.outerWidth(t+o),e&&r.outerHeight(e+s)},r.setDimensions(t);let u=[];r.addChildWindow=t=>{u.push(t)};const h=()=>{r.hasClass("focused")||(r.addClass("focused"),l.triggerHandler("focus"))},w=()=>{r.hasClass("focused")&&(r.removeClass("focused"),l.triggerHandler("blur"))};r.focus=()=>{r.bringToFront(),M()},r.blur=()=>{w(),document.activeElement&&document.activeElement.closest(".window")==r[0]&&document.activeElement.blur()},t.toolWindow&&(t.parentWindow?(t.parentWindow.onFocus(h),t.parentWindow.onBlur(w),document.activeElement&&document.activeElement.closest(".window")==t.parentWindow[0]&&h()):($(window).on("focus",h),$(window).on("blur",w),document.hasFocus()&&h()));{const P=g(r[0],!0);function p(t){if(!z.has(t)){const e=g(t,!1);z.set(t,e),setTimeout((()=>{try{const n=e=>{"complete"==t.contentDocument.readyState?e():setTimeout((()=>{n(e)}),100)};n((()=>{t.contentWindow.addEventListener("focusin",e),t.contentWindow.addEventListener("focusout",e),t.contentWindow.addEventListener("blur",e),t.contentWindow.addEventListener("focus",e),f(t.contentDocument)}))}catch(e){W(t,e)}}),100)}}function f(t){new MutationObserver((t=>{for(const e of t)for(const t of e.addedNodes)"IFRAME"==t.tagName&&p(t)})).observe(t,{childList:!0,subtree:!0});for(const e of t.querySelectorAll("iframe"))p(e)}function g(e,n){return function(i){const o="IFRAME"==e.tagName?e.contentDocument:e,s=o.ownerDocument??o;let a=i?"focusout"===i.type||"blur"===i.type?i.relatedTarget:i.target:s.activeElement;"blur"===i?.type&&(a=null),!s.activeElement||"IFRAME"!==s.activeElement.tagName||"focusout"!==i?.type&&"blur"!==i?.type||a||(a=s.activeElement);const c=!a||a.window===a||!o.contains(a);if(c&&o!==a&&n&&(t.toolWindow||w()),c||"HTML"===a.tagName||"BODY"===a.tagName||a===o||a.matches(".window-content")||a.closest(".menus")||a.closest(".window-titlebar")||(C.set(e,a),_(s,o,a,n)),!c&&"IFRAME"===a.tagName){const t=a;try{const e=t.contentDocument.activeElement;e&&"HTML"!==e.tagName&&"BODY"!==e.tagName&&!e.closest(".menus")&&(C.set(t,e),_(t.contentDocument,t.contentDocument,e,n))}catch(e){W(t,e)}}if(n)for(;;){const t=a?.closest?.("[data-semantic-parent]");if(!t)break;{const e=t.dataset.semanticParent,n=t.ownerDocument.getElementById(e);if(a=n,!n){console.warn("semantic parent not found with id",e);break}}}if(a&&a.window!==a&&o.contains(a)){if(t.toolWindow||h(),r.bringToFront(),!n){let t=e;for(;t;)t.dispatchEvent(new Event("focusin",{bubbles:!0,target:t,view:t.ownerDocument.defaultView})),t=t.currentView?.frameElement}}else n&&(t.toolWindow||w())}}window.addEventListener("focusin",P),window.addEventListener("focusout",P),window.addEventListener("blur",P),window.addEventListener("focus",P),f(r.$content[0])}r.css("touch-action","none");let b,v,x,y=null;r.setMinimizeTarget=function(t){y=t},Object.defineProperty(r,"task",{get:()=>b,set(t){console.warn("DEPRECATED: use $w.setMinimizeTarget(taskbar_button_el) instead of setting $window.task object"),b=t}}),r.minimize=()=>{if(y=y||b?.$task[0],X)Y.push(r.minimize);else if(r.is(":visible"))if(y&&!r.hasClass("minimized-without-taskbar")){const t=r.$titlebar[0].getBoundingClientRect(),e=y.getBoundingClientRect();r.animateTitlebar(t,e,(()=>{r.hide(),r.blur()}))}else{const t=150,e=10;if(r.hasClass("minimized-without-taskbar"))s[r._minimize_slot_index]=null;else{let t=0;for(;s[t];)t++;r._minimize_slot_index=t,s[t]=r}const n=r._minimize_slot_index*(t+e)+10,i=r.$titlebar.outerHeight();let o;const a=()=>{v={position:r.css("position"),left:r.css("left"),top:r.css("top"),width:r.css("width"),height:r.css("height")},r.addClass("minimized-without-taskbar"),r.hasClass("maximized")&&(r.removeClass("maximized"),r.addClass("was-maximized"),r.$maximize.removeClass("window-action-restore"),r.$maximize.addClass("window-action-maximize")),r.$minimize.removeClass("window-action-minimize"),r.$minimize.addClass("window-action-restore"),o?r.css({position:o.position,left:o.left,top:o.top,width:o.width,height:o.height}):r.css({position:"fixed",top:`calc(100% - ${i+5}px)`,left:n,width:t,height:i})},c=()=>{o={position:r.css("position"),left:r.css("left"),top:r.css("top"),width:r.css("width"),height:r.css("height")},r.removeClass("minimized-without-taskbar"),r.hasClass("was-maximized")&&(r.removeClass("was-maximized"),r.addClass("maximized"),r.$maximize.removeClass("window-action-maximize"),r.$maximize.addClass("window-action-restore")),r.$minimize.removeClass("window-action-restore"),r.$minimize.addClass("window-action-minimize"),r.css({width:"",height:""}),v&&r.css({position:v.position,left:v.left,top:v.top,width:v.width,height:v.height})},d=r.$titlebar[0].getBoundingClientRect();let l;r.css("transform",""),r.hasClass("minimized-without-taskbar")?(c(),l=r.$titlebar[0].getBoundingClientRect(),a()):(a(),l=r.$titlebar[0].getBoundingClientRect(),c()),r.animateTitlebar(d,l,(()=>{r.hasClass("minimized-without-taskbar")?c():(a(),r.blur())}))}},r.unminimize=()=>{if(X)Y.push(r.unminimize);else if(r.hasClass("minimized-without-taskbar"))r.minimize();else if(r.is(":hidden")){const t=y.getBoundingClientRect();r.show();const e=r.$titlebar[0].getBoundingClientRect();r.hide(),r.animateTitlebar(t,e,(()=>{r.show(),r.bringToFront(),r.focus()}))}},r.maximize=()=>{if(!t.resizable)return;if(X)return void Y.push(r.maximize);if(r.hasClass("minimized-without-taskbar"))return void r.minimize();const e=()=>{x={position:r.css("position"),left:r.css("left"),top:r.css("top"),width:r.css("width"),height:r.css("height")},r.addClass("maximized");const t=$(".taskbar"),e=window.innerWidth-$(window).width(),n=window.innerHeight-$(window).height(),i=t.length?t.outerHeight()+1:0;r.css({position:"fixed",top:0,left:0,width:`calc(100vw - ${e}px)`,height:`calc(100vh - ${n}px - ${i}px)`})},n=()=>{r.removeClass("maximized"),r.css({width:"",height:""}),x&&r.css({position:x.position,left:x.left,top:x.top,width:x.width,height:x.height})},i=r.$titlebar[0].getBoundingClientRect();let o;r.css("transform","");const s=r.hasClass("maximized");s?(n(),o=r.$titlebar[0].getBoundingClientRect(),e()):(e(),o=r.$titlebar[0].getBoundingClientRect(),n()),r.animateTitlebar(i,o,(()=>{s?(n(),r.$maximize.removeClass("window-action-restore"),r.$maximize.addClass("window-action-maximize")):(e(),r.$maximize.removeClass("window-action-maximize"),r.$maximize.addClass("window-action-restore"))}))},r.restore=()=>{r.is(".minimized-without-taskbar, .minimized")?r.unminimize():r.is(".maximized")&&r.maximize()},r.$minimize?.on("click",(t=>{r.minimize()})),r.$maximize?.on("click",(t=>{r.maximize()})),r.$x?.on("click",(t=>{r.close()})),r.$title_area.on("dblclick",(t=>{r.maximize()})),r.css({position:"absolute",zIndex:a.Z_INDEX++}),r.bringToFront=()=>{r.css({zIndex:a.Z_INDEX++});for(const t of u)t.bringToFront()};var C=new Map,z=new Map,E=new Map,I=[],T=new WeakSet;const W=(e,i)=>{const o=t=>[`OS-GUI.js failed to access an iframe (${n(e)}) for focus integration.\n${t}\nOriginal error:\n`,i];let s;if(e.srcdoc)s=!1;else try{s=new URL(e.src).origin!==window.location.origin}catch(t){return void console.error(...o(`This may be a bug in OS-GUI. Is this a cross-origin iframe? Failed to parse URL (${t}).`))}s?t.iframes?.ignoreCrossOrigin&&!T.has(e)&&(console.warn(...o("Only same-origin iframes can work with focus integration (showing window as focused, refocusing last focused controls).\nIf you can re-host the content on the same origin, you can resolve this and enable focus integration.\nYou can also disable this warning by passing {iframes: {ignoreCrossOrigin: true}} to $Window.")),T.add(e)):console.error(...o("This may be a bug in OS-GUI, since it doesn't appear to be a cross-origin iframe."))},_=(t,e,n,i)=>{if(!a.DEBUG_FOCUS)return;let o=E.get(e);o||(o=t.createElementNS("http://www.w3.org/2000/svg","svg"),o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.pointerEvents="none",o.style.zIndex="100000000",o.style.direction="ltr",E.set(e,o),I.push(o),t.body.appendChild(o)),o._container_el=e,o._descendant_el=n,o._is_root=i,B()},k=t=>{const e=t._container_el,i=t._descendant_el,o=t._is_root;for(;t.lastChild;)t.removeChild(t.lastChild);const s=i.getBoundingClientRect?.()??{left:0,top:0,width:innerWidth,height:innerHeight,right:innerWidth,bottom:innerHeight},a=e.getBoundingClientRect?.()??{left:0,top:0,width:innerWidth,height:innerHeight,right:innerWidth,bottom:innerHeight};for(const r of[s,a]){const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x",r.left),a.setAttribute("y",r.top),a.setAttribute("width",r.width),a.setAttribute("height",r.height),a.setAttribute("stroke","#f44"),a.setAttribute("stroke-width","2"),a.setAttribute("fill","none"),o||a.setAttribute("stroke-dasharray","5,5"),t.appendChild(a);const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",r.left),c.setAttribute("y",r.top+(r===s?20:0)),c.setAttribute("fill",r===s?"#f44":"aqua"),c.setAttribute("font-size","20"),c.style.textShadow="1px 1px 1px black, 0 0 10px black",c.textContent=n(r===s?i:e),t.appendChild(c)}const r=[[s.left,s.top,a.left,a.top],[s.right,s.top,a.right,a.top],[s.left,s.bottom,a.left,a.bottom],[s.right,s.bottom,a.right,a.bottom]];for(const e of r){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",e[0]),n.setAttribute("y1",e[1]),n.setAttribute("x2",e[2]),n.setAttribute("y2",e[3]),n.setAttribute("stroke","green"),n.setAttribute("stroke-width","2"),t.appendChild(n)}};let A;const B=()=>{if(cancelAnimationFrame(A),a.DEBUG_FOCUS){A=requestAnimationFrame(B);for(const t of I)k(t)}else D()},D=()=>{cancelAnimationFrame(A);for(const t of I)t.remove();I.length=0,E.clear()},M=(e=r.$content[0])=>{const n=e.matches(".window-content")?r[0]:e,o=C.get(n);if(o){if(o.focus({preventScroll:!0}),"IFRAME"===o.tagName)try{M(o)}catch(t){W(o,t)}return}const s=i(e),a=s.filter(".default");if(a.length)a[0].focus({preventScroll:!0});else if(s.length)if("IFRAME"===s[0].tagName)try{M(s[0])}catch(t){W(s[0],t)}else s[0].focus({preventScroll:!0});else if(t.toolWindow&&t.parentWindow)t.parentWindow.triggerHandler("refocus-window");else if(e.focus({preventScroll:!0}),"IFRAME"===e.tagName)try{M(e.contentDocument.body)}catch(t){W(e,t)}};var S,R,H,N,F;r.on("refocus-window",(()=>{M()})),r.on("pointerdown mousedown",(function(t){r.bringToFront(),requestAnimationFrame((()=>{const e=C.get(window);if(document.activeElement&&document.activeElement!==document&&document.activeElement!==document.body&&document.activeElement!==r.$content[0]&&document.activeElement!==e)return;if(document.activeElement?.closest?.(".menus, .menu-popup"))return;if("none"!==getComputedStyle(t.target).userSelect)return r.$content.focus(),void r.one("pointerup pointercancel",(()=>{requestAnimationFrame((()=>{getSelection().toString().trim()||M()}))}));M()}))})),o.on("focusin",(t=>{C.set(window,t.target)})),r.on("keydown",(t=>{if(t.isDefaultPrevented())return;if(t.ctrlKey||t.altKey||t.metaKey)return;if(t.target.closest(".menus"))return;const e=r.$content.find("button"),n=$(document.activeElement),o=e.index(n);switch(t.keyCode){case 40:case 39:n.is("button")&&!t.shiftKey&&o<e.length-1&&(e[o+1].focus(),t.preventDefault());break;case 38:case 37:n.is("button")&&!t.shiftKey&&o>0&&(e[o-1].focus(),t.preventDefault());break;case 32:case 13:if(n.is("button")&&!t.shiftKey){n.addClass("pressed");const t=()=>{n.removeClass("pressed"),n.off("focusout",t),$(window).off("keyup",e)},e=e=>{32!==e.keyCode&&13!==e.keyCode||t()};n.on("focusout",t),$(window).on("keyup",e)}break;case 9:{const e=i(r.$content[0]);if(e.length>0){const i=e.index(n);t.shiftKey?0===i&&(t.preventDefault(),e[e.length-1].focus()):i===e.length-1&&(t.preventDefault(),e[0].focus())}break}case 27:r.close()}})),r.applyBounds=()=>{const t=Math.max(document.body.scrollWidth,innerWidth),e=Math.max(document.body.scrollHeight,innerHeight);r.css({left:Math.max(0,Math.min(t-r.width(),r.position().left)),top:Math.max(0,Math.min(e-r.height(),r.position().top))})},r.bringTitleBarInBounds=()=>{const t=Math.max(document.body.scrollWidth,innerWidth),e=Math.max(document.body.scrollHeight,innerHeight);r.css({left:Math.max(40-r.outerWidth(),Math.min(t-40,r.position().left)),top:Math.max(0,Math.min(e-r.$titlebar.outerHeight()-5,r.position().top))})},r.center=()=>{r.css({left:(innerWidth-r.width())/2+window.scrollX,top:(innerHeight-r.height())/2+window.scrollY}),r.applyBounds()},o.on("resize",r.bringTitleBarInBounds);var O=t=>{const e=t.pointerId??t.originalEvent?.pointerId;F!==e&&void 0!==e&&void 0!==F&&1234567890!==F||(H=t.clientX??H,N=t.clientY??N),r.css({left:H+scrollX-S,top:N+scrollY-R})};if(r.$titlebar.css("touch-action","none"),r.$titlebar.on("selectstart",(t=>{t.preventDefault()})),r.$titlebar.on("mousedown","button",(t=>{M();const e=t.currentTarget;if(!$(e).is(":enabled"))return;e.classList.add("pressing");const n=t=>{t&&"blur"===t.type&&document.hasFocus()||(e.classList.remove("pressing"),o.off("mouseup blur",n),$(e).off("mouseenter",i),$(e).off("mouseleave",s))},i=()=>{e.classList.add("pressing")},s=()=>{e.classList.remove("pressing")};o.on("mouseup blur",n),$(e).on("mouseenter",i),$(e).on("mouseleave",s)})),r.$titlebar.on("pointerdown",(t=>{if($(t.target).closest("button").length)return;if(r.hasClass("maximized"))return;const e=$.Event("window-drag-start");r.trigger(e),e.isDefaultPrevented()||(S=t.clientX+scrollX-r.position().left,R=t.clientY+scrollY-r.position().top,H=t.clientX,N=t.clientY,F=t.pointerId??t.originalEvent?.pointerId,o.on("pointermove",O),o.on("scroll",O),$("body").addClass("dragging"))})),o.on("pointerup pointercancel",(t=>{const e=t.pointerId??t.originalEvent?.pointerId;e!==F&&void 0!==e||(o.off("pointermove",O),o.off("scroll",O),$("body").removeClass("dragging"),r.bringTitleBarInBounds(),F=-1)})),r.$titlebar.on("dblclick",(t=>{c&&c.dock()})),t.resizable){const U=0,j=-1,K=1,Z=j,q=K,G=j,V=K;[[G,q],[G,U],[G,Z],[U,Z],[V,Z],[V,U],[V,q],[U,q]].forEach((([e,n])=>{const i=$("<div>").addClass("handle").appendTo(r);let s="";e===G&&(s+="n"),e===V&&(s+="s"),n===Z&&(s+="w"),n===q&&(s+="e"),s+="-resize";const a=(r.outerWidth()-r.width())/2,c=(r.outerWidth()-r.innerWidth())/2,d=r.outerHeight()-r.$content.outerHeight(),l=r.outerWidth()-r.$content.outerWidth();let m,u,h,w,p,f;function g(t){const e=t.pointerId??t.originalEvent?.pointerId;e!==f&&void 0!==e||(w=t.clientX,p=t.clientY,v())}function b(t){const e=t.pointerId??t.originalEvent?.pointerId;e!==f&&void 0!==e||(o.off("pointermove",g),o.off("scroll",onscroll),$("body").removeClass("dragging"),o.off("pointerup pointercancel",b),r.bringTitleBarInBounds())}function v(){const i=w+scrollX-u,o=p+scrollY-h;let s,a,c=0,f=0;n===q?(c=0,s=~~(i-m.x)):n===Z?(c=~~(i-m.x),s=~~(m.x+m.width-i)):s=~~m.width,e===V?(f=0,a=~~(o-m.y)):e===G?(f=~~(o-m.y),a=~~(m.y+m.height-o)):a=~~m.height;let g={x:m.x+c,y:m.y+f,width:s,height:a};g.width=Math.max(1,g.width),g.height=Math.max(1,g.height),t.constrainRect&&(g=t.constrainRect(g,n,e)),g.width=Math.max(g.width,t.minOuterWidth??100),g.height=Math.max(g.height,t.minOuterHeight??0),g.width=Math.max(g.width,(t.minInnerWidth??0)+l),g.height=Math.max(g.height,(t.minInnerHeight??0)+d),n===Z&&(g.x=Math.min(g.x,m.x+m.width-g.width)),e===G&&(g.y=Math.min(g.y,m.y+m.height-g.height)),r.css({top:g.y,left:g.x}),r.outerWidth(g.width),r.outerHeight(g.height)}i.css({position:"absolute",top:e===G?-c:e===U?`calc(${a}px - ${c}px)`:"",bottom:e===V?-c:"",left:n===Z?-c:n===U?`calc(${a}px - ${c}px)`:"",right:n===q?-c:"",width:n===U?`calc(100% - ${a}px * 2 + ${2*c}px)`:`${a}px`,height:e===U?`calc(100% - ${a}px * 2 + ${2*c}px)`:`${a}px`,touchAction:"none",cursor:s}),i.on("pointerdown",(t=>{t.preventDefault(),o.on("pointermove",g),o.on("scroll",v),$("body").addClass("dragging"),o.on("pointerup pointercancel",b),m={x:r.position().left,y:r.position().top,width:r.outerWidth(),height:r.outerHeight()},u=t.clientX+scrollX-m.x-(n===q?m.width:0),h=t.clientY+scrollY-m.y-(e===V?m.height:0),w=t.clientX,p=t.clientY,f=t.pointerId??t.originalEvent?.pointerId,i[0].setPointerCapture(f)}))}))}r.$Button=(t,n)=>$(e("button")).appendTo(r.$content).text(t).on("click",(()=>{n&&n(),r.close()})),r.title=t=>t?(r.$title.text(t),r.trigger("title-change"),r.task&&r.task.updateTitle(),r):r.$title.text(),r.getTitle=()=>r.title();let L,X=!1,Y=[];return r.animateTitlebar=(t,e,n=(()=>{}))=>{X=!0;const i=r.$titlebar.clone(!0);i.find("button").remove(),i.appendTo("body");const o=a.OVERRIDE_TRANSITION_DURATION??200,s=`${o}ms`;i.css({transition:`left ${s} linear, top ${s} linear, width ${s} linear, height ${s} linear`,position:"fixed",zIndex:1e7,pointerEvents:"none",left:t.left,top:t.top,width:t.width,height:t.height}),setTimeout((()=>{i.css({left:e.left,top:e.top,width:e.width,height:e.height})}),5);let c=!1;const d=()=>{c||(c=!0,X=!1,i.remove(),n(),Y.shift()?.())};i.on("transitionend transitioncancel",d),setTimeout(d,1.2*o)},r.close=t=>{if(t&&!0!==t)throw new TypeError("force must be a boolean or undefined, not "+Object.prototype.toString.call(t));if(!t){var e=$.Event("close");if(r.trigger(e),e.isDefaultPrevented())return}c&&c.detach(),r.closed=!0,l.triggerHandler("closed"),r.trigger("closed"),r.remove(),$($(".window:visible").toArray().sort(((t,e)=>e.style.zIndex-t.style.zIndex))[0]).triggerHandler("refocus-window"),D()},r.closed=!1,r.setMenuBar=t=>{L&&L.element.remove(),t&&(r.$titlebar.after(t.element),t.setKeyboardScope(r[0]),L=t)},t.title&&r.title(t.title),c||r.center(),r}t.$Window=a,t.$FormWindow=function(t){var n=new a;return n.title(t),n.$form=$(e("form")).appendTo(n.$content),n.$main=$(e("div")).appendTo(n.$form),n.$buttons=$(e("div")).appendTo(n.$form).addClass("button-group"),n.$Button=(t,i)=>{var o=$(e("button")).appendTo(n.$buttons).text(t);return o.on("click",(t=>{t.preventDefault(),i()})),o.on("pointerdown",(()=>{o.focus()})),o},n}})(window);