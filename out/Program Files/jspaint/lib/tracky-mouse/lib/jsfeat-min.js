var jsfeat=jsfeat||{REVISION:"ALPHA"};!function(t){var a=256,e=512,r=1024,f=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),i=function(t){return 65280&t},o=function(t){return 255&t},s=function(t){return f[(65280&t)>>8]},n=function(t,a){this.size=-8&(t+7|0),void 0===a?this.buffer=new ArrayBuffer(this.size):(this.buffer=a,this.size=a.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)},h=function(){function t(t,f,s,n){this.type=0|i(s),this.channel=0|o(s),this.cols=0|t,this.rows=0|f,void 0===n?this.allocate():(this.buffer=n,this.data=this.type&a?this.buffer.u8:this.type&e?this.buffer.i32:this.type&r?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new n(this.cols*s(this.type)*this.channel*this.rows),this.data=this.type&a?this.buffer.u8:this.type&e?this.buffer.i32:this.type&r?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var a=t.data,e=this.data,r=0,f=this.cols*this.rows*this.channel|0;r<f-4;r+=4)a[r]=e[r],a[r+1]=e[r+1],a[r+2]=e[r+2],a[r+3]=e[r+3];for(;r<f;++r)a[r]=e[r]},t.prototype.resize=function(t,a,e){void 0===e&&(e=this.channel),t*s(this.type)*e*a>this.buffer.size?(this.cols=t,this.rows=a,this.channel=e,this.allocate()):(this.cols=t,this.rows=a,this.channel=e)},t}(),c=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=jsfeat.imgproc.pyrdown}return t.prototype.allocate=function(t,a,e){for(var r=this.levels;--r>=0;)this.data[r]=new h(t>>r,a>>r,e)},t.prototype.build=function(t,a){void 0===a&&(a=!0);var e=2,r=t,f=this.data[0];if(!a)for(var i=t.cols*t.rows;--i>=0;)f.data[i]=t.data[i];for(f=this.data[1],this.pyrdown(r,f);e<this.levels;++e)r=f,f=this.data[e],this.pyrdown(r,f)},t}(),u=function(t,a,e,r,f){void 0===t&&(t=0),void 0===a&&(a=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===f&&(f=-1),this.x=t,this.y=a,this.score=e,this.level=r,this.angle=f};t.U8_t=a,t.S32_t=e,t.F32_t=r,t.S64_t=2048,t.F64_t=4096,t.C1_t=1,t.C2_t=2,t.C3_t=3,t.C4_t=4,t.U8C1_t=1|a,t.U8C3_t=3|a,t.U8C4_t=4|a,t.F32C1_t=1|r,t.F32C2_t=2|r,t.S32C1_t=1|e,t.S32C2_t=2|e,t.EPSILON=1.192092896e-7,t.FLT_MIN=1e-37,t.COLOR_RGBA2GRAY=0,t.COLOR_RGB2GRAY=1,t.COLOR_BGRA2GRAY=2,t.COLOR_BGR2GRAY=3,t.BOX_BLUR_NOSCALE=1,t.SVD_U_T=1,t.SVD_V_T=2,t.get_data_type=i,t.get_channel=o,t.get_data_type_size=s,t.data_t=n,t.matrix_t=h,t.pyramid_t=c,t.keypoint_t=u}(jsfeat),function(t){var a,e,r,f=(r=function(){function t(t){this.next=null,this.data=new jsfeat.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new jsfeat.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}(),{allocate:function(t,f){a=e=new r(f);for(var i=0;i<t;++i){var o=new r(f);e=e.next=o}},get_buffer:function(t){var e=a;return a=a.next,t>e.size&&e.resize(t),e},put_buffer:function(t){e=e.next=t}});t.cache=f,f.allocate(30,2560)}(jsfeat),function(t){var a,e=(a=new Int32Array(96),{get_gaussian_kernel:function(t,a,e,r){var f=0,i=0,o=0,s=0,n=0,h=0,c=jsfeat.cache.get_buffer(t<<2),u=c.f32;if(1==(1&t)&&t<=7&&a<=0)switch(t>>1){case 0:u[0]=1,h=1;break;case 1:u[0]=.25,u[1]=.5,u[2]=.25,h=1;break;case 2:u[0]=.0625,u[1]=.25,u[2]=.375,u[3]=.25,u[4]=.0625,h=1;break;case 3:u[0]=.03125,u[1]=.109375,u[2]=.21875,u[3]=.28125,u[4]=.21875,u[5]=.109375,u[6]=.03125,h=1}else for(n=-.5/((s=a>0?a:.3*(.5*(t-1)-1)+.8)*s);f<t;++f)i=f-.5*(t-1),o=Math.exp(n*i*i),u[f]=o,h+=o;if(r&jsfeat.U8_t)for(h=256/h,f=0;f<t;++f)e[f]=u[f]*h+.5|0;else for(h=1/h,f=0;f<t;++f)e[f]=u[f]*h;jsfeat.cache.put_buffer(c)},perspective_4point_transform:function(t,a,e,r,f,i,o,s,n,h,c,u,d,_,l,v,b){var p=a,j=h,m=o,x=p*j*m,y=l,w=p*y,g=j*w,M=c,k=p*M,z=i,A=e,C=_,O=A*C,R=O*z,S=C*z*M,L=C*m,U=C*M,q=j*m,I=y*j,G=y*z,B=M*z,F=1/(L-U-q+I-G+B),N=p*C,V=A*z,E=m*p,P=y*E,T=A*j,Y=O*M,D=A*M*z,Q=m*y*j,X=y*A,H=-(g-x+k*z-z*w-O*j+R-S+L*j)*F,J=(x-g-N*m+N*M+R-j*V+G*j-S)*F,K=p,W=(-M*w+P+T*m-O*m+Y-D+G*M-Q)*F,Z=(E*M-P-X*j+Y-D+X*z+Q-L*M)*F,$=A,tt=(-k+E+T-V+U-L-I+G)*F,at=(-w+k+O-T+G-B-L+q)*F,et=-((g=(j=u)*(w=(p=r)*(y=b)))-(x=p*j*(m=n))+(k=p*(M=d))*(z=s)-z*w-(O=(A=f)*(C=v))*j+(R=O*z)-(S=C*z*M)+(L=C*m)*j)*(F=1/(L-(U=C*M)-(q=j*m)+(I=y*j)-(G=y*z)+(B=M*z))),rt=(x-g-(N=p*C)*m+N*M+R-j*(V=A*z)+G*j-S)*F,ft=p,it=(-M*w+(P=y*(E=m*p))+(T=A*j)*m-O*m+(Y=O*M)-(D=A*M*z)+G*M-(Q=m*y*j))*F,ot=(E*M-P-(X=y*A)*j+Y-D+X*z+Q-L*M)*F,st=A,nt=(-k+E+T-V+U-L-I+G)*F,ht=(-w+k+O-T+G-B-L+q)*F,ct=K*tt;R=$*tt-W;var ut=-W*at+Z*tt,dt=H-ct;V=H*at-(k=J*tt);var _t=(x=H*$)-(g=K*W),lt=(m=H*Z)-(w=W*J);D=(j=Z-at*$)*(C=1/(m-x*at-w+g*at+k*$-ct*Z));var vt=(B=K*at-J)*C,bt=(E=-J*$+K*Z)*C,pt=t.data;pt[0]=et*D+rt*(R*C)-ft*(ut*C),pt[1]=et*vt+rt*(dt*C)-ft*(V*C),pt[2]=-et*bt-rt*(_t*C)+ft*(lt*C),pt[3]=it*D+ot*(R*C)-st*(ut*C),pt[4]=it*vt+ot*(dt*C)-st*(V*C),pt[5]=-it*bt-ot*(_t*C)+st*(lt*C),pt[6]=nt*D+ht*(R*C)-ut*C,pt[7]=nt*vt+ht*(dt*C)-V*C,pt[8]=-nt*bt-ht*(_t*C)+lt*C},qsort:function(t,e,r,f){var i,o,s,n,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=a;if(!(r-e+1<=1))for(A[0]=e,A[1]=r;h>=0;)for(c=A[h<<1],u=A[1+(h<<1)],h--;;){if((_=u-c+1)<=7){for(v=c+1;v<=u;v++)for(b=v;b>c&&f(t[b],t[b-1]);b--)i=t[b],t[b]=t[b-1],t[b-1]=i;break}for(z=0,j=c,x=u,w=c+(_>>1),_>40&&(M=c+(p=_>>3),k=c+(p<<1),o=t[g=c],s=t[M],n=t[k],c=f(o,s)?f(s,n)?M:f(o,n)?k:g:f(n,s)?M:f(o,n)?g:k,M=w,k=w+p,o=t[g=w-p],s=t[M],n=t[k],w=f(o,s)?f(s,n)?M:f(o,n)?k:g:f(n,s)?M:f(o,n)?g:k,M=u-p,k=u,o=t[g=u-(p<<1)],s=t[M],n=t[k],u=f(o,s)?f(s,n)?M:f(o,n)?k:g:f(n,s)?M:f(o,n)?g:k),M=w,k=u,o=t[g=c],s=t[M],n=t[k],(w=f(o,s)?f(s,n)?M:f(o,n)?k:g:f(n,s)?M:f(o,n)?g:k)!=j&&(i=t[w],t[w]=t[j],t[j]=i,w=j),c=m=j+1,u=y=x,o=t[w];;){for(;c<=u&&!f(o,t[c]);)f(t[c],o)||(c>m&&(i=t[m],t[m]=t[c],t[c]=i),z=1,m++),c++;for(;c<=u&&!f(t[u],o);)f(o,t[u])||(u<y&&(i=t[y],t[y]=t[u],t[u]=i),z=1,y--),u--;if(c>u)break;i=t[c],t[c]=t[u],t[u]=i,z=1,c++,u--}if(0==z){for(u=x,v=(c=j)+1;v<=u;v++)for(b=v;b>c&&f(t[b],t[b-1]);b--)i=t[b],t[b]=t[b-1],t[b-1]=i;break}for(l=c-(_=Math.min(m-j,c-m))|0,d=0;d<_;++d,++l)i=t[j+d],t[j+d]=t[l],t[l]=i;for(l=x-(_=Math.min(x-y,y-u))+1|0,d=0;d<_;++d,++l)i=t[c+d],t[c+d]=t[l],t[l]=i;if(l=y-u,(_=c-m)>1)l>1?_>l?(A[++h<<1]=j,A[1+(h<<1)]=j+_-1,c=x-l+1,u=x):(A[++h<<1]=x-l+1,A[1+(h<<1)]=x,c=j,u=j+_-1):(c=j,u=j+_-1);else{if(!(l>1))break;c=x-l+1,u=x}}},median:function(t,a,e){for(var r,f=0,i=0,o=0,s=a+e>>1;;){if(e<=a)return t[s];if(e==a+1)return t[a]>t[e]&&(r=t[a],t[a]=t[e],t[e]=r),t[s];for(t[f=a+e>>1]>t[e]&&(r=t[f],t[f]=t[e],t[e]=r),t[a]>t[e]&&(r=t[a],t[a]=t[e],t[e]=r),t[f]>t[a]&&(r=t[f],t[f]=t[a],t[a]=r),i=a+1,r=t[f],t[f]=t[i],t[i]=r,o=e;;){do{++i}while(t[a]>t[i]);do{--o}while(t[o]>t[a]);if(o<i)break;r=t[i],t[i]=t[o],t[o]=r}r=t[a],t[a]=t[o],t[o]=r,o<=s?a=i:o>=s&&(e=o-1)}return 0}});t.math=e}(jsfeat),function(t){var a={identity:function(t,a){void 0===a&&(a=1);for(var e=t.data,r=t.rows,f=t.cols,i=f+1|0,o=r*f,s=o;--o>=0;)e[o]=0;for(o=s,s=0;s<o;)e[s]=a,s+=i},transpose:function(t,a){for(var e=0,r=0,f=a.rows,i=a.cols,o=0,s=0,n=0,h=a.data,c=t.data;e<f;s+=1,o+=i,e++)for(n=s,r=0;r<i;n+=f,r++)c[n]=h[o+r]},multiply:function(t,a,e){for(var r=0,f=0,i=0,o=0,s=0,n=0,h=0,c=0,u=a.cols,d=a.rows,_=e.cols,l=a.data,v=e.data,b=t.data,p=0;r<d;o+=u,r++)for(h=0,f=0;f<_;c++,h++,f++){for(n=h,s=o,p=0,i=0;i<u;s++,n+=_,i++)p+=l[s]*v[n];b[c]=p}},multiply_ABt:function(t,a,e){for(var r=0,f=0,i=0,o=0,s=0,n=0,h=0,c=a.cols,u=a.rows,d=e.rows,_=a.data,l=e.data,v=t.data,b=0;r<u;o+=c,r++)for(n=0,f=0;f<d;h++,f++){for(s=o,b=0,i=0;i<c;s++,n++,i++)b+=_[s]*l[n];v[h]=b}},multiply_AtB:function(t,a,e){for(var r=0,f=0,i=0,o=0,s=0,n=0,h=0,c=0,u=a.cols,d=a.rows,_=e.cols,l=a.data,v=e.data,b=t.data,p=0;r<u;o++,r++)for(h=0,f=0;f<_;c++,h++,f++){for(n=h,s=o,p=0,i=0;i<d;s+=u,n+=_,i++)p+=l[s]*v[n];b[c]=p}},multiply_AAt:function(t,a){for(var e=0,r=0,f=0,i=0,o=0,s=0,n=0,h=0,c=0,u=a.cols,d=a.rows,_=a.data,l=t.data,v=0;e<d;i+=d+1,o=s,e++)for(h=i,c=i,n=o,r=e;r<d;h++,c+=d,r++){for(s=o,v=0,f=0;f<u;f++)v+=_[s++]*_[n++];l[h]=v,l[c]=v}},multiply_AtA:function(t,a){for(var e=0,r=0,f=0,i=0,o=0,s=0,n=0,h=0,c=0,u=a.cols,d=a.rows,_=a.data,l=t.data,v=0;e<u;n+=u,e++)for(i=e,h=c=n+e,r=e;r<u;h++,c+=u,r++){for(o=i,s=r,v=0,f=0;f<d;o+=u,s+=u,f++)v+=_[o]*_[s];l[h]=v,l[c]=v}},identity_3x3:function(t,a){void 0===a&&(a=1);var e=t.data;e[0]=e[4]=e[8]=a,e[1]=e[2]=e[3]=0,e[5]=e[6]=e[7]=0},invert_3x3:function(t,a){var e=t.data,r=a.data,f=e[4],i=e[8],o=e[5],s=e[7],n=e[0],h=n*f,c=n*o,u=e[3],d=e[1],_=u*d,l=e[2],v=u*l,b=e[6],p=b*d,j=b*l,m=1/(h*i-c*s-_*i+v*s+p*o-j*f);r[0]=(f*i-o*s)*m,r[1]=-(d*i-l*s)*m,r[2]=-(-d*o+l*f)*m,r[3]=-(u*i-o*b)*m,r[4]=(n*i-j)*m,r[5]=-(c-v)*m,r[6]=-(-u*s+f*b)*m,r[7]=-(n*s-p)*m,r[8]=(h-_)*m},multiply_3x3:function(t,a,e){var r=t.data,f=a.data,i=e.data,o=f[0],s=f[1],n=f[2],h=f[3],c=f[4],u=f[5],d=f[6],_=f[7],l=f[8],v=i[0],b=i[1],p=i[2],j=i[3],m=i[4],x=i[5],y=i[6],w=i[7],g=i[8];r[0]=o*v+s*j+n*y,r[1]=o*b+s*m+n*w,r[2]=o*p+s*x+n*g,r[3]=h*v+c*j+u*y,r[4]=h*b+c*m+u*w,r[5]=h*p+c*x+u*g,r[6]=d*v+_*j+l*y,r[7]=d*b+_*m+l*w,r[8]=d*p+_*x+l*g},mat3x3_determinant:function(t){var a=t.data;return a[0]*a[4]*a[8]-a[0]*a[5]*a[7]-a[3]*a[1]*a[8]+a[3]*a[2]*a[7]+a[6]*a[1]*a[5]-a[6]*a[2]*a[4]},determinant_3x3:function(t,a,e,r,f,i,o,s,n){return t*f*n-t*i*s-r*a*n+r*e*s+o*a*i-o*e*f}};jsfeat.matmath=a}(),function(t){var a,e,r=(a=function(t,a,e,r){r=t[a],t[a]=t[e],t[e]=r},e=function(t,a){return(t=Math.abs(t))>(a=Math.abs(a))?(a/=t,t*Math.sqrt(1+a*a)):a>0?(t/=a,a*Math.sqrt(1+t*t)):0},{lu_solve:function(t,e){var r,f,i,o,s=0,n=0,h=0,c=1,u=t.cols,d=t.data,_=e.data;for(s=0;s<u;s++){for(h=s,n=s+1;n<u;n++)Math.abs(d[n*u+s])>Math.abs(d[h*u+s])&&(h=n);if(Math.abs(d[h*u+s])<jsfeat.EPSILON)return 0;if(h!=s){for(n=s;n<u;n++)a(d,s*u+n,h*u+n,r);a(_,s,h,r),c=-c}for(i=-1/d[s*u+s],n=s+1;n<u;n++){for(f=d[n*u+s]*i,h=s+1;h<u;h++)d[n*u+h]+=f*d[s*u+h];_[n]+=f*_[s]}d[s*u+s]=-i}for(s=u-1;s>=0;s--){for(o=_[s],h=s+1;h<u;h++)o-=d[s*u+h]*_[h];_[s]=o*d[s*u+s]}return 1},cholesky_solve:function(t,a){var e,r,f=0,i=0,o=0,s=0,n=0,h=0,c=0,u=t.cols,d=t.data,_=a.data;for(f=0;f<u;f++)for(r=1,n=s=f*u,i=f;i<u;i++){for(e=d[n+f],o=0;o<f;o++)e-=d[o*u+f]*d[n+o];if(i==f){if(d[n+f]=e,0==e)return 0;r=1/e}else d[s+i]=e,d[n+f]=e*r;n+=u}for(s=0,h=0;h<u;h++){for(e=_[h],c=0;c<h;c++)e-=d[s+c]*_[c];_[h]=e,s+=u}for(s=0,h=0;h<u;h++)_[h]/=d[s+h],s+=u;for(h=u-1;h>=0;h--){for(e=_[h],s=(c=h+1)*u;c<u;c++)e-=d[s+h]*_[c],s+=u;_[h]=e}return 1},svd_decompose:function(t,r,f,i,o){void 0===o&&(o=0);var s=0,n=0,h=t.rows,c=t.cols,u=h,d=c,_=t.type|jsfeat.C1_t;u<d&&(s=1,n=u,u=d,d=n);var l=jsfeat.cache.get_buffer(u*u<<3),v=jsfeat.cache.get_buffer(d<<3),b=jsfeat.cache.get_buffer(d*d<<3),p=new jsfeat.matrix_t(u,u,_,l.data),j=new jsfeat.matrix_t(1,d,_,v.data),m=new jsfeat.matrix_t(d,d,_,b.data);if(0==s)jsfeat.matmath.transpose(p,t);else{for(n=0;n<c*h;n++)p.data[n]=t.data[n];for(;n<d*u;n++)p.data[n]=0}if(function(t,r,f,i,o,s,n,h){for(var c=2*jsfeat.EPSILON,u=jsfeat.FLT_MIN,d=0,_=0,l=0,v=0,b=Math.max(s,30),p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,S=0,L=0,U=0,q=4660,I=0,G=0,B=0,F=jsfeat.cache.get_buffer(n<<3),N=F.f64;d<n;d++){for(l=0,A=0;l<s;l++)A+=(M=t[d*r+l])*M;if(N[d]=A,i){for(l=0;l<n;l++)i[d*o+l]=0;i[d*o+d]=1}}for(;v<b;v++){for(y=0,d=0;d<n-1;d++)for(_=d+1;_<n;_++){for(p=d*r|0,j=_*r|0,S=N[d],L=0,U=N[_],l=2,L+=t[p]*t[j],L+=t[p+1]*t[j+1];l<s;l++)L+=t[p+l]*t[j+l];if(!(Math.abs(L)<=c*Math.sqrt(S*U))){for(O=e(L*=2,C=S-U),C<0?(R=.5*(O-C),w=L/(O*(g=Math.sqrt(R/O))*2)):g=L/(O*(w=Math.sqrt((O+C)/(2*O)))*2),S=0,U=0,l=2,k=w*t[p]+g*t[j],z=-g*t[p]+w*t[j],t[p]=k,t[j]=z,S+=k*k,U+=z*z,k=w*t[p+1]+g*t[j+1],z=-g*t[p+1]+w*t[j+1],t[p+1]=k,t[j+1]=z,S+=k*k,U+=z*z;l<s;l++)k=w*t[p+l]+g*t[j+l],z=-g*t[p+l]+w*t[j+l],t[p+l]=k,t[j+l]=z,S+=k*k,U+=z*z;if(N[d]=S,N[_]=U,y=1,i)for(x=_*o|0,l=2,k=w*i[m=d*o|0]+g*i[x],z=-g*i[m]+w*i[x],i[m]=k,i[x]=z,k=w*i[m+1]+g*i[x+1],z=-g*i[m+1]+w*i[x+1],i[m+1]=k,i[x+1]=z;l<n;l++)k=w*i[m+l]+g*i[x+l],z=-g*i[m+l]+w*i[x+l],i[m+l]=k,i[x+l]=z}}if(0==y)break}for(d=0;d<n;d++){for(l=0,A=0;l<s;l++)A+=(M=t[d*r+l])*M;N[d]=Math.sqrt(A)}for(d=0;d<n-1;d++){for(_=d,l=d+1;l<n;l++)N[_]<N[l]&&(_=l);if(d!=_&&(a(N,d,_,A),i)){for(l=0;l<s;l++)a(t,d*r+l,_*r+l,M);for(l=0;l<n;l++)a(i,d*o+l,_*o+l,M)}}for(d=0;d<n;d++)f[d]=N[d];if(i){for(d=0;d<h;d++){for(A=d<n?N[d]:0;A<=u;){for(G=1/s,l=0;l<s;l++)I=0!=(256&(q=214013*q+2531011)>>16)?G:-G,t[d*r+l]=I;for(v=0;v<2;v++)for(_=0;_<d;_++){for(A=0,l=0;l<s;l++)A+=t[d*r+l]*t[_*r+l];for(B=0,l=0;l<s;l++)M=t[d*r+l]-A*t[_*r+l],t[d*r+l]=M,B+=Math.abs(M);for(B=B?1/B:0,l=0;l<s;l++)t[d*r+l]*=B}for(A=0,l=0;l<s;l++)A+=(M=t[d*r+l])*M;A=Math.sqrt(A)}for(g=1/A,l=0;l<s;l++)t[d*r+l]*=g}jsfeat.cache.put_buffer(F)}else jsfeat.cache.put_buffer(F)}(p.data,u,j.data,m.data,d,u,d,u),r){for(n=0;n<d;n++)r.data[n]=j.data[n];for(;n<c;n++)r.data[n]=0}if(0==s){if(f&&o&jsfeat.SVD_U_T)for(n=u*u;--n>=0;)f.data[n]=p.data[n];else f&&jsfeat.matmath.transpose(f,p);if(i&&o&jsfeat.SVD_V_T)for(n=d*d;--n>=0;)i.data[n]=m.data[n];else i&&jsfeat.matmath.transpose(i,m)}else{if(f&&o&jsfeat.SVD_U_T)for(n=d*d;--n>=0;)f.data[n]=m.data[n];else f&&jsfeat.matmath.transpose(f,m);if(i&&o&jsfeat.SVD_V_T)for(n=u*u;--n>=0;)i.data[n]=p.data[n];else i&&jsfeat.matmath.transpose(i,p)}jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(v),jsfeat.cache.put_buffer(b)},svd_solve:function(t,a,e){var r,f=0,i=0,o=0,s=0,n=0,h=t.rows,c=t.cols,u=0,d=0,_=t.type|jsfeat.C1_t,l=jsfeat.cache.get_buffer(h*h<<3),v=jsfeat.cache.get_buffer(c<<3),b=jsfeat.cache.get_buffer(c*c<<3),p=new jsfeat.matrix_t(h,h,_,l.data),j=new jsfeat.matrix_t(1,c,_,v.data),m=new jsfeat.matrix_t(c,c,_,b.data),x=e.data,y=p.data,w=j.data,g=m.data;for(this.svd_decompose(t,j,p,m,0),r=jsfeat.EPSILON*w[0]*c;f<c;f++,n+=c){for(d=0,i=0;i<c;i++)if(w[i]>r){for(o=0,u=0,s=0;o<h;o++,s+=c)u+=y[s+i]*x[o];d+=u*g[n+i]/w[i]}a.data[f]=d}jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(v),jsfeat.cache.put_buffer(b)},svd_invert:function(t,a){var e,r=0,f=0,i=0,o=0,s=0,n=0,h=a.rows,c=a.cols,u=0,d=a.type|jsfeat.C1_t,_=jsfeat.cache.get_buffer(h*h<<3),l=jsfeat.cache.get_buffer(c<<3),v=jsfeat.cache.get_buffer(c*c<<3),b=new jsfeat.matrix_t(h,h,d,_.data),p=new jsfeat.matrix_t(1,c,d,l.data),j=new jsfeat.matrix_t(c,c,d,v.data),m=t.data,x=b.data,y=p.data,w=j.data;for(this.svd_decompose(a,p,b,j,0),e=jsfeat.EPSILON*y[0]*c;r<c;r++,s+=c)for(f=0,o=0;f<h;f++,n++){for(i=0,u=0;i<c;i++,o++)y[i]>e&&(u+=w[s+i]*x[o]/y[i]);m[n]=u}jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(v)},eigenVV:function(t,r,f){for(var i=t.cols,o=i*i,s=t.type|jsfeat.C1_t,n=jsfeat.cache.get_buffer(i*i<<3),h=jsfeat.cache.get_buffer(i<<3),c=new jsfeat.matrix_t(i,i,s,n.data),u=new jsfeat.matrix_t(1,i,s,h.data);--o>=0;)c.data[o]=t.data[o];if(function(t,r,f,i,o,s){var n=jsfeat.EPSILON,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,j=s*s*30,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=jsfeat.cache.get_buffer(s<<2),O=jsfeat.cache.get_buffer(s<<2),R=C.i32,S=O.i32;if(i)for(;h<s;h++){for(u=h*o,c=0;c<s;c++)i[u+c]=0;i[u+h]=1}for(u=0;u<s;u++){if(f[u]=t[(r+1)*u],u<s-1){for(d=u+1,m=Math.abs(t[r*u+d]),h=u+2;h<s;h++)m<(x=Math.abs(t[r*u+h]))&&(m=x,d=h);R[u]=d}if(u>0){for(d=0,m=Math.abs(t[u]),h=1;h<u;h++)m<(x=Math.abs(t[r*h+u]))&&(m=x,d=h);S[u]=d}}if(s>1)for(;p<j;p++){for(u=0,m=Math.abs(t[R[0]]),h=1;h<s-1;h++)m<(x=Math.abs(t[r*h+R[h]]))&&(m=x,u=h);for(_=R[u],h=1;h<s;h++)m<(x=Math.abs(t[r*S[h]+h]))&&(m=x,u=S[h],_=h);if(y=t[r*u+_],Math.abs(y)<=n)break;for(w=.5*(f[_]-f[u]),k=(g=Math.abs(w)+e(y,w))/(M=e(y,g)),M=y/M,g=y/g*y,w<0&&(M=-M,g=-g),t[r*u+_]=0,f[u]-=g,f[_]+=g,h=0;h<u;h++)b=r*h+_,z=t[v=r*h+u],A=t[b],t[v]=z*k-A*M,t[b]=z*M+A*k;for(h=u+1;h<_;h++)b=r*h+_,z=t[v=r*u+h],A=t[b],t[v]=z*k-A*M,t[b]=z*M+A*k;for(v=r*u+(h=_+1),b=r*_+h;h<s;h++,v++,b++)z=t[v],A=t[b],t[v]=z*k-A*M,t[b]=z*M+A*k;if(i)for(v=o*u,b=o*_,h=0;h<s;h++,v++,b++)z=i[v],A=i[b],i[v]=z*k-A*M,i[b]=z*M+A*k;for(c=0;c<2;c++){if((l=0==c?u:_)<s-1){for(d=l+1,m=Math.abs(t[r*l+d]),h=l+2;h<s;h++)m<(x=Math.abs(t[r*l+h]))&&(m=x,d=h);R[l]=d}if(l>0){for(d=0,m=Math.abs(t[l]),h=1;h<l;h++)m<(x=Math.abs(t[r*h+l]))&&(m=x,d=h);S[l]=d}}}for(u=0;u<s-1;u++){for(d=u,h=u+1;h<s;h++)f[d]<f[h]&&(d=h);if(u!=d&&(a(f,d,u,m),i))for(h=0;h<s;h++)a(i,o*d+h,o*u+h,m)}jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(O)}(c.data,i,u.data,r?r.data:null,i,i),f)for(;--i>=0;)f.data[i]=u.data[i];jsfeat.cache.put_buffer(n),jsfeat.cache.put_buffer(h)}});jsfeat.linalg=r}(),function(t){var a,e,r,f,i,o,s,n,h=(a=function(t){return t*t},e=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),r=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),f=new jsfeat.matrix_t(6,6,jsfeat.F32_t|jsfeat.C1_t),i=new jsfeat.matrix_t(6,1,jsfeat.F32_t|jsfeat.C1_t),o=function(){function t(){}return t.prototype.run=function(t,a,o,s){var n,h,c=0,u=0,d=o.type|jsfeat.C1_t,_=o.data,l=e.data,v=r.data,b=0,p=0;!function(t,a,e,r,f){for(var i,o,s=0,n=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0;s<f;++s)n+=t[s].x,h+=t[s].y,u+=a[s].x,d+=a[s].y;for(n/=f,h/=f,u/=f,d/=f,s=0;s<f;++s)l=t[s].x-n,v=t[s].y-h,c+=Math.sqrt(l*l+v*v),l=a[s].x-u,v=a[s].y-d,_+=Math.sqrt(l*l+v*v);c/=f,_/=f,i=Math.SQRT2/c,o=Math.SQRT2/_,e[0]=e[4]=i,e[2]=-n*i,e[5]=-h*i,e[1]=e[3]=e[6]=e[7]=0,e[8]=1,r[0]=r[4]=o,r[2]=-u*o,r[5]=-d*o,r[1]=r[3]=r[6]=r[7]=0,r[8]=1}(t,a,l,v,s);for(var j=jsfeat.cache.get_buffer(2*s*6<<3),m=jsfeat.cache.get_buffer(2*s<<3),x=new jsfeat.matrix_t(6,2*s,d,j.data),y=new jsfeat.matrix_t(1,2*s,d,m.data),w=x.data,g=y.data;c<s;++c)n=t[c],h=a[c],b=l[0]*n.x+l[1]*n.y+l[2],p=l[3]*n.x+l[4]*n.y+l[5],w[u=2*c*6]=b,w[u+1]=p,w[u+2]=1,w[u+3]=0,w[u+4]=0,w[u+5]=0,w[u+=6]=0,w[u+1]=0,w[u+2]=0,w[u+3]=b,w[u+4]=p,w[u+5]=1,g[c<<1]=v[0]*h.x+v[1]*h.y+v[2],g[1+(c<<1)]=v[3]*h.x+v[4]*h.y+v[5];return jsfeat.matmath.multiply_AtA(f,x),jsfeat.matmath.multiply_AtB(i,x,y),jsfeat.linalg.lu_solve(f,i),_[0]=i.data[0],_[1]=i.data[1],_[2]=i.data[2],_[3]=i.data[3],_[4]=i.data[4],_[5]=i.data[5],_[6]=0,_[7]=0,_[8]=1,jsfeat.matmath.invert_3x3(r,r),jsfeat.matmath.multiply_3x3(o,r,o),jsfeat.matmath.multiply_3x3(o,o,e),jsfeat.cache.put_buffer(j),jsfeat.cache.put_buffer(m),1},t.prototype.error=function(t,e,r,f,i){for(var o,s,n=0,h=r.data;n<i;++n)o=t[n],s=e[n],f[n]=a(s.x-h[0]*o.x-h[1]*o.y-h[2])+a(s.y-h[3]*o.x-h[4]*o.y-h[5])},t.prototype.check_subset=function(t,a,e){return!0},t}(),s=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),n=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),{affine2d:o,homography2d:function(){function t(){}return t.prototype.run=function(t,a,f,i){for(var o=0,h=0,c=f.data,u=e.data,d=r.data,_=s.data,l=n.data,v=0,b=0,p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0;o<i;++o)y+=a[o].x,w+=a[o].y,k+=t[o].x,z+=t[o].y;for(y/=i,w/=i,k/=i,z/=i,o=0;o<i;++o)m+=Math.abs(a[o].x-y),x+=Math.abs(a[o].y-w),g+=Math.abs(t[o].x-k),M+=Math.abs(t[o].y-z);if(Math.abs(m)<jsfeat.EPSILON||Math.abs(x)<jsfeat.EPSILON||Math.abs(g)<jsfeat.EPSILON||Math.abs(M)<jsfeat.EPSILON)return 0;for(m=i/m,x=i/x,g=i/g,M=i/M,u[0]=g,u[1]=0,u[2]=-k*g,u[3]=0,u[4]=M,u[5]=-z*M,u[6]=0,u[7]=0,u[8]=1,d[0]=1/m,d[1]=0,d[2]=y,d[3]=0,d[4]=1/x,d[5]=w,d[6]=0,d[7]=0,d[8]=1,o=81;--o>=0;)_[o]=0;for(o=0;o<i;++o)v=(a[o].x-y)*m,b=(a[o].y-w)*x,p=(t[o].x-k)*g,j=(t[o].y-z)*M,_[0]+=p*p,_[1]+=p*j,_[2]+=p,_[6]+=p*-v*p,_[7]+=p*-v*j,_[8]+=p*-v,_[10]+=j*j,_[11]+=j,_[15]+=j*-v*p,_[16]+=j*-v*j,_[17]+=j*-v,_[20]+=1,_[24]+=-v*p,_[25]+=-v*j,_[26]+=-v,_[30]+=p*p,_[31]+=p*j,_[32]+=p,_[33]+=p*-b*p,_[34]+=p*-b*j,_[35]+=p*-b,_[40]+=j*j,_[41]+=j,_[42]+=j*-b*p,_[43]+=j*-b*j,_[44]+=j*-b,_[50]+=1,_[51]+=-b*p,_[52]+=-b*j,_[53]+=-b,_[60]+=-v*p*-v*p+-b*p*-b*p,_[61]+=-v*p*-v*j+-b*p*-b*j,_[62]+=-v*p*-v+-b*p*-b,_[70]+=-v*j*-v*j+-b*j*-b*j,_[71]+=-v*j*-v+-b*j*-b,_[80]+=-v*-v+-b*-b;for(o=0;o<9;++o)for(h=0;h<o;++h)_[9*o+h]=_[9*h+o];return jsfeat.linalg.eigenVV(s,n),c[0]=l[72],c[1]=l[73],c[2]=l[74],c[3]=l[75],c[4]=l[76],c[5]=l[77],c[6]=l[78],c[7]=l[79],c[8]=l[80],jsfeat.matmath.multiply_3x3(f,r,f),jsfeat.matmath.multiply_3x3(f,f,e),v=1/c[8],c[0]*=v,c[1]*=v,c[2]*=v,c[3]*=v,c[4]*=v,c[5]*=v,c[6]*=v,c[7]*=v,c[8]=1,1},t.prototype.error=function(t,a,e,r,f){for(var i,o,s=0,n=0,h=0,c=0,u=e.data;s<f;++s)i=t[s],o=a[s],n=1/(u[6]*i.x+u[7]*i.y+1),h=(u[0]*i.x+u[1]*i.y+u[2])*n-o.x,c=(u[3]*i.x+u[4]*i.y+u[5])*n-o.y,r[s]=h*h+c*c},t.prototype.check_subset=function(t,a,e){if(4==e){var r=0,f=t[0],i=t[1],o=t[2],s=t[3],n=a[0],h=a[1],c=a[2],u=a[3],d=f.x,_=f.y,l=i.x,v=i.y,b=o.x,p=o.y,j=n.x,m=n.y,x=h.x,y=h.y,w=c.x,g=c.y,M=jsfeat.matmath.determinant_3x3(d,_,1,l,v,1,b,p,1),k=jsfeat.matmath.determinant_3x3(j,m,1,x,y,1,w,g,1);if(M*k<0&&r++,d=i.x,_=i.y,l=o.x,v=o.y,b=s.x,p=s.y,j=h.x,m=h.y,x=c.x,y=c.y,w=u.x,g=u.y,(M=jsfeat.matmath.determinant_3x3(d,_,1,l,v,1,b,p,1))*(k=jsfeat.matmath.determinant_3x3(j,m,1,x,y,1,w,g,1))<0&&r++,d=f.x,_=f.y,l=o.x,v=o.y,b=s.x,p=s.y,j=n.x,m=n.y,x=c.x,y=c.y,w=u.x,g=u.y,(M=jsfeat.matmath.determinant_3x3(d,_,1,l,v,1,b,p,1))*(k=jsfeat.matmath.determinant_3x3(j,m,1,x,y,1,w,g,1))<0&&r++,d=f.x,_=f.y,l=i.x,v=i.y,b=s.x,p=s.y,j=n.x,m=n.y,x=h.x,y=h.y,w=u.x,g=u.y,(M=jsfeat.matmath.determinant_3x3(d,_,1,l,v,1,b,p,1))*(k=jsfeat.matmath.determinant_3x3(j,m,1,x,y,1,w,g,1))<0&&r++,0!=r&&4!=r)return!1}return!0},t}()}),c=function(){function t(t,a,e,r){void 0===t&&(t=0),void 0===a&&(a=.5),void 0===e&&(e=.5),void 0===r&&(r=.99),this.size=t,this.thresh=a,this.eps=e,this.prob=r}return t.prototype.update_iters=function(t,a){var e=Math.log(1-this.prob),r=Math.log(1-Math.pow(1-t,this.size));return 0|(r>=0||-e>=a*-r?a:Math.round(e/r))},t}(),u=function(){var t=function(t,a,e,r,f,i,o){for(var s=1e3,n=[],h=0,c=0,u=0,d=0,_=!1;u<s;++u){for(h=0;h<r&&u<s;){for(_=!1,d=0;!_;)for(_=!0,d=n[h]=0|Math.floor(Math.random()*f),c=0;c<h;++c)if(d==n[c]){_=!1;break}i[h]=a[d],o[h]=e[d],t.check_subset(i,o,h+1)?++h:u++}break}return h==r&&u<s},a=function(t,a,e,r,f,i,o,s){var n=0,h=0,c=0,u=i*i;for(t.error(e,r,a,o,f);h<f;++h)c=o[h]<=u,s[h]=c,n+=c;return n};return{ransac:function(e,r,f,i,o,s,n,h){if(void 0===h&&(h=1e3),o<e.size)return!1;var c=e.size,u=h,d=0,_=!1,l=[],v=[],b=s.cols,p=s.rows,j=s.type|jsfeat.C1_t,m=jsfeat.cache.get_buffer(b*p<<3),x=jsfeat.cache.get_buffer(o),y=jsfeat.cache.get_buffer(o<<2),w=new jsfeat.matrix_t(b,p,j,m.data),g=new jsfeat.matrix_t(o,1,jsfeat.U8C1_t,x.data),M=-1,k=0,z=y.f32;if(o==c){if(r.run(f,i,w,o)<=0)return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),!1;if(w.copy_to(s),n)for(;--o>=0;)n.data[o]=1;return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),!0}for(;d<u;++d){if(!t(r,f,i,c,o,l,v)){if(0==d)return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),!1;break}r.run(l,v,w,c)<=0||(k=a(r,w,f,i,o,e.thresh,z,g.data))>Math.max(M,c-1)&&(w.copy_to(s),M=k,n&&g.copy_to(n),u=e.update_iters((o-k)/o,u),_=!0)}return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),_},lmeds:function(e,r,f,i,o,s,n,h){if(void 0===h&&(h=1e3),o<e.size)return!1;var c=e.size,u=h,d=0,_=!1,l=[],v=[],b=s.cols,p=s.rows,j=s.type|jsfeat.C1_t,m=jsfeat.cache.get_buffer(b*p<<3),x=jsfeat.cache.get_buffer(o),y=jsfeat.cache.get_buffer(o<<2),w=new jsfeat.matrix_t(b,p,j,m.data),g=new jsfeat.matrix_t(o,1,jsfeat.U8_t|jsfeat.C1_t,x.data),M=0,k=y.f32,z=1e9,A=0,C=0;if(e.eps=.45,u=e.update_iters(e.eps,u),o==c){if(r.run(f,i,w,o)<=0)return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),!1;if(w.copy_to(s),n)for(;--o>=0;)n.data[o]=1;return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),!0}for(;d<u;++d){if(!t(r,f,i,c,o,l,v)){if(0==d)return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),!1;break}r.run(l,v,w,c)<=0||(r.error(f,i,w,k,o),(C=jsfeat.math.median(k,0,o-1))<z&&(z=C,w.copy_to(s),_=!0))}return _&&(A=2.5*1.4826*(1+5/(o-c))*Math.sqrt(z),A=Math.max(A,.001),M=a(r,s,f,i,o,A,k,g.data),n&&g.copy_to(n),_=M>=c),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),_}}}();t.ransac_params_t=c,t.motion_model=h,t.motion_estimator=u}(jsfeat),function(t){var a={grayscale:function(t,a,e,r,f){void 0===f&&(f=jsfeat.COLOR_RGBA2GRAY);var i=0,o=0,s=0,n=0,h=0,c=0,u=4899,d=9617,_=1868,l=4;f!=jsfeat.COLOR_BGRA2GRAY&&f!=jsfeat.COLOR_BGR2GRAY||(u=1868,_=4899),f!=jsfeat.COLOR_RGB2GRAY&&f!=jsfeat.COLOR_BGR2GRAY||(l=3);var v=l<<1,b=3*l|0;r.resize(a,e,1);var p=r.data;for(o=0;o<e;++o,n+=a,s+=a*l){for(i=0,h=s,c=n;i<=a-4;i+=4,h+=l<<2,c+=4)p[c]=t[h]*u+t[h+1]*d+t[h+2]*_+8192>>14,p[c+1]=t[h+l]*u+t[h+l+1]*d+t[h+l+2]*_+8192>>14,p[c+2]=t[h+v]*u+t[h+v+1]*d+t[h+v+2]*_+8192>>14,p[c+3]=t[h+b]*u+t[h+b+1]*d+t[h+b+2]*_+8192>>14;for(;i<a;++i,++c,h+=l)p[c]=t[h]*u+t[h+1]*d+t[h+2]*_+8192>>14}},resample:function(t,a,e,r){var f=t.rows,i=t.cols;f>r&&i>e&&(a.resize(e,r,t.channel),t.type&jsfeat.U8_t&&a.type&jsfeat.U8_t&&f*i/(r*e)<256?function(t,a,e,r){for(var f=0,i=t.channel,o=t.cols,s=t.rows,n=t.data,h=a.data,c=o/e,u=s/r,d=c*u*65536|0,_=0,l=0,v=0,b=0,p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=jsfeat.cache.get_buffer(e*i<<2),R=jsfeat.cache.get_buffer(e*i<<2),S=jsfeat.cache.get_buffer(2*o*3<<2),L=O.i32,U=R.i32,q=S.i32;_<e;_++){for(p=1+(y=_*c)-1e-6|0,j=0|(w=y+c),p=Math.min(p,o-1),j=Math.min(j,o-1),p>y&&(q[x++]=_*i|0,q[x++]=(p-1)*i|0,q[x++]=256*(p-y)|0,f++),v=p;v<j;v++)f++,q[x++]=_*i|0,q[x++]=v*i|0,q[x++]=256;w-j>.001&&(f++,q[x++]=_*i|0,q[x++]=j*i|0,q[x++]=256*(w-j)|0)}for(_=0;_<e*i;_++)L[_]=U[_]=0;for(l=0,b=0;b<s;b++){for(g=o*b,x=0;x<f;x++)for(k=q[3*x],p=q[3*x+1],z=q[3*x+2],m=0;m<i;m++)L[k+m]+=n[g+p+m]*z;if((l+1)*u<=b+1||b==s-1){if(C=256-(A=256*Math.max(b+1-(l+1)*u,0)|0),M=e*l,A<=0)for(_=0;_<e*i;_++)h[M+_]=Math.min(Math.max((U[_]+256*L[_])/d,0),255),U[_]=L[_]=0;else for(_=0;_<e*i;_++)h[M+_]=Math.min(Math.max((U[_]+L[_]*C)/d,0),255),U[_]=L[_]*A,L[_]=0;l++}else for(_=0;_<e*i;_++)U[_]+=256*L[_],L[_]=0}jsfeat.cache.put_buffer(R),jsfeat.cache.put_buffer(O),jsfeat.cache.put_buffer(S)}(t,a,e,r):function(t,a,e,r){for(var f=0,i=t.channel,o=t.cols,s=t.rows,n=t.data,h=a.data,c=o/e,u=s/r,d=1/(c*u),_=0,l=0,v=0,b=0,p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=jsfeat.cache.get_buffer(e*i<<2),R=jsfeat.cache.get_buffer(e*i<<2),S=jsfeat.cache.get_buffer(2*o*3<<2),L=O.f32,U=R.f32,q=S.f32;_<e;_++){for(p=1+(y=_*c)-1e-6|0,j=0|(w=y+c),p=Math.min(p,o-1),j=Math.min(j,o-1),p>y&&(f++,q[x++]=(p-1)*i|0,q[x++]=_*i|0,q[x++]=(p-y)*d),v=p;v<j;v++)f++,q[x++]=v*i|0,q[x++]=_*i|0,q[x++]=d;w-j>.001&&(f++,q[x++]=j*i|0,q[x++]=_*i|0,q[x++]=(w-j)*d)}for(_=0;_<e*i;_++)L[_]=U[_]=0;for(l=0,b=0;b<s;b++){for(g=o*b,x=0;x<f;x++)for(p=0|q[3*x],k=0|q[3*x+1],z=q[3*x+2],m=0;m<i;m++)L[k+m]+=n[g+p+m]*z;if((l+1)*u<=b+1||b==s-1){if(C=1-(A=Math.max(b+1-(l+1)*u,0)),M=e*l,Math.abs(A)<.001)for(_=0;_<e*i;_++)h[M+_]=U[_]+L[_],U[_]=L[_]=0;else for(_=0;_<e*i;_++)h[M+_]=U[_]+L[_]*C,U[_]=L[_]*A,L[_]=0;l++}else for(_=0;_<e*i;_++)U[_]+=L[_],L[_]=0}jsfeat.cache.put_buffer(R),jsfeat.cache.put_buffer(O),jsfeat.cache.put_buffer(S)}(t,a,e,r))},box_blur_gray:function(t,a,e,r){void 0===r&&(r=0);var f=t.cols,i=t.rows,o=i<<1,s=f<<1,n=0,h=0,c=0,u=0,d=1+(e<<1)|0,_=e+1|0,l=_+1|0,v=r&jsfeat.BOX_BLUR_NOSCALE?1:1/(d*d),b=jsfeat.cache.get_buffer(f*i<<2),p=0,j=0,m=0,x=0,y=0,w=b.i32,g=t.data,M=0;for(a.resize(f,i,t.channel),c=0;c<i;++c){for(j=c,p=_*g[m],n=m+1|0,u=m+e|0;n<=u;++n)p+=g[n];for(x=m+_|0,M=g[y=m],h=0;h<e;++h,j+=i)w[j]=p,p+=g[x]-M,x++;for(;h<f-l;h+=2,j+=o)w[j]=p,p+=g[x]-g[y],w[j+i]=p,p+=g[x+1]-g[y+1],x+=2,y+=2;for(;h<f-_;++h,j+=i)w[j]=p,p+=g[x]-g[y],x++,y++;for(M=g[x-1];h<f;++h,j+=i)w[j]=p,p+=M-g[y],y++;m+=f}if(m=0,g=a.data,1==v)for(c=0;c<f;++c){for(j=c,p=_*w[m],n=m+1|0,u=m+e|0;n<=u;++n)p+=w[n];for(x=m+_,M=w[y=m],h=0;h<e;++h,j+=f)g[j]=p,p+=w[x]-M,x++;for(;h<i-l;h+=2,j+=s)g[j]=p,p+=w[x]-w[y],g[j+f]=p,p+=w[x+1]-w[y+1],x+=2,y+=2;for(;h<i-_;++h,j+=f)g[j]=p,p+=w[x]-w[y],x++,y++;for(M=w[x-1];h<i;++h,j+=f)g[j]=p,p+=M-w[y],y++;m+=i}else for(c=0;c<f;++c){for(j=c,p=_*w[m],n=m+1|0,u=m+e|0;n<=u;++n)p+=w[n];for(x=m+_,M=w[y=m],h=0;h<e;++h,j+=f)g[j]=p*v,p+=w[x]-M,x++;for(;h<i-l;h+=2,j+=s)g[j]=p*v,p+=w[x]-w[y],g[j+f]=p*v,p+=w[x+1]-w[y+1],x+=2,y+=2;for(;h<i-_;++h,j+=f)g[j]=p*v,p+=w[x]-w[y],x++,y++;for(M=w[x-1];h<i;++h,j+=f)g[j]=p*v,p+=M-w[y],y++;m+=i}jsfeat.cache.put_buffer(b)},gaussian_blur:function(t,a,e,r){void 0===r&&(r=0),void 0===e&&(e=0);var f=(e=0==e?2*Math.max(1,4*r+1-1e-8)+1|0:e)>>1,i=t.cols,o=t.rows,s=t.type,n=s&jsfeat.U8_t;a.resize(i,o,t.channel);var h,c,u=t.data,d=a.data,_=e+Math.max(o,i)|0,l=jsfeat.cache.get_buffer(_<<2),v=jsfeat.cache.get_buffer(e<<2);n?(h=l.i32,c=v.i32):s&jsfeat.S32_t?(h=l.i32,c=v.f32):(h=l.f32,c=v.f32),jsfeat.math.get_gaussian_kernel(e,r,c,s),n?function(t,a,e,r,f,i,o,s){for(var n=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=i[0],j=0,m=r<<1,x=3*r,y=r<<2;n<f;++n){for(_=a[u],h=0;h<s;++h)t[h]=_;for(h=0;h<=r-2;h+=2)t[h+s]=a[u+h],t[h+s+1]=a[u+h+1];for(;h<r;++h)t[h+s]=a[u+h];for(_=a[u+r-1],h=r;h<s+r;++h)t[h+s]=_;for(h=0;h<=r-4;h+=4){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)j=i[c],_+=t[c+h]*j,l+=t[c+h+1]*j,v+=t[c+h+2]*j,b+=t[c+h+3]*j;e[d+h]=Math.min(_>>8,255),e[d+h+1]=Math.min(l>>8,255),e[d+h+2]=Math.min(v>>8,255),e[d+h+3]=Math.min(b>>8,255)}for(;h<r;++h){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];e[d+h]=Math.min(_>>8,255)}u+=r,d+=r}for(n=0;n<r;++n){for(_=e[n],h=0;h<s;++h)t[h]=_;for(c=n,h=0;h<=f-2;h+=2,c+=m)t[h+s]=e[c],t[h+s+1]=e[c+r];for(;h<f;++h,c+=r)t[h+s]=e[c];for(_=e[(f-1)*r+n],h=f;h<s+f;++h)t[h+s]=_;for(d=n,h=0;h<=f-4;h+=4,d+=y){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)j=i[c],_+=t[c+h]*j,l+=t[c+h+1]*j,v+=t[c+h+2]*j,b+=t[c+h+3]*j;e[d]=Math.min(_>>8,255),e[d+r]=Math.min(l>>8,255),e[d+m]=Math.min(v>>8,255),e[d+x]=Math.min(b>>8,255)}for(;h<f;++h,d+=r){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];e[d]=Math.min(_>>8,255)}}}(h,u,d,i,o,c,e,f):function(t,a,e,r,f,i,o,s){for(var n=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=i[0],j=0,m=r<<1,x=3*r,y=r<<2;n<f;++n){for(_=a[u],h=0;h<s;++h)t[h]=_;for(h=0;h<=r-2;h+=2)t[h+s]=a[u+h],t[h+s+1]=a[u+h+1];for(;h<r;++h)t[h+s]=a[u+h];for(_=a[u+r-1],h=r;h<s+r;++h)t[h+s]=_;for(h=0;h<=r-4;h+=4){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)j=i[c],_+=t[c+h]*j,l+=t[c+h+1]*j,v+=t[c+h+2]*j,b+=t[c+h+3]*j;e[d+h]=_,e[d+h+1]=l,e[d+h+2]=v,e[d+h+3]=b}for(;h<r;++h){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];e[d+h]=_}u+=r,d+=r}for(n=0;n<r;++n){for(_=e[n],h=0;h<s;++h)t[h]=_;for(c=n,h=0;h<=f-2;h+=2,c+=m)t[h+s]=e[c],t[h+s+1]=e[c+r];for(;h<f;++h,c+=r)t[h+s]=e[c];for(_=e[(f-1)*r+n],h=f;h<s+f;++h)t[h+s]=_;for(d=n,h=0;h<=f-4;h+=4,d+=y){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)j=i[c],_+=t[c+h]*j,l+=t[c+h+1]*j,v+=t[c+h+2]*j,b+=t[c+h+3]*j;e[d]=_,e[d+r]=l,e[d+m]=v,e[d+x]=b}for(;h<f;++h,d+=r){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];e[d]=_}}}(h,u,d,i,o,c,e,f),jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(v)},pyrdown:function(t,a,e,r){void 0===e&&(e=0),void 0===r&&(r=0);var f=t.cols,i=f>>1,o=t.rows>>1,s=i-(e<<1),n=o-(r<<1),h=0,c=0,u=e+r*f,d=0,_=0,l=0;a.resize(i,o,t.channel);var v=t.data,b=a.data;for(c=0;c<n;++c){for(d=u,l=_,h=0;h<=s-2;h+=2,l+=2,d+=4)b[l]=v[d]+v[d+1]+v[d+f]+v[d+f+1]+2>>2,b[l+1]=v[d+2]+v[d+3]+v[d+f+2]+v[d+f+3]+2>>2;for(;h<s;++h,++l,d+=2)b[l]=v[d]+v[d+1]+v[d+f]+v[d+f+1]+2>>2;u+=f<<1,_+=i}},scharr_derivatives:function(t,a){var e,r,f,i,o,s,n,h,c=t.cols,u=t.rows,d=c<<1,_=0,l=0,v=0,b=0,p=0,j=0,m=0;a.resize(c,u,2);var x=t.data,y=a.data,w=jsfeat.cache.get_buffer(c+2<<2),g=jsfeat.cache.get_buffer(c+2<<2);for(t.type&jsfeat.U8_t||t.type&jsfeat.S32_t?(n=w.i32,h=g.i32):(n=w.f32,h=g.f32);l<u;++l,p+=c){for(b=(l>0?l-1:1)*c|0,j=(l<u-1?l+1:u-2)*c|0,m=l*d|0,_=0,v=1;_<=c-2;_+=2,v+=2)e=x[b+_],r=x[j+_],n[v]=3*(e+r)+10*x[p+_],h[v]=r-e,e=x[b+_+1],r=x[j+_+1],n[v+1]=3*(e+r)+10*x[p+_+1],h[v+1]=r-e;for(;_<c;++_,++v)e=x[b+_],r=x[j+_],n[v]=3*(e+r)+10*x[p+_],h[v]=r-e;for(_=c+1|0,n[0]=n[1],n[_]=n[c],h[0]=h[1],h[_]=h[c],_=0;_<=c-4;_+=4)e=h[_+2],r=h[_+1],f=h[_+3],i=h[_+4],o=n[_+2],s=n[_+3],y[m++]=o-n[_],y[m++]=3*(e+h[_])+10*r,y[m++]=s-n[_+1],y[m++]=3*(f+r)+10*e,y[m++]=n[_+4]-o,y[m++]=3*(i+e)+10*f,y[m++]=n[_+5]-s,y[m++]=3*(h[_+5]+f)+10*i;for(;_<c;++_)y[m++]=n[_+2]-n[_],y[m++]=3*(h[_+2]+h[_])+10*h[_+1]}jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(g)},sobel_derivatives:function(t,a){var e,r,f,i,o,s,n,h,c=t.cols,u=t.rows,d=c<<1,_=0,l=0,v=0,b=0,p=0,j=0,m=0;a.resize(c,u,2);var x=t.data,y=a.data,w=jsfeat.cache.get_buffer(c+2<<2),g=jsfeat.cache.get_buffer(c+2<<2);for(t.type&jsfeat.U8_t||t.type&jsfeat.S32_t?(n=w.i32,h=g.i32):(n=w.f32,h=g.f32);l<u;++l,p+=c){for(b=(l>0?l-1:1)*c|0,j=(l<u-1?l+1:u-2)*c|0,m=l*d|0,_=0,v=1;_<=c-2;_+=2,v+=2)e=x[b+_],r=x[j+_],n[v]=e+r+2*x[p+_],h[v]=r-e,e=x[b+_+1],r=x[j+_+1],n[v+1]=e+r+2*x[p+_+1],h[v+1]=r-e;for(;_<c;++_,++v)e=x[b+_],r=x[j+_],n[v]=e+r+2*x[p+_],h[v]=r-e;for(_=c+1|0,n[0]=n[1],n[_]=n[c],h[0]=h[1],h[_]=h[c],_=0;_<=c-4;_+=4)e=h[_+2],r=h[_+1],f=h[_+3],i=h[_+4],o=n[_+2],s=n[_+3],y[m++]=o-n[_],y[m++]=e+h[_]+2*r,y[m++]=s-n[_+1],y[m++]=f+r+2*e,y[m++]=n[_+4]-o,y[m++]=i+e+2*f,y[m++]=n[_+5]-s,y[m++]=h[_+5]+f+2*i;for(;_<c;++_)y[m++]=n[_+2]-n[_],y[m++]=h[_+2]+h[_]+2*h[_+1]}jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(g)},compute_integral_image:function(t,a,e,r){var f=0|t.cols,i=0|t.rows,o=t.data,s=f+1|0,n=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0;if(a&&e){for(;d<s;++d)a[d]=0,e[d]=0;for(c=s+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(n=h=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)n+=l=o[v],h+=l*l,a[c]=a[u]+n,e[c]=e[u]+h,n+=l=o[v+1],h+=l*l,a[c+1]=a[u+1]+n,e[c+1]=e[u+1]+h;for(;_<f;++_,++v,++c,++u)n+=l=o[v],h+=l*l,a[c]=a[u]+n,e[c]=e[u]+h}}else if(a){for(;d<s;++d)a[d]=0;for(c=s+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(n=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)n+=o[v],a[c]=a[u]+n,n+=o[v+1],a[c+1]=a[u+1]+n;for(;_<f;++_,++v,++c,++u)n+=o[v],a[c]=a[u]+n}}else if(e){for(;d<s;++d)e[d]=0;for(c=s+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(h=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)h+=(l=o[v])*l,e[c]=e[u]+h,h+=(l=o[v+1])*l,e[c+1]=e[u+1]+h;for(;_<f;++_,++v,++c,++u)h+=(l=o[v])*l,e[c]=e[u]+h}}if(r){for(d=0;d<s;++d)r[d]=0;for(c=s+1|0,u=0,d=0,v=0;d<i;++d,++c,++u){for(_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)r[c]=o[v]+r[u],r[c+1]=o[v+1]+r[u+1];for(;_<f;++_,++v,++c,++u)r[c]=o[v]+r[u]}for(c=s+f|0,u=f,d=0;d<i;++d,c+=s,u+=s)r[c]+=r[u];for(_=f-1;_>0;--_)for(u=(c=_+i*s)-s,d=i;d>0;--d,c-=s,u-=s)r[c]+=r[u]+r[u+1]}},equalize_histogram:function(t,a){var e=t.cols,r=t.rows,f=t.data;a.resize(e,r,t.channel);var i,o,s=a.data,n=e*r,h=0,c=0,u=jsfeat.cache.get_buffer(1024);for(i=u.i32;h<256;++h)i[h]=0;for(h=0;h<n;++h)++i[f[h]];for(c=i[0],h=1;h<256;++h)c=i[h]+=c;for(o=255/n,h=0;h<n;++h)s[h]=i[f[h]]*o+.5|0;jsfeat.cache.put_buffer(u)},canny:function(t,a,e,r){var f=t.cols,i=t.rows;t.data,a.resize(f,i,t.channel);var o=a.data,s=0,n=0,h=0,c=f<<1,u=0,d=0,_=0,l=0,v=0,b=0,p=0,j=0,m=jsfeat.cache.get_buffer(i*c<<2),x=jsfeat.cache.get_buffer(3*(f+2)<<2),y=jsfeat.cache.get_buffer((i+2)*(f+2)<<2),w=jsfeat.cache.get_buffer(i*f<<2),g=x.i32,M=y.i32,k=w.i32,z=m.i32,A=new jsfeat.matrix_t(f,i,jsfeat.S32C2_t,m.data),C=1,O=f+2+1|0,R=2*(f+2)+1|0,S=f+2|0,L=S+1|0,U=0;for(this.sobel_derivatives(t,A),e>r&&(s=e,e=r,r=s),s=3*(f+2)|0;--s>=0;)g[s]=0;for(s=(i+2)*(f+2)|0;--s>=0;)M[s]=0;for(;n<f;++n,h+=2)l=z[h],v=z[h+1],g[O+n]=(l^l>>31)-(l>>31)+((v^v>>31)-(v>>31));for(s=1;s<=i;++s,h+=c){if(s==i)for(n=R+f;--n>=R;)g[n]=0;else for(n=0;n<f;n++)l=z[h+(n<<1)],v=z[h+(n<<1)+1],g[R+n]=(l^l>>31)-(l>>31)+((v^v>>31)-(v>>31));for(u=h-c|0,M[L-1]=0,d=0,n=0;n<f;++n,u+=2){if((_=g[O+n])>e)if(b=(l=z[u])^(v=z[u+1]),v=(v^v>>31)-(v>>31)|0,j=(p=13573*(l=(l^l>>31)-(l>>31)|0))+(l+l<<15),(v<<=15)<p){if(_>g[O+n-1]&&_>=g[O+n+1]){_>r&&!d&&2!=M[L+n-S]?(M[L+n]=2,d=1,k[U++]=L+n):M[L+n]=1;continue}}else if(v>j){if(_>g[C+n]&&_>=g[R+n]){_>r&&!d&&2!=M[L+n-S]?(M[L+n]=2,d=1,k[U++]=L+n):M[L+n]=1;continue}}else if(_>g[C+n-(b=b<0?-1:1)]&&_>g[R+n+b]){_>r&&!d&&2!=M[L+n-S]?(M[L+n]=2,d=1,k[U++]=L+n):M[L+n]=1;continue}M[L+n]=0,d=0}M[L+f]=0,L+=S,n=C,C=O,O=R,R=n}for(n=L-S-1,s=0;s<S;++s,++n)M[n]=0;for(;U>0;)L=k[--U],1==M[L-=S+1]&&(M[L]=2,k[U++]=L),1==M[L+=1]&&(M[L]=2,k[U++]=L),1==M[L+=1]&&(M[L]=2,k[U++]=L),1==M[L+=S]&&(M[L]=2,k[U++]=L),1==M[L-=2]&&(M[L]=2,k[U++]=L),1==M[L+=S]&&(M[L]=2,k[U++]=L),1==M[L+=1]&&(M[L]=2,k[U++]=L),1==M[L+=1]&&(M[L]=2,k[U++]=L);for(L=S+1,C=0,s=0;s<i;++s,L+=S)for(n=0;n<f;++n)o[C++]=255*(2==M[L+n]);jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(y),jsfeat.cache.put_buffer(w)},warp_perspective:function(t,a,e,r){void 0===r&&(r=0);for(var f=0|t.cols,i=0|t.rows,o=0|a.cols,s=0|a.rows,n=t.data,h=a.data,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=e.data,z=k[0],A=k[1],C=k[2],O=k[3],R=k[4],S=k[5],L=k[6],U=k[7],q=k[8],I=0;u<s;++u)for(p=A*u+C,j=R*u+S,m=U*u+q,c=0;c<o;++c,++I,p+=z,j+=O,m+=L)_=0|(v=p*(x=1/m)),l=0|(b=j*x),v>0&&b>0&&_<f-1&&l<i-1?(y=Math.max(v-_,0),w=Math.max(b-l,0),g=n[d=f*l+_|0]+y*(n[d+1]-n[d]),M=n[d+f]+y*(n[d+f+1]-n[d+f]),h[I]=g+w*(M-g)):h[I]=r},warp_affine:function(t,a,e,r){void 0===r&&(r=0);for(var f=t.cols,i=t.rows,o=a.cols,s=a.rows,n=t.data,h=a.data,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,j=0,m=0,x=0,y=e.data,w=y[0],g=y[1],M=y[2],k=y[3],z=y[4],A=y[5],C=0;u<s;++u)for(v=g*u+M,b=z*u+A,c=0;c<o;++c,++C,v+=w,b+=k)l=0|b,(_=0|v)>=0&&l>=0&&_<f-1&&l<i-1?(p=v-_,j=b-l,m=n[d=f*l+_]+p*(n[d+1]-n[d]),x=n[d+f]+p*(n[d+f+1]-n[d+f]),h[C]=m+j*(x-m)):h[C]=r},skindetector:function(t,a){for(var e,r,f,i,o=t.width*t.height;o--;)i=4*o,e=t.data[i],r=t.data[i+1],f=t.data[i+2],e>95&&r>40&&f>20&&e>r&&e>f&&e-Math.min(r,f)>15&&Math.abs(e-r)>15?a[o]=255:a[o]=0}};jsfeat.imgproc=a}(),function(t){var a,e,r,f,i,o,s=(a=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),e=new Uint8Array(512),r=new Int32Array(25),f=new Int32Array(25),i=function(t,a,e,r,f){for(var i=0,o=t[a],s=f,n=0,h=0,c=0;i<25;++i)r[i]=o-t[a+e[i]];for(i=0;i<16;i+=2)n=Math.min(r[i+1],r[i+2]),(n=Math.min(n,r[i+3]))<=s||(n=Math.min(n,r[i+4]),n=Math.min(n,r[i+5]),n=Math.min(n,r[i+6]),n=Math.min(n,r[i+7]),n=Math.min(n,r[i+8]),s=Math.max(s,Math.min(n,r[i])),s=Math.max(s,Math.min(n,r[i+9])));for(h=-s,i=0;i<16;i+=2)c=Math.max(r[i+1],r[i+2]),c=Math.max(c,r[i+3]),c=Math.max(c,r[i+4]),(c=Math.max(c,r[i+5]))>=h||(c=Math.max(c,r[i+6]),c=Math.max(c,r[i+7]),c=Math.max(c,r[i+8]),h=Math.min(h,Math.max(c,r[i])),h=Math.min(h,Math.max(c,r[i+9])));return-h-1},o=20,{set_threshold:function(t){o=Math.min(Math.max(t,0),255);for(var a=-255;a<=255;++a)e[a+255]=a<-o?1:a>o?2:0;return o},detect:function(t,s,n){void 0===n&&(n=3);var h,c=t.data,u=t.cols,d=t.rows,_=0,l=0,v=0,b=0,p=0,j=jsfeat.cache.get_buffer(3*u),m=jsfeat.cache.get_buffer(3*(u+1)<<2),x=j.u8,y=m.i32,w=r,g=f,M=Math.max(3,n),k=Math.min(d-2,d-n),z=Math.max(3,n),A=Math.min(u-3,u-n),C=0,O=0,R=i,S=e,L=o,U=0,q=0,I=0,G=0,B=0,F=0,N=0,V=0,E=0,P=0,T=0,Y=0;!function(t,e,r){for(var f=0,i=a;f<r;++f)t[f]=i[f<<1]+i[1+(f<<1)]*e;for(;f<25;++f)t[f]=t[f-r]}(w,u,16);var D=w[0],Q=w[1],X=w[2],H=w[3],J=w[4],K=w[5],W=w[6],Z=w[7],$=w[8],tt=w[9],at=w[10],et=w[11],rt=w[12],ft=w[13],it=w[14],ot=w[15];for(_=0;_<3*u;++_)x[_]=0;for(_=M;_<k;++_){for(N=_*u+z|0,F=(p=(_-3)%3)*u|0,B=p*(u+1)|0,l=0;l<u;++l)x[F+l]=0;if(G=0,_<k-1)for(l=z;l<A;++l,++N)if(0!=(I=S[(q=255-(U=c[N]))+c[N+D]]|S[q+c[N+$]])&&(I&=S[q+c[N+X]]|S[q+c[N+at]],I&=S[q+c[N+J]]|S[q+c[N+rt]],0!=(I&=S[q+c[N+W]]|S[q+c[N+it]]))){if(I&=S[q+c[N+Q]]|S[q+c[N+tt]],I&=S[q+c[N+H]]|S[q+c[N+et]],I&=S[q+c[N+K]]|S[q+c[N+ft]],1&(I&=S[q+c[N+Z]]|S[q+c[N+ot]]))for(b=U-L,C=0,v=0;v<25;++v)if(c[N+w[v]]<b){if(++C>8){y[B+ ++G]=l,x[F+l]=R(c,N,w,g,L);break}}else C=0;if(2&I)for(b=U+L,C=0,v=0;v<25;++v)if(c[N+w[v]]>b){if(++C>8){y[B+ ++G]=l,x[F+l]=R(c,N,w,g,L);break}}else C=0}if(y[B+u]=G,_!=M)for(V=(p=(_-4+3)%3)*u|0,B=p*(u+1)|0,E=(p=(_-5+3)%3)*u|0,G=y[B+u],v=0;v<G;++v)P=(l=y[B+v])+1|0,T=l-1|0,(Y=x[V+l])>x[V+P]&&Y>x[V+T]&&Y>x[E+T]&&Y>x[E+l]&&Y>x[E+P]&&Y>x[F+T]&&Y>x[F+l]&&Y>x[F+P]&&((h=s[O]).x=l,h.y=_-1,h.score=Y,O++)}return jsfeat.cache.put_buffer(j),jsfeat.cache.put_buffer(m),O}});t.fast_corners=s,s.set_threshold(20)}(jsfeat),function(t){var a,e=(a=function(t,a,e,r,f,i,o){var s=-2*t[a]+t[a+r]+t[a-r],n=-2*t[a]+t[a+f]+t[a-f],h=t[a+i]+t[a-i]-t[a+o]-t[a-o],c=0|Math.sqrt((s-n)*(s-n)+4*h*h);return Math.min(Math.abs(e-c),Math.abs(-(e+c)))},{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(t,e,r){void 0===r&&(r=5);var f,i=0,o=0,s=t.cols,n=t.rows,h=t.data,c=5*s|0,u=3+3*s|0,d=3-3*s|0,_=jsfeat.cache.get_buffer(s*n<<2),l=_.i32,v=0,b=0,p=0,j=0,m=0,x=this.laplacian_threshold,y=this.min_eigen_value_threshold,w=0|Math.max(5,r),g=0|Math.max(3,r),M=0|Math.min(s-5,s-r),k=0|Math.min(n-3,n-r);for(i=s*n;--i>=0;)l[i]=0;for(function(t,a,e,r,f,i,o,s,n,h){var c=0,u=0,d=s*e+o|0,_=d;for(c=s;c<h;++c,_=d+=e)for(u=o;u<n;++u,++_)a[_]=-4*t[_]+t[_+f]+t[_-f]+t[_+i]+t[_-i]}(h,l,s,0,5,c,w,g,M,k),b=g*s+w|0,o=g;o<k;++o,b+=s)for(i=w,p=b;i<M;++i,++p)((v=l[p])<-x&&v<l[p-1]&&v<l[p+1]&&v<l[p-s]&&v<l[p+s]&&v<l[p-s-1]&&v<l[p+s-1]&&v<l[p-s+1]&&v<l[p+s+1]||v>x&&v>l[p-1]&&v>l[p+1]&&v>l[p-s]&&v>l[p+s]&&v>l[p-s-1]&&v>l[p+s-1]&&v>l[p-s+1]&&v>l[p+s+1])&&(j=a(h,p,v,5,c,u,d))>y&&((f=e[m]).x=i,f.y=o,f.score=j,++m,++i,++p);return jsfeat.cache.put_buffer(_),m}});jsfeat.yape06=e}(),function(t){var a,e,r,f,i,o=(a=function(t,a,e){var r,f,i=0;for(r=e,f=0;f<r;f++,i++)r=Math.sqrt(e*e-f*f)+.5|0,a[i]=r+t*f;for(r--;r<f&&r>=0;r--,i++)f=Math.sqrt(e*e-r*r)+.5|0,a[i]=r+t*f;for(;-r<f;r--,i++)f=Math.sqrt(e*e-r*r)+.5|0,a[i]=r+t*f;for(f--;f>=0;f--,i++)r=-Math.sqrt(e*e-f*f)-.5|0,a[i]=r+t*f;for(;f>r;f--,i++)r=-Math.sqrt(e*e-f*f)-.5|0,a[i]=r+t*f;for(r++;r<=0;r++,i++)f=-Math.sqrt(e*e-r*r)-.5|0,a[i]=r+t*f;for(;r<-f;r++,i++)f=-Math.sqrt(e*e-r*r)-.5|0,a[i]=r+t*f;for(f++;f<0;f++,i++)r=Math.sqrt(e*e-f*f)+.5|0,a[i]=r+t*f;return a[i]=a[0],a[i+1]=a[1],i},e=function(t,a,e){var r=0;return 0!=t[a+1]&&r++,0!=t[a-1]&&r++,0!=t[a+e]&&r++,0!=t[a+e+1]&&r++,0!=t[a+e-1]&&r++,0!=t[a-e]&&r++,0!=t[a-e+1]&&r++,0!=t[a-e-1]&&r++,r},r=function(t,a,e,r,f){var i,o;if(e>0)for(a-=r*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[a+i]>e)return!1;a+=r}else for(a-=r*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[a+i]<e)return!1;a+=r}return!0},f=function(t,a,e,r,f,i,o,s){var n=0,h=0,c=o-1|0,u=0,d=0,_=0,l=0,v=0;if((u=t[a+i[h]])<=f)if(u>=r)if((d=t[a+i[c]])<=f){if(d>=r)return void(e[a]=0);if((_=t[a+i[++c]])>f)if((l=t[a+i[++c]])>f)v=3;else{if(!(l<r))return void(e[a]=0);v=6}else if((l=t[a+i[++c]])>f)v=7;else{if(!(l<r))return void(e[a]=0);v=2}}else if((_=t[a+i[++c]])>f)if((l=t[a+i[++c]])>f)v=3;else{if(!(l<r))return void(e[a]=0);v=6}else{if(!(_<r))return void(e[a]=0);if((l=t[a+i[++c]])>f)v=7;else{if(!(l<r))return void(e[a]=0);v=2}}else{if((d=t[a+i[c]])>f)return void(e[a]=0);if((_=t[a+i[++c]])>f)return void(e[a]=0);if((l=t[a+i[++c]])>f)return void(e[a]=0);v=1}else{if((d=t[a+i[c]])<r)return void(e[a]=0);if((_=t[a+i[++c]])<r)return void(e[a]=0);if((l=t[a+i[++c]])<r)return void(e[a]=0);v=0}for(h=1;h<=o;h++)switch(u=t[a+i[h]],v){case 0:if(u>f){if(_=l,(l=t[a+i[++c]])<r)return void(e[a]=0);n-=u+_,v=0;break}if(u<r){if(_>f)return void(e[a]=0);if(l>f)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])>f)return void(e[a]=0);n-=u+_,v=8;break}if(_<=f)return void(e[a]=0);if(l<=f)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])>f){n-=u+_,v=3;break}if(l<r){n-=u+_,v=6;break}return void(e[a]=0);case 1:if(u<r){if(_=l,(l=t[a+i[++c]])>f)return void(e[a]=0);n-=u+_,v=1;break}if(u>f){if(_<r)return void(e[a]=0);if(l<r)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])<r)return void(e[a]=0);n-=u+_,v=9;break}if(_>=r)return void(e[a]=0);if(l>=r)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])<r){n-=u+_,v=2;break}if(l>f){n-=u+_,v=7;break}return void(e[a]=0);case 2:if(u>f)return void(e[a]=0);if(_=l,l=t[a+i[++c]],u<r){if(l>f)return void(e[a]=0);n-=u+_,v=4;break}if(l>f){n-=u+_,v=7;break}if(l<r){n-=u+_,v=2;break}return void(e[a]=0);case 3:if(u<r)return void(e[a]=0);if(_=l,l=t[a+i[++c]],u>f){if(l<r)return void(e[a]=0);n-=u+_,v=5;break}if(l>f){n-=u+_,v=3;break}if(l<r){n-=u+_,v=6;break}return void(e[a]=0);case 4:if(u>f)return void(e[a]=0);if(u<r){if(_=l,(l=t[a+i[++c]])>f)return void(e[a]=0);n-=u+_,v=1;break}if(l>=r)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])<r){n-=u+_,v=2;break}if(l>f){n-=u+_,v=7;break}return void(e[a]=0);case 5:if(u<r)return void(e[a]=0);if(u>f){if(_=l,(l=t[a+i[++c]])<r)return void(e[a]=0);n-=u+_,v=0;break}if(l<=f)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])>f){n-=u+_,v=3;break}if(l<r){n-=u+_,v=6;break}return void(e[a]=0);case 7:if(u>f)return void(e[a]=0);if(u<r)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])>f){n-=u+_,v=3;break}if(l<r){n-=u+_,v=6;break}return void(e[a]=0);case 6:if(u>f)return void(e[a]=0);if(u<r)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])<r){n-=u+_,v=2;break}if(l>f){n-=u+_,v=7;break}return void(e[a]=0);case 8:if(u>f){if(l<r)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])<r)return void(e[a]=0);n-=u+_,v=9;break}if(u<r){if(_=l,(l=t[a+i[++c]])>f)return void(e[a]=0);n-=u+_,v=1;break}return void(e[a]=0);case 9:if(u<r){if(l>f)return void(e[a]=0);if(_=l,(l=t[a+i[++c]])>f)return void(e[a]=0);n-=u+_,v=8;break}if(u>f){if(_=l,(l=t[a+i[++c]])<r)return void(e[a]=0);n-=u+_,v=0;break}return void(e[a]=0)}e[a]=n+s*t[a]},i=function(t,e,r){this.dirs=new Int32Array(1024),this.dirs_count=0|a(t,this.dirs,r),this.scores=new Int32Array(t*e),this.radius=0|r},{level_tables:[],tau:7,init:function(t,a,e,r){var f;for(void 0===r&&(r=1),e=Math.min(e,7),e=Math.max(e,3),f=0;f<r;++f)this.level_tables[f]=new i(t>>f,a>>f,e)},detect:function(t,a,i){void 0===i&&(i=4);var o,s=this.level_tables[0],n=0|s.radius,h=n-1|0,c=s.dirs,u=0|s.dirs_count,d=u>>1,_=t.data,l=0|t.cols,v=0|t.rows,b=l>>1,p=s.scores,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0|this.tau,A=0,C=0|Math.max(n+1,i),O=0|Math.max(n+1,i),R=0|Math.min(l-n-2,l-i),S=0|Math.min(v-n-2,v-i);for(x=O*l+C|0,m=O;m<S;++m,x+=l)for(j=C,y=x;j<R;++j,++y)w=_[y]+z,(g=_[y]-z)<_[y+n]&&_[y+n]<w&&g<_[y-n]&&_[y-n]<w?p[y]=0:f(_,y,p,g,w,c,d,u);for(x=O*l+C|0,m=O;m<S;++m,x+=l)for(j=C,y=x;j<R;++j,++y)k=p[y],(M=Math.abs(k))<5?(++j,++y):e(p,y,l)>=3&&r(p,y,k,b,n)&&((o=a[A]).x=j,o.y=m,o.score=M,++A,j+=h,y+=h);return A}});jsfeat.yape=o}(),function(t){var a,e,r,f,i=(a=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),e=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),r=new jsfeat.matrix_t(32,32,jsfeat.U8_t|jsfeat.C1_t),f=function(t,a,r,f,i,o){var s=Math.cos(r),n=Math.sin(r);e.data[0]=s,e.data[1]=-n,e.data[2]=(-s+n)*o*.5+f,e.data[3]=n,e.data[4]=s,e.data[5]=(-n-s)*o*.5+i,jsfeat.imgproc.warp_affine(t,a,e,128)},{describe:function(t,e,i,o){var s=0,n=0,h=0,c=0,u=0,d=0,_=0,l=0,v=(t.data,t.cols,t.rows,r.data),b=528,p=0;o.type&jsfeat.U8_t?o.resize(32,i,1):(o.type=jsfeat.U8_t,o.cols=32,o.rows=i,o.channel=1,o.allocate());var j=o.data,m=0;for(s=0;s<i;++s){for(h=e[s].x,c=e[s].y,u=e[s].angle,f(t,r,u,h,c,32),p=0,n=0;n<32;++n)l=(d=v[b+32*a[p+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]])|0,l|=((d=v[b+32*a[(p+=2)+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]]))<<1,l|=((d=v[b+32*a[(p+=2)+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]]))<<2,l|=((d=v[b+32*a[(p+=2)+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]]))<<3,l|=((d=v[b+32*a[(p+=2)+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]]))<<4,l|=((d=v[b+32*a[(p+=2)+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]]))<<5,l|=((d=v[b+32*a[(p+=2)+1]+a[p]])<(_=v[b+32*a[(p+=2)+1]+a[p]]))<<6,d=v[b+32*a[(p+=2)+1]+a[p]],_=v[b+32*a[(p+=2)+1]+a[p]],p+=2,l|=(d<_)<<7,j[m+n]=l;m+=32}}});t.orb=i}(jsfeat),function(t){var a,e=(a=jsfeat.imgproc.scharr_derivatives,{track:function(t,e,r,f,i,o,s,n,h,c){void 0===s&&(s=30),void 0===n&&(n=new Uint8Array(i)),void 0===h&&(h=.01),void 0===c&&(c=1e-4);var u=.5*(o-1),d=o*o|0,_=d<<1,l=t.data,v=e.data,b=l[0].data,p=v[0].data,j=l[0].cols,m=l[0].rows,x=0,y=0,w=jsfeat.cache.get_buffer(d<<2),g=jsfeat.cache.get_buffer(_<<2),M=jsfeat.cache.get_buffer(m*(j<<1)<<2),k=new jsfeat.matrix_t(j,m,jsfeat.S32C2_t,M.data),z=w.i32,A=g.i32,C=M.i32,O=0,R=0,S=0,L=0,U=0,q=0,I=0,G=0,B=0,F=0,N=0,V=0,E=0,P=0,T=0,Y=0,D=0,Q=0,X=0,H=0,J=0,K=0,W=0,Z=0,$=0,tt=0,at=0,et=0,rt=0,ft=0,it=0,ot=0,st=16384,nt=1/(1<<20),ht=0,ct=0,ut=0,dt=0,_t=0,lt=0,vt=0,bt=0,pt=0,jt=0,mt=0;for(h*=h;H<i;++H)n[H]=1;var xt=t.levels-1|0;for(Z=xt;Z>=0;--Z)for(I=1/(1<<Z),y=m>>Z,O=(x=j>>Z)<<1,b=l[Z].data,p=v[Z].data,at=x-o|0,et=y-o|0,a(l[Z],k),$=0;$<i;++$)if(J=1+(H=$<<1),G=r[H]*I,B=r[J]*I,Z==xt?(F=G,N=B):(F=2*f[H],N=2*f[J]),f[H]=F,f[J]=N,0==(K=(Y=0|(G-=u))<=0|Y>=at|(D=0|(B-=u))<=0|D>=et)){for(dt=st-(ht=(1-(rt=G-Y))*(1-(ft=B-D))*st+.5|0)-(ct=rt*(1-ft)*st+.5|0)-(ut=(1-rt)*ft*st+.5|0),bt=0,pt=0,jt=0,W=0;W<o;++W)for(S=(R=(W+D)*x+Y|0)<<1,U=(L=W*o|0)<<1,K=0;K<o;++K,++R,++L,S+=2)_t=256+(_t=b[R]*ht+b[R+1]*ct+b[R+x]*ut+b[R+x+1]*dt)>>9,lt=8192+(lt=C[S]*ht+C[S+2]*ct+C[S+O]*ut+C[S+O+2]*dt)>>14,vt=8192+(vt=C[S+1]*ht+C[S+3]*ct+C[S+O+1]*ut+C[S+O+3]*dt)>>14,z[L]=_t,A[U++]=lt,A[U++]=vt,bt+=lt*lt,pt+=lt*vt,jt+=vt*vt;if(mt=(bt*=nt)*(jt*=nt)-(pt*=nt)*pt,(jt+bt-Math.sqrt((bt-jt)*(bt-jt)+4*pt*pt))/_<c||mt<1.1920929e-7)0==Z&&(n[$]=0);else for(mt=1/mt,F-=u,N-=u,V=0,E=0,tt=0;tt<s;++tt){if(0!=(K=(Q=0|F)<=0|Q>=at|(X=0|N)<=0|X>=et)){0==Z&&(n[$]=0);break}for(dt=st-(ht=(1-(rt=F-Q))*(1-(ft=N-X))*st+.5|0)-(ct=rt*(1-ft)*st+.5|0)-(ut=(1-rt)*ft*st+.5|0),it=0,ot=0,W=0;W<o;++W)for(q=(W+X)*x+Q|0,U=(L=W*o|0)<<1,K=0;K<o;++K,++q,++L)_t=256+(_t=p[q]*ht+p[q+1]*ct+p[q+x]*ut+p[q+x+1]*dt)>>9,it+=(_t-=z[L])*A[U++],ot+=_t*A[U++];if(F+=P=(pt*(ot*=nt)-jt*(it*=nt))*mt,N+=T=(pt*it-bt*ot)*mt,f[H]=F+u,f[J]=N+u,P*P+T*T<=h)break;if(tt>0&&Math.abs(P+V)<.01&&Math.abs(T+E)<.01){f[H]-=.5*P,f[J]-=.5*T;break}V=P,E=T}}else 0==Z&&(n[$]=0);jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(g),jsfeat.cache.put_buffer(M)}});t.optical_flow_lk=e}(jsfeat),function(t){var a,e=(a=function(t,a){var e=.25*t.width+.5|0;return a.x<=t.x+e&&a.x>=t.x-e&&a.y<=t.y+e&&a.y>=t.y-e&&a.width<=1.5*t.width+.5|0&&1.5*a.width+.5|0>=t.width},{edges_density:.07,detect_single_scale:function(t,a,e,r,f,i,o,s){var n,h,c,u,d,_,l,v,b,p,j,m,x,y,w,g,M,k,z,A,C,O,R,S,L,U=s.size[0]*o|0,q=s.size[1]*o|0,I=.5*o+1.5|0,G=I,B=f-U|0,F=i-q|0,N=f+1|0,V=1/(U*q),E=!0,P=0,T=U,Y=q*N,D=Y+U,Q=U*q*255*this.edges_density|0,X=[];for(d=0;d<F;d+=G)for(P=d*N,u=0;u<B;u+=I,P+=I)if(_=t[P]-t[P+T]-t[P+Y]+t[P+D],r&&(r[P]-r[P+T]-r[P+Y]+r[P+D]<Q||_<20))u+=I,P+=I;else{for(_*=V,v=(l=(a[P]-a[P+T]-a[P+Y]+a[P+D])*V-_*_)>0?Math.sqrt(l):1,x=(b=s.complexClassifiers).length,E=!0,n=0;n<x;++n){for(g=(p=b[n]).threshold,y=(j=p.simpleClassifiers).length,M=0,h=0;h<y;++h){if(k=0,w=(A=(m=j[h]).features).length,1===m.tilted)for(c=0;c<w;++c)C=~~(u+(z=A[c])[0]*o)+~~(d+z[1]*o)*N,O=(S=~~(z[2]*o))*N,R=(L=~~(z[3]*o))*N,k+=(e[C]-e[C+S+O]-e[C-L+R]+e[C+S-L+O+R])*z[4];else for(c=0;c<w;++c)C=~~(u+(z=A[c])[0]*o)+~~(d+z[1]*o)*N,S=~~(z[2]*o),R=(L=~~(z[3]*o))*N,k+=(t[C]-t[C+S]-t[C+R]+t[C+R+S])*z[4];M+=k*V<m.threshold*v?m.left_val:m.right_val}if(M<g){E=!1;break}}E&&(X.push({x:u,y:d,width:U,height:q,neighbor:1,confidence:M}),u+=I,P+=I)}return X},detect_multi_scale:function(t,a,e,r,f,i,o,s,n){void 0===s&&(s=1.2),void 0===n&&(n=1);for(var h=o.size[0],c=o.size[1],u=[];n*h<f&&n*c<i;)u=u.concat(this.detect_single_scale(t,a,e,r,f,i,n,o)),n*=s;return u},group_rectangles:function(t,e){void 0===e&&(e=1);var r,f,i=t.length,o=[];for(r=0;r<i;++r)o[r]={parent:-1,element:t[r],rank:0};for(r=0;r<i;++r)if(o[r].element){for(var s=r;-1!=o[s].parent;)s=o[s].parent;for(f=0;f<i;++f)if(r!=f&&o[f].element&&a(o[r].element,o[f].element)){for(var n=f;-1!=o[n].parent;)n=o[n].parent;if(n!=s){o[s].rank>o[n].rank?o[n].parent=s:(o[s].parent=n,o[s].rank==o[n].rank&&o[n].rank++,s=n);for(var h,c=f;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=s;for(c=r;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=s}}}var u=[],d=0;for(r=0;r<i;r++){f=-1;var _=r;if(o[_].element){for(;-1!=o[_].parent;)_=o[_].parent;o[_].rank>=0&&(o[_].rank=~d++),f=~o[_].rank}u[r]=f}var l=[];for(r=0;r<d+1;++r)l[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<i;++r){var v=t[r],b=u[r];0==l[b].neighbors&&(l[b].confidence=v.confidence),++l[b].neighbors,l[b].x+=v.x,l[b].y+=v.y,l[b].width+=v.width,l[b].height+=v.height,l[b].confidence=Math.max(l[b].confidence,v.confidence)}var p=[];for(r=0;r<d;++r)(i=l[r].neighbors)>=e&&p.push({x:(2*l[r].x+i)/(2*i),y:(2*l[r].y+i)/(2*i),width:(2*l[r].width+i)/(2*i),height:(2*l[r].height+i)/(2*i),neighbors:l[r].neighbors,confidence:l[r].confidence});var j=[];for(i=p.length,r=0;r<i;++r){v=p[r];var m=!0;for(f=0;f<i;++f){var x=p[f],y=.25*x.width+.5|0;if(r!=f&&v.x>=x.x-y&&v.y>=x.y-y&&v.x+v.width<=x.x+x.width+y&&v.y+v.height<=x.y+x.height+y&&(x.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){m=!1;break}}m&&j.push(v)}return j}});jsfeat.haar=e}(),function(t){var a,e,r=(a=function(t,a){var e=.25*t.width+.5|0;return a.x<=t.x+e&&a.x>=t.x-e&&a.y<=t.y+e&&a.y>=t.y-e&&a.width<=1.5*t.width+.5|0&&1.5*a.width+.5|0>=t.width},e=new jsfeat.pyramid_t(1),{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var a=t.stage_classifier.length,e=0;e<a;e++)for(var r=t.stage_classifier[e].feature,f=t.stage_classifier[e].count,i=t.stage_classifier[e]._feature=new Array(f),o=0;o<f;o++)i[o]={size:r[o].size,px:new Array(r[o].size),pz:new Array(r[o].size),nx:new Array(r[o].size),nz:new Array(r[o].size)}},build_pyramid:function(t,a,r,f){void 0===f&&(f=4);var i=t.cols,o=t.rows,s=0,n=0,h=0,c=!1,u=t,d=t,_=jsfeat.U8_t|jsfeat.C1_t;this.interval=f,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(i/a,o/r))/Math.log(this.scale)|0;var l=4*(this.scale_to+2*this.next)|0;for(e.levels!=l&&(e.levels=l,e.data=new Array(l),c=!0,e.data[0]=t),s=1;s<=this.interval;++s)n=i/Math.pow(this.scale,s)|0,h=o/Math.pow(this.scale,s)|0,u=e.data[s<<2],(c||n!=u.cols||h!=u.rows)&&(e.data[s<<2]=new jsfeat.matrix_t(n,h,_),u=e.data[s<<2]),jsfeat.imgproc.resample(t,u,n,h);for(s=this.next;s<this.scale_to+2*this.next;++s)d=e.data[(s<<2)-(this.next<<2)],u=e.data[s<<2],n=d.cols>>1,h=d.rows>>1,(c||n!=u.cols||h!=u.rows)&&(e.data[s<<2]=new jsfeat.matrix_t(n,h,_),u=e.data[s<<2]),jsfeat.imgproc.pyrdown(d,u);for(s=2*this.next;s<this.scale_to+2*this.next;++s)n=(d=e.data[(s<<2)-(this.next<<2)]).cols>>1,h=d.rows>>1,u=e.data[1+(s<<2)],(c||n!=u.cols||h!=u.rows)&&(e.data[1+(s<<2)]=new jsfeat.matrix_t(n,h,_),u=e.data[1+(s<<2)]),jsfeat.imgproc.pyrdown(d,u,1,0),u=e.data[2+(s<<2)],(c||n!=u.cols||h!=u.rows)&&(e.data[2+(s<<2)]=new jsfeat.matrix_t(n,h,_),u=e.data[2+(s<<2)]),jsfeat.imgproc.pyrdown(d,u,0,1),u=e.data[3+(s<<2)],(c||n!=u.cols||h!=u.rows)&&(e.data[3+(s<<2)]=new jsfeat.matrix_t(n,h,_),u=e.data[3+(s<<2)]),jsfeat.imgproc.pyrdown(d,u,1,1);return e},detect:function(t,a){this.interval;var e,r,f,i,o,s=this.scale,n=this.next,h=this.scale_to,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,j=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=!0,O=!0,R=1,S=1,L=[0,1,0,1],U=[0,0,1,1],q=[],I=t.data,G=[],B=[0,0,0],F=[0,0,0],N=[0,0,0];for(c=0;c<h;c++){for(k=I[(M=c<<2)+(n<<3)].cols-(a.width>>2),z=I[M+(n<<3)].rows-(a.height>>2),F[0]=1*I[M].cols,F[1]=1*I[M+(n<<2)].cols,F[2]=1*I[M+(n<<3)].cols,N[0]=4*I[M].cols-4*k,N[1]=2*I[M+(n<<2)].cols-2*k,N[2]=1*I[M+(n<<3)].cols-1*k,p=a.stage_classifier.length,u=0;u<p;u++)for(f=a.stage_classifier[u].feature,r=a.stage_classifier[u]._feature,j=a.stage_classifier[u].count,d=0;d<j;d++)for(i=r[d],m=0|(o=f[d]).size,b=0;b<m;b++)i.px[b]=1*o.px[b]+o.py[b]*F[o.pz[b]],i.pz[b]=o.pz[b],i.nx[b]=1*o.nx[b]+o.ny[b]*F[o.nz[b]],i.nz[b]=o.nz[b];for(G[0]=I[M].data,G[1]=I[M+(n<<2)].data,b=0;b<4;b++)for(G[2]=I[M+(n<<3)+b].data,B[0]=2*L[b]+U[b]*(2*I[M].cols),B[1]=1*L[b]+U[b]*(1*I[M+(n<<2)].cols),B[2]=0,v=0;v<z;v++){for(l=0;l<k;l++){for(A=0,C=!0,p=a.stage_classifier.length,u=0;u<p;u++){for(A=0,e=a.stage_classifier[u].alpha,r=a.stage_classifier[u]._feature,j=a.stage_classifier[u].count,d=0;d<j;d++)if((y=G[(i=r[d]).pz[0]][B[i.pz[0]]+i.px[0]])<=(w=G[i.nz[0]][B[i.nz[0]]+i.nx[0]]))A+=e[d<<1];else{for(O=!0,m=i.size,g=1;g<m;g++){if(i.pz[g]>=0&&(x=G[i.pz[g]][B[i.pz[g]]+i.px[g]])<y){if(x<=w){O=!1;break}y=x}if(i.nz[g]>=0&&(_=G[i.nz[g]][B[i.nz[g]]+i.nx[g]])>w){if(y<=_){O=!1;break}w=_}}A+=O?e[1+(d<<1)]:e[d<<1]}if(A<a.stage_classifier[u].threshold){C=!1;break}}C&&(q.push({x:(4*l+2*L[b])*R,y:(4*v+2*U[b])*S,width:a.width*R,height:a.height*S,neighbor:1,confidence:A}),++l,B[0]+=4,B[1]+=2,B[2]+=1),B[0]+=4,B[1]+=2,B[2]+=1}B[0]+=N[0],B[1]+=N[1],B[2]+=N[2]}R*=s,S*=s}return q},group_rectangles:function(t,e){void 0===e&&(e=1);var r,f,i=t.length,o=[];for(r=0;r<i;++r)o[r]={parent:-1,element:t[r],rank:0};for(r=0;r<i;++r)if(o[r].element){for(var s=r;-1!=o[s].parent;)s=o[s].parent;for(f=0;f<i;++f)if(r!=f&&o[f].element&&a(o[r].element,o[f].element)){for(var n=f;-1!=o[n].parent;)n=o[n].parent;if(n!=s){o[s].rank>o[n].rank?o[n].parent=s:(o[s].parent=n,o[s].rank==o[n].rank&&o[n].rank++,s=n);for(var h,c=f;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=s;for(c=r;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=s}}}var u=[],d=0;for(r=0;r<i;r++){f=-1;var _=r;if(o[_].element){for(;-1!=o[_].parent;)_=o[_].parent;o[_].rank>=0&&(o[_].rank=~d++),f=~o[_].rank}u[r]=f}var l=[];for(r=0;r<d+1;++r)l[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<i;++r){var v=t[r],b=u[r];0==l[b].neighbors&&(l[b].confidence=v.confidence),++l[b].neighbors,l[b].x+=v.x,l[b].y+=v.y,l[b].width+=v.width,l[b].height+=v.height,l[b].confidence=Math.max(l[b].confidence,v.confidence)}var p=[];for(r=0;r<d;++r)(i=l[r].neighbors)>=e&&p.push({x:(2*l[r].x+i)/(2*i),y:(2*l[r].y+i)/(2*i),width:(2*l[r].width+i)/(2*i),height:(2*l[r].height+i)/(2*i),neighbors:l[r].neighbors,confidence:l[r].confidence});var j=[];for(i=p.length,r=0;r<i;++r){v=p[r];var m=!0;for(f=0;f<i;++f){var x=p[f],y=.25*x.width+.5|0;if(r!=f&&v.x>=x.x-y&&v.y>=x.y-y&&v.x+v.width<=x.x+x.width+y&&v.y+v.height<=x.y+x.height+y&&(x.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){m=!1;break}}m&&j.push(v)}return j}});t.bbf=r}(jsfeat),function(t){"undefined"==typeof module||void 0===module.exports?window.jsfeat=t:module.exports=t}(jsfeat);