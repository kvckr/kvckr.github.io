let ALLOW_PARAM_OVERRIDE_FROM_URL=!0,SUPPRESS_WINEBOOT=!0,ROOT="/root",STORAGE_DROPBOX="DROPBOX",STORAGE_LOCAL_STORAGE="LOCAL_STORAGE",STORAGE_MEMORY="MEMORY",ONDEMAND_DEFAULT="notset",ONDEMAND_ROOT="root",DROPBOX_APP_KEY="put key in here",RECEIVE_URL="http://put url in here/oauth_receiver.html",DEFAULT_AUTO_RUN=!0,DEFAULT_SOUND_ENABLED=!0,DEFAULT_APP_DIRECTORY=ROOT+"/files/",DEFAULT_BPP=32,DEFAULT_FRAME_SKIP="0",DEFAULT_RENDERER="gdi",DEFAULT_ROOT_ZIP_FILE="boxedwine.zip",TEMP="/temp/",BFS_ROOT="/",Config=window.BoxedWineConfig||{};Config.locateRootBaseUrl="Program Files/BoxedWine",Config.locateAppBaseUrl="Program Files/BoxedWine",Config.locateOverlayBaseUrl="Program Files/BoxedWine",Config.storageMode=STORAGE_MEMORY,Config.isRunningInline=!0,Config.isRunning=!1,Config.showUploadDownload=!1,Config.recordLoadedFiles=!1;var selectedItem,selectedFilename,recordedFiles=[],uniqueDirs={},timer=null,index=0,files=[],client=null,alreadyBuiltFileSystem=!1,ae=document.createElement("a");document.body.appendChild(ae),ae.style="display: none";var url=null,flag_r={isReadable:function(){return!0},isWriteable:function(){return!1},isTruncating:function(){return!1},isAppendable:function(){return!1},isSynchronous:function(){return!1},isExclusive:function(){return!1},pathExistsAction:function(){return 0},pathNotExistsAction:function(){return 1}};function logAndExit(e){throw window.BoxedWineConfig.consoleLog("FATAL ERROR: "+e),new Error(e)}function setConfiguration(){Config.appDirPrefix=DEFAULT_APP_DIRECTORY,Config.isAutoRunSet=getAutoRun(),Config.rootZipFile=getRootZipFile("root"),Config.extraZipFiles=getZipFileList("overlay"),Config.appZipFile=getAppZipFile("app"),Config.appPayload=getPayload("app-payload"),Config.extraPayload=getPayload("overlay-payload"),Config.Program=getExecutable(),Config.WorkingDir=getWorkingDirectory(),Config.isSoundEnabled=getSound(),Config.bpp=getBitsPerPixel(),Config.useRangeRequests=getUseRangeRequests(),Config.glext=getGLExtensions(),Config.cpu=getCPU(),Config.envProp=getEnvProp(),Config.emEnvProps=getEmscriptenEnvProps(),Config.frameSkip=getFrameSkip(),Config.directDrawRenderer=getDirectDrawRenderer(),Config.cdromImage=getCDROMImage(),Config.resolution=getResolution()}function allowParameterOverride(){return Config.urlParams.length>0||ALLOW_PARAM_OVERRIDE_FROM_URL}function getEmscriptenEnvProps(){var e=getParameter("em-env").trim();let n=[];return allowParameterOverride()&&e.length>6&&(e.startsWith("%22")&&e.endsWith("%22")||e.startsWith("%27")&&e.endsWith("%27")?(e=(e=e.substring(3,e.length-3)).split("%20").join(" ")).trim().split(";").forEach((function(e){let t=e.split(":");if(2==t.length){let e=t[0].trim(),i=t[1].trim(),o=n.findIndex((n=>n.key===e));o>-1&&n.splice(o,1),n.push({key:e,value:i})}})):window.BoxedWineConfig.consoleLog("EMSCRIPTEN ENV props parameter must be in quoted string")),n.length>0&&(window.BoxedWineConfig.consoleLog("setting EMSCRIPTEN ENV props:"),n.forEach((function(e){window.BoxedWineConfig.consoleLog(e.key+" = "+e.value)}))),n}function getEnvProp(){var e=getParameter("env").trim();if(allowParameterOverride()&&e.length>6){if(e.startsWith("%22")&&e.endsWith("%22")||e.startsWith("%27")&&e.endsWith("%27")){let n=e.substring(3,e.length-3).split(":");return'"'+n[0].trim()+"="+n[1].trim()+'"'}window.BoxedWineConfig.consoleLog("ENV property must be in quoted string")}return""}function getCPU(){var e=getParameter("cpu");return allowParameterOverride()&&("p2"==e||"p3"==e)||(e=""),e.length>0&&window.BoxedWineConfig.consoleLog("setting CPU to: "+e),e}function getDirectDrawRenderer(){var e=getParameter("renderer");return allowParameterOverride()&&("gdi"==e||"opengl"==e)||(e=DEFAULT_RENDERER),window.BoxedWineConfig.consoleLog("setting DirectDrawRenderer to: "+e),e}function getResolution(){var e=getParameter("resolution");if(allowParameterOverride()){if(null!=e)if(e.indexOf("x")>-1){let n=e.split("x");2==n.length&&isNumber(n[0])&&isNumber(n[1])||(e=null)}else e=null}else e=null;return null==e?window.BoxedWineConfig.consoleLog("not setting Resolution"):window.BoxedWineConfig.consoleLog("setting Resolution to: "+e),e}function isNumber(e){const n=Number(e);return!isNaN(n)&&n>0&&n<2e3}function getFrameSkip(){var e=getParameter("skipFrameFPS");return allowParameterOverride()?(""==e||Number(e)<0||Number(e)>50)&&(e=DEFAULT_FRAME_SKIP):e=DEFAULT_FRAME_SKIP,window.BoxedWineConfig.consoleLog("setting skipFrameFPS to: "+e),e}function getBitsPerPixel(){var e=getParameter("bpp");return e=allowParameterOverride()?"8"==e?8:"16"==e?16:"32"==e?32:DEFAULT_BPP:DEFAULT_BPP,window.BoxedWineConfig.consoleLog("setting BPP to: "+e),e}function getGLExtensions(){var e=getParameter("glext");return allowParameterOverride()?e.length>6&&(e.startsWith("%22")&&e.endsWith("%22")||e.startsWith("%27")&&e.endsWith("%27")?e='"'+(e=(e=e.substring(3,e.length-3)).split("%20").join(" "))+'"':window.BoxedWineConfig.consoleLog("glext paramater must be in quoted string")):e="",e.length>0&&window.BoxedWineConfig.consoleLog("setting glext to: "+e),e}function getAutoRun(){var e=getParameter("auto");return!(e=allowParameterOverride()?"true"==e||"false"!=e&&DEFAULT_AUTO_RUN:DEFAULT_AUTO_RUN)&&Config.isRunningInline&&(window.BoxedWineConfig.consoleLog("parameter mismatch. Auto run can't be false if running inline. Resetting auto run to true"),e=!0),window.BoxedWineConfig.consoleLog("setting auto run to: "+e),e}function getPayload(e){var n=getParameter(e);return allowParameterOverride()||(n=""),n}function getUseRangeRequests(){var e=getParameter("ondemand");return allowParameterOverride()&&e==ONDEMAND_ROOT||(e=ONDEMAND_DEFAULT),window.BoxedWineConfig.consoleLog("setting ondemand to: "+e),e}function getSound(){var e=getParameter("sound");return e=allowParameterOverride()?"true"==e||"false"!=e&&DEFAULT_SOUND_ENABLED:DEFAULT_SOUND_ENABLED,window.BoxedWineConfig.consoleLog("setting sound to: "+e),e}function getWorkingDirectory(){var e=getParameter("work");return allowParameterOverride()&&""!==e?e.startsWith("c:/")?(e="/home/username/.wine/dosdevices/c:/"+e.substring(3),window.BoxedWineConfig.consoleLog("setting working directory to: "+e)):e.startsWith("d:/")?(e="/home/username/.wine/dosdevices/d:/"+e.substring(3),window.BoxedWineConfig.consoleLog("setting working directory to: "+e)):e.startsWith("e:/")?(e="/home/username/.wine/dosdevices/e:/"+e.substring(3),window.BoxedWineConfig.consoleLog("setting working directory to: "+e)):window.BoxedWineConfig.consoleLog("unable to set work directory"):e="",e}function getCDROMImage(){var e=getParameter("iso");return allowParameterOverride()&&""!==e?(e.endsWith(".iso")||(e+=".iso"),window.BoxedWineConfig.consoleLog("setting cdrom iso image to: "+e)):(e="",window.BoxedWineConfig.consoleLog("not setting cdrom iso image")),e}function getAppZipFile(e){var n=getParameter(e);return allowParameterOverride()&&""!==n?(n.endsWith(".zip")||(n+=".zip"),window.BoxedWineConfig.consoleLog("setting "+e+" zip file to: "+n)):(n="",window.BoxedWineConfig.consoleLog("not setting "+e+" zip file")),n}function getRootZipFile(e){var n=getParameter(e);return allowParameterOverride()&&""!==n?n.endsWith(".zip")||(n+=".zip"):n=DEFAULT_ROOT_ZIP_FILE,window.BoxedWineConfig.consoleLog("setting "+e+" zip file to: "+n),n}function getZipFileList(e){var n=[];if(Config.isRunningInline){let e=getParameter("inline-default-ondemand-root-overlay");e.length>0&&(e.endsWith(".zip")||(e+=".zip"),n.push(e))}var t=getParameter(e);if(allowParameterOverride()&&""!==r){if(t.length>0)for(var i=t.split(";"),o=0;o<i.length;o++){var r=i[o];r.endsWith(".zip")||(r+=".zip"),n.push(r)}}else window.BoxedWineConfig.consoleLog("not setting "+e+" zip file(s)");return n.length>0&&window.BoxedWineConfig.consoleLog("setting "+e+" zip file(s) to: "+n),n}function auth_callback(e){if(e)console.error("Authentication error: "+e);else if(client.isAuthenticated()){if(alreadyBuiltFileSystem)return;alreadyBuiltFileSystem=!0,window.BoxedWineConfig.consoleLog("authenticated!"),buildFileSystem(new BrowserFS.FileSystem.InMemory,!0)}else console.error("unable to authenticate")}function dropboxLogin(){(client=new Dropbox.Client({key:DROPBOX_APP_KEY})).authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:RECEIVE_URL})),client.authenticate(auth_callback)}function initFileSystem(){var e;(window.BoxedWineConfig.consoleLog("Use Storage mode: "+Config.storageMode),Config.storageMode===STORAGE_LOCAL_STORAGE)?(BrowserFS.FileSystem.LocalStorage.isAvailable?e=new BrowserFS.FileSystem.LocalStorage:(e=new BrowserFS.FileSystem.InMemory,window.BoxedWineConfig.consoleLog("Switching to In Memory store as LocalStorage is not available")),buildFileSystem(e,!1)):Config.storageMode===STORAGE_DROPBOX?client.authenticate({interactive:!1},auth_callback):buildFileSystem(new BrowserFS.FileSystem.InMemory,!1)}function syncGet(e,n,t){let i=new XMLHttpRequest;i.open("GET",Config.locateRootBaseUrl+e,!1);let o=null,r=null;i.overrideMimeType("text/plain; charset=x-user-defined");let a="bytes="+n+"-"+(n+t-1);if(i.setRequestHeader("Range",a),i.onreadystatechange=function(e){if(4!==i.readyState);else{if(200===i.status||206===i.status){const e=i.responseText;o=new Int8Array(e.length);for(let n=0;n<e.length;n++)o[n]=e.charCodeAt(n);return}r="XHR error."}},i.send(),r)throw r;return o}function getFileSize(e){return new Promise((function(n,t){const i=new XMLHttpRequest;i.open("HEAD",Config.locateRootBaseUrl+e),i.onreadystatechange=function(e){if(4===i.readyState){if(200!==i.status)throw new Error("Unable to get file size");try{n(parseInt(i.getResponseHeader("Content-Length")||"-1",10))}catch(e){throw e}}},i.onerror=function(){t(Error("Network Error"))},i.send()})).then((function(e,n){if(null!=n)throw new Error(n);return e}),(function(e){throw new Error("Something when wrong when getting file size")}))}function getCentralOffset(e){var n=0,t=e.byteLength-22,i=Math.max(0,t-65536),o=0;do{if(t<i)throw new Error("not a zip file?");n=t--,o=e[n++]|e[n++]<<8|(e[n++]|e[n++]<<8)<<16}while(101010256!=o);n=n+10-4;e[n++],e[n++];return n=n+16-12,e[n++]|e[n++]<<8|(e[n++]|e[n++]<<8)<<16}function buildFileSystem(e,n){var t=BrowserFS.BFSRequire("buffer").Buffer;buildCDROMFileSystem(t,(function(i){buildExtraFileSystems(t,(function(o){buildAppFileSystems((function(r){if(Config.useRangeRequests==ONDEMAND_ROOT)buildRemoteZipFile(Config.rootZipFile,(function(t){buildBrowserFileSystem(e,n,r,o,t,i)}));else{var a={};a[Config.rootZipFile]=null,BrowserFS.FileSystem.XmlHttpRequest.Create({index:a,baseUrl:Config.locateRootBaseUrl},(function(a,l){a&&logAndExit(a);var s=new BrowserFS.FileSystem.MountableFileSystem;s.mount("/temp",l),s.readFile(TEMP+Config.rootZipFile,null,flag_r,(function(a,l){a&&logAndExit(a),BrowserFS.FileSystem.ZipFS.Create({zipData:new t(l)},(function(t,a){t&&logAndExit(t),buildBrowserFileSystem(e,n,r,o,a,i)})),s=null}))}))}}))}))}))}function buildRemoteZipFile(e,n){var t=BrowserFS.BFSRequire("buffer").Buffer;getFileSize(e).then((function(i){let o=Number(i),r=o>1e5?1e5:o-22,a=syncGet(e,o-r,r),l=getCentralOffset(new Uint8Array(a)),s=syncGet(e,l,o-l);BrowserFS.FileSystem.ZipFS.Create({name:Config.locateRootBaseUrl+e,zipData:new t(s)},(function(e,t){e&&logAndExit(e),n(t)}))}))}function getBase64Data(e){let n=atob(e),t=n.length;for(var i=new Uint8Array(t),o=0;o<t;o++)i[o]=n.charCodeAt(o);return i}function buildAppFileSystems(e){var n=BrowserFS.BFSRequire("buffer").Buffer;if(Config.appPayload.length>0){let t=getBase64Data(Config.appPayload);BrowserFS.FileSystem.ZipFS.Create({zipData:new n(t)},(function(n,t){n&&logAndExit(n);let i=new BrowserFS.FileSystem.FolderAdapter(BFS_ROOT,t);e(i)}))}else if(Config.appZipFile.length>0){var t={};t[Config.appZipFile]=null;var i=new BrowserFS.FileSystem.MountableFileSystem;BrowserFS.FileSystem.XmlHttpRequest.Create({index:t,baseUrl:Config.locateAppBaseUrl},(function(t,o){t&&logAndExit(t),i.mount("/temp",o),i.readFile(TEMP+Config.appZipFile,null,flag_r,(function(t,o){t&&logAndExit(t),BrowserFS.FileSystem.ZipFS.Create({zipData:new n(o)},(function(n,t){n&&logAndExit(n);let o=new BrowserFS.FileSystem.FolderAdapter(BFS_ROOT,t);e(o),i=null}))}))}))}else{let n=new BrowserFS.FileSystem.FolderAdapter(BFS_ROOT,new BrowserFS.FileSystem.InMemory);e(n)}}function buildExtraFileSystems(e,n){var t=[];if(Config.extraPayload.length>0){let i=getBase64Data(Config.extraPayload);BrowserFS.FileSystem.ZipFS.Create({zipData:new e(i)},(function(e,i){e&&logAndExit(e),t.push(i),n(t)}))}else if(Config.extraZipFiles.length>0)for(let r=0;r<Config.extraZipFiles.length;r++){var i={};i[Config.extraZipFiles[r]]=null;var o=new BrowserFS.FileSystem.MountableFileSystem;BrowserFS.FileSystem.XmlHttpRequest.Create({index:i,baseUrl:Config.locateOverlayBaseUrl},(function(i,a){i&&logAndExit(i),o.mount("/temp",a),o.readFile(TEMP+Config.extraZipFiles[r],null,flag_r,(function(i,r){i&&logAndExit(i),BrowserFS.FileSystem.ZipFS.Create({zipData:new e(r)},(function(e,i){e&&logAndExit(e),t.push(i),t.length==Config.extraZipFiles.length&&n(t),o=null}))}))}))}else n(t)}function buildCDROMFileSystem(e,n){if(Config.cdromImage.length>0){var t={};t[Config.cdromImage]=null;var i=new BrowserFS.FileSystem.MountableFileSystem;BrowserFS.FileSystem.XmlHttpRequest.Create({index:t,baseUrl:Config.locateAppBaseUrl},(function(t,o){t&&logAndExit(t),i.mount("/temp",o),i.readFile(TEMP+Config.cdromImage,null,flag_r,(function(t,o){t&&logAndExit(t),BrowserFS.FileSystem.IsoFS.Create({data:new e(o)},(function(e,t){e&&logAndExit(e),n(t),i=null}))}))}))}else n(null)}function buildBrowserFileSystem(e,n,t,i,o,r){FS.createPath(FS.root,"root",FS.createPath),FS.createPath("/root","base",!0,!0),FS.createPath("/root","files",!0,!0),FS.createPath("/root","cdrom",!0,!1);BrowserFS.FileSystem.OverlayFS.Create({readable:o,writable:new BrowserFS.FileSystem.InMemory},(function(o,a){o&&logAndExit(o),SUPPRESS_WINEBOOT&&deleteFile(a,"/lib/wine/wineboot.exe.so"),t.initialize((function(o){o&&logAndExit(o),BrowserFS.FileSystem.OverlayFS.Create({readable:t,writable:e},(function(e,t){if(e&&logAndExit(e),n){var o=new BrowserFS.FileSystem.AsyncMirror(t,new BrowserFS.FileSystem.Dropbox(client));o.initialize((function(e){e&&logAndExit(e),postBuildFileSystem(a,o,i,r)}))}else postBuildFileSystem(a,t,i,r)}))}))}))}function postBuildFileSystem(e,n,t,i){var o=new BrowserFS.FileSystem.MountableFileSystem;o.mount("/root/base",e),o.mount(Config.appDirPrefix.substring(0,Config.appDirPrefix.length-1),n),null!=i&&o.mount("/root/cdrom",i);var r=new BrowserFS.EmscriptenFS;BrowserFS.initialize(o),FS.mount(r,{root:"/root"},"/root");for(let e=0;e<t.length;e++)recursiveCopy(t[e],Config.extraZipFiles[e],"/");t=null,setDirectDrawRenderer(Config.directDrawRenderer),toggleConsole(),Config.isAutoRunSet&&start()}function deleteFile(e,n){try{e.unlinkSync(n)}catch(e){window.BoxedWineConfig.consoleLog("Unable to delete:"+n+" error:"+e.message)}}function createFolders(e,n){for(var t="",i=0;i<n.length;i++)n[i].length>0&&(t=t+"/"+n[i],e.mkdirSync(t))}function recursiveCopy(e,n,t){var i=null==n?"":"/"+n.substring(0,n.length-4),o=BrowserFS.BFSRequire("path");!function e(n,t,i){createFolderIfNecessary(t,i),n.readdirSync(t).forEach((function(r){var a=o.resolve(t,r);a.startsWith("/__MACOSX")||a.endsWith(".DS_Store")||(n.statSync(a).isDirectory()?e(n,a,i):createFileIfNecessary(n,a,i))}))}(e,t,i)}function createFileIfNecessary(e,n,t){var i=n;n.startsWith(t)&&(n=n.substring(t.length));var o=extractFirstPartOfPath(n);if(o.length>0){var r=extractLastPartOfPath(n),a=e.readFileSync(i,null,flag_r);try{window.BoxedWineConfig.consoleLog("creating: root/base"+o+"/"+r),FS.createDataFile("root/base"+o,r,a,!0,!0)}catch(e){if("File exists"===e.message||"FS error"===e.message)try{FS.unlink("root/base"+o+"/"+r),FS.createDataFile("root/base"+o,r,a,!0,!0)}catch(e){window.BoxedWineConfig.consoleLog("file replace error:"+e.message+" for: "+o+"/"+r)}else window.BoxedWineConfig.consoleLog("file creation error:"+e.message+" for: "+o+"/"+r)}}}function createFolderIfNecessary(e,n){e.startsWith(n)&&(e=e.substring(n.length));var t=extractFirstPartOfPath(e),i=extractLastPartOfPath(e);if(t.length>0)try{FS.lookupPath("/root/base"+t+"/"+i,{follow:!0})}catch(e){if("No such file or directory"==e.message||"FS error"===e.message)try{FS.createPath("/root/base/"+t,i,!0,!0)}catch(e){window.BoxedWineConfig.consoleLog("Directory creation error:"+e.message+" for: "+t+"/"+i)}else"File exists"!=e.message&&window.BoxedWineConfig.consoleLog("Directory creation error:"+e.message+" for: "+t+"/"+i)}}function start(){Config.isRunning||startEmulator()}function startEmulator(){Config.isRunning=!0;for(var e=getEmulatorParams(),n=0;n<e.length;n++)Module.arguments.push(e[n]);Module.removeRunDependency("setupBoxedWine")}var initialSetup=function(){window.BoxedWineConfig.consoleLog("running initial setup"),setConfiguration(),Config.emEnvProps.length>0&&Config.emEnvProps.forEach((function(e){ENV[e.key]=e.value})),Module.addRunDependency("setupBoxedWine"),initFileSystem()};function getExecutable(){var e=getParameter("p");return allowParameterOverride()&&""!==e?((e.startsWith("%22")&&e.endsWith("%22")||e.startsWith("%27")&&e.endsWith("%27"))&&(e=e.substring(3,e.length-3)),e=e.split("%20").join(" "),window.BoxedWineConfig.consoleLog("setting program to execute to: "+e)):window.BoxedWineConfig.consoleLog("not setting program to execute"),e}var errorCallback=function(e){window.BoxedWineConfig.consoleLog(e)};function getEntriesAsPromise(e,n,t){var i=0;return new Promise(((o,r)=>{if(e.isDirectory){i+=1;let a=e.createReader(),l=()=>{a.readEntries((e=>{e.length>0?(e.forEach((function(e){getEntriesAsPromise(e,n,t)})),l()):(0==(i-=1)&&(Config.isAutoRunSet||Config.isRunning||loadExeModal(n,t)),o())}),r)};l()}else{let i=e.fullPath,o=i.toUpperCase();t.push(i),(o.endsWith(".EXE")||o.endsWith(".BAT"))&&n.push(i),e.file((function(e){uploadFile(e,i,t)}),errorCallback)}}))}function loadExeModal(e,n){timer=setInterval((function(){readyCheck(e,n)}),100)}function populateModalExe(e){}function execute(e){var n=extractLastPartOfPath(e),t=extractFirstPartOfPath(e);Config.WorkingDir="/home/username/.wine/dosdevices/d:/"+t.substring(1),Config.Program=n,startEmulator()}function readyCheck(e,n){0==n.length&&(clearInterval(timer),populateModalExe(e))}function isInSubDirectory(e,n){var t=FS.lookupPath(e,{follow:!0});if(null!=t&&t.node.isFolder)for(var i=FS.readdir(e).filter((function(e){return"."!==e&&".."!==e&&"__MACOSX"!==e})),o=0;o<i.length;o++)if(i[o]===n)return!0;return!1}function setDirectDrawRenderer(e){let n="root/base/home/username/.wine/user.reg",t=FS.readFile(n,{encoding:"utf8"}),i=t.indexOf('"DirectDrawRenderer');if(-1!=i){let o=t.indexOf("\n",i+1);if(-1!=o){let r='"DirectDrawRenderer"="'+e+'"',a=t.substring(0,i)+r+t.substring(o,t.length);FS.writeFile(n,a)}else window.BoxedWineConfig.consoleLog("Unable to set DirectDrawRenderer in user.reg")}else window.BoxedWineConfig.consoleLog("Unable to find DirectDrawRenderer in user.reg")}function getEmulatorParams(){var e=["-root","/root/base"];if(e.push("-mount_drive"),e.push(Config.appDirPrefix),e.push("d"),e.push("-nozip"),Config.cdromImage.length>0&&(e.push("-mount_drive"),e.push("/root/cdrom"),e.push("e")),null!=Config.resolution&&(e.push("-resolution"),e.push(Config.resolution)),"0"!=Config.frameSkip&&(e.push("-skipFrameFPS"),e.push(Config.frameSkip)),Config.isSoundEnabled||e.push("-nosound"),Config.bpp!=DEFAULT_BPP&&(e.push("-bpp"),e.push(""+Config.bpp)),Config.cpu.length>0&&e.push("-"+Config.cpu),Config.glext.length>0&&(e.push("-glext"),e.push(Config.glext)),Config.envProp.length>0&&(e.push("-env"),e.push(Config.envProp)),Config.WorkingDir.length>0)e.push("-w"),e.push(Config.WorkingDir);else if(Config.appPayload.length>0&&Config.Program.length>0&&"/"!=Config.Program.substring(0,1))e.push("-w"),e.push("/home/username/.wine/dosdevices/d:");else if(Config.appZipFile.length>0&&Config.Program.length>0&&"/"!=Config.Program.substring(0,1)){var n=Config.appZipFile.substring(0,Config.appZipFile.lastIndexOf("."));e.push("-w"),isInSubDirectory(Config.appDirPrefix,n)?e.push("/home/username/.wine/dosdevices/d:/"+n):e.push("/home/username/.wine/dosdevices/d:")}return e.push("/bin/wine"),Config.Program.length>0?(Config.Program.endsWith(".bat")&&(e.push("cmd"),e.push("/c")),e.push(Config.Program)):(e.push("explorer"),e.push("/desktop=shell")),window.BoxedWineConfig.consoleLog("Emulator params:"+e),e}function saveFSImage(){window.BoxedWineConfig.consoleLog("saving filesystem files:"+recordedFiles.length);var e=new JSZip;e.file("tmp",null,{dir:!0}),recordedFiles.forEach((n=>{try{if(!FS.isDir(FS.stat(n).mode)){let t=FS.readFile(n,{encoding:"binary"});e.file(n.substring("/root/base/".length),t)}}catch(e){window.BoxedWineConfig.consoleLog("unable to read file:"+n+" error:"+e)}})),window.BoxedWineConfig.consoleLog("generating zip file");let n=e.generate({type:"blob",compression:"DEFLATE"});window.BoxedWineConfig.consoleLog("finished generating zip file"),url=window.URL.createObjectURL(n),ae.href=url,ae.download="boxedwine-min.zip",ae.click()}function isHomeDirectory(e){return e.length>=10&&"/root/home"===e.substring(0,10)}function startWithFiles(e){for(let n=0;n<e.length;n++)uploadFile(e[n])}function uploadFile(e,n,t){let i=null;i=n?n.startsWith("/")?n.substring(1):n:0==e.webkitRelativePath.length?e.name:e.webkitRelativePath;var o=new FileReader;o.file_name=e.name,o.onload=function(){readFile(this.result,i,t)},o.readAsArrayBuffer(e)}function extractLastPartOfPath(e){return e.substring(e.lastIndexOf("/")+1,e.length)}function extractFirstPartOfPath(e){return e.substring(0,e.lastIndexOf("/"))}function extractFilenameExtension(e){return e.substring(e.lastIndexOf(".")+1,e.length)}function extractFilenameWithoutExtension(e){return e.substring(0,e.lastIndexOf("."))}function readFile(e,n,t){if("zip"===extractFilenameExtension(n).toLowerCase()){var i=extractFilenameWithoutExtension(n);if(!createFolder(Config.appDirPrefix,i))return;var o=Config.appDirPrefix+i,r=new JSZip(e);for(var a in r.files){if(null!=(e=r.file(a))){var l=e.asUint8Array();createFile(g=o+"/"+extractFirstPartOfPath(a),p=extractLastPartOfPath(a),l)}else{var s=a.substring(0,a.length-1),g=extractFirstPartOfPath(s),u=extractLastPartOfPath(s);createFolder(g=0==g.length?o:o+"/"+g,u)}}}else{for(var d=!1,f=0,c=Config.appDirPrefix,p=extractLastPartOfPath(n);!d;){var w=n.indexOf("/",f);if(-1==w)d=!0;else{var m=n.substring(f,w),F=c+m;m.length>0&&(null==uniqueDirs[F]&&m.length>0&&(createFolder(c,m),uniqueDirs[F]=""),c=c+m+"/"),f=w+1}}createFile(c.substring(0,c.length-1),p,new Uint8Array(e)),t&&t.pop(n)}}function calcBackupFilename(){var e=(new Date).toISOString();return e=".backup."+e.split(":").join(".")}function createFolder(e,n){var t=!0;try{FS.createPath(e,n,!0,!0)}catch(i){if("File exists"===i.message||"FS error"===i.message)if(window.BoxedWineConfig.consoleLog("Directory already exists! :"+e+n),confirm("Directory already exists: "+e+n+" continue?"))try{FS.rename(e+n,e+n+calcBackupFilename()),FS.createPath(e,n,!0,!0),window.BoxedWineConfig.consoleLog("Directory replaced: "+e+n)}catch(i){window.BoxedWineConfig.consoleLog("eef="+i),t=!1,console.error("unable to create folder: "+e+n)}else t=!1;else window.BoxedWineConfig.consoleLog("ef="+i)}return t}function createFile(e,n,t){if(!e.includes("__MACOSX"))try{FS.createDataFile(e,n,t,!0,!0)}catch(i){if("File exists"===i.message||"FS error"===i.message){if(window.BoxedWineConfig.consoleLog("File already exists!: "+e+n),confirm("File already exists: "+e+"/"+n+" replace?"))try{FS.unlink(e+"/"+n),FS.createDataFile(e,n,t,!0,!0),window.BoxedWineConfig.consoleLog("File replaced: "+e+n)}catch(t){window.BoxedWineConfig.consoleLog("ee="+t),console.error("unable to create file: "+e+n)}}else window.BoxedWineConfig.consoleLog("e="+i)}}function toggleConsole(){}function toggleSound(){}function toggleDirectory(e){}function getParameter(e){var n="",t=Config.urlParams,i=t.length>0?"?"+t:window.location.href,o=i.indexOf("?")+1;if(o>0)for(var r=i.substring(o).split("&"),a=0;a<r.length;a++){var l=r[a].split("=");if(l[0]===e){n=l[1];break}}var s=n.lastIndexOf("#");return s>0&&(n=n.substring(0,s)),n}function select(e,n,t){null!=selectedItem&&(selectedItem.style.backgroundColor="");selectedFilename=t}function endsWith(e,n){return-1!==e.indexOf(n,e.length-n.length)}function extract(){null!=url&&window.URL.revokeObjectURL(url)}function done(){null!=url&&window.URL.revokeObjectURL(url)}function leaf(e){return'<tr><td ><span id="'+ ++index+'-data" onclick="select('+index+",'"+e.dir+"','"+e.filename+"')\">"+e.filename+"</span></td></tr>"}function branch(e){var n=e[index];index++;var t=n.dir,i=t.substring(0,t.length-1);i=i.substring(i.lastIndexOf("/")+1,i.length);var o="<tr>";for(o=(o=(o=(o=(o+="<td>")+'<span id="'+index+'-expand"><a onclick="toggleDirectory(\''+index+"')\"><strong>+</strong></a></span>")+'<span id="'+index+'-contract" style="display:none;"><a onclick="toggleDirectory(\''+index+"')\"><strong>-</strong></a></span>")+'<span id="'+index+'-data" onclick="select('+index+",'"+t+"', null)\">["+i+"]</span>")+"<div id='"+index+'\' style="display:none;">',o+="<table>";index<e.length;){var r=e[index];if(r.dir===n.dir)o+=leaf(r);else{if(parentDir(r.dir)!==n.dir)break;o+=branch(e,index)}}return o+="</table>",o+="</div>",o+="</td>",o+="</tr>"}function parentDir(e){return endsWith(e,"/")&&(e=e.substring(0,e.length-1)),e.substring(0,e.lastIndexOf("/")+1)}function buildTree(){selectedFilename=null,files=[],index=0,readFiles(Config.appDirPrefix,files),toggleDirectory("1")}function readFiles(e,n){window.BoxedWineConfig.consoleLog("adding directory: "+e),n.push({dir:e,filename:""}),FS.readdir(e).filter((function(e){return"."!==e&&".."!==e})).forEach((function(t){FS.lookupPath(e+t,{follow:!0}).node.isFolder?readFiles(e+t+"/",n):(window.BoxedWineConfig.consoleLog("adding file: "+e+t),n.push({dir:e,filename:t}))}))}function startsWith(e,n){return e.slice(0,n.length)==n}function getFile(e,n){if(n){var t=new JSZip;return files.forEach((function(n){if(startsWith(n.dir,e))if(""!==n.filename){var i=n.dir+n.filename,o=FS.readFile(i,{encoding:"binary"});t.file(i.substring(e.length),o)}else t.file(n.dir.substring(e.length),null,{dir:!0})})),t.generate({type:"blob",compression:"DEFLATE"})}var i=FS.readFile(e,{encoding:"binary"});return new Blob([i],{type:"octet/stream"})}window.Module={},window.BoxedWineShell=e=>{Config=window.BoxedWineConfig;var n,t={logReadFiles:Config.recordLoadedFiles,preRun:[initialSetup],arguments:[],postRun:e?[e]:[],print:function(e){e=Array.prototype.slice.call(arguments).join(" "),window.BoxedWineConfig.consoleLog(e)},printErr:function(e){if(e=Array.prototype.slice.call(arguments).join(" "),Config.recordLoadedFiles&&e.startsWith("FS.trackingDelegate error on read file:")){window.BoxedWineConfig.consoleLog(e);let n=e.substring(e.indexOf("/")),t="/root/base/";n.startsWith(t)&&recordedFiles.push(n)}else console.error(e)},canvas:(n=document.getElementById("boxedWineCanvas"),n.addEventListener("webglcontextlost",(function(e){console.error("WebGL context lost. You will need to reload the page."),e.preventDefault()}),!1),n.width=800,n.height=600,n),setStatus:function(e){t.setStatus.last||(t.setStatus.last={time:Date.now(),text:""})},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),t.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"")}};window.Module=t,window.BoxedWine()};