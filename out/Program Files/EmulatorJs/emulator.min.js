var EJS=function(e){window.EJS_MODULES=e;var t={},n=[];function a(o){if(t[o])return t[o].exports;n.push(o);var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return window.getUsedModules=function(){return n.sort((function(e,t){return t<e?1:-1}))},window.getUnusedModules=function(){for(var t=[],n=getUsedModules(),a=0;a<e.length;a++)null===e[a]||n.includes(a)||t.push(a);return t},Array.isArray,a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=161)}([function(e){e.exports=function(e,t,n){console.warn(e),e&&e.response&&0===e.response.status?t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;"><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors">'+n.localization("CORS Error")+"</a></strong>":t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+n.localization("Network Error")+"</strong>"}},null,null,null,null,null,function(e){function t(){if(!navigator.getGamepads&&!navigator.webkitGetGamepads)throw new Error("get gamepads not found!");if(this.rAF=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.requestAnimationFrame,!this.rAF)throw new Error("request animation frame was not found!");this.loop()}t.prototype={gamepads:[],rAF:null,getGamepads:function(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]},loop:async function(){this.updateGamepadState(),this.rAF.call(null,this.loop.bind(this))},updateGamepadState:function(){for(var e=this.getGamepads(),t=0;t<e.length;t++)if(e[t]){for(var n=!1,a=0;a<this.gamepads.length;a++)if(this.gamepads[a]&&this.gamepads[a].index===e[t].index){if(n=!0,"function"==typeof this.onaxischanged)for(var o,i=0;i<this.gamepads[a].axes.length;i++)e[t].axes[i]===this.gamepads[a].axes[i]||(o=function(){switch(i){case 0:return"LEFT_STICK_X";case 1:return"LEFT_STICK_Y";case 2:return"RIGHT_STICK_X";case 3:return"RIGHT_STICK_Y";default:return""}}())&&this.onaxischanged({axis:o,value:e[t].axes[i],index:t,gamepadIndex:e[t].index});for(i=0;i<this.gamepads[a].buttons.length;i++){let n=1==this.gamepads[a].buttons[i],o=("object"==typeof this.gamepads[a].buttons[i]&&(n=this.gamepads[a].buttons[i].pressed),1==e[t].buttons[i]);"object"==typeof e[t].buttons[i]&&(o=e[t].buttons[i].pressed),n!==o&&(o?"function"==typeof this.onbuttondown&&this.onbuttondown({index:i,gamepadIndex:e[t].index}):"function"==typeof this.onbuttonup&&this.onbuttonup({index:i,gamepadIndex:e[t].index}))}this.gamepads[a]=e[t]}n||(this.gamepads.push(e[t]),"function"==typeof this.onconnected&&this.onconnected())}for(a=0;a<this.gamepads.length;a++)if(this.gamepads[a]){var s=!1;for(t=0;t<e.length;t++)e[t]&&this.gamepads[a].index===e[t].index&&(s=!0);s||(this.gamepads.splice(a,1),a--,"function"==typeof this.ondisconnected&&this.ondisconnected())}},on:function(e,t){this["on"+e.toLowerCase()]=t}},e.exports=t},null,null,null,null,function(e,t,n){function a(e,t){try{e=new URL(e)}catch(e){}return e&&!["http:","https:"].includes(e.protocol)?new Promise((async function(n,a){if("HEAD"===t.method)n({headers:{}});else{try{var o=await fetch(e);if(t.type&&"arraybuffer"===t.type.toLowerCase())o=await o.arrayBuffer();else{o=await o.text();try{o=JSON.parse(o)}catch(n){}}}catch(n){a(n)}n({data:o,headers:{}})}})):new Promise((function(n,a){var o=new XMLHttpRequest;o.onload=function(){if(o.readyState===o.DONE){var e=o.response;try{e=JSON.parse(e)}catch(e){}n({data:e,headers:{"content-length":o.getResponseHeader("content-length"),"content-type":o.getResponseHeader("content-type"),"last-modified":o.getResponseHeader("last-modified")}})}},o.responseType=t.type,o.onerror=a,o.open(t.method,e,!0),o.send()}))}e.exports={a:{get:async function(e,t){return a(e,{method:"GET",type:t=t&&t.responseType?t&&t.responseType:"text"})},head:async function(e,t){return a(e,{method:"HEAD",type:t=t&&t.responseType?t&&t.responseType:"text"})}}}},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t,n){var a;!function(){"use strict";void 0!==(a="function"==typeof(a=function(){function e(e){throw e}function t(){}function n(e,t){for(var n in void 0===t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={}),a)this[n]=(void 0!==e[n]?e:a)[n];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var o="object"==typeof window?window:self;t=this.implementationPreference.filter((function(e){return e in o}));this.implementation=t[0],this.idb=o[this.implementation],this.keyRange=o.IDBKeyRange||o.webkitIDBKeyRange||o.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()}var a={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:e,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},o={constructor:n,version:"1.7.2",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),t=!1;e.onerror=function(e){var t;("error"in(t=e).target?"VersionError"==t.target.error.name:"errorCode"in t.target&&12==t.target.errorCode)?this.onError(new Error("The version number provided is lower than the existing one.")):(e=e.target.error||(t="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion,"errorCode"in e.target&&(t+=" with error code "+e.target.errorCode),new Error(t)),this.onError(e))}.bind(this),e.onsuccess=function(e){var n;t||(this.db?this.onStoreReady():(this.db=e.target.result,"string"!=typeof this.db.version?this.db.objectStoreNames.contains(this.storeName)?(e=this.db.transaction([this.storeName],this.consts.READ_ONLY),this.store=e.objectStore(this.storeName),n=Array.prototype.slice.call(this.getIndexList()),this.indexes.forEach((function(e){var a,o=e.name;if(!o)return t=!0,void this.onError(new Error("Cannot create index: No index name given."));this.normalizeIndexData(e),this.hasIndex(o)?(a=this.store.index(o),this.indexComplies(a,e)||(t=!0,this.onError(new Error('Cannot modify index "'+o+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),n.splice(n.indexOf(o),1)):(t=!0,this.onError(new Error('Cannot create new index "'+o+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))}),this),n.length&&(t=!0,this.onError(new Error('Cannot delete index(es) "'+n.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),t||this.onStoreReady()):this.onError(new Error("Object store couldn't be created.")):this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."))))}.bind(this),e.onupgradeneeded=function(e){this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName)?this.store=e.target.transaction.objectStore(this.storeName):(e={autoIncrement:this.autoIncrement},null!==this.keyPath&&(e.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,e));var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach((function(e){var a,o=e.name;o||(t=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(o)?(a=this.store.index(o),this.indexComplies(a,e)||(this.store.deleteIndex(o),this.store.createIndex(o,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),n.splice(n.indexOf(o),1)):this.store.createIndex(o,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})}),this),n.length&&n.forEach((function(e){this.store.deleteIndex(e)}),this)}.bind(this)},deleteDatabase:function(e,t){var n;this.idb.deleteDatabase?(this.db.close(),(n=this.idb.deleteDatabase(this.dbName)).onsuccess=e,n.onerror=t):t(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(n,a,o,i){null!==this.keyPath&&(i=o,o=a,a=n),i=i||e,o=o||t;var s=!1,l=null,r=this.db.transaction([this.storeName],this.consts.READ_WRITE);return r.oncomplete=function(){(s?o:i)(l)},r.onabort=i,r.onerror=i,(a=null!==this.keyPath?(this._addIdPropertyIfNeeded(a),r.objectStore(this.storeName).put(a)):r.objectStore(this.storeName).put(a,n)).onsuccess=function(e){s=!0,l=e.target.result},a.onerror=i,r},get:function(n,a,o){o=o||e,a=a||t;var i=!1,s=null,l=this.db.transaction([this.storeName],this.consts.READ_ONLY);return(n=(l.oncomplete=function(){(i?a:o)(s)},l.onabort=o,l.onerror=o,l.objectStore(this.storeName).get(n))).onsuccess=function(e){i=!0,s=e.target.result},n.onerror=o,l},remove:function(n,a,o){o=o||e,a=a||t;var i=!1,s=null,l=this.db.transaction([this.storeName],this.consts.READ_WRITE);return(n=(l.oncomplete=function(){(i?a:o)(s)},l.onabort=o,l.onerror=o,l.objectStore(this.storeName).delete(n))).onsuccess=function(e){i=!0,s=e.target.result},n.onerror=o,l},batch:function(n,a,o){if(o=o||e,a=a||t,"[object Array]"!=Object.prototype.toString.call(n))o(new Error("dataArray argument must be of type Array."));else if(0===n.length)return a(!0);function i(){0!=--s||l||(r=l=!0)}var s=n.length,l=!1,r=!1,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);return c.oncomplete=function(){(r?a:o)(r)},c.onabort=o,c.onerror=o,n.forEach((function(e){function t(e){c.abort(),l||(l=!0,o(e,a,s))}var n,a=e.type,s=e.key;e=e.value;"remove"==a?((n=c.objectStore(this.storeName).delete(s)).onsuccess=i,n.onerror=t):"put"==a&&((n=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),c.objectStore(this.storeName).put(e)):c.objectStore(this.storeName).put(e,s)).onsuccess=i,n.onerror=t)}),this),c},putBatch:function(e,t,n){return e=e.map((function(e){return{type:"put",value:e}})),this.batch(e,t,n)},upsertBatch:function(n,a,o,i){function s(e){n[u++][l]=e.target.result,0!=--r||c||(d=c=!0)}"function"==typeof a&&(i=o=a,a={}),i=i||e,o=o||t,a=a||{},"[object Array]"!=Object.prototype.toString.call(n)&&i(new Error("dataArray argument must be of type Array."));var l=a.keyField||this.keyPath,r=n.length,c=!1,d=!1,u=0,f=this.db.transaction([this.storeName],this.consts.READ_WRITE);return f.oncomplete=function(){d?o(n):i(!1)},f.onabort=i,f.onerror=i,n.forEach((function(e){var t=e.key;(e=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),f.objectStore(this.storeName).put(e)):f.objectStore(this.storeName).put(e,t)).onsuccess=s,e.onerror=function(e){f.abort(),c||(c=!0,i(e))}}),this),f},removeBatch:function(e,t,n){return e=e.map((function(e){return{type:"remove",key:e}})),this.batch(e,t,n)},getBatch:function(n,a,o,i){if(o=o||e,a=a||t,i=i||"sparse","[object Array]"!=Object.prototype.toString.call(n))o(new Error("keyArray argument must be of type Array."));else if(0===n.length)return a([]);function s(e){e.target.result||"dense"==i?l.push(e.target.result):"sparse"==i&&l.length++,0==--r&&(c=!0,d=l)}var l=[],r=n.length,c=!1,d=null,u=this.db.transaction([this.storeName],this.consts.READ_ONLY);return u.oncomplete=function(){(c?a:o)(d)},u.onabort=o,u.onerror=o,n.forEach((function(e){(e=u.objectStore(this.storeName).get(e)).onsuccess=s,e.onerror=function(e){o(d=e),u.abort()}}),this),u},getAll:function(n,a){a=a||e,n=n||t;var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,n,a):this._getAllCursor(o,i,n,a),o},_getAllNative:function(e,t,n,a){var o=!1,i=null;(e=(e.oncomplete=function(){(o?n:a)(i)},e.onabort=a,e.onerror=a,t.getAll())).onsuccess=function(e){o=!0,i=e.target.result},e.onerror=a},_getAllCursor:function(e,t,n,a){var o=[],i=!1,s=null;(e=(e.oncomplete=function(){(i?n:a)(s)},e.onabort=a,e.onerror=a,t.openCursor())).onsuccess=function(e){(e=e.target.result)?(o.push(e.value),e.continue()):(i=!0,s=o)},e.onError=a},clear:function(n,a){a=a||e,n=n||t;var o=!1,i=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE),l=(s.oncomplete=function(){(o?n:a)(i)},s.onabort=a,s.onerror=a,s.objectStore(this.storeName).clear());return l.onsuccess=function(e){o=!0,i=e.target.result},l.onerror=a,s},_addIdPropertyIfNeeded:function(e){void 0===e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount+++Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(e,t){return["keyPath","unique","multiEntry"].every((function(n){if("multiEntry"==n&&void 0===e[n]&&!1===t[n])return!0;if("keyPath"!=n||"[object Array]"!=Object.prototype.toString.call(t[n]))return t[n]==e[n];var a=t.keyPath,o=e.keyPath;if("string"==typeof o)return a.toString()==o;if("function"!=typeof o.contains&&"function"!=typeof o.indexOf)return!1;if(o.length!==a.length)return!1;for(var i=0,s=a.length;i<s;i++)if(!(o.contains&&o.contains(a[i])||o.indexOf(-1!==a[i])))return!1;return!0}))},iterate:function(t,n){var a="desc"==(n=s({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:e,limit:1/0,offset:0,allowItemRejection:!1},n||{})).order.toLowerCase()?"PREV":"NEXT",o=(n.filterDuplicates&&(a+="_NO_DUPLICATE"),!1),i=this.db.transaction([this.storeName],this.consts[n.writeAccess?"READ_WRITE":"READ_ONLY"]),l=i.objectStore(this.storeName),r=(n.index&&(l=l.index(n.index)),0);return(l=(i.oncomplete=function(){o?n.onEnd?n.onEnd():t(null):n.onError(null)},i.onabort=n.onError,i.onerror=n.onError,l.openCursor(n.keyRange,this.consts[a]))).onerror=n.onError,l.onsuccess=function(e){var a;(e=e.target.result)?n.offset?(e.advance(n.offset),n.offset=0):(a=t(e.value,e,i),n.allowItemRejection&&!1===a||r++,n.autoContinue&&(r+n.offset<n.limit?e.continue():o=!0)):o=!0},i},query:function(e,t){var n=[],a=0;return(t=t||{}).autoContinue=!0,t.writeAccess=!1,t.allowItemRejection=!!t.filter,t.onEnd=function(){e(n,a)},this.iterate((function(e){a++;var o=!t.filter||t.filter(e);return!1!==o&&n.push(e),o}),t)},count:function(t,n){var a=(n=s({index:null,keyRange:null},n||{})).onError||e,o=!1,i=null,l=this.db.transaction([this.storeName],this.consts.READ_ONLY),r=(l.oncomplete=function(){(o?t:a)(i)},l.onabort=a,l.onerror=a,l.objectStore(this.storeName));return(r=(r=n.index?r.index(n.index):r).count(n.keyRange)).onsuccess=function(e){o=!0,i=e.target.result},r.onError=a,l},makeKeyRange:function(e){var t,n=void 0!==e.lower,a=void 0!==e.upper;switch(!0){case void 0!==e.only:t=this.keyRange.only(e.only);break;case n&&a:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case n:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case a:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}},i={};function s(e,t){var n,a;for(n in t)(a=t[n])!==i[n]&&a!==e[n]&&(e[n]=a);return e}return n.prototype=o,n.version=o.version,n})?a.call(t,n,t,e):a)&&(e.exports=a)}()},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t,n){var a;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var i=typeof a;if("string"==i||"number"==i)e.push(this&&this[a]||a);else if(Array.isArray(a))e.push(o.apply(this,a));else if("object"==i)for(var s in a)n.call(a,s)&&a[s]&&e.push(this&&this[s]||s)}}return e.join(" ")}e.exports?e.exports=o.default=o:void 0!==(a=function(){return o}.apply(t,[]))&&(e.exports=a)}()},function(e,t,n){e.exports={"ejs-wrapper":"ejs--de6433374cb30211f10e148b320b2f",ejs:"ejs--7a5f920ceffb2913f6dbda780573cf","ejs--full-ui":"ejs--f3a002bba9836fe4ebfed357a45521","controls-tabs":"ejs--008adea3c1ef33a8fc94892a1e97e6",overlay:"ejs--85a95eb6bf74a40ab61b91a91e5bff","key-setting-popup":"ejs--d169a219343bc32dd4aecc3f6b7f25","loading-info":"ejs--782e3572812f983b3a150eec177391",p1:"ejs--c426dd1d179aa351e6cec47e1d9438",p2:"ejs--31e7e81db48819ee35ec6f50378a2e",p3:"ejs--20d4eb2646d396f558a645dc0574f1",p4:"ejs--4de05306c8b099bdeb4585571ac095",ejs__contextmenu:"ejs--c7957d8666bb6b8fc7c3e9c021aaf8",ad:"ejs--cbcfe0a1421cadac9a04c81d6431d6","close-ad":"ejs--f3a1903d935f6cf720d4a0498db62a","start-game":"ejs--73f9b4e94a7a1fe74e11107d5ab2ef",pulse:"ejs--9bd947b3e6427453595f083d740a7c",ejs__control:"ejs--8732295ca5c4902a060d34706a8146","ejs__tab-focus":"ejs--a83b6c705e103e81a7762d0ed5e64b","ejs__control--pressed":"ejs--b1238136ec472a92297159882cf4b8","icon--pressed":"ejs--ec731619062226d943da67f5d83009","icon--not-pressed":"ejs--dc7068585e3d84fe0e676864c1439e","label--pressed":"ejs--0c6561f9155750b0aeeed6da5da7bf","label--not-pressed":"ejs--13d64e30c1333cc99391af48ddabaa","ejs--video":"ejs--d5f430a99a1619b3434bf58e34a99c",ejs__controls:"ejs--1acedc5ed6816abe96dd27d910fd74",ejs__progress:"ejs--f1aa376719b564cae0e653157cde14",ejs__time:"ejs--90d2780f99bcc76fdb6b0378a7238e",ejs__menu:"ejs--c7bfb2d1b75a40fdaaf90624bea9e7",ejs__volume:"ejs--36ceeeec0df37a9cf4bbe05fa204ec","ejs--hide-controls":"ejs--1b8cb7f2294b1eb5de5238daea3513","ejs--fullscreen-enabled":"ejs--19409fe2057ab935a7e46abb5b4f49",ejs__tooltip:"ejs--74c6d4176d27e37a19d2e9e61de8f4",ejs__menu__container:"ejs--013213afedeeb6878089b1ca1b4e47","ejs-popup":"ejs--c2532bfe04554193cc42b3be753700","ejs__control--forward":"ejs--0b4cdb4057d1a4623e60836ccc6275","ejs__control--back":"ejs--a7ad9de0cb0ca672b6703c50de7db9",ejs__menu__value:"ejs--f91e90fe7cabc875aff9a431bf5389","ejs__tooltip--visible":"ejs--6ea27aa07e60d1d6e4c9782740028a","ejs--menu-open":"ejs--da54136ccf8c6b0b16d98e8b8e8b88","ejs__video-wrapper":"ejs--057800d021995e1347ec07cb748672",portrait:"ejs--64f1256f556fb94454b930cb3ea7f2","game-started":"ejs--7da7949f602347007818e6d192eb23",ejs__progress__buffer:"ejs--f8d706413436fd119cf01aaf5a9d9d","ejs--audio":"ejs--bd0222e58d71b0a304d6037dfcffd5","ejs--loading":"ejs--2521e1257996f264de36e77cc9c5ee",ejs__dialogs:"ejs--d31688f864f56d6426ebbf2217d6ee",ejs__dialog:"ejs--5e71fd80268afbb1d588e40b993508",ejs__cache__container:"ejs--1e0f0672f67d0e96592314c9ed78b0",ejs__loading__container:"ejs--d7e6a6a8f38bfaa256fe5d709a8258","ejs__load-state__container":"ejs--b183f581b5336c4908ad258d3e1cc7",ejs__screenRecord__container:"ejs--b183f581b5336cashrqd258d3e1cc7",ejs__netplay__container:"ejs--158ea9dd34e3e7af2d837f8b05babb",ejs__gamepad__container:"ejs--3f0897a8158ba363a0ee0afe4da7c5","dialog-container":"ejs--38cc09882a55e98c76168dbe838aa0","dialog-title":"ejs--b373c9d5029d49324fb8ac3ece96c1","dialog-content":"ejs--a5e2629abb9a5bcbc8b2c1307922d2","dialog-buttons":"ejs--580e3c22e63f8a1eb29694fd0b141b","btn-cancel":"ejs--ad20569e1449d7b8e99e6465960456","btn-reset":"ejs--ad20569e1449d7b8e99e6465963825","btn-clear":"ejs--ad20569e1449d7b8e99e6468571053",tabs:"ejs--8e7922427f460a31935084b7acfb1a",active:"ejs--68d337c212ec6a5bc43125440d422b","tabs-content":"ejs--31eb28817642bb1bfe0a2c422108bb","tabs-panel":"ejs--f932566a0af5314da834324c901978","button-container":"ejs--c233fb69cbef43078bc39e9d1efac8","btn-submit":"ejs--bdb54e9fc47f9805b506b746e897bf","btn-create-room":"ejs--67d03ee7480b871ad6507d6319a839","btn-quit":"ejs--c2d931157456c1d438d40a2f66af2c",set:"ejs--6604c83041a275a78837c452a71dd8","btn-join-room":"ejs--99150e15f962c63c689cadc81ef40d","netplay-player-name":"ejs--71527b6509aa48afce3ce1a11c02f0","netplay-player-name-input":"ejs--7ad35768e3f6b9faf97db01d5b60ae","netplay-player-name-set":"ejs--9c403e5e107a3e4374ba244b636400","netplay-roomlist":"ejs--d6a46533fa6e510a571af5c28b440a","netplay-create-room":"ejs--57ca9b3853cc7de731483cfcc95a59","netplay-room-name-input":"ejs--0885d5e25e19127b6b516014426a1b","netplay-room-password-input":"ejs--25023d28756fdb9dfbbfb6dccb8677","netplay-create-room-set":"ejs--75b3a8d35aacc6424ed7422fdeaaaa","netplay-room":"ejs--eefdf28d69ed2d20f197308981bb61","cheats-add":"ejs--9e670880bb57e824400fa00f09aaad","cheats-list":"ejs--2b4e3c245b7b25dfdac5e09155a68e","cheat-code-input":"ejs--572b0b3a0345a6b01b01a15a02842c","cheat-name-input":"ejs--a7d7f80c8999469c991ea452a85dd9",ejs__widgets:"ejs--952c974392296e7f643d51db380157",ejs__widget:"ejs--0d7e216cf12ae73705b5d5bb0452fc",ejs__widget_controls_toggle:"ejs--666d4296310579687cf3cf3d2cf951",ejs__widget_netplay:"ejs--c0a5e71f6613caab66d6ae15a5a00f","virtual-gamepad":"ejs--2440e3b831017ff8327c939e2a4413",top:"ejs--b8d8b771d0bbb94e2bbd03054f53fd",left:"ejs--c83d70cb63c933edc073c7fe92e32b",buttons:"ejs--6e7015634623fd6a82e6a7d3488c84",center:"ejs--49fa47c86a131e4ca8fb268bfdde89",right:"ejs--7d2b19f77fd0ccabf94dc1ca39ae18",touch:"ejs--d708d9d486f1eca73a593d5c09f8ad",modal:"ejs--eefec939452eb92fad035932d0f47c",modal__overlay:"ejs--f1f43b27384834c8c22c6f81d0c5ae",modal__container:"ejs--c4ee33766a01ed0356c3ec07898e96",modal__header:"ejs--a073f32023da1ced805c5f95a4e81c",modal__footer:"ejs--ed44f59bb8cd49177586b140658c6c",modal__title:"ejs--81470ba5e6a6d68014839ad4d9a977",modal__close:"ejs--c3c85789c2a7f56d8b26dba75b7e1f",modal__content:"ejs--db44f5520e6f4fd0dd34b478bb9ee8",modal__btn:"ejs--319bcec5dee9444e1a2a53d6503b7c","modal__btn-primary":"ejs--eaf3c1cba25d415d92ac48d7db34dd",modal__errmsg:"ejs--940087708c06b6129ce2bfa45f1d89","micromodal-slide":"ejs--bef295f3125e9ba83d4f3677264bae","is-open":"ejs--60c17e0d149099f207b06f27edae6a",mmfadeIn:"ejs--9d7aa2bd5ee276be085e5b2a0bbc2e",mmslideIn:"ejs--8b069266f76099cc6bc220f6ea56cc",mmfadeOut:"ejs--184b7558ffeb569c1790654537477b",mmslideOut:"ejs--379a464ad0e66ea5fc601e5f2fd73e","ejs-switch":"ejs--4c3e63d4005bd8a0468e9c74a35f62","ejs-delete-cheat":"ejs--90bcdd71cd0d2307e9ee0dffa916da","icon--exit-fullscreen":"ejs--2b3dd6e2e26c0f0dc4ac5779dedd5e","ejs--fullscreen-fallback":"ejs--412041671de21945d3e028b6ae84c9","ejs--no-transition":"ejs--33643265135cf89e6c0a0d9866d6f1","ejs__sr-only":"ejs--6f0e996cd15e5fb6be0256918531d7","ejs-fade-in":"ejs--7cadf43f3d9eb17c7e3c36de84973b"}},function(e,t,n){var a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=function(){function e(){}function t(e,n){return this.identifier=n.identifier,this.position=n.position,this.frontPosition=n.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(n),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=t.id,t.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function n(e,t){var a=this;return a.nipples=[],a.idles=[],a.actives=[],a.ids=[],a.pressureIntervals={},a.manager=e,a.id=n.id,n.id+=1,a.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1},a.config(t),"static"!==a.options.mode&&"semi"!==a.options.mode||(a.options.multitouch=!1),a.options.multitouch||(a.options.maxNumberOfNipples=1),a.updateBox(),a.prepareNipples(),a.bindings(),a.begin(),a.nipples}function a(e){var t,n=this;return n.ids={},n.index=0,n.collections=[],n.config(e),n.prepareCollections(),d.bindEvt(window,"resize",(function(e){clearTimeout(t),t=setTimeout((function(){var e,t=d.getScroll();n.collections.forEach((function(n){n.forEach((function(n){e=n.el.getBoundingClientRect(),n.position={x:t.x+e.left,y:t.y+e.top}}))}))}),100)})),n.collections}var o,i=!!("ontouchstart"in window),s=!!window.PointerEvent,l=!!window.MSPointerEvent,r={start:"mousedown",move:"mousemove",end:"mouseup"},c={},d=(s?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:l?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:i?(o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},c=r):o=r,{distance:function(e,t){var n=t.x-e.x;t=t.y-e.y;return Math.sqrt(n*n+t*t)},angle:function(e,t){var n=t.x-e.x;t=t.y-e.y;return d.degrees(Math.atan2(t,n))},findCoord:function(e,t,n){var a={x:0,y:0};return n=d.radians(n),a.x=e.x-t*Math.cos(n),a.y=e.y-t*Math.sin(n),a},radians:function(e){return e*(Math.PI/180)},degrees:function(e){return e*(180/Math.PI)},bindEvt:function(e,t,n){for(var a,o=t.split(/[ ,]+/g),i=0;i<o.length;i+=1)a=o[i],e.addEventListener?e.addEventListener(a,n,!1):e.attachEvent&&e.attachEvent(a,n)},unbindEvt:function(e,t,n){for(var a,o=t.split(/[ ,]+/g),i=0;i<o.length;i+=1)a=o[i],e.removeEventListener?e.removeEventListener(a,n):e.detachEvent&&e.detachEvent(a,n)},trigger:function(e,t,n){t=new CustomEvent(t,n),e.dispatchEvent(t)},prepareEvent:function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},getScroll:function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},applyPosition:function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},getTransitionStyle:function(e,t,n){var a,o=d.configStylePropertyObject(e);for(a in o)if(o.hasOwnProperty(a))if("string"==typeof t)o[a]=t+" "+n;else{for(var i="",s=0,l=t.length;s<l;s+=1)i+=t[s]+" "+n+", ";o[a]=i.slice(0,-2)}return o},getVendorStyle:function(e,t){var n,a=d.configStylePropertyObject(e);for(n in a)a.hasOwnProperty(n)&&(a[n]=t);return a},configStylePropertyObject:function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach((function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},safeExtend:function(e,t){var n,a={};for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?a[n]=t[n]:e.hasOwnProperty(n)&&(a[n]=e[n]);return a},map:function(e,t){if(e.length)for(var n=0,a=e.length;n<a;n+=1)t(e[n]);else t(e)}}),u=(e.prototype.on=function(e,t){var n,a=this,o=e.split(/[ ,]+/g);a._handlers_=a._handlers_||{};for(var i=0;i<o.length;i+=1)n=o[i],a._handlers_[n]=a._handlers_[n]||[],a._handlers_[n].push(t);return a},e.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},void 0===e?n._handlers_={}:void 0===t?n._handlers_[e]=null:n._handlers_[e]&&0<=n._handlers_[e].indexOf(t)&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},e.prototype.trigger=function(e,t){var n,a=this,o=e.split(/[ ,]+/g);a._handlers_=a._handlers_||{};for(var i=0;i<o.length;i+=1)n=o[i],a._handlers_[n]&&a._handlers_[n].length&&a._handlers_[n].forEach((function(e){e.call(a,{type:n,target:a},t)}))},e.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=d.safeExtend(this.options,e))},e.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},d.bindEvt(e,o[t],n._domHandlers_[t]),c[t]&&d.bindEvt(e,c[t],n._domHandlers_[t]),n},e.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},d.unbindEvt(e,o[t],n._domHandlers_[t]),c[t]&&d.unbindEvt(e,c[t],n._domHandlers_[t]),delete n._domHandlers_[t],this},t.prototype=new e,(t.constructor=t).id=0,t.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},t.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=d.getVendorStyle("borderRadius","50%"),n=(e=d.getTransitionStyle("transition","opacity",e),{});return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},d.extend(n.el,e),d.extend(n.back,t),d.extend(n.front,t),this.applyStyles(n),this},t.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},t.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},t.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},t.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},t.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},t.prototype.hide=function(e){var t=this;return t.options.dataOnly||(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var n="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=n,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick&&t.restPosition()),t},t.prototype.restPosition=function(e){var t=this,n=(t.frontPosition={x:0,y:0},t.options.fadeTime+"ms"),a={};(n=(a.front=d.getTransitionStyle("transition",["top","left"],n),{front:{}})).front={left:t.frontPosition.x+"px",top:t.frontPosition.y+"px"},t.applyStyles(a),t.applyStyles(n),t.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(t),t.restCallback()}),t.options.fadeTime)},t.prototype.restCallback=function(){var e={};e.front=d.getTransitionStyle("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},t.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},t.prototype.computeDirection=function(e){var t,n,a,o=e.angle.radian,i=Math.PI/4,s=Math.PI/2;if(i<o&&o<3*i&&!e.lockX?t="up":-i<o&&o<=i&&!e.lockY?t="left":3*-i<o&&o<=-i&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=-s<o&&o<s?"left":"right"),e.lockX||(a=0<o?"up":"down"),e.force>this.options.threshold){var l={};for(r in this.direction)this.direction.hasOwnProperty(r)&&(l[r]=this.direction[r]);var r,c={};for(r in this.direction={x:n,y:a,angle:t},e.direction=this.direction,l)l[r]===this.direction[r]&&(c[r]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+t,e)}return e},n.prototype=new e,(n.constructor=n).id=0,n.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var n=0,a=t.length;n<a;n+=1)if(t[n].identifier===e)return t[n];return!1}},n.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},n.prototype.begin=function(){var e=this.options;"static"===e.mode&&((e=this.createNipple(e.position,this.manager.getIdentifier())).add(),this.idles.push(e))},n.prototype.createNipple=function(e,n){var a,o=this,i=d.getScroll(),s={},l=o.options,r=(e.x&&e.y?s={x:e.x-(i.x+o.box.left),y:e.y-(i.y+o.box.top)}:(e.top||e.right||e.bottom||e.left)&&((r=document.createElement("DIV")).style.display="hidden",r.style.top=e.top,r.style.right=e.right,r.style.bottom=e.bottom,r.style.left=e.left,r.style.position="absolute",l.zone.appendChild(r),a=r.getBoundingClientRect(),l.zone.removeChild(r),s=e,e={x:a.left+i.x,y:a.top+i.y}),new t(o,{color:l.color,size:l.size,threshold:l.threshold,fadeTime:l.fadeTime,dataOnly:l.dataOnly,restJoystick:l.restJoystick,restOpacity:l.restOpacity,mode:l.mode,identifier:n,position:e,zone:l.zone,frontPosition:{x:0,y:0}}));return l.dataOnly||(d.applyPosition(r.ui.el,s),d.applyPosition(r.ui.front,r.frontPosition)),o.nipples.push(r),o.trigger("added "+r.identifier+":added",r),o.manager.trigger("added "+r.identifier+":added",r),o.bindNipple(r),r},n.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},n.prototype.bindNipple=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,a.trigger(n,t)}var n,a=this;e.on("destroyed",a.onDestroyed.bind(a)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},n.prototype.pressureFn=function(e,t,n){var a=this,o=0;clearInterval(a.pressureIntervals[n]),a.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==o&&(t.trigger("pressure",n),a.trigger("pressure "+t.identifier+":pressure",n),o=n)}.bind(a),100)},n.prototype.onstart=function(e){var t=this,n=t.options;return e=d.prepareEvent(e),t.updateBox(),d.map(e,(function(e){t.actives.length<n.maxNumberOfNipples&&t.processOnStart(e)})),t.manager.bindDocument(),!1},n.prototype.processOnStart=function(e){function t(t){t.trigger("start",t),n.trigger("start "+t.id+":start",t),t.show(),0<i&&n.pressureFn(e,t,t.identifier),n.processOnMove(e)}var n=this,a=n.options,o=n.manager.getIdentifier(e),i=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},l=n.getOrCreate(o,s);if(l.identifier!==o&&n.manager.removeIdentifier(l.identifier),l.identifier=o,0<=(o=n.idles.indexOf(l))&&n.idles.splice(o,1),n.actives.push(l),n.ids.push(l.identifier),"semi"!==a.mode)t(l);else{if(!(d.distance(s,l.position)<=a.catchDistance))return l.destroy(),void n.processOnStart(e);t(l)}return l},n.prototype.getOrCreate=function(e,t){var n,a=this,o=a.options;return/(semi|static)/.test(o.mode)?(n=a.idles[0])?(a.idles.splice(0,1),n):"semi"===o.mode?a.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):a.createNipple(t,e)},n.prototype.processOnMove=function(e){var t=this,n=t.options,a=t.manager.getIdentifier(e),o=t.nipples.get(a);if(!o)return console.error("Found zombie joystick with ID "+a),void t.manager.removeIdentifier(a);o.identifier=a;a=o.options.size/2;var i={x:e.pageX,y:e.pageY},s=d.distance(i,o.position),l=d.angle(i,o.position),r=d.radians(l),c=s/a,u=(a=(i=a<s?d.findCoord(o.position,s=a,l):i).x-o.position.x,i.y-o.position.y);n.lockX&&(u=0),n.lockY&&(a=0),o.frontPosition={x:a,y:u},n.dataOnly||d.applyPosition(o.ui.front,o.frontPosition),a={identifier:o.identifier,position:i,force:c,pressure:e.force||e.pressure||e.webkitForce||0,distance:s,angle:{radian:r,degree:l},instance:o,lockX:n.lockX,lockY:n.lockY};(a=o.computeDirection(a)).angle={radian:d.radians(180-l),degree:180-l},o.trigger("move",a),t.trigger("move "+o.id+":move",a)},n.prototype.processOnEnd=function(e){var t=this,n=t.options,a=(e=t.manager.getIdentifier(e),t.nipples.get(e));e=t.manager.removeIdentifier(a.identifier);a&&(n.dataOnly||a.hide((function(){"dynamic"===n.mode&&(a.trigger("removed",a),t.trigger("removed "+a.id+":removed",a),t.manager.trigger("removed "+a.id+":removed",a),a.destroy())})),clearInterval(t.pressureIntervals[a.identifier]),a.resetDirection(),a.trigger("end",a),t.trigger("end "+a.id+":end",a),0<=t.ids.indexOf(a.identifier)&&t.ids.splice(t.ids.indexOf(a.identifier),1),0<=t.actives.indexOf(a)&&t.actives.splice(t.actives.indexOf(a),1),/(semi|static)/.test(n.mode)?t.idles.push(a):0<=t.nipples.indexOf(a)&&t.nipples.splice(t.nipples.indexOf(a),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[e.id]=e.identifier))},n.prototype.onDestroyed=function(e,t){var n=this;0<=n.nipples.indexOf(t)&&n.nipples.splice(n.nipples.indexOf(t),1),0<=n.actives.indexOf(t)&&n.actives.splice(n.actives.indexOf(t),1),0<=n.idles.indexOf(t)&&n.idles.splice(n.idles.indexOf(t),1),0<=n.ids.indexOf(t.identifier)&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument()},n.prototype.destroy=function(){var e,t=this;for(e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(e){e.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()},a.prototype=new e,(a.constructor=a).prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every((function(e){return!(n=e.get(t))})),n}},a.prototype.create=function(e){return this.createCollection(e)},a.prototype.createCollection=function(e){return e=new n(this,e),this.bindCollection(e),this.collections.push(e),e},a.prototype.bindCollection=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,a.trigger(n,t)}var n,a=this;e.on("destroyed",a.onDestroyed.bind(a)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},a.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},a.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},a.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},a.prototype.removeIdentifier=function(e){var t,n={};for(t in this.ids)if(this.ids[t]===e){n.id=t,n.identifier=this.ids[t],delete this.ids[t];break}return n},a.prototype.onmove=function(e){return this.onAny("move",e),!1},a.prototype.onend=function(e){return this.onAny("end",e),!1},a.prototype.oncancel=function(e){return this.onAny("end",e),!1},a.prototype.onAny=function(e,t){var n,a=this,o="processOn"+e.charAt(0).toUpperCase()+e.slice(1);return t=d.prepareEvent(t),d.map(t,(function(e){n=a.getIdentifier(e),d.map(a.collections,function(e,t,n){0<=n.ids.indexOf(t)&&(n[o](e),e._found_=!0)}.bind(null,e,n)),e._found_||a.removeIdentifier(n)})),!1},a.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},a.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)},new a);return{create:function(e){return u.create(e)},factory:u}},"object"==o(t)&&void 0!==e?e.exports=a():void 0!==(t="function"==typeof a?a.apply(t,[]):a)&&(e.exports=t)},null,function(e,t,n){"use strict";for(var a in window.EJS_RESET_VARS=[],window)window.EJS_RESET_VARS.push(a);function o(e){return null!=e?e.constructor:null}function i(e,t){return Boolean(e&&t&&e instanceof t)}function s(e){return null==e}function l(e){return o(e)===Object}function r(e){return o(e)===String}function c(e){return Array.isArray(e)}function d(e){return i(e,NodeList)}function u(e){return s(e)||(r(e)||c(e)||d(e))&&!e.length||l(e)&&!Object.keys(e).length}n.r(t);let f={volume:.5,muted:!1,i18n:{restart:"Restart",play:"Play",pause:"Pause",played:"Played",volume:"Volume",mute:"Mute (F9)",unmute:"Unmute (F9)",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",settings:"Settings",saveState:"Save State (Shift + F2)",loadState:"Load State (Shift + F4)",screenRecord:"Start Screen Recording",gamepad:"Control Settings",cheat:"Cheats",menuBack:"Go back to previous menu",normal:"Normal",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",playNow:"Start Game"},listeners:{play:null,pause:null,restart:null,rewind:null,mute:null,volume:null,fullscreen:null},events:["ready"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".ejs",controls:{container:null,wrapper:".jes__controls"},buttons:{play:'[data-btn="play"]',pause:'[data-btn="pause"]',mute:'[data-btn="mute"]',fullscreen:'[data-btn="fullscreen"]',settings:'[data-btn="settings"]',saveState:'[data-btn="save-state"]',loadState:'[data-btn="load-state"]',screenRecord:'[data-btn="screen-record"]',gamepad:'[data-btn="gamepad"]',cheat:'[data-btn="cheat"]'},inputs:{volume:'[data-range="volume"]'}},classNames:{type:"ejs--video",video:"ejs__video-wrapper",poster:"ejs__poster",posterEnabled:"ejs__poster-enabled",control:"ejs__control",controlPressed:"ejs__control--pressed",playing:"ejs--playing",paused:"ejs--paused",stopped:"ejs--stopped",loading:"ejs--loading",hover:"ejs--hover",tooltip:"ejs__tooltip",hidden:"ejs__sr-only",hideControls:"ejs--hide-controls",isIos:"ejs--is-ios",isTouch:"ejs--is-touch",uiSupported:"ejs--full-ui",noTransition:"ejs--no-transition",menu:{value:"ejs__menu__value",badge:"ejs__badge",open:"ejs--menu-open"},fullscreen:{enabled:"ejs--fullscreen-enabled",fallback:"ejs--fullscreen-fallback"},tabFocus:"ejs__tab-focus"}},p=n(0),m=n(157),h=n.n(m),g={nullOrUndefined:s,object:l,number:function(e){return o(e)===Number&&!Number.isNaN(e)},string:r,boolean:function(e){return o(e)===Boolean},function:function(e){return o(e)===Function},array:c,weakMap:function(e){return i(e,WeakMap)},nodeList:d,element:function(e){return i(e,Element)},textNode:function(e){return o(e)===Text},event:function(e){return i(e,Event)},keyboardEvent:function(e){return i(e,KeyboardEvent)},cue:function(e){return i(e,window.TextTrackCue)||i(e,window.VTTCue)},track:function(e){return i(e,TextTrack)||!s(e)&&r(e.kind)},url:function(e){if(i(e,window.URL))return!0;let t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!u(new URL(t).hostname)}catch(e){return!1}},empty:u},v=function(){let e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){return e=!0,null}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function y(e,t,n){let a=this,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if(e&&"addEventListener"in e&&!g.empty(t)&&g.function(n)){let l=t.split(" "),r=s;v&&(r={passive:i,capture:s}),l.forEach((function(t){a&&a.eventListeners&&o&&a.eventListeners.push({element:e,type:t,callback:n,options:r}),e[o?"addEventListener":"removeEventListener"](t,n,r)}))}}function _(e){y.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!0,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function b(e){y.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!1,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function T(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length?arguments[2]:void 0,a=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];y.call(this,e,t,(function i(){b(e,t,i,a,o);let s=arguments.length,l=new Array(s);for(let e=0;e<s;e++)l[e]=arguments[e];n.apply(this,l)}),!0,a,o)}function x(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};g.element(e)&&!g.empty(t)&&(t=new CustomEvent(t,{bubbles:n,detail:Object.assign({},a,{emulator:this})}),e.dispatchEvent(t))}let w=n(158),S=n.n(w);function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){let n,a=[],o=!0,i=!1;try{for(let n,i=e[Symbol.iterator]();!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){i=!0,n=e}finally{try{o||null==_0x557ef0.return||_0x557ef0.return()}finally{if(i)throw n}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function M(e,t){e=e.length?e:[e],Array.from(e).reverse().forEach((function(e,n){let a=0<n?t.cloneNode(!0):t,o=e.parentNode,i=e.nextSibling;a.appendChild(e),i?o.insertBefore(a,i):o.appendChild(a)}))}function C(e,t){g.element(e)&&!g.empty(t)&&Object.entries(t).filter((function(e){return e=E(e,2)[1],!g.nullOrUndefined(e)})).forEach((function(t){var n=(t=E(t,2))[0];t=t[1];return e.setAttribute(n,t)}))}function P(e,t,n){let a=document.createElement(e);return g.object(t)&&C(a,t),g.string(n)&&(a.innerText=n),a}function I(e){g.nodeList(e)||g.array(e)?Array.from(e).forEach(I):g.element(e)&&g.element(e.parentNode)&&e.parentNode.removeChild(e)}function O(e,t){if(!g.string(e)||g.empty(e))return{};let n={},a=t;return e.split(",").forEach((function(e){let t=e.trim(),o=t.replace(".",""),i=t.replace(/[[\]]/g,"").split("="),s=i[0],l=1<i.length?i[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":g.object(a)&&g.string(a.class)&&(a.class+=" ".concat(o)),n.class=o;break;case"#":n.id=t.replace("#","");break;case"[":n[s]=l}})),n}function A(e,t){if(g.element(e)){let n=t;(n=g.boolean(n)?n:!e.hidden)?e.setAttribute("hidden",""):e.removeAttribute("hidden")}}function R(e,t,n){if(g.nodeList(e))return Array.from(e).map((function(e){return R(e,t,n)}));if(g.element(e)){let a=void 0!==n?n?"add":"remove":"toggle";return e.classList[a](t),e.classList.contains(t)}return!1}function N(e,t){return g.element(e)&&e.classList.contains(t)}function k(e,t){let n={Element};return(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(e,t)}function z(e){return this.elements.container.querySelectorAll(e)}function L(e){return this.elements.container.querySelector(e)}function j(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];g.element(e)&&(e.focus(),t&&R(e,this.config.classNames.tabFocus))}function D(e){return h.a.bind(S.a)(e)}let F,G,V,U=(F=document.createElement("span"),G={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},V=Object.keys(G).find((function(e){return void 0!==F.style[e]})),!!g.string(V)&&G[V]);function B(e){setTimeout((function(){try{A(e,!0),e.offsetHeight,A(e,!1)}catch(e){}}),0)}let H,q={isEdge:"Netscape"===navigator.appName&&-1<navigator.appVersion.indexOf("Edge"),isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform),info:function(){let e=/(MSIE|(?!Gecko.+)Firefox|(?!AppleWebKit.+Chrome.+)Safari|(?!AppleWebKit.+)Chrome|AppleWebKit(?!.+Chrome|.+Safari)|Gecko(?!.+Firefox))(?: |\/)([\d\.apre]+)/.exec(navigator.userAgent);return{name:e[1].toLowerCase(),version:e[2]}}},X={rangeInput:((H=document.createElement("input")).type="range")===H.type,touch:"ontouchstart"in document.documentElement,transitions:!1!==U,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches,webgl:function(){let e={DETECTED:!1};if(!e.DETECTED){let n=document.createElement("canvas");if(n&&n.getContext)for(let a=["webgl2","experimental-webgl2","webgl","experimental-webgl"],o=0,i=a.length;o<i;++o){let i=a[o],s=n.getContext(i);if(s){e.WEBGL_CONTEXT=i,e.WEBGL_VERSION=s.getParameter(s.VERSION),e.WEBGL_VENDOR=s.getParameter(s.VENDOR),e.WEBGL_SL_VERSION=s.getParameter(s.SHADING_LANGUAGE_VERSION),e.MAX_TEXTURE_SIZE=s.getParameter(s.MAX_TEXTURE_SIZE);var t=s.getExtension("WEBGL_debug_renderer_info");t&&(e.WEBGL_VENDOR=s.getParameter(t.UNMASKED_VENDOR_WEBGL),e.WEBGL_RENDERER=s.getParameter(t.UNMASKED_RENDERER_WEBGL)),e.DETECTED=!0;break}}}return e}(),wasm:"undefined"!=typeof WebAssembly&&g.object(WebAssembly),audioContext:"undefined"!=typeof AudioContext};function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=new Array(1<t?t-1:0);for(let e=arguments.length,t=1;t<e;t++)n[t-1]=arguments[t];if(!n.length)return e;let a=n.shift();return g.object(a)?(Object.keys(a).forEach((function(t){g.object(a[t])?(Object.keys(e).includes(t)||Object.assign(e,Y({},t,{})),W(e[t],a[t])):Object.assign(e,Y({},t,a[t]))})),W.apply(void 0,[e].concat(n))):e}function K(e,t,n){let a=1<arguments.length&&void 0!==t?t:"",o=2<arguments.length&&void 0!==n?n:"";return(0<arguments.length&&void 0!==e?e:"").replace(new RegExp(a.toString().replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"),o.toString())}let J={get:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(g.empty(t)||g.empty(n))return"";e=n.i18n;let a=t.split(".").reduce((function(e,t){return e&&e[t]}),e);return g.empty(a)?"":(t={"{seektime}":n.seekTime,"{title}":n.title},Object.entries(t).forEach((function(e){t=2;e=function(e){if(Array.isArray(e))return e}(e)||function(e,t){let n,a=[],o=!0,i=!1;try{for(let n,i=e[Symbol.iterator]();!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){i=!0,n=e}finally{try{o||null==_0x2f59ed.return||_0x2f59ed.return()}finally{if(i)throw n}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}();var t=e[0];e=e[1];a=K(a,t,e)})),a)}};function Q(e,t){for(let n=0;n<t.length;n++){let a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Ue=[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.getItem("___test")||window.localStorage.setItem("___test","___test"),!0)}catch(e){return!1}}}],Q((Ve=$).prototype,[{key:"get",value:function(e){if(!$.supported||!this.enabled)return null;var t=window.localStorage.getItem(this.key);return g.empty(t)?null:(t=JSON.parse(t),g.string(e)&&e.length?t[e]:t)}},{key:"set",value:function(e){if($.supported&&this.enabled&&g.object(e)){let t=this.get();W(t=g.empty(t)?{}:t,e),window.localStorage.setItem(this.key,JSON.stringify(t))}}}]),Q(Ve,Ue);let Z=$;function $(e,t){if(!(this instanceof $))throw new TypeError("Cannot call a class as a function");this.enabled=!0,this.key=t}let ee,te=n(6),ne=n(159),ae=n.n(ne),oe={"2xScaleHQ.glslp":'shaders = 1\n\nshader0 = "2xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"4xScaleHQ.glslp":'shaders = 1\n\nshader0 = "4xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"crt-easymode.glslp":"shaders = 1\n\nshader0 = crt-easymode.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","crt-aperture.glslp":"shaders = 1\n\nshader0 = crt-aperture.glsl\nfilter_linear0 = false\n","crt-geom.glslp":"shaders = 1\n\nshader0 = crt-geom.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","2xScaleHQ.glsl":"/*\n2xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 dx = vec2(x, 0.0);\nvec2 dy = vec2(0.0, y);\nt1 = vec4(vTexCoord - dg1, vTexCoord - dy);\nt2 = vec4(vTexCoord - dg2, vTexCoord + dx);\nt3 = vec4(vTexCoord + dg1, vTexCoord + dy);\nt4 = vec4(vTexCoord + dg2, vTexCoord - dx);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 0.325;      // start smoothing wt.\nfloat k = -0.250;      // wt. decrease factor\nfloat max_w = 0.25;    // max filter weight\nfloat min_w =-0.05;    // min filter weight\nfloat lum_add = 0.25;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c00 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 c10 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 c20 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 c01 = COMPAT_TEXTURE(Source, t4.zw).xyz; \nvec3 c11 = COMPAT_TEXTURE(Source, vTexCoord).xyz; \nvec3 c21 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 c02 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 c12 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 c22 = COMPAT_TEXTURE(Source, t3.xy).xyz; \n\nfloat md1 = dot(abs(c00 - c22), dt);\nfloat md2 = dot(abs(c02 - c20), dt);\n\nfloat w1 = dot(abs(c22 - c11), dt) * md2;\nfloat w2 = dot(abs(c02 - c11), dt) * md1;\nfloat w3 = dot(abs(c00 - c11), dt) * md2;\nfloat w4 = dot(abs(c20 - c11), dt) * md1;\n\nfloat t1 = w1 + w3;\nfloat t2 = w2 + w4;\nfloat ww = max(t1, t2) + 0.0001;\n\nc11 = (w1 * c00 + w2 * c20 + w3 * c22 + w4 * c02 + ww * c11) / (t1 + t2 + ww);\n\nfloat lc1 = k / (0.12 * dot(c10 + c12 + c11, dt) + lum_add);\nfloat lc2 = k / (0.12 * dot(c01 + c21 + c11, dt) + lum_add);\n\nw1 = clamp(lc1 * dot(abs(c11 - c10), dt) + mx, min_w, max_w);\nw2 = clamp(lc2 * dot(abs(c11 - c21), dt) + mx, min_w, max_w);\nw3 = clamp(lc1 * dot(abs(c11 - c12), dt) + mx, min_w, max_w);\nw4 = clamp(lc2 * dot(abs(c11 - c01), dt) + mx, min_w, max_w);\nFragColor = vec4(w1 * c10 + w2 * c21 + w3 * c12 + w4 * c01 + (1.0 - w1 - w2 - w3 - w4) * c11, 1.0);\n} \n#endif\n","4xScaleHQ.glsl":"/*\n4xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 sd1 = dg1 * 0.5;\nvec2 sd2 = dg2 * 0.5;\nvec2 ddx = vec2(x, 0.0);\nvec2 ddy = vec2(0.0, y);\nt1 = vec4(vTexCoord - sd1, vTexCoord - ddy);\nt2 = vec4(vTexCoord - sd2, vTexCoord + ddx);\nt3 = vec4(vTexCoord + sd1, vTexCoord + ddy);\nt4 = vec4(vTexCoord + sd2, vTexCoord - ddx);\nt5 = vec4(vTexCoord - dg1, vTexCoord - dg2);\nt6 = vec4(vTexCoord + dg1, vTexCoord + dg2);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 1.0;      // start smoothing wt.\nfloat k = -1.10;      // wt. decrease factor\nfloat max_w = 0.75;    // max filter weight\nfloat min_w = 0.03;    // min filter weight\nfloat lum_add = 0.33;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c  = COMPAT_TEXTURE(Source, vTexCoord).xyz;\nvec3 i1 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 i2 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 i3 = COMPAT_TEXTURE(Source, t3.xy).xyz; \nvec3 i4 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 o1 = COMPAT_TEXTURE(Source, t5.xy).xyz; \nvec3 o3 = COMPAT_TEXTURE(Source, t6.xy).xyz; \nvec3 o2 = COMPAT_TEXTURE(Source, t5.zw).xyz;\nvec3 o4 = COMPAT_TEXTURE(Source, t6.zw).xyz;\nvec3 s1 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 s2 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 s3 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 s4 = COMPAT_TEXTURE(Source, t4.zw).xyz; \n\nfloat ko1=dot(abs(o1-c),dt);\nfloat ko2=dot(abs(o2-c),dt);\nfloat ko3=dot(abs(o3-c),dt);\nfloat ko4=dot(abs(o4-c),dt);\n\nfloat k1=min(dot(abs(i1-i3),dt),max(ko1,ko3));\nfloat k2=min(dot(abs(i2-i4),dt),max(ko2,ko4));\n\nfloat w1 = k2; if(ko3<ko1) w1*=ko3/ko1;\nfloat w2 = k1; if(ko4<ko2) w2*=ko4/ko2;\nfloat w3 = k2; if(ko1<ko3) w3*=ko1/ko3;\nfloat w4 = k1; if(ko2<ko4) w4*=ko2/ko4;\n\nc=(w1*o1+w2*o2+w3*o3+w4*o4+0.001*c)/(w1+w2+w3+w4+0.001);\nw1 = k*dot(abs(i1-c)+abs(i3-c),dt)/(0.125*dot(i1+i3,dt)+lum_add);\nw2 = k*dot(abs(i2-c)+abs(i4-c),dt)/(0.125*dot(i2+i4,dt)+lum_add);\nw3 = k*dot(abs(s1-c)+abs(s3-c),dt)/(0.125*dot(s1+s3,dt)+lum_add);\nw4 = k*dot(abs(s2-c)+abs(s4-c),dt)/(0.125*dot(s2+s4,dt)+lum_add);\n\nw1 = clamp(w1+mx,min_w,max_w); \nw2 = clamp(w2+mx,min_w,max_w);\nw3 = clamp(w3+mx,min_w,max_w); \nw4 = clamp(w4+mx,min_w,max_w);\n\nFragColor = vec4((w1*(i1+i3)+w2*(i2+i4)+w3*(s1+s3)+w4*(s2+s4)+c)/(2.0*(w1+w2+w3+w4)+1.0), 1.0);\n} \n#endif\n","crt-easymode.glsl":"#if defined(VERTEX)\n\n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING out\n    #define COMPAT_ATTRIBUTE in\n    #define COMPAT_TEXTURE texture\n    #else\n    #define COMPAT_VARYING varying\n    #define COMPAT_ATTRIBUTE attribute\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _oPosition1;\n    vec4 _r0005;\n    COMPAT_ATTRIBUTE vec4 VertexCoord;\n    COMPAT_ATTRIBUTE vec4 TexCoord;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform mat4 MVPMatrix;\n    uniform int FrameDirection;\n    uniform int FrameCount;\n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _oTex;\n    _r0005 = VertexCoord.x*MVPMatrix[0];\n    _r0005 = _r0005 + VertexCoord.y*MVPMatrix[1];\n    _r0005 = _r0005 + VertexCoord.z*MVPMatrix[2];\n    _r0005 = _r0005 + VertexCoord.w*MVPMatrix[3];\n    _oPosition1 = _r0005;\n    _oTex = TexCoord.xy;\n    gl_Position = _r0005;\n    TEX0.xy = TexCoord.xy;\n    }\n    #elif defined(FRAGMENT)\n    \n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING in\n    #define COMPAT_TEXTURE texture\n    out vec4 FragColor;\n    #else\n    #define COMPAT_VARYING varying\n    #define FragColor gl_FragColor\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _ret_0;\n    float _TMP30;\n    float _TMP29;\n    float _TMP28;\n    float _TMP13;\n    float _TMP32;\n    float _TMP11;\n    float _TMP10;\n    float _TMP31;\n    float _TMP9;\n    float _TMP8;\n    float _TMP15;\n    float _TMP14;\n    float _TMP33;\n    vec4 _TMP34;\n    vec4 _TMP27;\n    vec4 _TMP25;\n    vec4 _TMP23;\n    vec4 _TMP21;\n    vec4 _TMP26;\n    vec4 _TMP24;\n    vec4 _TMP22;\n    vec4 _TMP20;\n    float _TMP4;\n    vec4 _TMP3;\n    vec4 _TMP2;\n    float _TMP19;\n    float _TMP18;\n    float _TMP17;\n    float _TMP16;\n    vec4 _TMP1;\n    vec2 _TMP0;\n    uniform sampler2D Texture;\n    input_dummy _IN1;\n    float _TMP43;\n    float _x_step0044;\n    float _curve0044;\n    float _a0048;\n    float _val0052;\n    float _a0052;\n    vec4 _TMP57;\n    vec4 _x0072;\n    vec2 _c0086;\n    vec4 _x0088;\n    vec4 _x0094;\n    vec2 _c0098;\n    vec4 _x0100;\n    vec2 _c0104;\n    vec4 _x0106;\n    vec4 _sample_min0110;\n    vec4 _sample_max0110;\n    vec4 _r0112;\n    vec4 _TMP117;\n    vec2 _co0124;\n    vec2 _c0126;\n    vec4 _x0128;\n    vec4 _x0134;\n    vec2 _c0138;\n    vec4 _x0140;\n    vec2 _c0144;\n    vec4 _x0146;\n    vec4 _sample_min0150;\n    vec4 _sample_max0150;\n    vec4 _r0152;\n    vec4 _TMP157;\n    float _TMP163;\n    float _x_step0164;\n    float _curve0164;\n    float _a0168;\n    float _val0172;\n    float _a0172;\n    float _TMP183;\n    float _TMP189;\n    float _x0190;\n    float _a0196;\n    float _x0198;\n    vec2 _x0200;\n    float _x0208;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _dx1;\n    vec2 _dy;\n    vec2 _pix_co;\n    vec2 _tex_co;\n    vec2 _dist;\n    vec3 _col2;\n    vec3 _col21;\n    vec4 _coeffs1;\n    float _luma;\n    float _bright;\n    float _scan_weight;\n    vec2 _mod_fac;\n    int _dot_no;\n    vec3 _mask_weight;\n    vec3 _TMP37;\n    _dx1 = vec2(1.00000000E+00/TextureSize.x, 0.00000000E+00);\n    _dy = vec2(0.00000000E+00, 1.00000000E+00/TextureSize.y);\n    _pix_co = TEX0.xy*TextureSize - vec2( 5.00000000E-01, 5.00000000E-01);\n    _TMP0 = floor(_pix_co);\n    _tex_co = (_TMP0 + vec2( 5.00000000E-01, 5.00000000E-01))/TextureSize;\n    _dist = fract(_pix_co);\n    _x_step0044 = float((_dist.x >= 5.00000000E-01));\n    _a0048 = 2.50000000E-01 - (_dist.x - _x_step0044)*(_dist.x - _x_step0044);\n    _TMP33 = inversesqrt(_a0048);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0052 = 5.00000000E-01 - _dist.x;\n    _val0052 = float((_a0052 > 0.00000000E+00));\n    _TMP15 = _val0052 - float((_a0052 < 0.00000000E+00));\n    _curve0044 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP43 = _dist.x + 2.50000000E-01*(_curve0044 - _dist.x);\n    _coeffs1 = 3.14159274E+00*vec4(1.00000000E+00 + _TMP43, _TMP43, 1.00000000E+00 - _TMP43, 2.00000000E+00 - _TMP43);\n    _TMP1 = abs(_coeffs1);\n    _TMP57 = max(_TMP1, vec4( 9.99999975E-06, 9.99999975E-06, 9.99999975E-06, 9.99999975E-06));\n    _TMP16 = sin(_TMP57.x);\n    _TMP17 = sin(_TMP57.y);\n    _TMP18 = sin(_TMP57.z);\n    _TMP19 = sin(_TMP57.w);\n    _TMP2 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _x0072 = _TMP57/2.00000000E+00;\n    _TMP16 = sin(_x0072.x);\n    _TMP17 = sin(_x0072.y);\n    _TMP18 = sin(_x0072.z);\n    _TMP19 = sin(_x0072.w);\n    _TMP3 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _coeffs1 = ((2.00000000E+00*_TMP2)*_TMP3)/(_TMP57*_TMP57);\n    _TMP4 = dot(_coeffs1, vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _coeffs1 = _coeffs1/_TMP4;\n    _c0086 = _tex_co - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0086);\n    _x0088 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0088;\n    _TMP22 = COMPAT_TEXTURE(Texture, _tex_co);\n    _x0094 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0094;\n    _c0098 = _tex_co + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0098);\n    _x0100 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0100;\n    _c0104 = _tex_co + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0104);\n    _x0106 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0106;\n    _r0112 = _coeffs1.x*_TMP21;\n    _r0112 = _r0112 + _coeffs1.y*_TMP23;\n    _r0112 = _r0112 + _coeffs1.z*_TMP25;\n    _r0112 = _r0112 + _coeffs1.w*_TMP27;\n    _sample_min0110 = min(_TMP23, _TMP25);\n    _sample_max0110 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0110, _r0112);\n    _TMP117 = max(_sample_min0110, _TMP34);\n    _co0124 = _tex_co + _dy;\n    _c0126 = _co0124 - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0126);\n    _x0128 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0128;\n    _TMP22 = COMPAT_TEXTURE(Texture, _co0124);\n    _x0134 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0134;\n    _c0138 = _co0124 + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0138);\n    _x0140 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0140;\n    _c0144 = _co0124 + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0144);\n    _x0146 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0146;\n    _r0152 = _coeffs1.x*_TMP21;\n    _r0152 = _r0152 + _coeffs1.y*_TMP23;\n    _r0152 = _r0152 + _coeffs1.z*_TMP25;\n    _r0152 = _r0152 + _coeffs1.w*_TMP27;\n    _sample_min0150 = min(_TMP23, _TMP25);\n    _sample_max0150 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0150, _r0152);\n    _TMP157 = max(_sample_min0150, _TMP34);\n    _x_step0164 = float((_dist.y >= 5.00000000E-01));\n    _a0168 = 2.50000000E-01 - (_dist.y - _x_step0164)*(_dist.y - _x_step0164);\n    _TMP33 = inversesqrt(_a0168);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0172 = 5.00000000E-01 - _dist.y;\n    _val0172 = float((_a0172 > 0.00000000E+00));\n    _TMP15 = _val0172 - float((_a0172 < 0.00000000E+00));\n    _curve0164 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP163 = _dist.y + (_curve0164 - _dist.y);\n    _col2 = _TMP117.xyz + _TMP163*(_TMP157.xyz - _TMP117.xyz);\n    _luma = dot(vec3( 2.12599993E-01, 7.15200007E-01, 7.22000003E-02), _col2);\n    _TMP8 = max(_col2.y, _col2.z);\n    _TMP9 = max(_col2.x, _TMP8);\n    _bright = (_TMP9 + _luma)/2.00000000E+00;\n    _TMP31 = min(6.49999976E-01, _bright);\n    _TMP183 = max(3.49999994E-01, _TMP31);\n    _x0190 = _bright*1.50000000E+00;\n    _TMP31 = min(1.50000000E+00, _x0190);\n    _TMP189 = max(1.50000000E+00, _TMP31);\n    _a0196 = TEX0.y*2.00000000E+00*3.14159274E+00*TextureSize.y;\n    _TMP10 = cos(_a0196);\n    _x0198 = _TMP10*5.00000000E-01 + 5.00000000E-01;\n    _TMP11 = pow(_x0198, _TMP189);\n    _scan_weight = 1.00000000E+00 - _TMP11;\n    _x0200 = (TEX0.xy*OutputSize*TextureSize)/InputSize;\n    _mod_fac = floor(_x0200);\n    _x0208 = _mod_fac.x/3.00000000E+00;\n    _TMP32 = floor(_x0208);\n    _TMP13 = _mod_fac.x - 3.00000000E+00*_TMP32;\n    _dot_no = int(_TMP13);\n    if (_dot_no == 0) {\n    _mask_weight = vec3( 1.00000000E+00, 6.99999988E-01, 6.99999988E-01);\n    } else {\n    if (_dot_no == 1) {\n    _mask_weight = vec3( 6.99999988E-01, 1.00000000E+00, 6.99999988E-01);\n    } else {\n    _mask_weight = vec3( 6.99999988E-01, 6.99999988E-01, 1.00000000E+00);\n    }\n    }\n    if (InputSize.y >= 4.00000000E+02) {\n    _scan_weight = 1.00000000E+00;\n    }\n    _col21 = _col2.xyz;\n    _col2 = _col2*vec3(_scan_weight, _scan_weight, _scan_weight);\n    _col2 = _col2 + _TMP183*(_col21 - _col2);\n    _col2 = _col2*_mask_weight;\n    _TMP28 = pow(_col2.x, 5.55555582E-01);\n    _TMP29 = pow(_col2.y, 5.55555582E-01);\n    _TMP30 = pow(_col2.z, 5.55555582E-01);\n    _col2 = vec3(_TMP28, _TMP29, _TMP30);\n    _TMP37 = _col2*1.20000005E+00;\n    _ret_0 = vec4(_TMP37.x, _TMP37.y, _TMP37.z, 1.00000000E+00);\n    FragColor = _ret_0;\n    return;\n    }\n    #endif\n","crt-aperture.glsl":'\n/*\nCRT Shader by EasyMode\nLicense: GPL\n*/\n/*\n#pragma parameter SHARPNESS_IMAGE "Sharpness Image" 1.0 1.0 5.0 1.0\n#pragma parameter SHARPNESS_EDGES "Sharpness Edges" 3.0 1.0 5.0 1.0\n#pragma parameter GLOW_WIDTH "Glow Width" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HEIGHT "Glow Height" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HALATION "Glow Halation" 0.1 0.0 1.0 0.01\n#pragma parameter GLOW_DIFFUSION "Glow Diffusion" 0.05 0.0 1.0 0.01\n#pragma parameter MASK_COLORS "Mask Colors" 2.0 2.0 3.0 1.0\n#pragma parameter MASK_STRENGTH "Mask Strength" 0.3 0.0 1.0 0.05\n#pragma parameter MASK_SIZE "Mask Size" 1.0 1.0 9.0 1.0\n#pragma parameter SCANLINE_SIZE_MIN "Scanline Size Min." 0.5 0.5 1.5 0.05\n#pragma parameter SCANLINE_SIZE_MAX "Scanline Size Max." 1.5 0.5 1.5 0.05\n#pragma parameter GAMMA_INPUT "Gamma Input" 2.4 1.0 5.0 0.1\n#pragma parameter GAMMA_OUTPUT "Gamma Output" 2.4 1.0 5.0 0.1\n#pragma parameter BRIGHTNESS "Brightness" 1.5 0.0 2.0 0.05\n* */\n\n#define Coord TEX0\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define OUT out\n#define IN  in\n#define tex2D texture\n#else\n#define OUT varying \n#define IN attribute \n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nIN  vec4 VertexCoord;\nIN  vec4 Color;\nIN  vec2 TexCoord;\nOUT vec4 color;\nOUT vec2 Coord;\n\nuniform mat4 MVPMatrix;\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\ncolor = Color;\nCoord = TexCoord;\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define IN in\n#define tex2D texture\nout vec4 FragColor;\n#else\n#define IN varying\n#define FragColor gl_FragColor\n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nIN vec2 Coord;\n\n#ifdef PARAMETER_UNIFORM\nuniform PRECISION float SHARPNESS_IMAGE;\nuniform PRECISION float SHARPNESS_EDGES;\nuniform PRECISION float GLOW_WIDTH;\nuniform PRECISION float GLOW_HEIGHT;\nuniform PRECISION float GLOW_HALATION;\nuniform PRECISION float GLOW_DIFFUSION;\nuniform PRECISION float MASK_COLORS;\nuniform PRECISION float MASK_STRENGTH;\nuniform PRECISION float MASK_SIZE;\nuniform PRECISION float SCANLINE_SIZE_MIN;\nuniform PRECISION float SCANLINE_SIZE_MAX;\nuniform PRECISION float GAMMA_INPUT;\nuniform PRECISION float GAMMA_OUTPUT;\nuniform PRECISION float BRIGHTNESS;\n#else\n#define SHARPNESS_IMAGE 1.0\n#define SHARPNESS_EDGES 3.0\n#define GLOW_WIDTH 0.5\n#define GLOW_HEIGHT 0.5\n#define GLOW_HALATION 0.1\n#define GLOW_DIFFUSION 0.05\n#define MASK_COLORS 2.0\n#define MASK_STRENGTH 0.3\n#define MASK_SIZE 1.0\n#define SCANLINE_SIZE_MIN 0.5\n#define SCANLINE_SIZE_MAX 1.5\n#define GAMMA_INPUT 2.4\n#define GAMMA_OUTPUT 2.4\n#define BRIGHTNESS 1.5\n#endif\n\n#define FIX(c) max(abs(c), 1e-5)\n#define PI 3.141592653589\n#define saturate(c) clamp(c, 0.0, 1.0)\n#define TEX2D(c) pow(tex2D(tex, c).rgb, vec3(GAMMA_INPUT))\n\nmat3 get_color_matrix(sampler2D tex, vec2 co, vec2 dx)\n{\nreturn mat3(TEX2D(co - dx), TEX2D(co), TEX2D(co + dx));\n}\n\nvec3 blur(mat3 m, float dist, float rad)\n{\nvec3 x = vec3(dist - 1.0, dist, dist + 1.0) / rad;\nvec3 w = exp2(x * x * -1.0);\n\nreturn (m[0] * w.x + m[1] * w.y + m[2] * w.z) / (w.x + w.y + w.z);\n}\n\nvec3 filter_gaussian(sampler2D tex, vec2 co, vec2 tex_size)\n{\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / tex_size.y);\nvec2 pix_co = co * tex_size;\nvec2 tex_co = (floor(pix_co) + 0.5) / tex_size;\nvec2 dist = (fract(pix_co) - 0.5) * -1.0;\n\nmat3 line0 = get_color_matrix(tex, tex_co - dy, dx);\nmat3 line1 = get_color_matrix(tex, tex_co, dx);\nmat3 line2 = get_color_matrix(tex, tex_co + dy, dx);\nmat3 column = mat3(blur(line0, dist.x, GLOW_WIDTH),\n                       blur(line1, dist.x, GLOW_WIDTH),\n                       blur(line2, dist.x, GLOW_WIDTH));\n\nreturn blur(column, dist.y, GLOW_HEIGHT);\n}\n\nvec3 filter_lanczos(sampler2D tex, vec2 co, vec2 tex_size, float sharp)\n{\ntex_size.x *= sharp;\n\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 pix_co = co * tex_size - vec2(0.5, 0.0);\nvec2 tex_co = (floor(pix_co) + vec2(0.5, 0.0)) / tex_size;\nvec2 dist = fract(pix_co);\nvec4 coef = PI * vec4(dist.x + 1.0, dist.x, dist.x - 1.0, dist.x - 2.0);\n\ncoef = FIX(coef);\ncoef = 2.0 * sin(coef) * sin(coef / 2.0) / (coef * coef);\ncoef /= dot(coef, vec4(1.0));\n\nvec4 col1 = vec4(TEX2D(tex_co), 1.0);\nvec4 col2 = vec4(TEX2D(tex_co + dx), 1.0);\n\nreturn (mat4(col1, col1, col2, col2) * coef).rgb;\n}\n\nvec3 get_scanline_weight(float x, vec3 col)\n{\nvec3 beam = mix(vec3(SCANLINE_SIZE_MIN), vec3(SCANLINE_SIZE_MAX), col);\nvec3 x_mul = 2.0 / beam;\nvec3 x_offset = x_mul * 0.5;\n\nreturn smoothstep(0.0, 1.0, 1.0 - abs(x * x_mul - x_offset)) * x_offset;\n}\n\nvec3 get_mask_weight(float x)\n{\nfloat i = mod(floor(x * OutputSize.x * TextureSize.x / (InputSize.x * MASK_SIZE)), MASK_COLORS);\n\nif (i == 0.0) return mix(vec3(1.0, 0.0, 1.0), vec3(1.0, 0.0, 0.0), MASK_COLORS - 2.0);\nelse if (i == 1.0) return vec3(0.0, 1.0, 0.0);\nelse return vec3(0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\nvec3 col_glow = filter_gaussian(Texture, Coord, TextureSize);\nvec3 col_soft = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_IMAGE);\nvec3 col_sharp = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_EDGES);\nvec3 col = sqrt(col_sharp * col_soft);\n\ncol *= get_scanline_weight(fract(Coord.y * TextureSize.y), col_soft);\ncol_glow = saturate(col_glow - col);\ncol += col_glow * col_glow * GLOW_HALATION;\ncol = mix(col, col * get_mask_weight(Coord.x) * MASK_COLORS, MASK_STRENGTH);\ncol += col_glow * GLOW_DIFFUSION;\ncol = pow(col * BRIGHTNESS, vec3(1.0 / GAMMA_OUTPUT));\n\nFragColor = vec4(col, 1.0);\n}\n\n#endif\n',"crt-geom.glsl":'\n/*\nCRT-interlaced\n\nCopyright (C) 2010-2012 cgwg, Themaister and DOLLS\n\nThis program is free software; you can redistribute it and/or modify it\nunder the terms of the GNU General Public License as published by the Free\nSoftware Foundation; either version 2 of the License, or (at your option)\nany later version.\n\n(cgwg gave their consent to have the original version of this shader\ndistributed under the GPL in this message:\n\nhttp://board.byuu.org/viewtopic.php?p=26075#p26075\n\n"Feel free to distribute my shaders under the GPL. After all, the\nbarrel distortion code was taken from the Curvature shader, which is\nunder the GPL."\n)\nThis shader variant is pre-configured with screen curvature\n*/\n/*\n#pragma parameter CRTgamma "CRTGeom Target Gamma" 2.4 0.1 5.0 0.1\n#pragma parameter monitorgamma "CRTGeom Monitor Gamma" 2.2 0.1 5.0 0.1\n#pragma parameter d "CRTGeom Distance" 1.6 0.1 3.0 0.1\n#pragma parameter CURVATURE "CRTGeom Curvature Toggle" 1.0 0.0 1.0 1.0\n#pragma parameter R "CRTGeom Curvature Radius" 2.0 0.1 10.0 0.1\n#pragma parameter cornersize "CRTGeom Corner Size" 0.03 0.001 1.0 0.005\n#pragma parameter cornersmooth "CRTGeom Corner Smoothness" 1000.0 80.0 2000.0 100.0\n#pragma parameter x_tilt "CRTGeom Horizontal Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter y_tilt "CRTGeom Vertical Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter overscan_x "CRTGeom Horiz. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter overscan_y "CRTGeom Vert. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter DOTMASK "CRTGeom Dot Mask Toggle" 0.3 0.0 0.3 0.3\n#pragma parameter SHARPER "CRTGeom Sharpness" 1.0 1.0 3.0 1.0\n#pragma parameter scanline_weight "CRTGeom Scanline Weight" 0.3 0.1 0.5 0.05\n*/\n\n#ifndef PARAMETER_UNIFORM\n#define CRTgamma 2.4\n#define monitorgamma 2.2\n#define d 1.6\n#define CURVATURE 1.0\n#define R 2.0\n#define cornersize 0.03\n#define cornersmooth 1000.0\n#define x_tilt 0.0\n#define y_tilt 0.0\n#define overscan_x 100.0\n#define overscan_y 100.0\n#define DOTMASK 0.3\n#define SHARPER 1.0\n#define scanline_weight 0.3\n#endif\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\n#define FIX(c) max(abs(c), 1e-5);\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = R*acos(a);\nreturn uv*r/sin(r/R);\n}\n\nvec2 fwtrans(vec2 uv)\n{\nfloat r = FIX(sqrt(dot(uv,uv)));\nuv *= sin(r/R)/r;\nfloat x = 1.0-cos(r/R);\nfloat D = d/R + x*cosangle.x*cosangle.y+dot(uv,sinangle);\nreturn d*(uv*cosangle-x*sinangle)/D;\n}\n\nvec3 maxscale()\n{\nvec2 c = bkwtrans(-R * sinangle / (1.0 + R/d*cosangle.x*cosangle.y));\nvec2 a = vec2(0.5,0.5)*aspect;\nvec2 lo = vec2(fwtrans(vec2(-a.x,c.y)).x, fwtrans(vec2(c.x,-a.y)).y)/aspect;\nvec2 hi = vec2(fwtrans(vec2(+a.x,c.y)).x, fwtrans(vec2(c.x,+a.y)).y)/aspect;\nreturn vec3((hi+lo)*aspect*0.5,max(hi.x-lo.x,hi.y-lo.y));\n}\n\nvoid main()\n{\n// START of parameters\n\n// gamma of simulated CRT\n//\tCRTgamma = 1.8;\n// gamma of display monitor (typically 2.2 is correct)\n//\tmonitorgamma = 2.2;\n// overscan (e.g. 1.02 for 2% overscan)\noverscan = vec2(1.00,1.00);\n// aspect ratio\naspect = vec2(1.0, 0.75);\n// lengths are measured in units of (approximately) the width\n// of the monitor simulated distance from viewer to monitor\n//\td = 2.0;\n// radius of curvature\n//\tR = 1.5;\n// tilt angle in radians\n// (behavior might be a bit wrong if both components are\n// nonzero)\nconst vec2 angle = vec2(0.0,0.0);\n// size of curved corners\n//\tcornersize = 0.03;\n// border smoothness parameter\n// decrease if borders are too aliased\n//\tcornersmooth = 1000.0;\n\n// END of parameters\n\nvec4 _oColor;\nvec2 _otexCoord;\ngl_Position = VertexCoord.x * MVPMatrix[0] + VertexCoord.y * MVPMatrix[1] + VertexCoord.z * MVPMatrix[2] + VertexCoord.w * MVPMatrix[3];\n_oPosition1 = gl_Position;\n_oColor = COLOR;\n_otexCoord = TexCoord.xy;\nCOL0 = COLOR;\nTEX0.xy = TexCoord.xy;\n\n// Precalculate a bunch of useful values we\'ll need in the fragment\n// shader.\nsinangle = sin(vec2(x_tilt, y_tilt)) + vec2(0.001);//sin(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\ncosangle = cos(vec2(x_tilt, y_tilt)) + vec2(0.001);//cos(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\nstretch = maxscale();\n\nilfac = vec2(1.0,clamp(floor(InputSize.y/200.0), 1.0, 2.0));\n\n// The size of one texel, in texture-coordinates.\nvec2 sharpTextureSize = vec2(SHARPER * TextureSize.x, TextureSize.y);\none = ilfac / sharpTextureSize;\n\n// Resulting X pixel-coordinate of the pixel we\'re drawing.\nmod_factor = TexCoord.x * TextureSize.x * OutputSize.x / InputSize.x;\n\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nstruct output_dummy {\nvec4 _color;\n};\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// Comment the next line to disable interpolation in linear gamma (and\n// gain speed).\n#define LINEAR_PROCESSING\n\n// Enable screen curvature.\n//        #define CURVATURE\n\n// Enable 3x oversampling of the beam profile\n#define OVERSAMPLE\n\n// Use the older, purely gaussian beam profile\n//#define USEGAUSSIAN\n\n// Macros.\n#define FIX(c) max(abs(c), 1e-5);\n#define PI 3.141592653589\n\n#ifdef LINEAR_PROCESSING\n#       define TEX2D(c) pow(COMPAT_TEXTURE(Texture, (c)), vec4(CRTgamma))\n#else\n#       define TEX2D(c) COMPAT_TEXTURE(Texture, (c))\n#endif\n\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = FIX(R*acos(a));\nreturn uv*r/sin(r/R);\n}\n\nvec2 transform(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord-vec2(0.5))*aspect*stretch.z+stretch.xy;\nreturn (bkwtrans(coord)/vec2(overscan_x / 100.0, overscan_y / 100.0)/aspect+vec2(0.5)) * InputSize / TextureSize;\n}\n\nfloat corner(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord - vec2(0.5)) * vec2(overscan_x / 100.0, overscan_y / 100.0) + vec2(0.5);\ncoord = min(coord, vec2(1.0)-coord) * aspect;\nvec2 cdist = vec2(cornersize);\ncoord = (cdist - min(coord,cdist));\nfloat dist = sqrt(dot(coord,coord));\nreturn clamp((cdist.x-dist)*cornersmooth,0.0, 1.0);\n}\n\n// Calculate the influence of a scanline on the current pixel.\n//\n// \'distance\' is the distance in texture coordinates from the current\n// pixel to the scanline in question.\n// \'color\' is the colour of the scanline at the horizontal location of\n// the current pixel.\nvec4 scanlineWeights(float distance, vec4 color)\n{\n// "wid" controls the width of the scanline beam, for each RGB\n// channel The "weights" lines basically specify the formula\n// that gives you the profile of the beam, i.e. the intensity as\n// a function of distance from the vertical center of the\n// scanline. In this case, it is gaussian if width=2, and\n// becomes nongaussian for larger widths. Ideally this should\n// be normalized so that the integral across the beam is\n// independent of its width. That is, for a narrower beam\n// "weights" should have a higher peak at the center of the\n// scanline than for a wider beam.\n#ifdef USEGAUSSIAN\nvec4 wid = 0.3 + 0.1 * pow(color, vec4(3.0));\nvec4 weights = vec4(distance / wid);\nreturn 0.4 * exp(-weights * weights) / wid;\n#else\nvec4 wid = 2.0 + 2.0 * pow(color, vec4(4.0));\nvec4 weights = vec4(distance / scanline_weight);\nreturn 1.4 * exp(-pow(weights * inversesqrt(0.5 * wid), wid)) / (0.6 + 0.2 * wid);\n#endif\n}\n\nvoid main()\n{\n// Here\'s a helpful diagram to keep in mind while trying to\n// understand the code:\n//\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  01  |  11  |  21  |  31  | <-- current scanline\n//  |      | @    |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  02  |  12  |  22  |  32  | <-- next scanline\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//\n// Each character-cell represents a pixel on the output\n// surface, "@" represents the current pixel (always somewhere\n// in the bottom half of the current scan-line, or the top-half\n// of the next scanline). The grid of lines represents the\n// edges of the texels of the underlying texture.\n\n// Texture coordinates of the texel containing the active pixel.\nvec2 xy = (CURVATURE > 0.5) ? transform(TEX0.xy) : TEX0.xy;\n\nfloat cval = corner(xy);\n\n// Of all the pixels that are mapped onto the texel we are\n// currently rendering, which pixel are we currently rendering?\nvec2 ilvec = vec2(0.0,ilfac.y > 1.5 ? mod(float(FrameCount),2.0) : 0.0);\nvec2 ratio_scale = (xy * TextureSize - vec2(0.5) + ilvec)/ilfac;\n#ifdef OVERSAMPLE\nfloat filter_ = InputSize.y/OutputSize.y;//fwidth(ratio_scale.y);\n#endif\nvec2 uv_ratio = fract(ratio_scale);\n\n// Snap to the center of the underlying texel.\nxy = (floor(ratio_scale)*ilfac + vec2(0.5) - ilvec) / TextureSize;\n\n// Calculate Lanczos scaling coefficients describing the effect\n// of various neighbour texels in a scanline on the current\n// pixel.\nvec4 coeffs = PI * vec4(1.0 + uv_ratio.x, uv_ratio.x, 1.0 - uv_ratio.x, 2.0 - uv_ratio.x);\n\n// Prevent division by zero.\ncoeffs = FIX(coeffs);\n\n// Lanczos2 kernel.\ncoeffs = 2.0 * sin(coeffs) * sin(coeffs / 2.0) / (coeffs * coeffs);\n\n// Normalize.\ncoeffs /= dot(coeffs, vec4(1.0));\n\n// Calculate the effective colour of the current and next\n// scanlines at the horizontal location of the current pixel,\n// using the Lanczos coefficients above.\nvec4 col  = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, 0.0)),\n                TEX2D(xy),\n                TEX2D(xy + vec2(one.x, 0.0)),\n                TEX2D(xy + vec2(2.0 * one.x, 0.0))) * coeffs,\n                0.0, 1.0);\nvec4 col2 = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, one.y)),\n                TEX2D(xy + vec2(0.0, one.y)),\n                TEX2D(xy + one),\n                TEX2D(xy + vec2(2.0 * one.x, one.y))) * coeffs,\n                0.0, 1.0);\n\n#ifndef LINEAR_PROCESSING\ncol  = pow(col , vec4(CRTgamma));\ncol2 = pow(col2, vec4(CRTgamma));\n#endif\n\n// Calculate the influence of the current and next scanlines on\n// the current pixel.\nvec4 weights  = scanlineWeights(uv_ratio.y, col);\nvec4 weights2 = scanlineWeights(1.0 - uv_ratio.y, col2);\n#ifdef OVERSAMPLE\nuv_ratio.y =uv_ratio.y+1.0/3.0*filter_;\nweights = (weights+scanlineWeights(uv_ratio.y, col))/3.0;\nweights2=(weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2))/3.0;\nuv_ratio.y =uv_ratio.y-2.0/3.0*filter_;\nweights=weights+scanlineWeights(abs(uv_ratio.y), col)/3.0;\nweights2=weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2)/3.0;\n#endif\n\nvec3 mul_res  = (col * weights + col2 * weights2).rgb * vec3(cval);\n\n// dot-mask emulation:\n// Output pixels are alternately tinted green and magenta.\nvec3 dotMaskWeights = mix(\nvec3(1.0, 1.0 - DOTMASK, 1.0),\nvec3(1.0 - DOTMASK, 1.0, 1.0 - DOTMASK),\nfloor(mod(mod_factor, 2.0))\n);\n\nmul_res *= dotMaskWeights;\n\n// Convert the image gamma for display on our output device.\nmul_res = pow(mul_res, vec3(1.0 / monitorgamma));\n\n// Color the texel.\noutput_dummy _OUT;\n_OUT._color = vec4(mul_res, 1.0);\nFragColor = _OUT._color;\nreturn;\n} \n#endif\n\n'},ie=n(57),se=n(11),le={addStyleHook:function(){R(this.elements.container,this.config.selectors.container.replace(".",""),!0),R(this.elements.container,this.config.classNames.uiSupported,!0),R(this.elements.container,this.config.classNames.hideControls,!0)},build:function(){this.listeners.media(),g.element(this.elements.controls)||(He.inject.call(this),this.listeners.controls()),this.volume=null,this.muted=null,He.updateVolume.call(this),R(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0},toggleControls:function(e){var t=this.elements.controls;if(t){let n=0,a=z.call(this,".".concat(D({ejs__dialogs:!0})," > .").concat(D({ejs__dialog:!0})));Array.from(a).forEach((function(e,t){!0!==e.hidden&&(n+=1)})),0<n?this.toggleControls(!1):this.toggleControls(Boolean(e||this.paused||t.pressed||t.hover))}}};function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){if("object"===re(e)&&e.files&&(e=e.files[0]),this.littleEndian=!1,this.offset=0,this._lastRead=null,"object"===re(e)&&e.name&&e.size){if("function"!=typeof window.FileReader)throw new Error("Incompatible Browser");this.fileName=e.name,this.fileType=e.type,this.fileSize=e.size,this._fileReader=new FileReader,(this._fileReader.marcFile=this)._fileReader.addEventListener("load",(function(){this.marcFile._u8array=new Uint8Array(this.result),this.marcFile._dataView=new DataView(this.result),t&&t.call()}),!1),this._fileReader.readAsArrayBuffer(e)}else if("object"===re(e)&&"string"==typeof e.fileName&&"boolean"==typeof e.littleEndian)this.fileName=e.fileName,this.fileType=e.fileType,this.fileSize=e.fileSize,new ArrayBuffer(e),this._u8array=new Uint8Array(this.fileType),this._dataView=new DataView(this.fileType),e.copyToFile(this,0),t&&t.call();else if("object"===re(e)&&"number"==typeof e.byteLength)this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e.byteLength,void 0!==e.buffer&&(e=e.buffer),this._u8array=new Uint8Array(e),this._dataView=new DataView(e),t&&t.call();else{if("number"!=typeof e)throw new Error("Invalid source");this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e,n=new ArrayBuffer(e),this._u8array=new Uint8Array(n),this._dataView=new DataView(n),t&&t.call()}}ce.IS_MACHINE_LITTLE_ENDIAN=(ee=new ArrayBuffer(2),new DataView(ee).setInt16(0,256,!0),256===new Int16Array(ee)[0]),ce.prototype.seek=function(e){this.offset=e},ce.prototype.skip=function(e){this.offset+=e},ce.prototype.isEOF=function(){return!(this.offset<this.fileSize)},ce.prototype.slice=function(e,t){let n;return t=t||this.fileSize-e,void 0!==this._u8array.buffer.slice?((n=new ce(0)).fileSize=t,n._u8array=new Uint8Array(this._u8array.buffer.slice(e,e+t))):(n=new ce(t),this.copyToFile(n,e,t,0)),n.fileName=this.fileName,n.fileType=this.fileType,n.littleEndian=this.littleEndian,n},ce.prototype.copyToFile=function(e,t,n,a){void 0===a&&(a=t),n=n||this.fileSize-t;for(let o=0;o<n;o++)e._u8array[a+o]=this._u8array[t+o]},ce.prototype.save=function(){let e;try{e=new Blob([this._u8array],{type:this.fileType})}catch(t){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"InvalidStateError"!==t.name||!window.BlobBuilder)throw new Error("Incompatible Browser");let n=new BlobBuilder;n.append(this._u8array.buffer),e=n.getBlob(this.fileType)}saveAs(e,this.fileName)},ce.prototype.readU8=function(){return this._lastRead=this._u8array[this.offset],this.offset++,this._lastRead},ce.prototype.readU16=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8):this._lastRead=(this._u8array[this.offset]<<8)+this._u8array[this.offset+1],this.offset+=2,this._lastRead>>>0},ce.prototype.readU24=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16):this._lastRead=(this._u8array[this.offset]<<16)+(this._u8array[this.offset+1]<<8)+this._u8array[this.offset+2],this.offset+=3,this._lastRead>>>0},ce.prototype.readU32=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16)+(this._u8array[this.offset+3]<<24):this._lastRead=(this._u8array[this.offset]<<24)+(this._u8array[this.offset+1]<<16)+(this._u8array[this.offset+2]<<8)+this._u8array[this.offset+3],this.offset+=4,this._lastRead>>>0},ce.prototype.readBytes=function(e){this._lastRead=new Array(e);for(let t=0;t<e;t++)this._lastRead[t]=this._u8array[this.offset+t];return this.offset+=e,this._lastRead},ce.prototype.readString=function(e){this._lastRead="";for(let t=0;t<e&&this.offset+t<this.fileSize&&0<this._u8array[this.offset+t];t++)this._lastRead=this._lastRead+String.fromCharCode(this._u8array[this.offset+t]);return this.offset+=e,this._lastRead},ce.prototype.writeU8=function(e){this._u8array[this.offset]=e,this.offset++},ce.prototype.writeU16=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=e>>8):(this._u8array[this.offset]=e>>8,this._u8array[this.offset+1]=255&e),this.offset+=2},ce.prototype.writeU24=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16):(this._u8array[this.offset]=(16711680&e)>>16,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=255&e),this.offset+=3},ce.prototype.writeU32=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16,this._u8array[this.offset+3]=(4278190080&e)>>24):(this._u8array[this.offset]=(4278190080&e)>>24,this._u8array[this.offset+1]=(16711680&e)>>16,this._u8array[this.offset+2]=(65280&e)>>8,this._u8array[this.offset+3]=255&e),this.offset+=4},ce.prototype.writeBytes=function(e){for(let t=0;t<e.length;t++)this._u8array[this.offset+t]=e[t];this.offset+=e.length},ce.prototype.writeString=function(e,t){t=t||e.length;for(let n=0;n<e.length&&n<t;n++)this._u8array[this.offset+n]=e.charCodeAt(n);for(;n<t;n++)this._u8array[this.offset+n]=0;this.offset+=t};let de=ce,ue=0;function fe(){this.records=[],this.truncate=!1}function pe(e){let t=new fe;e.seek(5);for(var n,a;!e.isEOF();){if(4542278===(n=e.readU24())){if(e.isEOF())break;if(e.offset+3===e.fileSize){t.truncate=e.readU24();break}}(a=e.readU16())===ue?t.addRLERecord(n,e.readU16(),e.readU8()):t.addSimpleRecord(n,e.readBytes(a))}return t}fe.prototype.addSimpleRecord=function(e,t){this.records.push({offset:e,type:1,length:t.length,data:t})},fe.prototype.addRLERecord=function(e,t,n){this.records.push({offset:e,type:ue,length:t,byte:n})},fe.prototype.toString=function(){nSimpleRecords=0;for(let e=nRLERecords=0;e<this.records.length;e++)this.records[e].type===ue?nRLERecords++:nSimpleRecords++;let e="Simple records: "+nSimpleRecords;return e=(e+="\nRLE records: "+nRLERecords)+"\nTotal records: "+this.records.length,this.truncate&&(e+="\nTruncate at: 0x"+this.truncate.toString(16)),e},fe.prototype.export=function(e){for(let e=5,t=0;t<this.records.length;t++)this.records[t].type===ue?e+=8:e+=5+this.records[t].data.length;for(t+=3,this.truncate&&(t+=3),(tempFile=new de(t)).fileName=e+".ips",tempFile.writeString("PATCH"),n=0;n<this.records.length;n++){var a=this.records[n];tempFile.writeU24(a.offset),a.type===ue?(tempFile.writeU16(0),tempFile.writeU16(a.length),tempFile.writeU8(a.byte)):(tempFile.writeU16(a.data.length),tempFile.writeBytes(a.data))}return tempFile.writeString("EOF"),_0x512785.truncate&&tempFile.writeU24(_0x512785.truncate),tempFile},fe.prototype.apply=function(e){let t;if(this.truncate)t=e.slice(0,this.truncate);else{for(let t=e.fileSize,n=0;n<this.records.length;n++){var a=this.records[n];a.type===ue?a.offset+a.length>t&&(t=a.offset+a.length):a.offset+a.data.length>t&&(t=a.offset+a.data.length)}n===e.fileSize?t=e.slice(0,e.fileSize):(t=new de(n),e.copyToFile(t,0))}for(e.seek(0),_0x5a0a71=0;_0x5a0a71<this.records.length;_0x5a0a71++)if(t.seek(this.records[_0x5a0a71].offset),this.records[_0x5a0a71].type===ue)for(let e=0;e<this.records[_0x5a0a71].length;e++)t.writeU8(this.records[_0x5a0a71].byte);else t.writeBytes(this.records[_0x5a0a71].data);return t},"0123456789abcdef".split("");let me=function(){for(let e,t=[],n=0;n<256;n++){e=n;for(let t=0;t<8;t++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function he(e,t,n){for(let a=t?new Uint8Array(e._u8array.buffer,t):e._u8array,o=-1,i=n?a.length-4:a.length,s=0;s<i;s++)o=o>>>8^me[255&(o^a[s])];return(-1^_0x20e2c1)>>>0}let ge=1,ve=2,ye=3;function _e(){this.sourceSize=0,this.targetSize=0,this.metaData="",this.actions=[],this.sourceChecksum=0,this.targetChecksum=0,this.patchChecksum=0}function be(e){e.readVLV=Te,e.littleEndian=!0;let t=new _e;e.seek(4),t.sourceSize=e.readVLV(),t.targetSize=e.readVLV();var n=e.readVLV();n&&(t.metaData=e.readString(n));for(var a,o=e.fileSize-12;e.offset<o;){let n=e.readVLV(),o={type:3&n,length:1+(n>>2)};o.type===ge?o.bytes=e.readBytes(o.length):o.type!==ve&&o.type!==ye||(a=e.readVLV(),o.relativeOffset=(1&a?-1:1)*(a>>1)),t.actions.push(o)}if(t.sourceChecksum=e.readU32(),t.targetChecksum=e.readU32(),t.patchChecksum=e.readU32(),t.patchChecksum!==he(e,0,!0))throw new Error("error_crc_patch");return t}function Te(){for(let e=0,n=1;;){var t=this.readU8();if(e+=(127&t)*n,128&t)break;e+=n<<=7}return this._lastRead=e}function xe(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),e--}}function we(e){for(let t=0;;){if(0==(e>>=7)){t++;break}t++,e--}return t}_e.prototype.toString=function(){var e="Source size: "+this.sourceSize;return(e=(e+="\nTarget size: "+this.targetSize)+"\nMetadata: "+this.metaData)+"\n#Actions: "+this.actions.length},_e.prototype.validateSource=function(e,t){return this.sourceChecksum===he(e,t)},_e.prototype.apply=function(e,t){if(t&&!this.validateSource(e))throw new Error("error_crc_input");for(let t=new de(this.targetSize),n=0,o=0,i=0;i<this.actions.length;i++){var a=this.actions[i];if(0===a.type)e.copyToFile(t,t.offset,a.length),t.skip(a.length);else if(a.type===ge)t.writeBytes(a.bytes);else if(a.type===ve){n+=a.relativeOffset;for(let o=a.length;o--;)t.writeU8(e._u8array[n]),n++}else if(a.type===ye)for(o+=a.relativeOffset,_0x5c2263=a.length;_0x5c2263--;)t.writeU8(t._u8array[o]),o++}if(t&&this.targetChecksum!==he(n))throw new Error("error_crc_output");return n},_e.prototype.export=function(e){let t="BPS1".length;t=(t=(t=(t+=we(this.sourceSize))+we(this.targetSize))+we(this.metaData.length))+this.metaData.length;for(let e=0;e<this.actions.length;e++)t+=we(((_0x38dad6=this.actions[e]).length-1<<2)+_0x38dad6.type),_0x38dad6.type===ge?t+=_0x38dad6.length:_0x38dad6.type!==ve&&_0x38dad6.type!==ye||(t+=we((Math.abs(_0x38dad6.relativeOffset)<<1)+(_0x38dad6.relativeOffset<0?1:0)));let a=new de(t+=12);for(a.fileName=e+".bps",a.littleEndian=!0,a.writeVLV=xe,a.writeString("BPS1"),a.writeVLV(this.sourceSize),a.writeVLV(this.targetSize),a.writeVLV(this.metaData.length),a.writeString(this.metaData,this.metaData.length),n=0;n<this.actions.length;n++){var o=this.actions[n];a.writeVLV((o.length-1<<2)+o.type),o.type===ge?a.writeBytes(o.bytes):o.type!==ve&&o.type!==ye||a.writeVLV((Math.abs(o.relativeOffset)<<1)+(o.relativeOffset<0?1:0))}return a.writeU32(this.sourceChecksum),a.writeU32(this.targetChecksum),a.writeU32(this.patchChecksum),a};let Se="UPS1";function Ee(){this.records=[],this.sizeInput=0,this.sizeOutput=0,this.checksumInput=0,this.checksumOutput=0}function Me(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),--e}}function Ce(){for(let e=0,n=1;;){var t=this.readU8();if(-1==t)throw new Error("Can't read UPS VLV at 0x"+(this.offset-1).toString(16));if(e+=(127&t)*n,0!=(128&t))break;e+=n<<=7}return e}function Pe(e){for(let t=0;t++,0!=(e>>=7);)--e;return t}function Ie(e){let t=new Ee;for(e.readVLV=Ce,e.seek(Se.length),t.sizeInput=e.readVLV(),t.sizeOutput=e.readVLV();e.offset<e.fileSize-12;){e.readVLV();for(let t=[];e.readU8();)t.push(e._lastRead);t.addRecord(n,_0x3bca86)}return e.littleEndian=!0,t.checksumInput=e.readU32(),t.checksumOutput=e.readU32(),e.littleEndian=!1,t}Ee.prototype.addRecord=function(e,t){this.records.push({offset:e,XORdata:t})},Ee.prototype.toString=function(){var e="Records: "+(void 0).records.length;return(e=(e=(e+="\nInput file size: "+(void 0).sizeInput)+"\nOutput file size: "+(void 0).sizeOutput)+"\nInput file checksum: "+padZeroes((void 0).checksumInput,4))+"\nOutput file checksum: "+padZeroes((void 0).checksumOutput,4)},Ee.prototype.export=function(e){let t=Se.length;t=(t+=Pe(this.sizeInput))+Pe(this.sizeOutput);for(let e=0;e<this.records.length;e++)t=(t+=Pe(this.records[e].offset))+(this.records[e].XORdata.length+1);for(t+=12,(tempFile=new de(t)).writeVLV=Me,tempFile.fileName=e+".ups",tempFile.writeString(Se),tempFile.writeVLV(this.sizeInput),tempFile.writeVLV(this.sizeOutput),n=0;n<this.records.length;n++)tempFile.writeVLV(this.records[n].offset),tempFile.writeBytes(this.records[n].XORdata),tempFile.writeU8(0);return tempFile.littleEndian=!0,tempFile.writeU32(this.checksumInput),tempFile.writeU32(this.checksumOutput),tempFile.writeU32(he(tempFile,0,!0)),tempFile},Ee.prototype.validateSource=function(e,t){return he(e,t)===this.checksumInput};var Oe={_FS:{createFolder:function(e,t,n,a){var o,i;Oe.FS&&("function"==typeof Oe.FS.mkdir&&window.PATH?(o=PATH.join2("string"==typeof e?e:Oe.FS.getPath(e),t),i=Oe.FS.getMode(n,a),Oe.FS.mkdir(o,i)):Oe.FS.createFolder(e,t,n,a))}},romdb:null,supportBatterySave:!(Ee.prototype.apply=function(e,t){t&&this.validateSource(e),tempFile=new de(this.sizeOutput),e.copyToFile(tempFile,0,this.sizeInput),e.seek(0);for(let t=0;t<this.records.length;t++){var n=this.records[t];tempFile.skip(n.offset),e.skip(n.offset);for(let t=0;t<n.XORdata.length;t++)tempFile.writeU8((e.isEOF()?0:e.readU8())^n.XORdata[t]);tempFile.skip(1),e.skip(1)}return t&&(he(tempFile),this.checksumOutput),tempFile}),hash:"2b35cacf70ae",hash2:"f5cbb3f38c0bb20e4",hash3:"88cc8ad0c350400499a0",loading:null,gamePatch:null,saveFilenames:[],FS:null,Module:null,aspectRatio:4/3,memData:null,wasmData:null,coreFileData:{},coreFileName:"",coreFileVersion:"",isMobileDevice:!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||""),create:function(){let e=this;window.URL=window.URL||window.webkitURL;let t,n,a,o=!1,i=!1,s=!1,l=0,r=!1,c={psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],"3do":["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a5200:["a52","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],"32x":["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],"fba0.2.97.29":["zip"],mame2003:["zip"],mame:["zip"]},d={psx:"psx",nds:"nds",nes:"nes",snes:"snes",snes2002:"snes2002",snes2005:"snes2005",snes2010:"snes2010",gb:"gb",gbc:"gb",gba:"gba",vbanext:"vbanext",vb:"vb",n64:"n64","3do":"3do",segaMS:"sega",segaGG:"sega",segaMD:"sega",segaCD:"segacd",sega32x:"32x",segaSaturn:"saturn",ngp:"ngp",pce:"pce",msx:"bluemsx",atari2600:"a2600",atari7800:"a7800",atari5200:"a5200",lynx:"lynx",ws:"ws",arcade:"arcade","fba0.2.97.29":"fba0.2.97.29",jaguar:"jaguar",mame2003:"mame2003"},u=this,f=u.system,m=(t=u.customPaths&&"string"==typeof u.customPaths["extract7z.js"]?u.customPaths["extract7z.js"]:u.dataPath+"extract7z.js",n=u.customPaths&&"string"==typeof u.customPaths["extractzip.js"]?u.customPaths["extractzip.js"]:u.dataPath+"extractzip.js?v=1",a=u.customPaths&&"string"==typeof u.customPaths["libunrar.js"]?u.customPaths["libunrar.js"]:u.dataPath+"libunrar.js",P("canvas",{})),h=(this.game.appendChild(m),Oe.loading=P("div",{class:this.config.classNames.loading}),this.elements.container.appendChild(Oe.loading),{"loading-info":D({"loading-info":!0}),ad:D({ad:!0}),"close-ad":D({"close-ad":!0}),"start-game":D({"start-game":!0}),on:D({on:!0}),p1:D({p1:!0}),p2:D({p2:!0}),p3:D({p3:!0}),p4:D({p4:!0})});var v;"string"==typeof u.adUrl?(Oe.loading.innerHTML='\n        <div>\n        <div class="'+h.ad+'" style="display:block !important;width:300px !important">\n        <div class="'+h["close-ad"]+'" hidden><a href="#" onclick="return false"></a></div>\n        <iframe scrolling="no" frameborder="no" style="width:300px !important;height:250px !important;display: block !important;" src="'+u.adUrl+'"></iframe>\n        </div>\n        <div class="'+h["loading-info"]+'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="'+h.p1+'"></div>\n        <div class="'+h.p2+'"></div>\n        <div class="'+h.p3+'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="'+h["start-game"]+'">'+J.get("playNow",u.config)+"</a>\n        </div>\n        </div>",v=P("iframe",{src:u.adUrl,scrolling:"no",frameborder:"no",style:"width:300px !important;height:250px !important;display: block !important;"}),Oe.loading.querySelector(".".concat(h.ad)).removeChild(Oe.loading.querySelector(".".concat(h.ad," iframe"))),Oe.loading.querySelector(".".concat(h.ad)).appendChild(v),X.webgl.DETECTED||(A(Oe.loading.querySelector(".".concat(h["start-game"])),!0),Oe.loading.querySelector(".".concat(h.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'),Oe.loading.querySelector(".".concat(h.ad," iframe")).style.setProperty("display","block","important"),Oe.loading.querySelector(".".concat(h.ad," iframe")).style.setProperty("visibility","visible","important"),Oe.loading.querySelector(".".concat(h.ad)).style.setProperty("display","block","important"),Oe.loading.querySelector(".".concat(h.ad)).style.setProperty("visibility","visible","important")):(Oe.loading.innerHTML='\n        <div>\n        <div class="'.concat(h["loading-info"],'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="').concat(h.p1,'"></div>\n        <div class="').concat(h.p2,'"></div>\n        <div class="').concat(h.p3,'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="').concat(h["start-game"],'">').concat(J.get("playNow",u.config),"</a>\n        </div>\n        </div>"),X.webgl.DETECTED||(A(Oe.loading.querySelector(".".concat(h["start-game"])),!0),Oe.loading.querySelector(".".concat(h.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'));let y=window.URL||window.webkitURL,b=function(e){return 80===e[0]&&75===e[1]&&(3===e[2]&&4===e[3]||5===e[2]&&6===e[3]||7===e[2]&&8===e[3])?"zip":55===e[0]&&122===e[1]&&188===e[2]&&175===e[3]&&39===e[4]&&28===e[5]?"7z":82===e[0]&&97===e[1]&&114===e[2]&&33===e[3]&&26===e[4]&&7===e[5]&&(0===e[6]||1===e[6]&&0==e[7])?"rar":void 0},w=async function(e){return e=await(await fetch(e)).text(),e=new Blob([e],{type:"application/javascript"}),e=window.URL.createObjectURL(e),new Worker(e)},S=async function(e){var t=await(await fetch(e)).text();e=new Blob(["\nlet dataToPass = [];\nModule = {\n    monitorRunDependencies: function(left)  {\n        if (left == 0) {\n            setTimeout(function() {\n                unrar(dataToPass, null);\n            }, 100);\n        }\n    },\n    onRuntimeInitialized: function() {\n    },\n    locateFile: function(file) {\n        return '"+e+".mem';\n    }\n};\n"+t+'\nlet unrar = function(data, password) {\n    let cb = function(fileName, fileSize, progress) {\n        postMessage({"t":4,"current":progress,"total":fileSize, "name": fileName});\n    };\n\n    let rarContent = readRARContent(data.map(function(d) {\n        return {\n            name: d.name,\n            content: new Uint8Array(d.content)\n        }\n    }), password, cb)\n    let rec = function(entry) {\n        if (entry.type === \'file\') {\n            postMessage({"t":2,"file":entry.fullFileName,"size":entry.fileSize,"data":entry.fileContent});\n        } else if (entry.type === \'dir\') {\n            Object.keys(entry.ls).forEach(function(k) {\n                rec(entry.ls[k]);\n            })\n        } else {\n            throw "Unknown type";\n        }\n    }\n    rec(rarContent);\n    postMessage({"t":1});\n    return rarContent;\n};\nonmessage = function(data) {\n    dataToPass.push({name:  \'test.rar\', content: data.data});\n};\n                '],{type:"application/javascript"}),t=window.URL.createObjectURL(e);return new Worker(t)},E=null,M=null,C=null,I=null;try{E=new ie({dbVersion:1,storePrefix:"ejs-",storeName:"system",keyPath:null,autoIncrement:!1,onStoreReady:function(){o=!0},onError:function(){o=!0}}),M=new ie({dbVersion:1,storePrefix:"ejs-",storeName:"roms",keyPath:null,autoIncrement:!1,onStoreReady:function(){i=!0},onError:function(){i=!0}}),C=new ie({dbVersion:1,storePrefix:"ejs-",storeName:"bios",keyPath:null,autoIncrement:!1,onStoreReady:function(){s=!0},onError:function(){s=!0}}),I=new ie({dbVersion:1,storePrefix:"ejs-",storeName:"romsdata",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(v){o=!0,i=!0,s=!0,console.log(v)}_.call(u,u.elements.container,"start-game",(function(t){u.started=!0,u.playing=!0,A(Oe.loading.querySelector(".".concat(h["loading-info"])),!0),!Ge||"undefined"!=Ge.virtualGamepadContainer&&null!==Ge.virtualGamepadContainer||le.toggleControls.call(u,!0);let n=D({"ejs__tooltip--visible":!0}),a=u.elements.buttons.gamepad.querySelector(".".concat(D({ejs__tooltip:!0}))),o=(R(a,n,!0),setTimeout((function(){R(a,n,!1)}),5e3),"string"==typeof u.adUrl&&(A(Oe.loading.querySelector(".".concat(h["close-ad"])),!1),!0!==u.config.noAutoAdClose&&setTimeout((function(){u.started&&Oe.loading.querySelector(".".concat(h.ad))&&Oe.loading.querySelector(".".concat(h.ad)).parentNode.removeChild(Oe.loading.querySelector(".".concat(h.ad)))}),1e4)),A(Oe.loading.querySelector(".".concat(h["start-game"])),!0),W(He.defaultCoreOptionsValues.call(e),He.storage.get("core-options")||{}));"n64"===u.system&&o&&Object.keys(o).forEach((function(e){"glupen64-aspect"===e&&"16:9"===o[e]&&(m.height=m.width/16*9,Oe.aspectRatio=16/9)})),"arcade"!==e.system&&"fba0.2.97.29"!==e.system||o&&Object.keys(o).forEach((function(e){"fba-aspect"===e&&"PAR"===o[e]&&(m.height=m.width/16*9,Oe.aspectRatio=16/9)})),"gba"===u.system&&(m.height=m.width/1.5,Oe.aspectRatio=1.5);{let t=e;"undefined"!=typeof RI?(document.removeEventListener("mousemove",RI.eventHandler,!1),m.removeEventListener("mousedown",RI.canvasEventHandler,!1),m.removeEventListener("mouseup",RI.canvasEventHandler,!1),t.elements.container.addEventListener("mousemove",(function(e){let t=0,n=0,a=e.offsetX-Oe.Module.canvas.offsetLeft,o=e.offsetY-Oe.Module.canvas.offsetTop;if("mousemove"===e.type){t=a<0?(a=0,-Oe.Module.canvas.offsetWidth):a>Oe.Module.canvas.offsetWidth?(a=Oe.Module.canvas.offsetWidth,Oe.Module.canvas.offsetWidth):a-RI.currentX,n=o<0?(o=0,-Oe.Module.canvas.offsetHeight):o>Oe.Module.canvas.offsetHeight?(o=Oe.Module.canvas.offsetHeight,Oe.Module.canvas.offsetHeight):o-RI.currentY,RI.currentX=a,RI.currentY=o;for(let e=0;e<RI.contexts.length;e+=1)HEAP32[RI.contexts[e].state+32>>2]=t,HEAP32[RI.contexts[e].state+36>>2]=n}}),!1),t.elements.container.addEventListener("mousedown",RI.canvasEventHandler,!1),t.elements.container.addEventListener("mouseup",RI.canvasEventHandler,!1),i=function(e){if(e.targetTouches[0]){let t,n,a=0,o=0,i=e.target.getBoundingClientRect(),s=e.targetTouches[0].clientX-i.left,l=e.targetTouches[0].clientY-i.top;a=s<0?(s=0,-Oe.Module.canvas.offsetWidth):s>Oe.Module.canvas.offsetWidth?(s=Oe.Module.canvas.offsetWidth,Oe.Module.canvas.offsetWidth):s-RI.currentX,o=l<0?(l=0,-Oe.Module.canvas.offsetHeight):l>Oe.Module.canvas.offsetHeight?(l=Oe.Module.canvas.offsetHeight,Oe.Module.canvas.offsetHeight):l-RI.currentY,RI.currentX=s,RI.currentY=l;for(let e=0;e<RI.contexts.length;e+=1)HEAP32[RI.contexts[e].state+32>>2]=a,HEAP32[RI.contexts[e].state+36>>2]=o;switch(e.type){case"touchend":case"touchstart":if(0===e.button)n=40;else{if(2!==e.button)break;n=41}t="touchend"===e.type?0:1;for(let e=0;e<RI.contexts.length;e+=1)HEAP8[RI.contexts[e].state+n>>0]=t}}},t.elements.container.addEventListener("touchstart",i,!1),t.elements.container.addEventListener("touchend",i,!1)):(i=function(e){e=new MouseEvent(e.type,e),Oe.Module.canvas.dispatchEvent(e)},L.call(e,".".concat(D({ejs__dialogs:!0}))).addEventListener("mousemove",i,!1),L.call(e,".".concat(D({ejs__dialogs:!0}))).addEventListener("mousedown",i,!1),L.call(e,".".concat(D({ejs__dialogs:!0}))).addEventListener("mouseup",i,!1))}var i;"msx"===u.system&&"undefined"!=typeof RI&&(document.removeEventListener("keydown",RI.eventHandler,!1),document.removeEventListener("keyup",RI.eventHandler,!1),i=function(e){var t=e.keyCode,n=t>>3,a=1<<(7&t);switch(e.type){case"keyup":case"keydown":if(32<=n)throw"key code error! bad code: "+t;for(let t=0;t<RI.contexts.length;t++){let o=HEAP8[RI.contexts[t].state+n>>0];"keyup"===e.type?o&=~a:o|=a,HEAP8[RI.contexts[t].state+n>>0]=o}}},document.addEventListener("keydown",i,!1),document.addEventListener("keyup",i,!1)),setTimeout((function(){let e;e=q.info(),null===Ge.setVolume&&"undefined"!=typeof RA?(RA.queueAudio=function(){let t,n=u.volume,a=RA.bufIndex,o=(t=RA.bufIndex?RA.buffers[RA.bufIndex-1].endTime:RA.context.currentTime,RA.buffers[a].endTime=t+RA.buffers[a].duration,RA.context.createBufferSource());if(o.buffer=RA.buffers[a],1===(n=u.muted?0:n))o.connect(RA.context.destination);else{let t=RA.context.createGain();o.connect(t),t.connect(RA.context.destination),q.isEdge||"chrome"===e.name&&parseInt(e.version,10)<=60||"firefox"===e.name&&parseInt(e.version,10)<=56||"opera"===e.name&&parseInt(e.version,10)<=44?t.gain.value=n:"firefox"===e.name?t.gain.setValueAtTime(n,RA.context.currentTime):t.gain.setValueAtTime(n,RA.context.currentTime,0)}o.start(t),RA.bufIndex+=1,RA.bufOffset=0},q.isIos&&window.addEventListener("touchstart",(function(){if(RA.context){RA.context.resume();let e=RA.context.createBufferSource();e.connect(RA.context.destination),e.start()}}),!1)):Ge.setVolume()}),500),setTimeout((function(){u.elements.container.focus()}),30),void 0===window.addRunDependency&&(window.Module=void 0)})),"string"==typeof u.adUrl&&_.call(u,Oe.loading.querySelector(".".concat(h["close-ad"])),"click",(function(e){e instanceof MouseEvent&&u.started&&Oe.loading.querySelector(".".concat(h.ad))&&Oe.loading.querySelector(".".concat(h.ad)).parentNode.removeChild(Oe.loading.querySelector(".".concat(h.ad))),u.elements.container.focus()}));let O=function(){M.db&&M.getAll((function(e){Array.isArray(e)&&10<e.length&&e.sort((function(e,t){return(t.lastaccess||0)-(e.lastaccess||0)})).forEach((function(e,t){10<t&&!Oe.saveFilenames.includes(e.key)?(M.remove(e.key),I.db&&I.remove(e.key)):(delete e.data,M.put(e.key,e))}))}),(function(){M.clear(),I.db&&I.clear()}))},N=function(e){if(Oe.gamePatch){let a=Oe.getStartName(!0),o=a.split("/"),i=o.pop().split(".").pop(),s=(Oe.gamePatch.split(".").pop(),Oe.gamePatch.split("/").pop().split(".").shift()),l="".concat(o.join("/"),"/").concat(s,".").concat(i);l=l.replace(/\#/g,""),Oe.gamePatch.startsWith("blob:")&&(l=a);var t,n=Oe.gamePatch;if(Oe.FS.rename(a,l),e.startName=l,a=Oe.getStartName(!0),"snes"===e.system||["snes2002","snes2005","snes2010"].includes(e.system)){let e,o,i,s=new de(Oe.FS.readFile(a)),l=he(s),r=new de(Oe.FS.readFile(n)),c=r.readString(6),d=s._u8array.length%1024;c.startsWith("PATCH")?(e=pe(r),0==d&&"B19ED489"===l.toString(16).toUpperCase()&&((o=new Uint8Array(s._u8array.length+512)).set(new Uint8Array(512),0),o.set(s._u8array,512),s=new de(o))):c.startsWith(Se)?e=Ie(r):c.startsWith("BPS1")&&(e=be(r),0<d&&"A31BEAD4"===l.toString(16).toUpperCase()&&(o=s._u8array.slice?s._u8array.slice(d):s._u8array.subarray(d),s=new de(o)));try{(i=e.apply(s,!1))&&(0<(t=i._u8array.length%1024)&&(o=i._u8array.slice?i._u8array.slice(t):i._u8array.subarray(t),i=new de(o)),Oe.FS.unlink(n),Oe.FS.unlink(a),Oe.FS.writeFile(a,i._u8array))}catch(e){}}else{let e,t,o=new de(Oe.FS.readFile(a)),i=new de(Oe.FS.readFile(n)),s=i.readString(6);s.startsWith("PATCH")?e=pe(i):s.startsWith(Se)?e=Ie(i):s.startsWith("BPS1")&&(e=be(i));try{(t=e.apply(o,!1))&&(Oe.FS.unlink(n),Oe.FS.unlink(a),Oe.FS.writeFile(a,t._u8array))}catch(e){}}}},k=function(){var t=2===e.coreVer?"INITIAL_MEMORY":"TOTAL_MEMORY";r?(window.Module[t]=268435456,["jaguar"].includes(e.system)&&(window.Module[t]=268435456),["nds","nes","snes","arcade","mame"].includes(e.system)&&(window.Module[t]=0),["snes2002","snes2005","snes2010"].includes(e.system)&&(window.Module[t]=0),"gba"==e.system&&(window.Module[t]=0),"3do"==e.system&&(window.Module[t]=0),"n64"==e.system&&(window.Module[t]=0)):("nes"===e.system&&(window.Module[t]=134217728),window.Module[t]=l+67108864,["arcade","mame","mame2003","fba0.2.97.29"].includes(e.system)&&(window.Module[t]=l+268435456,Oe.isMobileDevice&&(window.Module[t]=314572800)),["n64","nds","jaguar"].includes(e.system)&&(window.Module[t]=l+268435456,Oe.isMobileDevice&&(window.Module[t]=314572800)),"gba"==e.system&&(window.Module[t]=268435456)),"undefined"!=typeof EJS_MEMORY&&(window.Module[t]=EJS_MEMORY)},z=function(o,i){function s(e){if(m.innerHTML="Game Data ready",e)try{k(),N(p),O();let t=[e,[Oe.hash,Oe.hash2,Oe.hash3].join("")];if("undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&t.unshift("-v"),Oe.Module.callMain(t),2===u.coreVer){Oe.Module.resumeMainLoop(),Oe.Module.setCanvasSize(800,600);let e=0,t=setInterval((function(){20<e&&clearInterval(t),e++,Oe.Module.setCanvasSize(800,600)}),100)}x.call(p,p.elements.container,"start-game");try{_()}catch(e){}}catch(e){console.log(e),m.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Doesn\'t look like your browser is supported</strong>'}else m.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Invalid Rom</strong>'}function r(t){if(t.data){if(1===t.data.t&&(!p.startName&&y&&(p.startName=y),t.target.terminate(),s(p.startName)),2===t.data.t){let e=t.data.file.split("/"),n=e.pop(),a=n.split(".").pop();n=n.replace(/\#/g,""),Oe.FS.createPath("/",e.join("/"),!0,!0);for(let t=c[g].length-1;0<=t;--t)c[g][t]===a.toLowerCase()&&t>v&&(v=t,p.startName=["",e.join("/"),n].join("/"),p.startName=p.startName.replace(/\/+/,"/"));n&&(Oe.FS.createDataFile("/".concat(e.join("/")),n,t.data.data,!0,!1),l+=t.data.data.length),y="/".concat(e.join("/"),"/").concat(n)}var n;4===t.data.t&&0<t.data.total&&(n=Math.floor(t.data.current/t.data.total*100),t=t.data.name||"",n<=100&&0<n&&(m.innerHTML=e.localization("Decompress Game Data")+t+" "+n+"%"))}}let p=e,m=Oe.loading.querySelector(".".concat(h.p3)),g=(o.split(".").pop(),d[f]),v=-1,y="",_=function(){if(2===p.coreVer){p.elements.settings.panels.home.querySelector('[role="menu"]').innerHTML="",Be.setNormalOptionsMenu.call(p),Be.setCoreOptionsMenu.call(p);let e=Oe.Module.cwrap("toggleMainLoop","null",["number"]);Oe.Module.resumeMainLoop=function(){e(1)},Oe.Module.pauseMainLoop=function(){e(0)}}"string"==typeof p.loadStateOnStart&&fetch(p.loadStateOnStart).then((function(e){e.arrayBuffer().then((function(e){e=new Uint8Array(e),EJS_loadState(e)}))}))},T=(window.EJS_terminate=function(){if(Oe.Module.pauseMainLoop(),p&&p.eventListeners)for(var e in p)for(let e=0;e<p.eventListeners.length;e++){let t=p.eventListeners[e];t.element.removeEventListener(t.type,t.callback,t.capture)}if(window.EJS_RESET_VARS){let e=[],n=[];for(var t in window)e.push(t);for(let t=0;t<e.length;t++)window.EJS_RESET_VARS.includes(e[t])||n.push(e[t]);for(let e=0;e<n.length;e++)window[n[e]]&&delete window[n[e]]}},!1);if(["arcade","mame","mame2003","fba0.2.97.29"].includes(p.system)||(o=i.slice?i.slice(0,10):i.subarray(0,10),"7z"===(o=b(o))?(w(t).then((function(e){e.onmessage=r,e.postMessage(i)})),T=!0):"zip"===o?(w(n).then((function(e){e.onmessage=r,e.postMessage(i)})),T=!0):"rar"===o&&(S(a).then((function(e){e.onmessage=r,e.postMessage(i)})),T=!0)),!T){p.startName=p.getStartName(),p.startName||(p.startName="rom");try{l+=i.length,Oe.FS.createDataFile("/",p.startName,i,!0,!1)}catch(o){console.log(o)}s(p.startName)}},j=function(){let t=e,n=Oe.loading.querySelector(".".concat(h.p3)),a=e.config,o=a.gameUrl,i=a.system,s=("vbanext"==i&&(i="gba"),"string"==typeof o?o.split("/"):"ga.me"),l=s[s.length-1];(l=-1<l.indexOf("?")?l.substr(0,l.indexOf("?")):l).split(".").pop(),n.innerHTML=e.localization("Download Game Data"),["arcade","mame","mame2003","fba0.2.97.29"].includes(t.system)&&t.config.gameParentUrl&&(n.innerHTML+=" (2/2)"),t.config.gamePatchUrl&&(n.innerHTML+=" (2/2)"),"string"!=typeof o?"[object Blob]"===o.toString()?o.arrayBuffer().then((function(e){z(l,new Uint8Array(e))})):"[object ArrayBuffer]"===o.toString()?z(l,new Uint8Array(o)):z(l,Uint8Array.from(o)):se.a.head(o,{}).then((function(a){function s(){se.a.get(o,{onDownloadProgress:function(a){a=a.total?"".concat(Math.floor(a.loaded/a.total*100),"%"):"",["arcade","mame","mame2003","fba0.2.97.29"].includes(t.system)&&t.config.gameParentUrl||t.config.gamePatchUrl?n.innerHTML=e.localization("Download Game Data")+" (2/2) ".concat(a):n.innerHTML=e.localization("Download Game Data")+" ".concat(a)},responseType:"arraybuffer"}).then((function(t){let n=new Uint8Array(t.data);if("string"!=typeof e.config.gameUrl||"string"==typeof e.config.gameUrl&&(e.config.gameUrl.startsWith("blob:")||e.config.gameUrl.startsWith("file:")||e.config.gameUrl.startsWith("chrome-extension:")||("file:"==window.location.protocol||"chrome-extension:"==window.location.protocol)&&1===e.config.gameUrl.split(":").length))z(l,n);else{if(d&&M.db)if(104857600<n.length)for(let e=Math.ceil(n.length/104857600),t=0;t<e;t+=1){let e=n.slice?n.slice(104857600*t,104857600*(t+1)):n.subarray(104857600*t,104857600*(t+1)),a="".concat(d);0<t&&(a="".concat(d,"-part-").concat(t)),Oe.saveFilenames.push(a),M.put(a,{filename:l,filesize:n.length,filetype:c,key:a,lastaccess:(new Date).valueOf(),next:"".concat(d,"-part-").concat(t+1)}),I.db&&I.put(a,{filename:l,filesize:n.length,filetype:c,key:a,data:e})}else Oe.saveFilenames.push(d),M.put(d,{filename:l,filesize:n.length,filetype:c,key:d,lastaccess:(new Date).valueOf()}),I.db&&I.put(d,{filename:l,filesize:n.length,filetype:c,key:d,data:n});z(l,n)}})).catch((function(t){p(t,n,e)}))}let r=a.headers["content-length"],c=a.headers["content-type"],d=(a.headers["last-modified"],"".concat(i,"-").concat(l));I.db?I.get(d,(function(e){if(e&&e.filename===l&&e.filesize-r==0&&e.filetype===c&&e.key)if(M.get(d,(function(e){e.lastaccess=(new Date).valueOf(),M.put(e.key,e)})),104857600<e.filesize){let t=new Uint8Array(e.filesize);t.set(e.data);for(let t=Math.ceil(e.filesize/104857600),n=[],a=1;a<t;a+=1)n.push("".concat(d,"-part-").concat(a)),M.get("".concat(d,"-part-").concat(a),(function(e){e.lastaccess=(new Date).valueOf(),M.put(e.key,e)}));I.getBatch(_0x36180f,(function(n){n.filter((function(e){return e})).length!==_0x36180f.length?s():(n.forEach((function(e,n){t.set(e.data,104857600*(n+1))})),z(e.filename,t))}),(function(){}),"sparse")}else z(e.filename,e.data);else s()})):s()})).catch((function(t){p(t,n,e)}))},F=function(){let o=Oe.loading.querySelector(".".concat(h.p3)),i=e.config.gamePatchUrl;if(i){let s=i.split("/"),r=s[s.length-1];(r=-1<r.indexOf("?")?r.substr(0,r.indexOf("?")):r).split(".").pop(),o.innerHTML=e.localization("Download Game Data")+" (1/2)",se.a.get(i,{onDownloadProgress:function(t){o.innerHTML=e.localization("Download Game Data")+" (1/2) ",t=t.total?"".concat(Math.floor(t.loaded/t.total*100),"%"):"",o.innerHTML+=t},responseType:"arraybuffer"}).then((function(o){function i(t){if(t.data){if(1===t.data.t&&(t.target.terminate(),j()),2===t.data.t){let e=t.data.file.split("/"),n=e.pop(),a=n.split(".").pop();Oe.FS.createPath("/",e.join("/"),!0,!0),Oe.FS.createDataFile("/"+e.join("/"),n,t.data.data,!0,!1),l+=t.data.data.length,["ips","bps","ups"].includes(a)&&!Oe.gamePatch&&(Oe.gamePatch="/"+e.join("/")+"/"+n)}var n;4===t.data.t&&0<t.data.total&&(n=Math.floor(t.data.current/t.data.total*100),t=t.data.name||"",n<=100&&0<n&&(d.innerHTML=e.localization("Decompress Game Patch")+" ".concat(t," ").concat(n,"%")))}}let s=new Uint8Array(o.data),c=r.split(".").pop(),d=Oe.loading.querySelector(".".concat(h.p3)),u=s.slice?s.slice(0,10):s.subarray(0,10),f=b(u);"7z"===f?w(t).then((function(e){e.onmessage=i,e.postMessage(s)})):"zip"===f?w(n).then((function(e){e.onmessage=i,e.postMessage(s)})):"rar"===f?S(a).then((function(e){e.onmessage=i,e.postMessage(s)})):(l+=s.length,Oe.gamePatch="/"+c,Oe.FS.createDataFile("/",c,s,!0,!1),j())})).catch((function(t){p(t,n,e)}))}else j()},G=function(){let t=e,n=Oe.loading.querySelector(".".concat(h.p3)),a=e.config.gameParentUrl;if(a&&["arcade","mame","mame2003","fba0.2.97.29"].includes(t.system)){let o=a.split("/"),i=o[o.length-1];(i=-1<i.indexOf("?")?i.substr(0,i.indexOf("?")):i).split(".").pop(),n.innerHTML=e.localization("Download Game Data")+" (1/2)",t.config.gamePatchUrl&&(n.innerHTML=e.localization("Download Game Data")+" (1/3)"),se.a.head(a,{}).then((function(t){function o(){se.a.get(a,{onDownloadProgress:function(t){t=t.total?"".concat(Math.floor(t.loaded/t.total*100),"%"):"",n.innerHTML=e.localization("Download Game Data")+" (1/2) ".concat(t)},responseType:"arraybuffer"}).then((function(e){let t=new Uint8Array(e.data);if(c&&M.db)if(104857600<t.length)for(let e=Math.ceil(t.length/104857600),n=0;n<e;n+=1){let e=t.slice?t.slice(104857600*n,104857600*(n+1)):t.subarray(104857600*n,104857600*(n+1)),a="".concat(c);0<n&&(a="".concat(c,"-part-").concat(n)),Oe.saveFilenames.push(a),M.put(a,{filename:i,filesize:t.length,filetype:r,key:a,lastaccess:(new Date).valueOf(),next:"".concat(c,"-part-").concat(n+1)}),I.db&&I.put(a,{filename:i,filesize:t.length,filetype:r,key:a,data:e})}else Oe.saveFilenames.push(c),M.put(c,{filename:i,filesize:t.length,filetype:r,key:c,lastaccess:(new Date).valueOf()}),I.db&&I.put(c,{filename:i,filesize:t.length,filetype:r,key:c,data:t});e=i.replace(/\#/g,"");try{l+=t.length,Oe.FS.createDataFile("/",e,t,!0,!1),F()}catch(e){console.log(e)}})).catch((function(t){p(t,n,e)}))}let s=t.headers["content-length"],r=t.headers["content-type"],c=(t.headers["last-modified"],"".concat(f,"-").concat(i));I.db?I.get(c,(function(e){if(e&&e.filename===i&&e.filesize-s==0&&e.filetype===r&&e.key)if(104857600<e.filesize){let t=new Uint8Array(e.filesize);t.set(e.data);for(let t=Math.ceil(e.filesize/104857600),n=[],a=1;a<t;a+=1)n.push("".concat(c,"-part-").concat(a));I.getBatch(_0x6f30ae,(function(n){n.filter((function(e){return e})).length!==_0x6f30ae?o():(n.forEach((function(e,n){t.set(e.data,104857600*(n+1))})),Oe.FS.createDataFile("/",e.filename,t,!0,!1),F())}),(function(){}),"sparse")}else Oe.FS.createDataFile("/",e.filename,e.data,!0,!1),F();else o()})):o()})).catch((function(t){p(t,n,e)}))}else F()},V=function(o,i){function s(e){if(e.data){if(1===e.data.t&&(c.innerHTML="BIOS ready",e.target.terminate(),G()),2===e.data.t){let t=e.data.file.split("/"),n=t.pop();n.split(".").pop(),Oe.FS.createPath("/",t.join("/"),!0,!0),Oe.FS.createDataFile("/"+t.join("/"),n,e.data.data,!0,!1),l+=e.data.data.length}var t;4===e.data.t&&0<e.data.total&&(t=Math.floor(e.data.current/e.data.total*100),e=e.data.name||"",t<=100&&0<t&&(c.innerHTML="Decompress BIOS ".concat(e," ").concat(t,"%")))}}let r=e,c=Oe.loading.querySelector(".".concat(h.p2)),d=(o.split(".").pop(),i.slice?i.slice(0,10):i.subarray(0,10)),u=b(d);"7z"===u?w(t).then((function(e){e.onmessage=s,e.postMessage(i)})):"rar"===u?S(a).then((function(e){e.onmessage=s,e.postMessage(i)})):"zip"!==u||["arcade","mame","mame2003","fba0.2.97.29"].includes(r.system)?(l+=i.length,c.innerHTML="BIOS ready",Oe.FS.createDataFile("/",o,i,!0,!1),G()):w(n).then((function(e){e.onmessage=s,e.postMessage(i)}))},U=function(){Oe.loading.querySelector(".".concat(h.p1)).innerHTML="Game Core ready";let t=e.config.biosUrl,n=(Ge.bindFunction.call(e),Ge.setGamepadDialog.call(e),Ge.setCacheDialog.call(e),Ge.setLoadingDialog.call(e),Ge.setCheatDialog.call(e),Ge.initGamepad.call(e),Ge.initKeyboard.call(e),Ge.listeners.call(e),Oe._FS.createFolder("/","etc",!0,!0),Oe.FS.mkdir("/data"),Oe.FS.mkdir("/data/saves"),"undefined"!=typeof IDBFS?Oe.FS.mount(IDBFS,{},"/data/saves"):Oe.FS.mount(Oe.FS.filesystems.IDBFS,{},"/data/saves"),Oe.FS.mkdir("/shader"),Oe.FS.syncfs(!0,(function(e){})),Ge.initShaders(),""),a=(n=(n=(n=(n=(n+="savefile_directory = /data/saves\n")+"video_vsync = true\nscreenshot_directory = /\n")+"video_shader = /shader/shader.glslp\nvideo_shader_enable = true\n")+"video_font_enable = false\nvideo_scale = 1.0\n")+"video_gpu_screenshot = false\naudio_latency = 96\n",He.defaultCoreOptionsValues.call(e)),o=(e.lightgun&&("nes"===e.system&&(n+='input_libretro_device_p2 = "258"\n'),"segaMS"!==e.system&&"segaMD"!==e.system&&"segaCD"!==e.system||(a.genesis_plus_gx_gun_cursor="yes",a.genesis_plus_gx_invert_mouse="yes",a.genesis_plus_gx_bram="per game",n+='input_libretro_device_p2 = "260"\n'),"snes"===e.system&&(n+='input_libretro_device_p2 = "260"\n'),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+='input_libretro_device_p2 = "260"\n')),e.mouse&&("snes"===e.system&&(n+="input_libretro_device_p1 = 2\n"),["snes2002","snes2005","snes2010","snesnext"].includes(e.system)&&(n+="input_libretro_device_p1 = 2\n")),e.multitap&&["snes2002","snes2005","snes2010","snesnext","snes"].includes(e.system)&&(n+="input_libretro_device_p2 = 257\n"),"n64"===e.system&&(n+="input_libretro_device_p1 = 5\n"),n+="fastforward_ratio = 1.0\nvideo_smooth = false\n",W(a,He.storage.get("core-options")||{})),i="";if(2===e.coreVer?(Oe.FS.createDataFile("/etc","retroarch.cfg",n,!0,!0),Oe._FS.createFolder("/home/web_user","retroarch",!0,!0),Oe._FS.createFolder("/home/web_user/retroarch","userdata",!0,!0),Oe.FS.createDataFile("/home/web_user/retroarch/userdata","retroarch.cfg",i,!0,!0)):(Oe.FS.createDataFile("/etc","retroarch.cfg",n,!0,!0),Oe._FS.createFolder("/home/web_user",".config",!0,!0),Oe._FS.createFolder("/home/web_user/.config","retroarch",!0,!0),Oe.FS.createDataFile("/home/web_user/.config/retroarch","retroarch-core-options.cfg",i,!0,!0)),o&&Object.keys(o).forEach((function(t){if(e.lightgun&&"nes"===e.system&&"system_type"===t)return!1;i+="".concat(t,' = "').concat(o[t],'"\n'),_.call(e,e.elements.container,"start-game",(function(e){Ge.setVariable(t,o[t])}))})),t){let n=t.split("/"),a=n[n.length-1],o=((a=-1<a.indexOf("?")?a.substr(0,a.indexOf("?")):a).split(".").pop(),Oe.loading.querySelector(".".concat(h.p2)));se.a.head(t,{}).then((function(n){function i(){se.a.get(t,{onDownloadProgress:function(e){e=e.total?"".concat(Math.floor(e.loaded/e.total*100),"%"):"",o.innerHTML="Download BIOS ".concat(e)},responseType:"arraybuffer"}).then((function(e){e=new Uint8Array(e.data),C.db&&C.put(f,{filename:a,filesize:e.length,filetype:l,data:e}),V(a,e)})).catch((function(t){p(t,o,e)}))}let s=n.headers["content-length"],l=n.headers["content-type"],r=(n.headers["last-modified"],e.system);C.db?C.get(r,(function(e){e&&e.filename===a&&e.filesize-s==0&&e.filetype===l?V(e.filename,e.data):i()})):i()})).catch((function(t){p(t,o,e)}))}else G()},B=function(e){e=e.byteLength?new Uint8Array(e):e,"undefined"!=typeof GLOBAL_BASE?Oe.Module.HEAPU8.set(e,GLOBAL_BASE):"undefined"!=typeof Runtime&&Runtime.GLOBAL_BASE?Oe.Module.HEAPU8.set(e,Runtime.GLOBAL_BASE):Oe.Module.HEAPU8.set(e,8)},H=function(n){function a(t){if(t.data){if(1===t.data.t&&(x.call(u,u.elements.container,"script-loaded"),t.target.terminate()),2===t.data.t){let e=t.data.file.split("/").pop(),n=e.split(".").pop();Oe.coreFileData[e]=t.data.data,"js"!==n||e.includes(".worker.js")||(i=t.data.data),"mem"===n&&(Oe.memData=t.data.data),"wasm"===n&&(Oe.wasmData=t.data.data)}4===t.data.t&&0<t.data.total&&(o.innerHTML=e.localization("Decompress Game Core")+" ".concat(Math.floor(t.data.current/t.data.total*100),"%"))}}let o=Oe.loading.querySelector(".".concat(h.p1)),i="";_.call(u,u.elements.container,"script-loaded",(function(e){{null!==Oe.wasmData?(window.Module.wasmBinary=Oe.wasmData,k(),window.Module.monitorRunDependencies=function(e){0===e&&U()},window.Module.onRuntimeInitialized=function(){}):(k(),window.Module.monitorRunDependencies=function(e){console.log("monitorRunDependencies, ",e)},window.Module.onRuntimeInitialized=function(){Oe.Module||(Oe.Module=window.Module),Oe.Module&&Oe.Module.FS?Oe.FS=Oe.Module.FS:Oe.FS=window.FS,console.log("onRuntimeInitialized"),U()});let e=window.Module;if(null!==Oe.wasmData&&(e.wasmBinary=Oe.wasmData),q.isIos&&null!==Oe.wasmData){let t=new Blob([i],{type:"text/javascript"}),n=P("script",{src:y.createObjectURL(t)});document.body.appendChild(n),n.onload=function(){void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&(Oe.Module=EmulatorJS(e),EmulatorJS=void 0),null!==Oe.memData&&2!==u.coreVer&&B(Oe.memData),Oe.Module||(Oe.Module=window.Module),Oe.Module&&Oe.Module.FS?Oe.FS=Oe.Module.FS:Oe.FS=window.FS}}else try{i=function(e){let t=[];for(let n=0;n<e.length;n+=1){let a=e[n];255<a&&(a&=255),t.push(String.fromCharCode(a))}return t.join("").replace(/fullscreenElement/gi,"fullscreenElement_OFF")}(i),window.eval(i),void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&(Oe.Module=EmulatorJS(e),EmulatorJS=void 0),null!==Oe.memData&&2!==u.coreVer&&B(Oe.memData),Oe.Module||(Oe.Module=window.Module),Oe.Module&&Oe.Module.FS?Oe.FS=Oe.Module.FS:Oe.FS=window.FS,window.EJS_MODULE=Oe.Module,window.ejs_loader=Oe,window.ejs_media=Ge}catch(e){}return void(i=null)}})),w(t).then((function(e){e.onmessage=a,e.postMessage(n)}))},Y=function(t){A(Oe.loading.querySelector(".".concat(h["start-game"])),!0);let n=Oe.loading.querySelector(".".concat(h.p1));if(n.innerHTML=e.localization("Loading")+"...",!0===o&&!0===i&&!0===s){window.Module={TOTAL_MEMORY:268435456,noInitialRun:!0,arguments:[],preRun:[],postRun:[],canvas:m,print:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},printErr:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},totalDependencies:0,monitorRunDependencies:function(e){},locateFile:function(e){let t=null;var n;return e.includes(".worker.js")?(Object.keys(Oe.coreFileData).includes(e)&&(t=Oe.coreFileData[e]),n=new Blob([""],{type:"application/javascript"}),window.URL.createObjectURL(n)):e.includes(".js.mem")&&Object.keys(Oe.coreFileData).includes(e)?(t=Oe.coreFileData[e],URL.createObjectURL(new Blob([t.buffer]))):null},readAsync:function(e,t,n){if(e instanceof ArrayBuffer)setTimeout((function(){t(e)}),500);else{let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){200==a.status||0==a.status&&a.response?t(a.response):n()},a.onerror=n,a.send()}}};let o=function(t,a){var o=e.customPaths&&"string"==typeof e.customPaths[t]?e.customPaths[t]:2===e.coreVer?e.dataPath+"cores/"+t+"?v="+a:e.dataPath+"old/"+t+"?v="+a;se.a.get(o,{onDownloadProgress:function(t){t.total&&Math.floor(t.loaded/t.total*100).toString(),n.innerHTML=e.localization("Download Game Core")+a},responseType:"arraybuffer"}).then((function(n){let o=new Uint8Array(n.data);if(E.db&&E.put(t,{version:a,data:o}),2===e.coreVer)H(o);else{let e=o.slice?o.slice(12):o.subarray(12);e.set([55,122,188,175,39,28,0,3],0),o=null,H(e)}})).catch((function(t){p(t,n,e)}))};var a=e.customPaths&&"string"==typeof e.customPaths["v.json"]?e.customPaths["v.json"]:e.dataPath+"v.json";return se.a.get(a,{}).then((function(t){let n,a=d[e.system],i=t.data[e.system],s=Oe.loading.querySelector(".".concat(h.p1));if(i){let l=i.version||1,c=Boolean(i.state),d=Boolean(i.asmjs),f=Boolean(i.wasm),p=(!0===e.config.oldCores&&1===i.oldCores||1!==i.newCores||!X.wasm&&!d||Oe.isMobileDevice&&1===i.oldCores||(e.coreVer=2,delete Module.readAsync,Module.INITIAL_MEMORY=Module.TOTAL_MEMORY,delete Module.TOTAL_MEMORY,e.elements.settings.panels.home.querySelector('[role="menu"]').innerHTML="",Be.setNormalOptionsMenu.call(e),Be.setCoreOptionsMenu.call(e)),2!==e.coreVer&&i.old&&(d=Boolean(i.old.asmjs),f=Boolean(i.old.wasm)),"nds"!=e.system||X.wasm||2===e.coreVer||(c=!1),!1===e.statesSupported&&(c=!1),Oe.coreFileVersion=l,Oe.coreFileName=a,!1);if(["webgl2","experimental-webgl2"].includes(X.webgl.WEBGL_CONTEXT)&&(p=!0),"undefined"!=typeof EJS_N64_LEGACY&&1==EJS_N64_LEGACY&&(p=!1),"mame"==e.system){let a=e.mameCore;if(!a||null===a||2!==a.split("|").length)return void(s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+e.localization("Missing mame config")+"</strong>");t=a.split("|"),Oe.coreFileName="".concat(e.system,"-").concat(t[0]),c="1"===t[1],g.element(e.elements.buttons.saveState)&&A(e.elements.buttons.saveState,!c),g.element(e.elements.buttons.loadState)&&A(e.elements.buttons.loadState,!c),A(He.contextMenu.querySelectorAll("ul li").item(2),!c),A(He.contextMenu.querySelectorAll("ul li").item(3),!c),n=2===e.coreVer?"":e.system.concat("-old-").concat(t[0],"-wasm.data"),t[0]?(X.wasm&&f?r=!0:(s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+e.localization("Webassembly support is not detected in this browser")+"</strong>",n=""),n&&(E.db?E.get(n,(function(e){if(e&&e.version===l)if(2===u.coreVer)H(e.data);else{let t=e.data.slice?e.data.slice(12):e.data.subarray(12);t.set([55,122,188,175,39,28,0,3],0),H(t)}else o(n,l)})):o(n,l))):s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+e.localization("Unsupported Game")+"</strong>"}else{let t;if(n=!1,X.wasm&&f?(t="wasm",n=!0,"n64"!==e.system||p||2===e.coreVer||(t="legacy-wasm"),r=!0):d&&(n=!0,t="asmjs","n64"!==e.system||p||2===e.coreVer||(t="legacy-asmjs")),!0!==(n="undefined"!=typeof EJS_CUSTOM_COREFILE?EJS_CUSTOM_COREFILE:n))return void(s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+e.localization("Please upgrade your browser to the latest version")+"</strong>");n=2===e.coreVer?a+"-"+t+".data":a+"-old-"+t+".data","undefined"!=typeof EJS_CUSTOM_COREFILE&&(n=EJS_CUSTOM_COREFILE),E.db?E.get(n,(function(e){if(!e||e.version!==l||"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX)o(n,l);else if(2===u.coreVer)H(e.data);else{let t=e.data.slice?e.data.slice(12):e.data.subarray(12);t.set([55,122,188,175,39,28,0,3],0),H(t)}})):o(n,l)}g.element(e.elements.buttons.saveState)&&A(e.elements.buttons.saveState,!c),g.element(e.elements.buttons.loadState)&&A(e.elements.buttons.loadState,!c),A(He.contextMenu.querySelectorAll("ul li").item(2),!c),A(He.contextMenu.querySelectorAll("ul li").item(3),!c),e.statesSupported=c,e.config.buttons&&(!1===e.config.buttons.playPause&&g.element(e.elements.buttons.play[0])&&A(e.elements.buttons.play[0],!0),!1===e.config.buttons.restart&&g.element(e.elements.buttons.restart)&&A(e.elements.buttons.restart,!0),!1===e.config.buttons.mute&&g.element(e.elements.buttons.mute)&&A(e.elements.buttons.mute,!0),!1===e.config.buttons.settings&&g.element(e.elements.buttons.settings)&&A(e.elements.buttons.settings,!0),!1===e.config.buttons.fullscreen&&g.element(e.elements.buttons.fullscreen)&&A(e.elements.buttons.fullscreen,!0),!1===e.config.buttons.saveState&&g.element(e.elements.buttons.saveState)&&A(e.elements.buttons.saveState,!0),!1===e.config.buttons.loadState&&g.element(e.elements.buttons.loadState)&&A(e.elements.buttons.loadState,!0),!1===e.config.buttons.screenRecord&&g.element(e.elements.buttons.screenRecord)&&A(e.elements.buttons.screenRecord,!0),!1===e.config.buttons.gamepad&&g.element(e.elements.buttons.gamepad)&&A(e.elements.buttons.gamepad,!0),!1===e.config.buttons.cheat&&g.element(e.elements.buttons.cheat)&&A(e.elements.buttons.cheat,!0),!1===e.config.buttons.volume&&g.element(e.elements.inputs.volume)&&A(e.elements.inputs.volume,!0),!1===e.config.buttons.screenshot&&A(He.contextMenu.querySelectorAll("ul li").item(0),!0),!0===e.config.buttons.cacheManage&&A(He.contextMenu.querySelectorAll("ul li").item(1),!1),!1===e.config.buttons.quickSave&&A(He.contextMenu.querySelectorAll("ul li").item(2),!0),!1===e.config.buttons.quickLoad&&A(He.contextMenu.querySelectorAll("ul li").item(3),!0))}else s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+e.localization("Invalid System")+"</strong>"})).catch((function(e){p(e,t,u)})),Oe.romdb=M,!1}setTimeout(Y,50)};T(Oe.loading.querySelector(".".concat(h["start-game"])),"click touchstart",Y),!0===u.startOnLoad&&Oe.loading.querySelector(".".concat(h["start-game"])).click()}};let Ae=Oe;function Re(e){return function(e){if(Array.isArray(e)){for(let t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}let Ne,ke,ze,Le,je,De=(Ne=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],ke=function(){function e(t){var n=t.targetModal,a=void 0===(a=t.triggers)?[]:a,o=void 0===(o=t.onShow)?function(){}:o,i=void 0===(i=t.onClose)?function(){}:i,s=void 0===(s=t.openTrigger)?"data-micromodal-trigger":s,l=void 0===(l=t.closeTrigger)?"data-micromodal-close":l,r=void 0!==(r=t.disableScroll)&&r,c=void 0!==(c=t.disableFocus)&&c,d=void 0!==(d=t.awaitCloseAnimation)&&d,u=void 0!==(u=t.debugMode)&&u;t=void 0===(t=t.closeByEsckey)||t;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.modal=document.getElementById(n),this.config={debugMode:u,disableScroll:r,openTrigger:s,closeTrigger:l,onShow:o,onClose:i,awaitCloseAnimation:d,disableFocus:c,closeByEsckey:t},0<a.length&&this.registerTriggers.apply(this,Re(a)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}let t,n;return t=e,n=[{key:"registerTriggers",value:function(){for(let e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];n.forEach((function(t){t.addEventListener("click",(function(){return e.showModal()}))}))}},{key:"showModal",value:function(){this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(D({"is-open":!0})),this.setFocusToFirstNode(),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){let e=this.modal;this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",(function t(){e.classList.remove(D({"is-open":!0})),e.removeEventListener("animationend",t,!1)}),!1):e.classList.remove(D({"is-open":!0}))}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){this.config.closeByEsckey&&27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){let e=this.modal.querySelectorAll(Ne);return Object.keys(e).map((function(t){return e[t]}))}},{key:"setFocusToFirstNode",value:function(){if(!this.config.disableFocus){let e=this.getFocusableNodes();e.length&&e[0].focus()}}},{key:"maintainFocus",value:function(e){let t=this.getFocusableNodes();var n;this.modal.contains(document.activeElement)?(n=t.indexOf(document.activeElement),e.shiftKey&&0===n&&(t[t.length-1].focus(),e.preventDefault()),e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault())):t[0].focus()}}],function(e,t){for(let n=0;n<t.length;n++){let a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(t.prototype,n),e}(),ze=null,Le=function(e){if(!document.getElementById(e))return!1},je=function(e,t){if(e.length<=0&&(console.warn("MicroModal v".concat(version,": ❗Please specify at least one %c'micromodal-trigger'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>')),!t)return!0;for(var n in t)Le(n);return!0},{init:function(e){let t=Object.assign({},{openTrigger:"data-micromodal-trigger"},e),n=Re(document.querySelectorAll("[".concat(t.openTrigger,"]"))),a=function(e,t){let n=[];return e.forEach((function(e){var a=e.attributes[t].value;void 0===n[a]&&(n[a]=[]),n[a].push(e)})),n}(n,t.openTrigger);if(!0!==t.debugMode||!1!==je(n,a))for(var o in a){var i=a[o];t.targetModal=o,t.triggers=Re(i),new ke(t)}},show:function(e,t){let n=t||{};return n.targetModal=e,!0===n.debugMode&&!1===Le(e)?ze=null:(ze=new ke(n)).showModal(),ze},close:function(){ze.closeModal()}});var Fe={defaultControllers:{0:{0:{value:"88",value2:"1"},1:{value:"83",value2:"3"},2:{value:"16",value2:"8"},3:{value:"13",value2:"9"},4:{value:"38",value2:"12"},5:{value:"40",value2:"13"},6:{value:"37",value2:"14"},7:{value:"39",value2:"15"},8:{value:"90",value2:"0"},9:{value:"65",value2:"2"},10:{value:"81",value2:"4"},11:{value:"69",value2:"5"},12:{value:"82",value2:"6"},13:{value:"87",value2:"7"},14:{},15:{},16:{value:"72"},17:{value:"70"},18:{value:"71"},19:{value:"84"},20:{value:"76"},21:{value:"74"},22:{value:"75"},23:{value:"73"},24:{},25:{},26:{}},1:{},2:{},3:{}},controllers:{},virtualGamepadContainer:null,keyMap:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",27:"escape",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"left window key",92:"right window key",93:"select key",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num lock",145:"scroll lock",186:"semi-colon",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash",192:"grave accent",219:"open bracket",220:"back slash",221:"close braket",222:"single quote"},saveLoaddbDB:function(){try{return new ie({dbVersion:1,storePrefix:"ejs-",storeName:"states",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(e){console.log(e)}}(),saveLoadDB:function(e){try{if(!Fe.saveLoaddbDB.db)return!1;if(He&&"function"==typeof He.getCoreOptionsValues){var t=He.getCoreOptionsValues()["save-state-location"];if(!t||"download"===t)return!1;if(!this.getStartName())return!1;var n=He.getCoreOptionsValues()["save-state-slot"],a=this.getStartName();if(!n)return!1;let o=a+"-"+n;return async function(){if("save"===e)try{var t=await Fe.saveState();Fe.saveLoaddbDB.put(o,t)}catch(t){return}else Fe.saveLoaddbDB.get(o,(function(e){EJS_loadState(e)}))}(),!0}return!1}catch(t){return!1}},gamepad:null,allowCheat:!0,connection:null,connected:!1,playerName:"",players:[],waitingList:{},roomMaster:null,inputsData:{},coreOptionData:{},currentFrame:0,wait:!1,progressHelper:{},icons:{lock:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="lock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-lock fa-w-14 fa-3x"><path fill="currentColor" d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z" class=""></path></svg>'},isPaused:null,setVolume:null,setVariable:null,simulateInput:null,simulateInputFn:null,toggleShader:null,saveState:null,screenRecord:null,loadState:null,quickSaveState:null,quickLoadState:null,changeStateSlot:null,getScreenData:null,getStateInfo:null,setCheat:null,resetCheat:null,getGameCoreOptions:null,classNames:{"dialog-container":D({"dialog-container":!0}),tabs:D({tabs:!0}),"dialog-title":D({"dialog-title":!0}),"dialog-content":D({"dialog-content":!0}),"dialog-buttons":D({"dialog-buttons":!0}),overlay:D({overlay:!0}),"key-setting-popup":D({"key-setting-popup":!0}),"tabs-panel":D({"tabs-panel":!0}),"tabs-content":D({"tabs-content":!0}),"button-container":D({"button-container":!0}),set:D({set:!0}),active:D({active:!0}),"btn-cancel":D({"btn-cancel":!0}),"btn-reset":D({"btn-reset":!0}),"btn-clear":D({"btn-clear":!0}),"btn-create":D({"btn-create":!0}),"btn-submit":D({"btn-submit":!0}),"btn-join-room":D({"btn-join-room":!0}),"btn-quit":D({"btn-quit":!0}),"btn-create-room":D({"btn-create-room":!0}),modal:D({modal:!0}),modal__overlay:D({modal__overlay:!0}),modal__container:D({modal__container:!0}),modal__header:D({modal__header:!0}),modal__title:D({modal__title:!0}),modal__close:D({modal__close:!0}),modal__content:D({modal__content:!0}),modal__btn:D({modal__btn:!0}),"modal__btn-primary":D({"modal__btn-primary":!0}),"micromodal-slide":D({"micromodal-slide":!0}),modal__errmsg:D({modal__errmsg:!0}),modal__footer:D({modal__footer:!0}),"cheats-add":D({"cheats-add":!0}),"cheats-list":D({"cheats-list":!0}),"cheat-code-input":D({"cheat-code-input":!0}),"cheat-name-input":D({"cheat-name-input":!0}),"ejs-switch":D({"ejs-switch":!0}),"ejs-delete-cheat":D({"ejs-delete-cheat":!0})},initShaders:function(){for(let e,t=oe,n=Object.keys(t),a=0;a<n.length;a+=1)e=t[n[a]],Ae.FS.writeFile("/shader/".concat(n[a]),e),He.storage.get("shader")===n[a]&&Ae.FS.writeFile("/shader/shader.glslp",e)},setGamepadDialog:function(){let e,t=this,n=(t.elements.dialogs.gamepad.innerHTML='\n        <div class="'+Fe.classNames["dialog-container"]+'">\n            <div class="'+Fe.classNames["dialog-title"]+'">\n                <h4>'+t.localization("Control Settings")+'</h4>\n            </div>\n            \n            <ul class="'+Fe.classNames.tabs+'" id="controls-tabs">\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-0" aria-selected="false" id="controls-0-label">'+t.localization("Player 1")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-1" aria-selected="false" id="controls-1-label">'+t.localization("Player 2")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-2" aria-selected="false" id="controls-2-label">'+t.localization("Player 3")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-3" aria-selected="false" id="controls-3-label">'+t.localization("Player 4")+'</a></li>\n            </ul>\n            <div class="'+Fe.classNames["dialog-content"]+'">\n            <div class="'+Fe.classNames["tabs-content"]+' controls">\n                \n            </div>\n            </div>\n            <div class="'+Fe.classNames["dialog-buttons"]+'">\n                <a href="#" onclick="return false" class="'+Fe.classNames["btn-submit"]+'">'+t.localization("Update")+'</a>\n                <a href="#" onclick="return false" class="'+Fe.classNames["btn-reset"]+'">'+t.localization("Reset")+'</a>\n                <a href="#" onclick="return false" class="'+Fe.classNames["btn-clear"]+'">'+t.localization("Clear")+'</a>\n                <a href="#" onclick="return false" class="'+Fe.classNames["btn-cancel"]+'">'+t.localization("Cancel")+'</a>\n            </div>\n            <div class="'+Fe.classNames.overlay+'" hidden>\n                <div class="'+Fe.classNames["key-setting-popup"]+'">\n                    <span>[Select]</span><br />\n                    <div style="color:#fff !important">'+t.localization("Press keyboard or gamepad")+"</div>\n                </div>\n            </div>\n        </div>\n        ",'\n        <div class="'.concat(Fe.classNames["tabs-panel"],'" id="controls-{index}" hidden>\n            <div>\n                <div style="">\n                    <div class="gamepad" style="font-size:12px">Connected gamepad: <span class="gamepad-name">n/a</span></div>\n                </div>\n                <div style="width:25%;float:left">&nbsp;</div>\n                <div style="font-size:12px;width:50%;float:left">\n                    <div class="row">\n                        <div style="text-align:center;width:50%;float:left">'+t.localization("Gamepad")+'</div>\n                        <div style="text-align:center;width:50%;float:left">'+t.localization("Keyboard")+'</div>\n                    </div>\n                </div>\n                <div style="clear:both"></div>\n            </div>\n        </div>')),a='\n        <div class="'.concat(Fe.classNames["button-container"],'" data-id="{id}" data-index="{index}" data-label="{label}" style="margin-bottom:10px">\n            <div style="width:25%;float:left;font-size:12px">\n                <label>{label}:</label>\n            </div>\n            <div style="width:50%;float:left">\n                <div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="2" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="1" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="clear:both"></div>\n                </div>\n            </div>\n            <div style="width:25%;float:left">\n                <a class="').concat(Fe.classNames.set,'" href="#" onclick="return false">'+t.localization("Set")+'</a>\n            </div>\n            <div style="clear:both"></div>\n        </div>');"nes"===t.system?e={0:"B",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:"snes"===t.system?e={0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:"n64"===t.system?(e={0:"B",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",10:"L",11:"R",12:"Z",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")},2===t.coreVer&&(e[0]="A",e[1]="B",delete e[8])):e="nds"===t.system?{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",14:"Microphone",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")}:{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",12:"L2",13:"R2",14:"L3",15:"R3",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:t.localization("QUICK SAVE STATE"),25:t.localization("QUICK LOAD STATE"),26:t.localization("CHANGE STATE SLOT")},["arcade","mame"].includes(t.system)&&(e[2]=t.localization("INSERT COIN")),!1===t.statesSupported&&(delete e[24],delete e[25],delete e[26]);for(let o=[2,3,4,5,6,7,8,0,9,1,10,11,12,13,14,15,19,18,17,16,23,22,21,20,24,25,26],i=0;i<=3;i+=1)!function(i){t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames["tabs-content"])).innerHTML+=n.replace(/{index}/g,i),o.forEach((function(n){e[n]&&(t.elements.dialogs.gamepad.querySelector("#controls-".concat(i)).innerHTML+=a.replace(/{index}/g,i).replace(/{id}/g,n).replace(/{label}/g,e[n]))})),t.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc"),t.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(i,'"][data-type="2"]'))&&(t.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(i,'"][data-type="2"]')).style.backgroundColor="#ccc")}(i);Object.keys(Fe.controllers).forEach((function(e){Fe.controllers[e]&&Object.keys(Fe.controllers[e]).forEach((function(n){let a=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(n,'"][data-index="').concat(e,'"][data-type="1"]')),o=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(n,'"][data-index="').concat(e,'"][data-type="2"]'));if(!a||!o)return!1;(n=Fe.controllers[e][n])&&(n.type&&1!==parseInt(n.type,10)?o.value="":n.value&&(a.value=Fe.keyMap[n.value]||"",a.setAttribute("data-value",n.value)),n.value2&&(o.value=isNaN(n.value2)?n.value2:"button ".concat(parseInt(n.value2,10)+1),o.setAttribute("data-value",n.value2)))}))})),_.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames["btn-submit"])),"click",(function(e){let n=t.elements.dialogs.gamepad.querySelectorAll("input"),a={};return Array.from(n).forEach((function(e){let t,n=e.getAttribute("data-index"),o=e.getAttribute("data-value");2===parseInt(e.getAttribute("data-type"),10)&&(t=e.getAttribute("data-value")),e=e.getAttribute("data-id"),a[n]||(a[n]={}),a[n][e]||(a[n][e]={}),o&&(a[n][e].value=o),t&&(a[n][e].value2=t)})),He.storage.set({controllers:a}),Fe.controllers=a,A(t.elements.dialogs.gamepad,!0),t.elements.container.focus(),e.stopPropagation(),!1})),_.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames["btn-reset"])),"click",(function(e){Fe.controllers=JSON.parse(JSON.stringify(Fe.defaultControllers)),localStorage.removeItem(He.storage.key);let n=t.elements.dialogs.gamepad.querySelectorAll("input");for(let e=0;e<n.length;e++){var a=n[e].getAttribute("data-index"),o=n[e].getAttribute("data-type"),i=n[e].getAttribute("data-id"),s=1==o?"value":"value2";Fe.defaultControllers[a]&&Fe.defaultControllers[a][i]&&Fe.defaultControllers[a][i][s]?(n[e].value=1==o?Fe.keyMap[Fe.defaultControllers[a][i][s]]:"button "+(parseInt(Fe.defaultControllers[a][i][s])+1),n[e].setAttribute("data-value",Fe.defaultControllers[a][i][s])):(n[e].value="",n[e].setAttribute("data-value",""))}})),_.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames["btn-clear"])),"click",(function(n){let a={0:{},1:{},2:{},3:{}};for(var o in e)a[0][o]={},a[1][o]={},a[2][o]={},a[3][o]={};Fe.controllers=a,localStorage.setItem(He.storage.key,JSON.stringify({controllers:Fe.controllers}));let i=t.elements.dialogs.gamepad.querySelectorAll("input");for(let e=0;e<i.length;e++)i[e].value="",i[e].setAttribute("data-value","")})),_.call(this,t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames["btn-cancel"])),"click",(function(e){return A(t.elements.dialogs.gamepad,!0),t.elements.container.focus(),e.stopPropagation(),!1})),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(Fe.classNames.tabs," li"))).forEach((function(e){_.call(t,e,"mousedown",(function(n){R(t.elements.dialogs.gamepad.querySelectorAll(".".concat(Fe.classNames.tabs," li")),Fe.classNames.active,!1),R(e,Fe.classNames.active,!0);var a=e.querySelector("a").getAttribute("aria-controls");return Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(Fe.classNames["tabs-content"]," .").concat(Fe.classNames["tabs-panel"]))).forEach((function(e){A(e,!0)})),A(t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames["tabs-content"]," #").concat(a)),!1),n.stopPropagation(),!1}))})),x.call(t,t.elements.dialogs.gamepad.querySelector('[aria-controls="controls-0"]').parentNode,"mousedown");let o=t.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames.overlay));_.call(t,o,"mousedown",(function(e){A(o,!0),e.stopPropagation()})),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(Fe.classNames["button-container"]))).forEach((function(e){_.call(t,e,"mousedown",(function(n){x.call(t,e.querySelector("a.".concat(Fe.classNames.set)),n.type,!0,{})}))})),Array.from(t.elements.dialogs.gamepad.querySelectorAll(".".concat(Fe.classNames["tabs-panel"]," a.").concat(Fe.classNames.set))).forEach((function(e){_.call(t,e,"mousedown",(function(n){let a=e.parentNode.parentNode,i=a.getAttribute("data-id"),s=a.getAttribute("data-index"),l=a.getAttribute("data-label"),r=(A(o,!1),o.setAttribute("data-id",i),o.setAttribute("data-index",s),"[ ".concat(l," ]"));Fe.gamepad.gamepads[s]&&i<16?r+='<br /><span style="font-size:12px">Gamepad:'.concat(Fe.gamepad.gamepads[s].id,"</span><br />"+t.localization("Press keyboard or gamepad")+"<br/>"+t.localization("Press escape (esc) to clear")):r+="<br />Press keyboard<br/>"+t.localization("Press escape (esc) to clear"),o.querySelector(".".concat(Fe.classNames["key-setting-popup"])).innerHTML=r,n.stopPropagation()}))}))},setCacheDialog:function(){let e=this;e.elements.dialogs.cache.innerHTML='\n        <div class="'.concat(Fe.classNames["dialog-container"],'">\n            <div class="').concat(Fe.classNames["dialog-title"],'">\n                <h4>'+e.localization("Cache Manager")+'</h4>\n            </div>\n            <div class="').concat(Fe.classNames["dialog-content"],'">\n\n            </div>\n            <div class="').concat(Fe.classNames["dialog-buttons"],'">\n                <a href="#" onclick="return false" class="').concat(Fe.classNames["btn-cancel"],'">'+e.localization("Close")+"</a>\n            </div>\n        </div>\n        "),_.call(this,e.elements.dialogs.cache.querySelector(".".concat(Fe.classNames["btn-cancel"])),"click",(function(t){return A(e.elements.dialogs.cache,!0),e.elements.container.focus(),t.stopPropagation(),!1})),_.call(this,e.elements.dialogs.cache.querySelector(".".concat(Fe.classNames["dialog-title"]," a")),"click",(function(t){return Ae.romdb&&(Ae.romdb.clear(),e.elements.dialogs.cache.querySelector(".".concat(Fe.classNames["dialog-content"])).innerHTML='<div style="text-align:center">'+e.localization("Empty")+"</div>"),t.stopPropagation(),!1}))},showLoading:function(e){De.show("modal-6ed698f3d04061f5",{closeByEsckey:!1}),e&&console.log(""),A(this.elements.dialogs.loading,!1)},hideLoading:function(){De.close(),A(this.elements.dialogs.loading,!0)},setLoadingDialog:function(){this.elements.dialogs.loading&&(this.elements.dialogs.loading.innerHTML='\n            <div class="'.concat(Fe.classNames.modal," ").concat(Fe.classNames["micromodal-slide"],'" id="modal-6ed698f3d04061f5" aria-hidden="true">\n                <div class="').concat(Fe.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(Fe.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-6ed698f3d04061f5-title">\n                '+this.localization("Loading")+"...\n                </div>\n                </div>\n            </div>"))},setCheatDialog:function(){let e=this;if(e.elements.dialogs.cheat){e.elements.dialogs.cheat.innerHTML='\n            <div class="'.concat(Fe.classNames["dialog-container"],'">\n                <div class="').concat(Fe.classNames["dialog-title"],'">\n                    <h4>Cheats</h4>\n                </div>\n                <div class="').concat(Fe.classNames["dialog-content"],'">\n                    <div class="').concat(Fe.classNames["cheats-list"],'">\n                        \n                    </div>\n                </div>\n                <div class="').concat(Fe.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(Fe.classNames["cheats-add"],'">'+e.localization("Add Cheat")+'</a>\n                    <a href="#" onclick="return false" class="').concat(Fe.classNames["btn-submit"],'">'+e.localization("OK")+'</a>\n                    <a href="#" onclick="return false" class="').concat(Fe.classNames["btn-cancel"],'">Close</a>\n                </div>\n            </div>\n\n            \n\n            <div class="').concat(Fe.classNames.modal," ").concat(Fe.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484b" aria-hidden="true">\n                <div class="').concat(Fe.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(Fe.classNames.modal__container,'" style="width:100%" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484b-title">\n                    <div class="').concat(Fe.classNames.modal__header,'">\n                    <h2 class="').concat(Fe.classNames.modal__title,'" id="modal-85cd7a1c543a484b-title">\n                    '+e.localization("Add Cheat Code")+'\n                    </h2>\n                    <button class="').concat(Fe.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(Fe.classNames.modal__content,'" id="modal-85cd7a1c543a484b-content">\n\n                        <div class="').concat(Fe.classNames.modal__errmsg,'"></div>\n                        <strong>'+e.localization("Code")+'</strong><br />\n                        <textarea style="width:100%;height:80px;" class="').concat(Fe.classNames["cheat-code-input"],'"></textarea><br />\n                        <strong>'+e.localization("Description")+'</strong><br />\n                        <input type="text" class="').concat(Fe.classNames["cheat-name-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(Fe.classNames.modal__footer,'">\n                    <button class="').concat(Fe.classNames.modal__btn," ").concat(Fe.classNames["modal__btn-primary"],'">'+e.localization("Submit")+'</button>\n                    <button class="').concat(Fe.classNames.modal__btn,'" data-modal-close aria-label="Close">'+e.localization("Close")+"</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            ");let t=e.elements.dialogs.cheat.querySelector("#modal-85cd7a1c543a484b"),n=(_.call(this,e.elements.dialogs.cheat.querySelector(".".concat(Fe.classNames["cheats-add"])),"click",(function(e){return De.show("modal-85cd7a1c543a484b",{closeTrigger:"data-modal-close"}),!1})),e.elements.dialogs.cheat.querySelector(".".concat(Fe.classNames["cheats-list"]))),a=(_.call(this,t.querySelector(".".concat(Fe.classNames["modal__btn-primary"])),"click",(function(a){var o=t.querySelector(".".concat(Fe.classNames["cheat-name-input"])).value,i=t.querySelector(".".concat(Fe.classNames["cheat-code-input"])).value;if(o&&i){let a=n.querySelectorAll("input:checked");t.querySelector(".".concat(Fe.classNames["cheat-name-input"])).value="",t.querySelector(".".concat(Fe.classNames["cheat-code-input"])).value="",De.close();var s=e.cheats.length;e.cheats.push([o,i]),n.innerHTML+='<div class="'.concat(Fe.classNames["ejs-switch"],'">\n                            <input type="checkbox" value="').concat(s,'" id="ejs-cheat-switch-').concat(s,'">\n                            <label for="ejs-cheat-switch-').concat(s,'">').concat(o,'</label>\n                            <a href="#" data-idx="').concat(s,'" onclick="return false" class="').concat(Fe.classNames["ejs-delete-cheat"],'">&times;</a>\n                        </div>'),a.forEach((function(e,t){n.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")}))}return"localStorage"in window&&e.getStartName()&&(localStorage.setItem("".concat(e.system,"-").concat(e.getStartName(),"-cheats"),JSON.stringify(e.cheats)),a.stopPropagation()),!1})),function(){if("localStorage"in window&&e.getStartName()){let t=localStorage.getItem("".concat(e.system,"-").concat(e.getStartName(),"-cheats"));try{t=JSON.parse(t)}catch(e){}t&&(e.cheats=t)}n.innerHTML="",e.cheats&&Array.isArray(e.cheats)&&e.cheats.forEach((function(e,t){var a=e[0];e[1],n.innerHTML+='<div class="'.concat(Fe.classNames["ejs-switch"],'">\n                                <input type="checkbox" value="').concat(t,'" id="ejs-cheat-switch-').concat(t,'">\n                                <label for="ejs-cheat-switch-').concat(t,'">').concat(a,'</label>\n                                <a href="#" data-idx="').concat(t,'" onclick="return false" class="').concat(Fe.classNames["ejs-delete-cheat"],'">&times;</a>\n                            </div>')}))});_.call(e,n,"click",(function(t){if(t.target&&t.target.classList.contains(Fe.classNames["ejs-delete-cheat"])&&t.target.getAttribute("data-idx")){var o=t.target.getAttribute("data-idx");e.cheats.splice(o,1),"localStorage"in window&&e.getStartName()&&localStorage.setItem("".concat(e.system,"-").concat(e.getStartName(),"-cheats"),JSON.stringify(e.cheats));let i=[];n.querySelectorAll("input").forEach((function(e,t){i[t]=!!n.querySelector("#ejs-cheat-switch-".concat(t,":checked"))})),i.splice(o,1),a(),i.forEach((function(e,t){e&&n.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")}))}return t.stopPropagation(),!1})),_.call(e,e.elements.container,"start-game",(function(e){a()})),_.call(this,e.elements.dialogs.cheat.querySelector(".".concat(Fe.classNames["btn-cancel"])),"click",(function(t){return A(e.elements.dialogs.cheat,!0),t.stopPropagation(),e.elements.container.focus(),!1})),_.call(this,e.elements.dialogs.cheat.querySelector(".".concat(Fe.classNames["btn-submit"])),"click",(function(t){return Fe.resetCheat(),n.querySelectorAll("input:checked").forEach((function(t,n){(t=e.cheats[t.value])&&Fe.setCheat(n,1,t[1])})),A(e.elements.dialogs.cheat,!0),e.elements.container.focus(),!1})),"arcade"!==e.system&&"mame"!==e.system&&"mame2003"!==e.system&&"mame2010"!==e.system||(g.element(e.elements.buttons.cheat)&&A(e.elements.buttons.cheat,!0),Fe.allowCheat=!1),Fe.setCheat||(A(e.elements.buttons.cheat,!0),Fe.allowCheat=!1)}},initKeyboard:function(){let e=this,t=this,n=this.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames.overlay));_.call(this,document.body,"keydown keyup",(function(a){if(!(112<=a.which&&a.which<=123)){let o=!e.elements.dialogs.gamepad.hidden&&!n.hidden,i="keydown"===a.type;if(i&&o){let e=n.getAttribute("data-index"),o=n.getAttribute("data-id"),i=null;if(a.key&&"escape"===Fe.keyMap[a.keyCode])return(i=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(o,'"][data-index="').concat(e,'"][data-type="1"]'))).setAttribute("data-value",""),i.value=""(i=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(o,'"][data-index="').concat(e,'"][data-type="2"]'))).setAttribute("data-value",""),i.value="",void A(n,!0);e=n.getAttribute("data-index"),o=n.getAttribute("data-id"),i=null,a.key&&((i=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(o,'"][data-index="').concat(e,'"][data-type="1"]'))).setAttribute("data-value",a.keyCode),i.value=Fe.keyMap[a.keyCode]),A(n,!0)}else Object.keys(Fe.controllers).forEach((function(e){Object.keys(Fe.controllers[e]).forEach((function(t){parseInt(Fe.controllers[e][t].value,10)===a.keyCode&&["24","25","26"].includes(t)&&"keydown"==a.type&&!a.repeat&&("24"==t?Fe.quickSaveState():"25"==t?Fe.quickLoadState():"26"==t&&Fe.changeStateSlot()),parseInt(Fe.controllers[e][t].value,10)===a.keyCode&&(i?16<=t&&t<=23?Fe.simulateInput(e,t,32767):Fe.simulateInput(e,t,1):Fe.simulateInput(e,t,0))}))}))}})),document.body.addEventListener("keydown",(function(e){var n=e.keyCode||e.which;[32,37,38,39,40,112,113,114,115,116,117,118,119,120,121,122,123].includes(n)&&e.srcElement===t.elements.container&&e.preventDefault(),e.srcElement.className.split(/ +/).includes(Fe.classNames.set)&&e.preventDefault()}))},initGamepad:function(){let e,t=this,n=this,a=this.elements.dialogs.gamepad.querySelector(".".concat(Fe.classNames.overlay));try{e=new te}catch(e){return void console.warn("gamepad not supported")}(Fe.gamepad=e).on("buttondown",(function(e){if(t.elements.dialogs.gamepad.hidden||a.hidden)Object.keys(Fe.controllers[e.gamepadIndex.toString()]).forEach((function(t){var n=e.gamepadIndex.toString();parseInt(Fe.controllers[n][t].value2,10)===parseInt(e.index,10)&&["24","25","26"].includes(t)&&("24"==t?Fe.quickSaveState():"25"==t?Fe.quickLoadState():"26"==t&&Fe.changeStateSlot()),parseInt(Fe.controllers[n][t].value2,10)===parseInt(e.index,10)&&parseInt(n,10)===parseInt(e.gamepadIndex,10)&&Fe.simulateInput(n,t,1)}));else{var o=parseInt(a.getAttribute("data-index"),10),i=a.getAttribute("data-id");if(e.gamepadIndex===parseInt(o,10)){let t=null;(t=n.elements.dialogs.gamepad.querySelector('[data-id="'.concat(i,'"][data-index="').concat(o,'"][data-type="2"]'))).setAttribute("data-value",e.index),t.value="button ".concat(e.index+1),A(a,!0)}}})),e.on("buttonup",(function(e){Object.keys(Fe.controllers).forEach((function(t){Object.keys(Fe.controllers[t]).forEach((function(n){parseInt(Fe.controllers[t][n].value2,10)===parseInt(e.index,10)&&parseInt(t,10)===parseInt(e.gamepadIndex,10)&&Fe.simulateInput(t,n,0)}))}))})),e.on("axischanged",(function(e){var n=.5<(s=e.value)||s<-.5?0<s?1:-1:0;if(t.elements.dialogs.gamepad.hidden||a.hidden){Fe.prevButtons||(Fe.prevButtons={});let s=!1;var o=e.gamepadIndex.toString();Fe.prevButtons[o]||(Fe.prevButtons[o]={}),Fe.prevButtons[o][e.axis]||(Fe.prevButtons[o][e.axis]=0),Fe.prevButtons[o].buttonID||(Fe.prevButtons[o].buttonID=0);for(let t=0;t<Object.keys(Fe.controllers[o]).length;t++){var i=Object.keys(Fe.controllers[o])[t];Fe.controllers[o][i].value2&&(Fe.controllers[o][i].value2.split(":")[0]===e.axis&&parseInt(Fe.controllers[o][i].value2.split(":")[1])===n&&["24","25","26"].includes(i)&&("24"==i?(s=!0,Fe.quickSaveState()):"25"==i?(s=!0,Fe.quickLoadState()):"26"==i&&Fe.changeStateSlot()),0==n?Fe.controllers[o][i].value2.split(":")[0]===e.axis&&(Fe.prevButtons[o][e.axis]=n,Fe.prevButtons[o].buttonID=i,Fe.simulateInput(o,i,0)):((1===Fe.prevButtons[o][e.axis]&&-1==n||-1===Fe.prevButtons[o][e.axis]&&1==n)&&Fe.simulateInput(o,Fe.prevButtons[o].buttonID,0),Fe.controllers[o][i].value2.split(":")[0]===e.axis&&parseInt(Fe.controllers[o][i].value2.split(":")[1])===n&&(Fe.prevButtons[o][e.axis]=n,Fe.prevButtons[o].buttonID=i,s=!0,Fe.simulateInput(o,i,1))))}if(s)return;if(!t.elements.dialogs.gamepad.hidden&&!a.hidden)return}else if(0!=n){var s=a.getAttribute("data-id"),l=parseInt(a.getAttribute("data-index"),10);let o=t.elements.dialogs.gamepad.querySelector('[data-id="'.concat(s,'"][data-index="').concat(l,'"][data-type="2"]'));o.setAttribute("data-value",e.axis+":"+n),o.value=e.axis+":"+n,A(a,!0)}Math.abs(e.value)<=.1&&(e.value=0),s=e.gamepadIndex,t.coreVer,"LEFT_STICK_X"===e.axis?0<e.value?(Fe.simulateInput(s,16,32767*e.value),Fe.simulateInput(s,17,0)):(Fe.simulateInput(s,17,-32767*e.value),Fe.simulateInput(s,16,0)):"LEFT_STICK_Y"===e.axis?0<e.value?(Fe.simulateInput(s,18,32767*e.value),Fe.simulateInput(s,19,0)):(Fe.simulateInput(s,19,-32767*e.value),Fe.simulateInput(s,18,0)):"RIGHT_STICK_X"===e.axis?0<e.value?(Fe.simulateInput(s,20,32767*e.value),Fe.simulateInput(s,21,0)):(Fe.simulateInput(s,21,-32767*e.value),Fe.simulateInput(s,20,0)):"RIGHT_STICK_Y"===e.axis&&(0<e.value?(Fe.simulateInput(s,22,32767*e.value),Fe.simulateInput(s,23,0)):(Fe.simulateInput(s,23,32767*e.value),Fe.simulateInput(s,22,0)))})),e.on("disconnected",(function(t){[0,1,2,3].forEach((function(t){var a=e.gamepads[t];n.elements.dialogs.gamepad.querySelector("#controls-".concat(t," .gamepad-name")).innerHTML=a?a.id:"n/a"}))})),e.on("connected",(function(t){Object.keys(e.gamepads).forEach((function(t){var a=e.gamepads[t];n.elements.dialogs.gamepad.querySelector("#controls-".concat(t," .gamepad-name")).innerHTML=a?a.id:"n/a"}))}))},setShader:function(e){try{"disabled"===e?(Ae.FS.unlink("/shader/shader.glslp",""),Fe.toggleShader&&Fe.toggleShader(0)):(Fe.toggleShader&&Fe.toggleShader(0),e="/shader/".concat(e),Ae.FS.writeFile("/shader/shader.glslp",Ae.FS.readFile(e)),Fe.toggleShader&&Fe.toggleShader(1))}catch{}},toggleVirtualGamepad:function(e){let t=this;if(null!==Fe.virtualGamepadContainer)A(Fe.virtualGamepadContainer,!e);else{Fe.virtualGamepadContainer=P("div",{class:D({"ejs-virtual-gamepad":!0}),hidden:""}),this.elements.container.appendChild(Fe.virtualGamepadContainer);var n="height:31px;text-align:center;border:1px solid #ccc;border-radius:5px;line-height:31px;";let a,o="";t.config.VirtualGamepadSettings&&function(e){if(Array.isArray(e)){if(e.length){for(let t=0;t<e.length;t++)if("zone"!==e[t].type){if(!e[t].location)return void console.warn("Missing location value for button "+e[t].text+"! Using default gamepad settings");if(!e[t].type)return void console.warn("Missing type value for button "+e[t].text+"! Using default gamepad settings");if(!e[t].id.toString())return void console.warn("Missing id value for button "+e[t].text+"! Using default gamepad settings");if(!e[t].input_value.toString())return void console.warn("Missing input_value for button "+e[t].text+"! Using default gamepad settings")}return 1}console.warn("Vritual gamepad settings is empty! Using default gamepad settings")}else console.warn("Vritual gamepad settings is not array! Using default gamepad settings")}(t.config.VirtualGamepadSettings)?a=t.config.VirtualGamepadSettings:["gba","gb","vb","nes"].includes(t.system)?(a=[{type:"button",text:"B",id:"b",location:"right",left:-10,top:70,input_value:0},{type:"button",text:"A",id:"a",location:"right",left:60,top:70,input_value:8},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:60,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,input_value:2}],"gba"===t.system&&(a.push({type:"button",text:"L",id:"l",block:!0,location:"top",left:10,top:-40,input_value:10}),a.push({type:"button",text:"R",id:"r",block:!0,location:"top",right:10,top:-40,input_value:11}))):a="n64"===t.system?[{type:"button",text:"B",id:"b",location:"right",left:-10,top:95,input_value:0,input_new_cores:1},{type:"button",text:"A",id:"a",location:"right",left:40,top:150,input_value:8,input_new_cores:0},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:30,top:-10,input_value:3},{type:"button",text:"L",id:"l",block:!0,location:"top",left:10,top:-40,input_value:10},{type:"button",text:"R",id:"r",block:!0,location:"top",right:10,top:-40,input_value:11},{type:"button",text:"Z",id:"z",block:!0,location:"top",left:10,input_value:12},{type:"button",text:"",id:"cu",location:"right",left:25,top:-65,input_value:23},{type:"button",text:"",id:"cd",location:"right",left:25,top:15,input_value:22},{type:"button",text:"",id:"cl",location:"right",left:-15,top:-25,input_value:21},{type:"button",text:"",id:"cr",location:"right",left:65,top:-25,input_value:20}]:["snes","nds"].includes(t.system)?[{type:"button",text:"X",id:"x",location:"right",left:40,input_value:9},{type:"button",text:"Y",id:"y",location:"right",top:40,input_value:1},{type:"button",text:"A",id:"a",location:"right",left:81,top:40,input_value:8},{type:"button",text:"B",id:"b",location:"right",left:40,top:80,input_value:0},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:60,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,input_value:2}]:[{type:"button",text:"Y",id:"y",location:"right",left:40,input_value:9},{type:"button",text:"X",id:"X",location:"right",top:40,input_value:1},{type:"button",text:"B",id:"b",location:"right",left:81,top:40,input_value:8},{type:"button",text:"A",id:"a",location:"right",left:40,top:80,input_value:0},{type:"zone",location:"left",left:"50%",top:"50%"},{type:"button",text:"Start",id:"start",location:"center",left:60,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,input_value:2}],o=(o+='<div class="'+D({"virtual-gamepad":!0})+'" style="display: block;">')+'<div class="'+D({top:!0})+'">';for(let u=0;u<a.length;u++)if("top"===a[u].location&&"button"===a[u].type){let f={buttons:!0},p=(f["b_"+a[u].id.toLowerCase()]=!0,"");a[u].left&&(p+="left:"+a[u].left+"px;"),a[u].right&&(p+="right:"+a[u].right+"px;"),a[u].top&&(p+="top:"+a[u].top+"px;"),a[u].block&&(p+=n),o+='<div class="'+D(f)+'" style="'+p+'">'+a[u].text+"</div>"}o=(o+="</div>")+'<div class="'+D({left:!0})+'">';for(let m=0;m<a.length;m++)if("left"===a[m].location&&"button"===a[m].type){let h={buttons:!0},g=(h["b_"+a[m].id.toLowerCase()]=!0,"");a[m].left&&(g+="left:"+a[m].left+"px;"),a[m].right&&(g+="right:"+a[m].right+"px;"),a[m].top&&(g+="top:"+a[m].top+"px;"),a[m].block&&(g+=n),o+='<div class="'+D(h)+'" style="'+g+'">'+a[m].text+"</div>"}o=(o+="</div>")+'<div class="'+D({center:!0})+'">';for(let v=0;v<a.length;v++)if("center"===a[v].location&&"button"===a[v].type){let y={buttons:!0},b=(y["b_"+a[v].id.toLowerCase()]=!0,"");a[v].left&&(b+="left:"+a[v].left+"px;"),a[v].right&&(b+="right:"+a[v].right+"px;"),a[v].top&&(b+="top:"+a[v].top+"px;"),a[v].block&&(b+=n),o+='<div class="'+D(y)+'" style="'+b+'">'+a[v].text+"</div>"}o=(o+="</div>")+'<div class="'+D({right:!0})+'">';for(let T=0;T<a.length;T++)if("right"===a[T].location&&"button"===a[T].type){let x={buttons:!0},w=(x["b_"+a[T].id.toLowerCase()]=!0,"");a[T].left&&(w+="left:"+a[T].left+"px;"),a[T].right&&(w+="right:"+a[T].right+"px;"),a[T].top&&(w+="top:"+a[T].top+"px;"),a[T].block&&(w+=n),o+='<div class="'+D(x)+'" style="'+w+'">'+a[T].text+"</div>"}o+="</div></div>",Fe.virtualGamepadContainer.innerHTML=o,A(Fe.virtualGamepadContainer,!e);let i,s=D({"virtual-gamepad":!0}),l=D({touch:!0});q.isIos||_.call(this,L.call(this,".".concat(s)),"touchmove",(function(e){e.stopPropagation()}));for(let S=0;S<a.length;S++)if("zone"===a[S].type){i=a[S];break}if(i){let E={},M=(E[i.location.toLowerCase()]=!0,ae.a.create({zone:L.call(this,".".concat(D({"ejs-virtual-gamepad":!0})," .").concat(D(E))),mode:"static",position:{left:i.left,top:i.top},color:"red"}));function C(){if("n64"!==t.system)return{downVal:1,4:4,5:5,6:6,7:7};{let e;return"d-pad"===(e=He&&"function"==typeof He.getCoreOptionsValues?He.getCoreOptionsValues()["joystick-input"]:e)?{downVal:1,4:4,5:5,6:6,7:7}:{downVal:32767,4:19,5:18,6:17,7:16}}}M.on("end",(function(e,t){Fe.syncInput(0,C()[4],0),Fe.syncInput(0,C()[5],0),Fe.syncInput(0,C()[6],0),Fe.syncInput(0,C()[7],0)})),M.on("move",(function(e,t){30<=(t=t.angle.degree)&&t<150?Fe.syncInput(0,C()[4],C().downVal):window.setTimeout((function(){Fe.syncInput(0,C()[4],0)}),30),210<=t&&t<330?Fe.syncInput(0,C()[5],C().downVal):window.setTimeout((function(){Fe.syncInput(0,C()[5],0)}),30),120<=t&&t<240?Fe.syncInput(0,C()[6],C().downVal):window.setTimeout((function(){Fe.syncInput(0,C()[6],0)}),30),300<=t||0<=t&&t<60?Fe.syncInput(0,C()[7],C().downVal):window.setTimeout((function(){Fe.syncInput(0,C()[7],0)}),30)}))}let r=[];for(let I=0;I<a.length;I++)if("zone"!==a[I].type){let O,N={};N["b_"+a[I].id.toLowerCase()]=!0,O=2===t.newCores&&a[I].input_new_cores?a[I].input_new_cores:a[I].input_value,r.push({id:N,number:O})}r.forEach((e=>{var n=L.call(t,".".concat(s," .").concat(D(e.id)));n&&_.call(t,n,"touchstart touchend",(function(t){"touchend"===t.type?(R(t.target,l,!1),window.setTimeout((function(){Fe.syncInput(0,e.number,0)}),30)):(R(t.target,l,!0),Fe.syncInput(0,e.number,1)),t.stopPropagation()}))}));let c,d=P("div",{class:D({ejs__widget:!0,ejs__widget_controls_toggle:!0})},"");d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>',L.call(this,".".concat(D({ejs__widgets:!0}))).appendChild(d),_.call(this,d,"mousedown touchstart",(function(e){R(e.target,l,!0),clearTimeout(c),le.toggleControls.call(t,!0),c=setTimeout((function(){le.toggleControls.call(t,!1)}),5e3)}))}},setup:function(){let e=this;if(this.game){var t;if(Fe.playerName=e.config.playerName,R(this.elements.container,this.config.classNames.type,!0),this.elements.container.setAttribute("tabindex","0"),!this.color||(t=function(e){let t=e.toLowerCase();if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(let e="#",n=1;n<4;n+=1)e+=t.slice(n,n+1).concat(t.slice(n,n+1));t=n}for(let e=[],n=1;n<7;n+=2)e.push(parseInt("0x".concat(t.slice(n,n+2)),16));return _0x5ac4ff}return null}(this.color))&&this.elements.container.setAttribute("style","--ejs-primary-color: ".concat(t[0],", ").concat(t[1],", ").concat(t[2])),this.elements.wrapper=P("div",{class:this.config.classNames.video}),M(this.game,this.elements.wrapper),"video"!==e.game.tagName.toLocaleLowerCase()){let t=this.config.volume,n=(Object.defineProperty(e.game,"volume",{get:function(){return t},set:function(n){t=n,x.call(e,e.game,"volumechange")}}),e.storage.get("muted"));Object.defineProperty(e.game,"muted",{get:function(){return n},set:function(t){t=!!g.boolean(t)&&t,n=t,x.call(e,e.game,"volumechange")}})}window.saveSaveFiles=function(){e.getStartName()&&(console.log("saving save files"),Fe.saveSavFiles(),Ae.FS.syncfs(!1,(function(){})))}}else console.warn("No game element found!")},listeners:function(){let e=this;e.elements.buttons.restart&&_.call(e,e.elements.buttons.restart,"click",(function(e){Fe.restartGame(),Fe.inputsData={},saveSaveFiles()})),e.elements.buttons.screenRecord&&_.call(e,e.elements.buttons.screenRecord,"click",(function(t){if(e.recordData||(e.recordData={started:!1,data:[],stopped:!1}),e.recordData.started)e.recordData.started&&(e.recordData.recorder.stop(),e.recordData.stopped=!0);else{let t;t=MediaRecorder.isTypeSupported("video/webm; codecs=h264")?{mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/webm; codecs=H264")?{mimeType:"video/webm; codecs=H264"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?{mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8")?{mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm; codecs=avc1")?{mimeType:"video/webm; codecs=avc1"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9.0")?{mimeType:"video/webm; codecs=vp9.0"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8.0")?{mimeType:"video/webm; codecs=vp8.0"}:{},Ae.Module.pauseMainLoop(),e.playing=!1,alert('please check "share system audio" to have audio in the recording. We only need the audio stream so your entire screen will not be recorded');let n=Ae.Module.canvas.captureStream(30),a=setTimeout((function(){e.playing=!0,Ae.Module.resumeMainLoop()}),2e4);navigator.mediaDevices.getDisplayMedia({audio:!0,video:{mediaSource:"screen"}}).then((function(o){try{clearTimeout(a)}catch(o){}var i=o.getAudioTracks();for(let e=0;e<i.length;e++)n.addTrack(i[e]);o=n,e.elements.buttons.screenRecord.querySelector(".".concat(D({ejs__tooltip:!0}))).innerHTML=e.localization("Stop Screen Recording"),e.recordData.stream=o,e.recordData.recorder=new MediaRecorder(e.recordData.stream,t),e.recordData.recorder.ondataavailable=function(t){if(0<t.data.size&&e.recordData.data.push(t.data),e.recordData.stopped){let t,n=document.createElement("a");n.href=window.URL.createObjectURL(new Blob(e.recordData.data,{type:"video/webm"})),"string"==typeof e.gameName&&(t=e.gameName),n.download=t?"".concat(t,"-recording.webm"):"record.webm",n.click(),window.URL.revokeObjectURL(n.href),delete e.recordData,e.elements.buttons.screenRecord.querySelector(".".concat(D({ejs__tooltip:!0}))).innerHTML=e.localization("Start Screen Recording")}},e.recordData.recorder.start(),e.recordData.started=!0,e.playing=!0,Ae.Module.resumeMainLoop()}))}})),e.elements.buttons.play&&Array.from(e.elements.buttons.play).forEach((function(t){_.call(e,t,"click",(function(t){e.playing?(e.playing=!1,Ae.Module.pauseMainLoop(),x.call(e,e.elements.container,"pause",!1,{pause:!0})):(e.playing=!0,Ae.Module.resumeMainLoop(),x.call(e,e.elements.container,"pause",!1,{pause:!1}))}))})),e.elements.buttons.cheat&&_.call(e,e.elements.buttons.cheat,"click",(function(t){A(e.elements.dialogs.cheat,!1)})),e.game.stateloadField=P("input"),e.game.stateloadField.type="file",e.game.stateloadField.onchange=function t(n){let a,o=n.target.files;0<o.length&&((a=new FileReader).file_name=o[0].name,a.onload=function(){EJS_loadState(new Uint8Array(a.result))},a.readAsArrayBuffer(o[0])),e.game.stateloadField=P("input"),e.game.stateloadField.type="file",e.game.stateloadField.onchange=t},_.call(e,e.elements.container,"loadstate",(function(t){Fe.saveLoadDB.call(e,"load")||(g.function(e.config.onloadstate)?e.config.onloadstate.call(null,e.loadState):e.game.stateloadField.click(),e.elements.container.focus())})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?console.log("hidden"):console.log("active")}))},bindFunction:function(){let e=this,t=e.system;if(Ae.Module&&Ae.Module._set_volume){let t=Ae.Module.cwrap("set_volume","null",["number"]);Fe.setVolume=function(){let n=0;e.volume<1&&(n=0===e.volume?-80:30*e.volume-30,t(n)),e.muted&&(n=-80),t(n)}}Fe.setVariable=Ae.Module.cwrap("set_variable","null",["string","string"]),Fe.simulateInputFn=Ae.Module.cwrap("simulate_input","null",["number","number","number"]),Fe.simulateInput=function(e,t,n){Fe.simulateInputFn(e,t,n)},Fe.syncInput=Fe.simulateInput,window.simulateInput=Fe.simulateInput;let n=Ae.Module.cwrap("shader_enable","null",["number"]),a=(Fe.toggleShader=function(e){return n(e)},2!==e.coreVer?Fe.getStateInfo=Ae.Module.cwrap("get_state_info","string",[]):(Fe.getInfoOfState=Ae.Module.cwrap("get_state_info","string",[]),Fe.getStateInfo1=Ae.Module.cwrap("save_state_info","null",[]),Fe.getStateInfo=function(){return Fe.getStateInfo1(),new Promise((function(e,t){let n=Fe.getInfoOfState();if(n)e(n);else{let t=setInterval((function(){(n=Fe.getInfoOfState())&&(clearInterval(t),e(n))}),50)}}))}),Fe.saveState=async function(){let t,n;var a=(n=(2!==e.coreVer?Fe.getStateInfo():await Fe.getStateInfo()).split("|"))[0]>>0;if(0<a){t=new Uint8Array(a);for(let e=n[1]>>0,o=0;o<a;o++)t[o]=Ae.Module.getValue(e+o)}return t},Ae.Module.cwrap("load_state","number",["string","number"])),o=(Fe.loadState=function(n,o){try{Ae.FS.unlink("game.state")}catch(n){}Ae.FS.createDataFile("/","game.state",n,!0,!0),null===o&&(o=0),"arcade"===t?setTimeout((function(){Fe.getStateInfo(),a("game.state",o),Ae.FS.unlink("game.state")}),10):(a("game.state",o),setTimeout((function(){Ae.FS.unlink("game.state")}),100)),e.elements.container.focus()},Ae.Module._set_cheat&&(Fe.setCheat=Ae.Module.cwrap("set_cheat","number",["number","number","string"])),Ae.Module._reset_cheat&&(Fe.resetCheat=Ae.Module._reset_cheat),Fe.quickSaveState=async function(){if(e.started){if(!1===e.statesSupported)return e.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY SAVE STATE",clearTimeout(Fe.saveMsgTransitions),void(Fe.saveMsgTransitions=setTimeout((function(){e.elements.widgets.stateInfoDiv.innerHTML=""}),1500));let a;var t=(a=He&&"function"==typeof He.getCoreOptionsValues&&(a=He.getCoreOptionsValues()["save-state-slot"])||1)+"-quick.state";try{Ae.FS.unlink(t)}catch(t){}try{var n=await Fe.saveState();Ae.FS.createDataFile("/",t,n,!0,!0),e.elements.widgets.stateInfoDiv.innerHTML="STATE SAVED TO SLOT "+a,clearTimeout(Fe.saveMsgTransitions),Fe.saveMsgTransitions=setTimeout((function(){e.elements.widgets.stateInfoDiv.innerHTML=""}),1500)}catch(t){console.warn(t),e.elements.widgets.stateInfoDiv.innerHTML="FAILED TO SAVE STATE TO SLOT "+a,clearTimeout(Fe.saveMsgTransitions),Fe.saveMsgTransitions=setTimeout((function(){e.elements.widgets.stateInfoDiv.innerHTML=""}),1500)}saveSaveFiles()}},Fe.saveMsgTransitions=null,Fe.quickLoadState=function(){if(e.started){if(!1===e.statesSupported)return e.elements.widgets.stateInfoDiv.innerHTML="CANNOT CURRENTLY LOAD STATE",clearTimeout(Fe.saveMsgTransitions),void(Fe.saveMsgTransitions=setTimeout((function(){e.elements.widgets.stateInfoDiv.innerHTML=""}),1500));let n,o=(n=He&&"function"==typeof He.getCoreOptionsValues&&(n=He.getCoreOptionsValues()["save-state-slot"])||1)+"-quick.state",i=!0;try{a(o,0),"arcade"===t&&setTimeout((function(){Fe.getStateInfo(),a(o,0)}),10)}catch(e){i=!1}e.elements.widgets.stateInfoDiv.innerHTML=i?"LOADED STATE FROM SLOT "+n:"FAILED TO LOAD STATE FROM SLOT "+n,clearTimeout(Fe.saveMsgTransitions),Fe.saveMsgTransitions=setTimeout((function(){e.elements.widgets.stateInfoDiv.innerHTML=""}),1500),saveSaveFiles()}},Fe.changeStateSlot=function(t){let n;He&&"function"==typeof He.getCoreOptionsValues&&He.getCoreOptionsValues()["save-state-slot"],9<(n="number"!=typeof t?slot+1:t)&&(n=1),Be.updateCoreOptions.call(e,"save-state-slot",n),e.elements.widgets.stateInfoDiv.innerHTML="SET SAVE STATE SLOT TO "+n,clearTimeout(Fe.saveMsgTransitions),Fe.saveMsgTransitions=setTimeout((function(){e.elements.widgets.stateInfoDiv.innerHTML=""}),1500)},window.EJS_loadState=function(e){Fe.loadState(e,0)},Ae.Module.cwrap("cmd_take_screenshot","",[]));Fe.getScreenData=function(){return o(),Ae.FS.readFile("screenshot.png")},Fe.restartGame=Ae.Module.cwrap("system_restart","",[]),Fe.saveSavFiles=Ae.Module.cwrap("cmd_savefiles","",[]),Ae.Module._get_core_options&&(Fe.getGameCoreOptions=Ae.Module.cwrap("get_core_options","string",[])),Fe.controllers=He.storage.get("controllers"),Fe.controllers||(Fe.controllers=JSON.parse(JSON.stringify(Fe.defaultControllers)))}};let Ge=Fe;var Ve,Ue,Be={storage:null,coreOptionsValues:{},contextMenu:null,normalOptions:{shader:{label:"Shader",options:{disabled:"Disabled","2xScaleHQ.glslp":"2xScaleHQ","4xScaleHQ.glslp":"4xScaleHQ","crt-easymode.glslp":"CRT easymode","crt-aperture.glslp":"CRT aperture","crt-geom.glslp":"CRT geom"},default:"disabled"},"virtual-gamepad":{label:"Virtual Gamepad",options:{disabled:"Disabled",enabled:"Enabled"},default:"enabled"}},defaultCoreOptionsValues:function(){let e={};switch(this.system){case"pce":e={pce_nospritelimit:"enabled"};break;case"jaguar":e={virtualjaguar_doom_res_hack:"enabled"};break;case"psx":e={pcsx_rearmed_memcard2:"enabled"};break;case"nds":e={}}return e},getCoreOptionsValues:function(){let e=Be.storage.get("core-options");return g.empty(e)?{}:e},getCoreOptions:function(){let e={};switch(this.system){case"nes":e.fceumm_palette={label:this.localization("Color Palette"),options:{default:this.localization("Default"),asqrealc:"asqrealc","nintendo-vc":"nintendo-vc",rgb:"rgb","yuv-v3":"yuv-v3","unsaturated-final":"unsaturated-final","sony-cxa2025as-us":"sony-cxa2025as-us",pal:"pal","bmf-final2":"bmf-final2","bmf-final3":"bmf-final3","smooth-fbx":"smooth-fbx","composite-direct-fbx":"composite-direct-fbx","pvm-style-d93-fbx":"pvm-style-d93-fbx",nescap:"nescap","ntsc-hardware-fbx":"ntsc-hardware-fbx","nes-classic-fbx-fs":"nes-classic-fbx-fs",wavebeam:"wavebeam"},default:"default"},e.fceumm_nospritelimit={label:this.localization("No Sprite Limit"),options:{enabled:this.localization("Enabled"),disabled:this.localization("Disabled")},default:"disabled"},e.fceumm_sndquality={label:this.localization("Sound Quality"),options:{Low:this.localization("Low"),High:this.localization("High"),"Very High":this.localization("Very High")},default:"Low"},this.lightgun||(e.system_type={label:this.localization("4 Players Support"),options:{nes:"NES",famicom:"Famicom"},default:"nes",netplay:!0}),e.fceumm_turbo_enable={label:this.localization("Turbo Enable"),options:{None:this.localization("None"),"Player 1":this.localization("Player 1"),"Player 2":this.localization("Player 2"),Both:this.localization("Both")},default:"None",netplay:!0},e.fceumm_region={label:this.localization("Region"),options:{Auto:this.localization("Auto"),NTSC:"NTSC",PAL:"PAL",Dendy:"Dendy"},default:"Auto",netplay:!0};break;case"snes":e={snes9x_next_overclock:{label:this.localization("SuperFX Overclock"),options:{disabled:this.localization("Disabled")+"(10MHz)","40MHz":"40MHz","60MHz":"60MHz","80MHz":"80MHz","100MHz":"100MHz"},default:"disabled",netplay:!0}};break;case"snes2002":case"snes2005":case"snes2010":case"vb":case"pce":case"ws":case"ngp":default:e={};break;case"gb":e={gambatte_gb_colorization:{label:this.localization("GB Colorization"),options:{disabled:this.localization("Disabled"),auto:this.localization("auto"),internal:this.localization("internal")},default:"disabled"},gambatte_gb_internal_palette:{label:this.localization("Internal Palette"),options:{"GBC - Blue":this.localization("GBC - Blue"),"GBC - Brown":this.localization("GBC - Brown"),"GBC - Dark Blue":this.localization("GBC - Dark Blue"),"GBC - Dark Brown":this.localization("GBC - Dark Brown"),"GBC - Dark Green":this.localization("GBC - Dark Green"),"GBC - Grayscale":this.localization("GBC - Grayscale"),"GBC - Green":this.localization("GBC - Green"),"GBC - Inverted":this.localization("GBC - Inverted"),"GBC - Orange":this.localization("GBC - Orange"),"GBC - Pastel Mix":this.localization("GBC - Pastel Mix"),"GBC - Red":this.localization("GBC - Red"),"GBC - Yellow":this.localization("GBC - Yellow")},default:"GBC - Blue"}};break;case"gba":e={mgba_solar_sensor_level:{label:this.localization("Solar sensor level"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"},mgba_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"}};break;case"vbanext":e={vbanext_turboenable:{label:this.localization("Enable Turbo Buttons"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},vbanext_turbodelay:{label:this.localization("Turbo Delay in frames"),options:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],default:"2"}};break;case"n64":e={"glupen64-aspect":{label:this.localization("Aspect Ratio (Need to refresh page)"),options:["4:3","16:9"],default:"4:3"},"glupen64-43screensize":{label:this.localization("4:3 Resolution"),options:["320x240","640x480","960x720","1280x960"],default:"320x240"},"glupen64-169screensize":{label:this.localization("16:9 Resolution"),options:["640x360","960x540","1280x720"],default:"640x360"},"glupen64-pak1":{label:this.localization("Player 1 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak2":{label:this.localization("Player 2 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak3":{label:this.localization("Player 3 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0},"glupen64-pak4":{label:this.localization("Player 4 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none",netplay:!0}},!Ge||"undefined"==Ge.virtualGamepadContainer&&null===Ge.virtualGamepadContainer||(e["joystick-input"]={label:this.localization("Joystick input keys"),options:{"d-pad":this.localization("d-pad"),"analog-stick":this.localization("Analog Stick")},default:"analog-stick",netplay:!0});break;case"nds":e={desmume_screens_layout:{label:this.localization("Screen layout"),options:{"top/bottom":this.localization("top/bottom"),"bottom/top":this.localization("bottom/top"),"left/right":this.localization("left/right"),"right/left":this.localization("right/left"),"top only":this.localization("top only"),"bottom only":this.localization("bottom only"),"quick switch":this.localization("quick switch"),"hybrid/top":this.localization("hybrid/top"),"hybrid/bottom":this.localization("hybrid/bottom")},default:"top/bottom"},screen_rotation:{label:this.localization("Screen Rotation"),options:{0:"0°",90:"90°",180:"180°",270:"270°"},default:0},desmume_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9"],default:"0"}},X.wasm||delete e.screen_rotation;break;case"segaMS":case"segaGG":case"segaMD":case"segaCD":e={genesis_plus_gx_no_sprite_limit:{label:this.localization("No Sprite Limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},genesis_plus_gx_overclock:{label:this.localization("CPU speed"),options:["100%","125%","150%","175%","200%"],default:"100%",netplay:!0},genesis_plus_gx_sound_output:{label:this.localization("Sound output"),options:{stereo:this.localization("stereo"),mono:this.localization("mono")},default:"stereo"}};break;case"sega32x":e={picodrive_sprlim:{label:this.localization("No sprite limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"segaSaturn":e={yabause_frameskip:{label:this.localization("Frameskip"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"msx":e={bluemsx_nospritelimits:{label:this.localization("No Sprite Limit"),options:{OFF:this.localization("OFF"),ON:this.localization("ON")},default:"OFF"}};break;case"jaguar":e={virtualjaguar_usefastblitter:{label:this.localization("Fast Blitter"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},virtualjaguar_bios:{label:this.localization("Bios"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"psx":e={pcsx_rearmed_frameskip:{label:this.localization("Frameskip"),options:[0,1,2,3],default:0,netplay:!0},pcsx_rearmed_memcard2:{label:this.localization("Enable second memory card"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_pad1type:{label:this.localization("Pad 1 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad2type:{label:this.localization("Pad 2 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad3type:{label:this.localization("Pad 3 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_pad4type:{label:this.localization("Pad 4 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default",netplay:!0},pcsx_rearmed_vibration:{label:this.localization("Enable Vibration"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled",netplay:!0},pcsx_rearmed_neon_interlace_enable:{label:this.localization("Enable interlacing mode(s)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_enable:{label:this.localization("Enhanced resolution (slow)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0},pcsx_rearmed_neon_enhancement_no_main:{label:this.localization("Enhanced resolution speed hack"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled",netplay:!0}};break;case"arcade":case"fba0.2.97.29":e={"fba-aspect":{label:this.localization("Aspect ratio"),options:["DAR","PAR"],default:"DAR"},"fba-frameskip":{label:this.localization("Frameskip"),options:["0","1","2","3","4","5"],default:"0",netplay:!0},"fba-cpu-speed-adjust":{label:this.localization("CPU overclock"),options:["100","110","120","130","140","150","160","170","180","190","200"],default:"100",netplay:!0},"fba-diagnostic-input":{label:this.localization("Diagnostic Input"),options:["None","Hold Start","Start + A + B","Hold Start + A + B","Start + L + R","Hold Start + L + R","Hold Select","Select + A + B","Hold Select + A + B","Select + L + R","Hold Select + L + R"],default:"None",netplay:!0},"fba-neogeo-mode":{label:this.localization("Force Neo Geo mode"),options:["MVS","AES","UNIBIOS","DIPSWITCH"],default:"MVS",netplay:!0}}}2===this.coreVer&&((e={}).fps={label:this.localization("FPS"),options:["show","hide"],default:"hide"}),!0===this.statesSupported&&(e["save-state-slot"]={label:this.localization("Save State Slot"),options:[1,2,3,4,5,6,7,8,9],default:1}),!0===this.statesSupported&&window.indexedDB&&this.getStartName()&&(e["save-state-location"]={label:this.localization("Save State Location"),options:{download:this.localization("download"),"keep in browser":this.localization("keep in browser")},default:"download"});let t=this;return Ge.getGameCoreOptions&&Ge.getGameCoreOptions().split("\n").forEach((function(n,a){let o=n.split("; "),i=o[0];if(0===i.indexOf("fba-dipswitch-")||2===t.coreVer){if(!o[1])return;let t=o[1].split("|"),n=i.split("|")[0].replace(/_/g," ").replace(/.+\-(.+)/,"$1");t.slice(1,-1),1!==t.length&&(e[i.split("|")[0]]={label:n,options:t,default:1<i.split("|").length?i.split("|")[1]:t[0].replace("(Default) ",""),netplay:!0})}})),e},findElements:function(){try{return this.elements.controls=L.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:z.call(this,this.config.selectors.buttons.play),pause:L.call(this,this.config.selectors.buttons.pause),restart:L.call(this,this.config.selectors.buttons.restart),mute:L.call(this,this.config.selectors.buttons.mute),settings:L.call(this,this.config.selectors.buttons.settings),fullscreen:L.call(this,this.config.selectors.buttons.fullscreen),saveState:L.call(this,this.config.selectors.buttons.saveState),screenRecord:L.call(this,this.config.selectors.buttons.screenRecord),loadState:L.call(this,this.config.selectors.buttons.loadState),gamepad:L.call(this,this.config.selectors.buttons.gamepad),cheat:L.call(this,this.config.selectors.buttons.cheat)},this.elements.inputs={volume:L.call(this,this.config.selectors.inputs.volume)},!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),!1}},createIcon:function(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=(C(n,W(t,{role:"presentation",focusable:"false"})),document.createElement("div"));a.innerHTML="<svg>".concat(this.icons[e],"</svg>");for(let e=a.childNodes[0].childNodes,t=0;t<e.length;t+=1)n.appendChild(e[t]);return n},createLabel:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=J.get(e,this.config),a={};return a[t.class]=!0,a[this.config.classNames.hidden]=!0,P("span",Object.assign({},t,{class:[t.class,this.config.classNames.tooltip].filter(Boolean).join(" ")}),n)},createBadge:function(e){if(g.empty(e))return null;let t=P("span",{class:this.config.classNames.menu.value});return t.appendChild(P("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(e,t){let n,a,o,i,s=P("button"),l=Object.assign({},t),r=function(e){let t=(0<arguments.length&&void 0!==e?e:"").toString();return(t=function(e){return e=K((0<arguments.length&&void 0!==e?e:"").toString(),"-"," "),e=K(e,"_"," "),K(function(e){return(0<arguments.length&&void 0!==e?e:"").toString().replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}(e)," ","")}(t)).charAt(0).toLowerCase()+t.slice(1)}(e),c=!1;switch("type"in l||(l.type="button"),t=D({ejs__control:!0}),"class"in l?l.class.includes(t)||(l.class+=" ".concat(t)):l.class=t,e){case"play":c=!0,n="play",o="pause",a="play",i="pause";break;case"mute":c=!0,n="mute",o="unmute",a="volume",i="muted";break;case"fullscreen":c=!0,n="enterFullscreen",o="exitFullscreen",a="enter-fullscreen",i="exit-fullscreen";break;default:n=r,a=e}return c?(s.appendChild(Be.createIcon.call(this,i,{class:D({"icon--pressed":!0})})),s.appendChild(Be.createIcon.call(this,a,{class:D({"icon--not-pressed":!0})})),s.appendChild(Be.createLabel.call(this,o,{class:D({"icon--pressed":!0})})),s.appendChild(Be.createLabel.call(this,n,{class:D({"icon--not-pressed":!0})}))):(s.appendChild(Be.createIcon.call(this,a)),s.appendChild(Be.createLabel.call(this,n))),W(l,O(this.config.selectors.buttons[r],l)),C(s,l),"play"===r?(g.array(this.elements.buttons[r])||(this.elements.buttons[r]=[]),this.elements.buttons[r].push(s)):this.elements.buttons[r]=s,s},createRange:function(e,t){return t=P("input",W(O(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.1,value:0,autocomplete:"off",role:"slider","aria-label":J.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t)),this.elements.inputs[e]=t,Be.updateRangeFill.call(this,t),t},bindMenuItemShortcuts:function(e,t){let n=this;_(e,"keydown keyup",(function(a){if([32,38,39,40].includes(a.which)&&(a.preventDefault(),a.stopPropagation(),"keydown"!==a.type)){let o,i=k(e,'[role="menuitemradio"]');!i&&[32,39].includes(a.which)?Be.showMenuPanel.call(n,t,!0):32!==a.which&&(40===a.which||i&&39===a.which?(o=e.nextElementSibling,g.element(o)||(o=e.parentNode.firstElementChild)):(o=e.previousElementSibling,g.element(o)||(o=e.parentNode.lastElementChild)),j.call(n,o,!0))}}),!1),_(e,"keyup",(function(e){13===e.which&&Be.focusFirstMenuItem.call(n,null,!0)}))},createMenuItem:function(e){let t=this,n=e.value,a=e.list,o=e.type,i=e.title,s=e.badge,l=void 0===s?null:s,r=e.checked,c=void 0!==r&&r,d=O(this.config.selectors.inputs[o]),u=P("button",W(d,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(d.class||"").trim(),"aria-checked":c,value:n})),f=P("span"),p=(f.innerHTML=i,g.element(l)&&f.appendChild(l),u.appendChild(f),Object.defineProperty(u,"checked",{enumerable:!0,get:function(){return"true"===u.getAttribute("aria-checked")},set:function(e){e&&Array.from(u.parentNode.children).filter((function(e){return k(e,'[role="menuitemradio"]')})).forEach((function(e){return e.setAttribute("aria-checked","false")})),u.setAttribute("aria-checked",e?"true":"false")}}),Be.getCoreOptions.call(this));this.listeners.bind(u,"click keyup",(function(e){g.keyboardEvent(e)&&32!==e.which||(e.preventDefault(),e.stopPropagation(),u.checked=!0,Object.keys(Be.normalOptions).includes(o)&&Be.updateNormalOptions.call(t,o,n),Object.keys(p).includes(o)&&Be.updateCoreOptions.call(t,o,n)),Be.showMenuPanel.call(t,"home",g.keyboardEvent(e))}),o,!1),Be.bindMenuItemShortcuts.call(this,u,o),a.appendChild(u)},updateVolume:function(){g.element(this.elements.inputs.volume)&&Be.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),g.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume)},setRange:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;g.element(e)&&(e.value=t,Be.updateRangeFill.call(this,e))},updateRangeFill:function(e){let t=g.event(e)?e.target:e;if(g.element(t)&&"range"===t.getAttribute("type")){if(k(t,this.config.selectors.inputs.volume)){let e=100*t.value;t.setAttribute("aria-valuenow",e),t.setAttribute("aria-valuetext","".concat(e.toFixed(1),"%"))}else t.setAttribute("aria-valuenow",t.value);q.isWebkit&&t.style.setProperty("--value","".concat(t.value/t.max*100,"%"))}},toggleMenuButton:function(e,t){A(this.elements.settings.buttons[e],!t)},updateNormalOptions:function(e,t){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=Be.normalOptions[e].options[t];let n={};n[e]=t,Be.storage.set(n),"shader"===e&&Ge.setShader(t),"virtual-gamepad"===e&&Ge.toggleVirtualGamepad.call(this,"enabled"===t)},updateCoreOptions:function(e,t){if("nds"==this.system&&!X.wasm)return!0;if(Be.coreOptionsValues[e]=t,"psx"===this.system&&Ae.Module.pauseMainLoop(),Ge.setVariable(e,t),"psx"===this.system&&(setTimeout((function(){Ae.Module.resumeMainLoop()}),100),setTimeout((function(){Ae.Module.resumeMainLoop()}),200)),"nds"===this.system&&X.wasm){let n=this.elements.wrapper.querySelector("canvas");if("screen_rotation"===e)switch(n.style.transform="rotate("+t+"deg)",t){case"0":Ge.setVariable("desmume_input_rotation","0");break;case"90":Ge.setVariable("desmume_input_rotation","270");break;case"180":Ge.setVariable("desmume_input_rotation","180");break;case"270":Ge.setVariable("desmume_input_rotation","90")}}if("arcade"===this.system||"fba0.2.97.29"===this.system){let n=this.elements.wrapper.querySelector("canvas");n.height="fba-aspect"===e&&"PAR"===t?n.width/16*9:n.width/4*3}let n=Be.getCoreOptions.call(this),a=Be.storage.get("core-options");if((a=g.empty(a)?{}:a)[e]=t,Be.storage.set({"core-options":a}),this.elements.settings.buttons[e]){let a=this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value));g.object(n[e].options)?a.innerHTML=n[e].options[t]:a.innerHTML=t}},setOptionMenuItem:function(e,t){let n=this,a=this.elements.settings.panels.home.querySelector('[role="menu"]'),o=this.elements.settings.popup.children[0];Object.keys(e).forEach((function(i){let s=i,l=P("button",W(O(n.config.selectors.buttons.settings),{type:"button",class:D({ejs__control:!0,"ejs__control--forward":!0}),role:"menuitem",item:i,"aria-haspopup":!0}));_(l,"click",(function(){Be.showMenuPanel.call(n,s,!1)}));let r,c=P("span",null,e[i].label),d=P("span",{class:n.config.classNames.menu.value}),u=(g.object(t)&&(r=t[s]),g.empty(r)&&(r=e[s].default),g.object(e[s].options)?d.innerHTML=e[s].options[r]:d.innerHTML=r,c.appendChild(d),l.appendChild(c),a.appendChild(l),P("div",{"data-pane":escape(s),hidden:""})),f=P("button",{type:"button",class:D({ejs__control:!0,"ejs__control--back":!0})}),p=(f.appendChild(P("span",{"aria-hidden":!0},e[i].label)),f.appendChild(P("span",{class:D({"ejs__sr-only":!0})},J.get("menuBack",n.config))),_(u,"keydown",(function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),Be.showMenuPanel.call(n,"home",!0))}),!1),_(f,"click",(function(){Be.showMenuPanel.call(n,"home",!1)})),u.appendChild(f),u.appendChild(P("div",{role:"menu"})),o.appendChild(u),n.elements.settings.buttons[s]=l,(n.elements.settings.panels[s]=u).querySelector('[role="menu"]'));var m=p;if(g.element(m))for(let e=m.childNodes.length;0<e;)m.removeChild(m.lastChild),--e;g.object(e[i].options)?Object.keys(e[i].options).forEach((function(t){Be.createMenuItem.call(n,{value:t,list:p,type:s,title:e[i].options[t],badge:null,checked:Boolean(r===t)})})):g.array(e[i].options)&&e[i].options.forEach((function(e){Be.createMenuItem.call(n,{value:e,list:p,type:s,title:e,badge:null,checked:Boolean(r===e)})}))}))},setNormalOptionsMenu:function(){let e=this,t=this,n={};n.orientation=Be.storage.get("orientation"),n.shader=Be.storage.get("shader"),t.touch?(n["virtual-gamepad"]=Be.storage.get("virtual-gamepad"),_.call(t,t.elements.container,"start-game",(function(){"enabled"!==n["virtual-gamepad"]&&!g.empty(n["virtual-gamepad"])||Ge.toggleVirtualGamepad.call(t,!0)}))):delete Be.normalOptions["virtual-gamepad"],Be.setOptionMenuItem.call(this,Be.normalOptions,n),_.call(t,t.elements.container,"start-game",(function(){var n=Be.storage.get("shader");"disabled"!==n&&Ge.setShader(n);let a=e,o={};Ge.getGameCoreOptions&&Ge.getGameCoreOptions().split("\n").forEach((function(e,n){let a=e.split("; "),i=a[0];if(0===i.indexOf("fba-dipswitch-")||2===t.coreVer){if(!a[1])return;let e=a[1].split("|"),t=i.split("|")[0].replace(/_/g," ").replace(/.+\-(.+)/,"$1");e.slice(1,-1),1!==e.length&&(o[i.split("|")[0]]={label:t,options:e,default:1<i.split("|").length?i.split("|")[1]:e[0].replace("(Default) ",""),netplay:!0})}})),n=Be.storage.get("core-options"),Be.coreOptionsValues=n||{},Be.setOptionMenuItem.call(t,o,Be.coreOptionsValues),Object.keys(Be.coreOptionsValues).forEach((function(e,t){Be.updateCoreOptions.call(a,e,Be.coreOptionsValues[e])})),"nds"==t.system&&(Ae.Module._fast_forward_2?Ae.Module._fast_forward_2(1):Ae.Module._fast_forward&&Ae.Module._fast_forward(1))}))},updateCoreOptionMenuItems:function(){let e=this.elements.settings.panels.home.querySelector('[role="menu"]'),t=Be.getCoreOptions.call(this);Object.keys(t).forEach((function(t){e.querySelector('[item="'.concat(t,'"]')).removeAttribute("disabled")}))},setCoreOptionsMenu:function(){this.elements.settings.panels.home.querySelector('[role="menu"]'),this.elements.settings.popup.children[0];var e=Be.getCoreOptions.call(this),t=Be.storage.get("core-options");Be.coreOptionsValues=t||{},Be.setOptionMenuItem.call(this,e,t)},checkMenu:function(){var e=this.elements.settings.buttons;g.empty(e)||Object.values(e).some((function(e){return!e.hidden})),A(this.elements.settings.menu,!1)},focusFirstMenuItem:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!this.elements.settings.popup.hidden){let n=e;e=(n=g.element(n)?n:Object.values(this.elements.settings.panels).find((function(e){return!e.hidden}))).querySelector('[role^="menuitem"]'),j.call(this,e,t)}},toggleMenu:function(e){let t=this.elements.settings.popup,n=this.elements.buttons.settings;if(g.element(t)&&g.element(n)){let o=t.hidden,i=o;if(g.boolean(e))i=e;else if(g.keyboardEvent(e)&&27===e.which)i=!1;else if(g.event(e)){var a=t.contains(e.target);if(a||!a&&e.target!==n&&i)return}n.setAttribute("aria-expanded",i),A(t,!i),R(this.elements.container,this.config.classNames.menu.open,i),i&&g.keyboardEvent(e)?Be.focusFirstMenuItem.call(this,null,!0):i||o||j.call(this,n,g.keyboardEvent(e))}},getMenuSize:function(e){let t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);e=t.scrollWidth;var n=t.scrollHeight;return I(t),{width:e,height:n}},showLoadStatePanel:function(){},showMenuPanel:function(){let e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=L.call(this,'[data-pane="'.concat(escape(t),'"]'));if(g.element(a)){let t=a.parentNode,s=Array.from(t.children).find((function(e){return!e.hidden}));var o,i;X.transitions&&!X.reducedMotion&&(t.style.width="".concat(s.scrollWidth,"px"),t.style.height="".concat(s.scrollHeight,"px"),o=Be.getMenuSize.call(this,a),i=function n(a){a.target===t&&["width","height"].includes(a.propertyName)&&(t.style.width="",t.style.height="",b.call(e,t,U,n))},_.call(this,t,U,i),t.style.width="".concat(o.width,"px"),t.style.height="".concat(o.height,"px")),A(s,!0),A(a,!1),Be.focusFirstMenuItem.call(this,a,n)}},setLoadState:function(e,t){e.appendChild(Be.createButton.call(this,"load-state",{"aria-haspopup":!0,"aria-expanded":!1}));let n=P("div",{class:D({ejs__dialog:!0,"ejs__load-state__container":!0}),hidden:""}),a=P("div");n.appendChild(a),L.call(this,".".concat(D({ejs__dialogs:!0}))).appendChild(n),this.elements.dialogs.loadState=n},setScreenRecord:function(e,t){if(window.MediaRecorder){var n=Be.createButton.call(this,"screen-record",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let t=P("div",{class:D({ejs__dialog:!0,ejs__screenRecord__container:!0}),hidden:""}),a=P("div");t.appendChild(a),L.call(this,".".concat(D({ejs__dialogs:!0}))).appendChild(t),this.elements.dialogs.screenRecord=t}},setGamepad:function(e,t){var n=Be.createButton.call(this,"gamepad",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let a=P("div",{class:D({ejs__dialog:!0,ejs__gamepad__container:!0}),hidden:""}),o=P("div");a.appendChild(o),L.call(this,".".concat(D({ejs__dialogs:!0}))).appendChild(a),this.elements.dialogs.gamepad=a},setCheat:function(e,t){var n=Be.createButton.call(this,"cheat",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let a=P("div",{class:D({ejs__dialog:!0,ejs__cheat__container:!0}),hidden:""}),o=P("div");a.appendChild(o),L.call(this,".".concat(D({ejs__dialogs:!0}))).appendChild(a),this.elements.dialogs.cheat=a},setStateInfoBarWidget:function(){let e=P("div",{class:D({ejs__widget:!0})}),t=P("div");t.style="color: red;font-size: 17px;padding:10px;text-align:left;text-shadow:1px 1px 1px #000",e.appendChild(t),L.call(this,".".concat(D({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.stateInfo=e,this.elements.widgets.stateInfoDiv=t},toggleContextMenu:function(e,t){if(N(e.target,D({ejs__dialogs:!0}))){let n=Be.contextMenu.timer;if(this.started){let a=L.call(this,".".concat(D({ejs__contextmenu:!0})," ul"));if(t){if(Be.contextMenu.style.display="block",Be.contextMenu.style.left="".concat(e.layerX,"px"),Be.contextMenu.style.top="".concat(e.layerY,"px"),z.call(this,".".concat(D({ejs__contextmenu:!0})," ul li")),null===a.getAttribute("menu")){let e=P("li",{});a.appendChild(e),a.setAttribute("menu","")}n&&clearTimeout(n),n=setTimeout((function(){}),4e3),Be.contextMenu.timer=n}else Be.contextMenu.style.display="none"}}},create:function(e){let t=this,n=(Be.storage=new Z(this,"ejs_".concat(this.system,"_settings")),P("div",O(this.config.selectors.controls.wrapper))),a=(Be.contextMenu=P("div",{class:D({ejs__contextmenu:!0}),style:"position: absolute; display:none;z-index:-1"}),["<ul>","</ul>"]),o=[];function i(e,t,n){"function"==typeof n?o.push(n):o.push((function(){})),n=a.length-1,t?a.splice(n,0,'<li hidden><a href="#" onclick="return false">'+e+"</a></li>"):a.splice(n,0,'<li><a href="#" onclick="return false">'+e+"</a></li>")}i(t.localization("Take Screenshot"),!1,(function(e){var n=Fe.getScreenData();let a;var o=(a="string"==typeof t.gameName?t.gameName:a)?"".concat(a,"-screenshot.png"):"game.png";let i=document.createElement("a");return i.href=URL.createObjectURL(new Blob([n])),i.download=o,i.click(),setTimeout((function(){URL.revokeObjectURL(i.src)})),!1})),i(t.localization("Cache Manage"),!0,(function(e){if(Ae.romdb){A(t.elements.dialogs.cache,!1);let e=t.elements.dialogs.cache.querySelector(".".concat(Fe.classNames["dialog-content"]));e.innerHTML="<div>"+t.localization("Loading")+"</div>",Ae.romdb.getAll((function(n){if(n){let a=P("table",{style:"width:100%;padding-left:10px;text-align:left"}),o=P("tbody");0<n.length?(e.innerHTML="",n.forEach((function(e,t){if(e.key&&!/-part-\d+$/.test(e.key)){for(let t=Math.ceil(e.filesize/104857600),n=[e.key],a=1;a<t;a+=1)n.push("".concat(e.key,"-part-").concat(a));let t=P("tr"),n=P("td"),a=P("td"),i=P("td");n.innerHTML=e.filename,a.innerHTML=function(e){let t=-1;for(;t++,1024<(e/=1024););return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}(e.filesize),i.innerHTML='<a href="#" onclick="return false">Remove</a>',t.appendChild(n),t.appendChild(a),t.appendChild(i),o.appendChild(t),i.querySelector("a").onclick=function(e){Ae.romdb.removeBatch(_0x277c67);try{o.removeChild(t)}catch(e){}return e.stopPropagation(),!1}}})),a.appendChild(o),e.appendChild(a)):e.innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"}else e.innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"}),(function(){}))}return!1})),i(t.localization("Quick Save")+" (F2)",!1,(function(e){Fe.quickSaveState(),He.contextMenu.style.display="none"})),i(t.localization("Quick Load")+" (F4)",!1,(function(e){Fe.quickLoadState(),He.contextMenu.style.display="none"})),Be.contextMenu.innerHTML=a.join("");var s=Be.contextMenu.getElementsByTagName("li");for(let e=0;e<s.length;e++)_.call(t,s[e],"click",o[e]);this.elements.container.appendChild(Be.contextMenu);var l=P("div",{class:D({ejs__dialog:!0,ejs__cache__container:!0}),hidden:""});L.call(this,".".concat(D({ejs__dialogs:!0}))).appendChild(l),this.elements.dialogs.cache=l,l=P("div",{class:D({ejs__dialog:!0,ejs__loading__container:!0}),hidden:""});L.call(this,".".concat(D({ejs__dialogs:!0}))).appendChild(l),this.elements.dialogs.loading=l,n.appendChild(Be.createButton.call(this,"restart")),n.appendChild(Be.createButton.call(this,"play")),n.appendChild(Be.createButton.call(this,"save-state",{"aria-expanded":!1})),Be.setLoadState.call(this,n,e),Be.setScreenRecord.call(this,n,e),Be.setGamepad.call(this,n,e),Be.setStateInfoBarWidget.call(this,n,e),Be.setCheat.call(this,n,e),n.appendChild(P("span",{style:"flex:1"}));let r=P("div",{class:D({ejs__volume:!0})});r.appendChild(Be.createButton.call(this,"mute")),l={max:1,step:.01,value:this.config.volume},r.appendChild(Be.createRange.call(this,"volume",W(l,{}))),this.elements.volume=r,n.appendChild(r);let c=P("div",{class:D({ejs__menu:!0})}),d=(c.appendChild(Be.createButton.call(this,"settings",{"aria-haspopup":!0,"aria-expanded":!1})),P("div",{class:D({ejs__menu__container:!0}),hidden:""})),u=P("div"),f=P("div",{"data-pane":"home"}),p=P("div",{role:"menu"}),m=(f.appendChild(p),u.appendChild(f),this.elements.settings.panels.home=f,d.appendChild(u),c.appendChild(d),n.appendChild(c),this.elements.settings.popup=d,this.elements.settings.menu=c,n.appendChild(Be.createButton.call(this,"fullscreen")),this);return n.addEventListener("mousedown",(function(){m.onButtonDiv=!0})),this.elements.controls=n,Be.setNormalOptionsMenu.call(this),Be.setCoreOptionsMenu.call(this),n},inject:function(){let e,t=this,n=(this.icons={"enter-fullscreen":'<path d="M10 3h3.6l-4 4L11 8.4l4-4V8h2V1h-7zM7 9.6l-4 4V10H1v7h7v-2H4.4l4-4z"/>',"exit-fullscreen":'<path d="M1 12h3.6l-4 4L2 17.4l4-4V17h2v-7H1zM16 .6l-4 4V1h-2v7h7V6h-3.6l4-4z"/>',gamepad:'<svg viewBox="0 0 640 512"><path fill="currentColor" d="M480 96H160C71.6 96 0 167.6 0 256s71.6 160 160 160c44.8 0 85.2-18.4 114.2-48h91.5c29 29.6 69.5 48 114.2 48 88.4 0 160-71.6 160-160S568.4 96 480 96zM256 276c0 6.6-5.4 12-12 12h-52v52c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-52H76c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h52v-52c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h52c6.6 0 12 5.4 12 12v40zm184 68c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-80c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>',"load-state":'<svg viewBox="0 0 576 512"><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"/></svg>',muted:'<path d="M12.4 12.5l2.1-2.1 2.1 2.1 1.4-1.4L15.9 9 18 6.9l-1.4-1.4-2.1 2.1-2.1-2.1L11 6.9 13.1 9 11 11.1zM3.786 6.008H.714C.286 6.008 0 6.31 0 6.76v4.512c0 .452.286.752.714.752h3.072l4.071 3.858c.5.3 1.143 0 1.143-.602V2.752c0-.601-.643-.977-1.143-.601L3.786 6.008z"/>',pause:'<path d="M6 1H3c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1zM12 1c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1h-3z"/>',play:'<path d="M15.562 8.1L3.87.225C3.052-.337 2 .225 2 1.125v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"/>',restart:'<path d="M9.7 1.2l.7 6.4 2.1-2.1c1.9 1.9 1.9 5.1 0 7-.9 1-2.2 1.5-3.5 1.5-1.3 0-2.6-.5-3.5-1.5-1.9-1.9-1.9-5.1 0-7 .6-.6 1.4-1.1 2.3-1.3l-.6-1.9C6 2.6 4.9 3.2 4 4.1 1.3 6.8 1.3 11.2 4 14c1.3 1.3 3.1 2 4.9 2 1.9 0 3.6-.7 4.9-2 2.7-2.7 2.7-7.1 0-9.9L16 1.9l-6.3-.7z"/>',"save-state":'<svg viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>',"screen-record":'<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px",viewBox="0 0 39.989 39.989" style="enable-background:new 0 0 39.989 39.989;" xml:space="preserve"><path id="XMLID_155_" d="M19.994,0C8.952,0,0,8.952,0,19.995c0,11.043,8.952,19.994,19.994,19.994s19.995-8.952,19.995-19.994,C39.989,8.952,31.037,0,19.994,0z M19.994,27.745c-4.28,0-7.75-3.47-7.75-7.75s3.47-7.75,7.75-7.75s7.75,3.47,7.75,7.75,S24.275,27.745,19.994,27.745z"/></svg>',settings:'<path d="M16.135 7.784a2 2 0 0 1-1.23-2.969c.322-.536.225-.998-.094-1.316l-.31-.31c-.318-.318-.78-.415-1.316-.094a2 2 0 0 1-2.969-1.23C10.065 1.258 9.669 1 9.219 1h-.438c-.45 0-.845.258-.997.865a2 2 0 0 1-2.969 1.23c-.536-.322-.999-.225-1.317.093l-.31.31c-.318.318-.415.781-.093 1.317a2 2 0 0 1-1.23 2.969C1.26 7.935 1 8.33 1 8.781v.438c0 .45.258.845.865.997a2 2 0 0 1 1.23 2.969c-.322.536-.225.998.094 1.316l.31.31c.319.319.782.415 1.316.094a2 2 0 0 1 2.969 1.23c.151.607.547.865.997.865h.438c.45 0 .845-.258.997-.865a2 2 0 0 1 2.969-1.23c.535.321.997.225 1.316-.094l.31-.31c.318-.318.415-.781.094-1.316a2 2 0 0 1 1.23-2.969c.607-.151.865-.547.865-.997v-.438c0-.451-.26-.846-.865-.997zM9 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>',volume:'<path d="M15.5999996,3.3 C15.1999996,2.9 14.5999996,2.9 14.1999996,3.3 C13.7999996,3.7 13.7999996,4.3 14.1999996,4.7 C15.3999996,5.9 15.9999996,7.4 15.9999996,9 C15.9999996,10.6 15.3999996,12.1 14.1999996,13.3 C13.7999996,13.7 13.7999996,14.3 14.1999996,14.7 C14.3999996,14.9 14.6999996,15 14.8999996,15 C15.1999996,15 15.3999996,14.9 15.5999996,14.7 C17.0999996,13.2 17.9999996,11.2 17.9999996,9 C17.9999996,6.8 17.0999996,4.8 15.5999996,3.3 L15.5999996,3.3 Z"></path>\n            <path d="M11.2819745,5.28197449 C10.9060085,5.65794047 10.9060085,6.22188944 11.2819745,6.59785542 C12.0171538,7.33303477 12.2772954,8.05605449 12.2772954,9.00000021 C12.2772954,9.93588462 11.851678,10.9172014 11.2819745,11.4869049 C10.9060085,11.8628709 10.9060085,12.4268199 11.2819745,12.8027859 C11.4271642,12.9479755 11.9176724,13.0649528 12.2998149,12.9592565 C12.4124479,12.9281035 12.5156669,12.8776063 12.5978555,12.8027859 C13.773371,11.732654 14.1311161,10.1597914 14.1312523,9.00000021 C14.1312723,8.8299555 14.1286311,8.66015647 14.119665,8.4897429 C14.0674781,7.49784946 13.8010171,6.48513613 12.5978554,5.28197449 C12.2218894,4.9060085 11.6579405,4.9060085 11.2819745,5.28197449 Z"></path>\n            <path d="M3.78571429,6.00820648 L0.714285714,6.00820648 C0.285714286,6.00820648 0,6.30901277 0,6.76022222 L0,11.2723167 C0,11.7235261 0.285714286,12.0243324 0.714285714,12.0243324 L3.78571429,12.0243324 L7.85714286,15.8819922 C8.35714286,16.1827985 9,15.8819922 9,15.2803796 L9,2.75215925 C9,2.15054666 8.35714286,1.77453879 7.85714286,2.15054666 L3.78571429,6.00820648 Z"></path>',cheat:'<svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z" class=""></path></svg>'},this.id=Math.floor(1e4*Math.random()),null),a=(this.elements.controls=null,{id:this.id}),o=!0;function i(e){let t=e;return Object.entries(a).forEach((function(e){n=2;e=function(e){if(Array.isArray(e))return e}(e)||function(e,t){let n,a=[],o=!0,i=!1;try{for(let n,i=e[Symbol.iterator]();!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){i=!0,n=e}finally{try{o||null==_0x4d9086.return||_0x4d9086.return()}finally{if(i)throw n}}return a}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}();var n=e[0];e=e[1];t=K(t,"{".concat(n,"}"),e)})),t}if(g.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this.props)),this.config.controls||(this.config.controls=[]),g.element(this.config.controls)||g.string(this.config.controls)?n=this.config.controls:(n=Be.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality}),o=!1),o&&(g.string(this.config.controls)?n=i(n):g.element(n)&&(n.innerHTML=i(n.innerHTML))),g.string(this.config.selectors.controls.container)&&(e=document.querySelector(this.config.selectors.controls.container)),(e=g.element(e)?e:this.elements.container)[g.element(n)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",n),g.element(this.elements.controls)||Be.findElements.call(this),!g.empty(this.elements.buttons)){let e=function(e){let n=t.config.classNames.controlPressed;Object.defineProperty(e,"pressed",{enumerable:!0,get:function(){return N(e,n)},set:function(){R(e,n,0<arguments.length&&void 0!==arguments[0]&&arguments[0])}})};Object.values(this.elements.buttons).filter(Boolean).forEach((function(t){g.array(t)||g.nodeList(t)?Array.from(t).filter(Boolean).forEach(e):e(t)}))}window.navigator.userAgent.includes("Edge")&&B(e)}},He=Be;function qe(e,t){for(let n=0;n<t.length;n++){let a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Xe(){if(this.enabled){let e=this.player.elements.buttons.fullscreen;g.element(e)&&(e.pressed=this.active),x.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0),q.isIos||function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(g.element(e)){let e=z.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]"),n=e[0],a=e[e.length-1];y.call(this,this.elements.container,"keydown",(function(e){var t;"Tab"===e.key&&9===e.keyCode&&((t=document.activeElement)!==a||e.shiftKey?t===n&&e.shiftKey&&(a.focus(),e.preventDefault()):(n.focus(),e.preventDefault()))}),t,!1)}}.call(this.player,this.target,this.active)}}function Ye(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];e?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",R(this.target,this.player.config.classNames.fullscreen.fallback,e),Xe.call(this)}Ve=[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(g.function(document.exitFullscreen))return"";let e="";return["webkit","moz","ms"].some((function(t){return!(!g.function(document["".concat(t,"ExitFullscreen")])&&!g.function(document["".concat(t,"CancelFullScreen")])||(e=t,0))})),e}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}],qe((Ue=Ke).prototype,[{key:"update",value:function(){this.enabled,R(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function(){this.enabled&&(Ke.native?this.prefix?g.empty(this.prefix)||this.target["".concat(this.prefix,"Request").concat(this.property)]():this.target.requestFullscreen():Ye.call(this,!0))}},{key:"exit",value:function(){var e;this.enabled&&(Ke.native?this.prefix?g.empty(this.prefix)||(e="moz"===this.prefix?"Cancel":"Exit",document["".concat(this.prefix).concat(e).concat(this.property)]()):(document.cancelFullScreen||document.exitFullscreen).call(document):Ye.call(this,!1))}},{key:"toggle",value:function(){this.active?this.exit():this.enter()}},{key:"enabled",get:function(){return Ke.native}},{key:"active",get:function(){return!!this.enabled&&(Ke.native?(this.prefix?document["".concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement)===this.target:N(this.target,this.player.config.classNames.fullscreen.fallback))}},{key:"target",get:function(){return q.isEdge?this.player.game:this.player.elements.container}}]),qe(Ue,Ve);let We=Ke;function Ke(e){let t=this;if(!(this instanceof Ke))throw new TypeError("Cannot call a class as a function");this.player=e,this.prefix=Ke.prefix,this.property=Ke.property,this.scrollPosition={x:0,y:0},_.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),(function(){Xe.call(t)})),this.update()}Qe.prototype={toggleMenu:function(e){He.toggleMenu.call(this.emulator,e)},firstTouch:function(){let e=this.emulator,t=e.elements;e.touch=!0,R(t.container,e.config.classNames.isTouch,!0)},setTabFocus:function(e){let t=this.emulator,n=t.elements,a=t;var o;clearTimeout(this.focusTimer),"keydown"===e.type&&9!==e.which||("keydown"===e.type&&(this.lastKeyDown=e.timeStamp),o=e.timeStamp-this.lastKeyDown<=20,"focus"===e.type&&!o||(e=a.config.classNames.tabFocus,R(z.call(a,".".concat(e)),e,!1),this.focusTimer=setTimeout((function(){var e=document.activeElement;n.container.contains(e)&&R(document.activeElement,a.config.classNames.tabFocus,!0)}),10)))},global:function(){let e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.emulator;y.call(t,document.body,"click",this.toggleMenu,e),T.call(t,document.body,"touchstart",this.firstTouch),y.call(t,document.body,"keydown focus blur",this.setTabFocus,e,!1,!0),_.call(t,document.body,"keyup",(function(e){t.started&&(113===e.which&&(e.shiftKey?null===t.elements.buttons.saveState.getAttribute("hidden")&&x.call(t,t.elements.buttons.saveState,"click"):Ge.quickSaveState()),115===e.which&&(e.shiftKey?null===t.elements.buttons.loadState.getAttribute("hidden")&&x.call(t,t.elements.buttons.loadState,"click"):Ge.quickLoadState()),120===e.which&&x.call(t,t.elements.buttons.mute,"click"))}))},container:function(){let e,t=this.emulator,n=t.elements,a=t,o=null;_.call(a,n.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen start-game",(function(o){let i=n.controls;if(i&&"enterfullscreen"===o.type&&(i.pressed=!1,i.hover=!1),["touchstart","touchmove","mousemove","start-game"].includes(o.type)){if("nds"==t.system&&"mousemove"==o.type&&Ae&&Ae.Module&&Ae.Module.canvas&&(document.pointerLockElement===Ae.Module.canvas||document.mozPointerLockElement===Ae.Module.canvas))return void le.toggleControls.call(a,!1);!Ge||"undefined"!=Ge.virtualGamepadContainer&&null!==Ge.virtualGamepadContainer||(le.toggleControls.call(a,!0),o=a.touch?3e3:2e3,clearTimeout(e),e=setTimeout((function(){return le.toggleControls.call(a,!1)}),o),n.controls.setAttribute("data-timer",e))}})),_.call(a,window,"resize",(function(e){let t=a.elements.container.clientHeight,n=z.call(a,".".concat(D({ejs__menu__container:!0}),' [role="menu"]'));Array.from(n).forEach((function(e){e.style.maxHeight="".concat(t-95,"px"),e.style.overflow="auto"})),Ae.Module&&Ae.Module.canvas,a.elements.container.clientWidth/a.elements.container.clientHeight<1.3?R(a.elements.container,D({portrait:!0}),!0):R(a.elements.container,D({portrait:!0}),!1)})),x.call(a,window,"resize"),_.call(a,a.elements.container,"enterfullscreen",(function(e){if(Ae.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.lock)try{screen.orientation.lock("landscape")}catch(e){}else if(Ae.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.lock)try{ScreenOrientation.lock("landscape")}catch(e){}if(2===a.coreVer&&Ae.Module){let e=50;clearInterval(o),o=setInterval((function(){Ae.Module.setCanvasSize(window.innerWidth,window.innerHeight),e<0&&clearInterval(o),e--}),100)}setTimeout((function(){x.call(a,window,"resize")}),300)})),_.call(a,a.elements.container,"exitfullscreen",(function(e){if(Ae.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.unlock)try{screen.orientation.unlock()}catch(e){}else if(Ae.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.unlock)try{ScreenOrientation.unlock()}catch(e){}2===a.coreVer&&Ae.Module&&(clearInterval(o),Ae.Module.setCanvasSize(800,600)),setTimeout((function(){x.call(a,window,"resize")}),300)})),_.call(a,a.elements.container,"start-game",(function(e){let t=window.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t),R(a.elements.container,D({"game-started":!0}),!0)})),_.call(a,a.elements.container,"blur",(function(e){let t=e.currentTarget;setTimeout((function(){t.contains(document.activeElement)||x.call(a,a.elements,"blurgame")}),0)})),_.call(a,a.elements.container,"focus",(function(e){let t=e.currentTarget;setTimeout((function(){t.contains(document.activeElement)&&x.call(a,a.elements,"focusgame")}),0)}))},media:function(){let e=this.emulator,t=e.elements,n=e;_.call(n,n.game,"volumechange",(function(e){return He.updateVolume.call(n,e)})),_.call(n,t.container,"contextmenu",(function(e){n.touch||n.lightgun||He.toggleContextMenu.call(n,e,!0),e.preventDefault()}),!1),_.call(n,t.container,"mousewheel",(function(e){e.stopPropagation()}),!1),_.call(n,t.container,"mousedown",(function(t){"nds"==e.system&&Ae&&Ae.Module&&Ae.Module.canvas&&!Ae.isMobileDevice&&document.pointerLockElement!==Ae.Module.canvas&&document.mozPointerLockElement!==Ae.Module.canvas&&e.started&&!e.connected&&setTimeout((function(){!0!==e.onButtonDiv&&(Ae.Module.canvas.requestPointerLock=Ae.Module.canvas.requestPointerLock||Ae.Module.canvas.mozRequestPointerLock,Ae.Module.canvas.requestPointerLock()),e.onButtonDiv=!1}),100),n.touch||He.toggleContextMenu.call(n,t,!1)}),!1),_.call(n,n.game,"volumechange",(function(){n.storage.set({volume:n.volume,muted:n.muted}),Ge.setVolume&&Ge.setVolume()}));var a=n.config.events.concat(["keyup","keydown"]).join(" ");_.call(n,n.game,a,(function(e){let a=e.detail,o=void 0===a?{}:a;"error"===e.type&&(o=n.game.error),x.call(n,t.container,e.type,!0,o)}))},proxy:function(e,t,n){let a=this.emulator,o=a.config.listeners[n],i=!0;(i=g.function(o)?o.call(a,e):i)&&g.function(t)&&t.call(a,e)},bind:function(e,t,n,a){let o=this,i=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],s=this.emulator,l=s.config.listeners[a],r=g.function(l);_.call(s,e,t,(function(e){return o.proxy(e,n,a)}),i&&!r)},controls:function(){let e=this,t=this.emulator,n=t.elements,a=q.isIE?"change":"input";var o;this.bind(n.buttons.mute,"click",(function(){t.muted=!t.muted}),"mute"),this.bind(n.buttons.fullscreen,"click",(function(){t.fullscreen.toggle()}),"fullscreen"),this.bind(n.buttons.gamepad,"click",(function(){le.toggleControls.call(t,!1),A(n.dialogs.gamepad,!1)}),"mute"),this.bind(n.buttons.saveState,"click",(function(){saveSaveFiles(),async function(){x.call(t,t.elements.container,"savestate-start",!1,{});var e=await Ge.saveState(),n=Ge.getScreenData();if(!Fe.saveLoadDB.call(t,"save")){if(g.function(t.config.onsavestate))t.config.onsavestate.call(null,{screenshot:n,state:e});else{let a=t.getStartName(!0,!0).split("/").pop();n=new Blob([e]),a.includes(".")&&(a=a.substring(0,a.length-a.split(".").pop().length-1)),e=(a="string"==typeof t.gameName?t.gameName:a)?"".concat(a,".state"):"game.state";let o=document.createElement("a");o.download=e,o.href=URL.createObjectURL(n),o.click(),setTimeout((function(){URL.revokeObjectURL(o.href)}),2e3)}t.elements.container.focus()}}()}),"mute"),this.bind(n.buttons.loadState,"click",(function(){x.call(t,t.elements.container,"loadstate",!1,{})}),"mute"),this.bind(n.buttons.settings,"click",(function(e){e.stopPropagation(),He.toggleMenu.call(t,e)})),this.bind(n.buttons.settings,"keyup",(function(e){var n=e.which;[13,32].includes(n)&&(13!==n?(e.preventDefault(),e.stopPropagation(),He.toggleMenu.call(t,e)):He.focusFirstMenuItem.call(t,null,!0))}),null,!1),this.bind(n.settings.menu,"keydown",(function(e){27===e.which&&He.toggleMenu.call(t,e)})),q.isIos&&(o=z.call(t,'input[type="range"]'),Array.from(o).forEach((function(t){return e.bind(t,a,(function(e){return B(e.target)}))}))),q.isWebkit&&Array.from(z.call(t,'input[type="range"]')).forEach((function(n){e.bind(n,"input",(function(e){return He.updateRangeFill.call(t,e.target)}))})),this.bind(n.inputs.volume,a,(function(e){t.volume=e.target.value}),"volume"),this.bind(n.controls,"mouseenter mouseleave",(function(e){"mouseleave"===e.type&&null===e.toElement?n.controls.hover=!0:n.controls.hover=!t.touch&&"mouseenter"===e.type})),this.bind(n.controls,"mousedown mouseup touchstart touchend touchcancel",(function(e){["mousedown","touchstart"].includes(e.type)?(n.controls.pressed=!0,e=n.controls.getAttribute("data-timer2"),clearTimeout(e)):(e=setTimeout((function(){n.controls.pressed=!1}),4e3),n.controls.setAttribute("data-timer2",e))})),this.bind(n.controls,"focusin focusout",(function(n){let a=t.config,o=t.elements,i="focusin"===n.type,s=o.controls.getAttribute("data-timer");R(o.controls,a.classNames.noTransition,i),le.toggleControls.call(t,i),i&&(setTimeout((function(){R(o.controls,a.classNames.noTransition,!1)}),0),n=e.touch?3e3:4e3,clearTimeout(s),s=setTimeout((function(){return le.toggleControls.call(t,!1)}),n),o.controls.setAttribute("data-timer",s))})),this.bind(n.inputs.volume,"wheel",(function(e){let n=e.webkitDirectionInvertedFromDevice,a=function(e,t){if(Array.isArray(e))return e;let n,a=[],o=!0,i=!1;try{for(let t,n=e[Symbol.iterator]();!(o=(t=n.next()).done)&&(a.push(t.value),2!==a.length);o=!0);}catch(e){i=!0,n=e}finally{try{o||null==_0x1bb8de.return||_0x1bb8de.return()}finally{if(i)throw n}}return a}([e.deltaX,-e.deltaY].map((function(e){return n?-e:e}))),o=a[0],i=a[1],s=Math.sign(Math.abs(o)>Math.abs(i)?o:i);t.increaseVolume(s/50);var l=t.game.volume;(1===s&&l<1||-1===s&&0<l)&&e.preventDefault()}),"volume",!1),this.bind(n.controls,"contextmenu",(function(e){e.stopPropagation()})),this.bind(n.contextMenu,"contextmenu",(function(e){e.stopPropagation()}))}};let Je=Qe;function Qe(e){if(!(this instanceof Qe))throw new TypeError("Cannot call a class as a function");this.emulator=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}function Ze(e,t){for(let n=0;n<t.length;n++){let a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Ue=[{key:"setup",value:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=null;return g.string(e)?n=Array.from(document.querySelectorAll(e)):g.nodeList(e)?n=Array.from(e):g.array(e)&&(n=e.filter(g.element)),g.empty(n)?null:n.map((function(e){return new et(e,t)}))}}],Ze((Ve=et).prototype,[{key:"restart",value:function(){this.currentTime=0}},{key:"increaseVolume",value:function(e){var t=this.game.muted?0:this.volume;this.volume=t+(g.number(e)?e:0)}},{key:"decreaseVolume",value:function(e){this.increaseVolume(-e)}},{key:"toggleControls",value:function(e){return!!this.started&&((e=R(this.elements.container,this.config.classNames.hideControls,void 0===e?void 0:!e))&&He.toggleMenu.call(this,!1),!e)}},{key:"getStartName",value:function(e,t){let n;return!this.startName||!0!==e&&"rom"===this.startName?this.config.gameUrl.startsWith("blob:")?this.gameName?n=(!0===t?"":this.system+"-")+this.gameName.replace(/\#/g,""):this.config.gameId?n=(!0===t?"":this.system+"-")+this.config.gameId:!0===e&&(n=this.config.gameUrl.split("/").pop().replace(/[^a-z0-9 ,.]/gi,"")):n=this.config.gameUrl.split("/").pop().replace(/[^a-z0-9 ,.]/gi,""):n=this.startName,n}},{key:"loadState",value:function(e){Ge.loadState(e,0)}},{key:"on",value:function(e,t){_.call(this,this.elements.container,e,t)}},{key:"once",value:function(e,t){T.call(this,this.elements.container,e,t)}},{key:"off",value:function(e,t){b(this.elements.container,e,t)}},{key:"playing",set:function(){let e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Array.from(this.elements.buttons.play||[]).forEach((function(t){t.pressed=e})),this.paused=!e},get:function(){return Boolean(this.ready&&!this.paused)}},{key:"volume",set:function(e){let t=e;g.string(t)&&(t=Number(t)),g.number(t)||(t=this.storage.get("volume")),(t=1<(t=g.number(t)?t:this.config.volume)?1:t)<0&&(t=0),this.config.volume=t,this.game.volume=t,!g.empty(e)&&this.muted&&0<t&&(this.muted=!1)},get:function(){return Number(this.game.volume)}},{key:"muted",set:function(e){let t=e;g.boolean(t)||(t=this.storage.get("muted")),g.boolean(t)||(t=this.config.muted),this.config.muted=t,this.game.muted=t},get:function(){return Boolean(this.game.muted)}}]),Ze(Ve,Ue);let $e=et;function et(e,t){return new Promise(async function(n,a){function o(e,t){var n=window.location.pathname.split("/").pop();var a,o=window.location.pathname.substring(0,window.location.pathname.length-n.length).split("/"),i=e.split("/");let s=[];for(let e=0;e<o.length;e++)""!=o[e]&&s.push(o[e]);if(!(e.startsWith("/")||e.includes("://")||e.includes("http:")||e.includes("https:")||e.includes("file:")||e.includes("blob:"))){for(let e=0;e<i.length;e++)if(""!=i[e]&&"."!=i[e])if(".."==i[e]){if(0<s.length){let e=("/"===(a=e.join("/"))?"/":a.substring(0,a.length-a.split("/").pop().length)).split("/")}}else s.push(i[e]);(e=s.join("/")).startsWith("/")||(e="/"+e),e=window.location.protocol+"//"+window.location.host+e}return!(e=e.startsWith("/")?window.location.protocol+"//"+window.location.host+e:e).endsWith("/")&&t&&(e+="/"),e}let i=this;this.version="2.3.5",this.system="",this.adUrl=null,this.gameName=null,this.loadStateOnStart=!1,this.statesSupported=!0,this.mameCore=null,this.startOnLoad=!1,this.dataPath="",this.customPaths=null,this.hash="",this.lightgun=!1,this.mouse=!1,this.multitap=!1,this.ready=!1,this.paused=!0,this.started=!1,this.touch=X.touch,this.game=e,g.string(this.game)&&(this.game=document.querySelectorAll(this.game)),(window.jQuery&&this.game instanceof jQuery||g.nodeList(this.game)||g.array(this.game))&&(this.game=this.game[0]),this.game=this.game,this.game.innerHTML="",this.config=W({},f,et.defaults,t||{}),this.config.settings&&this.config.settings.volume&&(f.volume=this.config.settings.volume),this.config.settings&&this.config.settings.defaultControllers&&(Fe.defaultControllers=this.config.settings.defaultControllers),this.coreVer=1,this.lightgun=this.config.lightgun,this.loadStateOnStart=this.config.loadStateOnStart||!1,this.adUrl=this.config.adUrl||null,g.string(this.config.gameName)&&(this.gameName=this.config.gameName||null),this.mouse=this.config.mouse,this.multitap=this.config.multitap,this.cheats=this.config.cheats,this.cheats||(this.cheats=[]),this.mameCore=this.config.mameCore||null,this.color=this.config.color,this.startOnLoad=this.config.startOnLoad||!1,this.statesSupported=this.config.statesSupported||!0,this.customPaths=function(e){if(!e)return{};let t={};for(var n in e)"string"==typeof e[n]&&(t[n]=o(e[n]));return t}(this.config.paths),this.dataPath=function(e){if("string"==typeof e)return o(e,!0);{let n=e=window.location.href;var t=n.split("/").pop();let a=n.substring(0,n.length-t.length);return"/"==e?window.location.protocol+"//"+window.location.host+"/":((a=a.startsWith("/")?window.location.protocol+"//"+window.location.host+a:a).endsWith("/")||(a+="/"),a)}}(this.config.dataPath),this.localization=await async function(e,t,n){let a={};if(n&&"string"==typeof n&&"en-US"!==n){t=t&&"string"==typeof t[n+".json"]?t[n+".json"]:e+"localization/"+n+".json";try{let e=await fetch(t);var o=await e.text(),i=JSON.parse(o);f.i18n=i.i18n,Be.normalOptions=i.normalOptions}catch(e){console.warn("error setting localization",e)}}return function(e){return"string"==typeof a[e]?a[e]:(n&&"en-US"!==n&&"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&console.warn('Missing translation for "'+e+'". Language is set to "'+n+'"'),e)}}(this.dataPath,this.customPaths,this.config.lang),this.config=W({},f,et.defaults,t||{}),Object.keys(this.config.classNames).forEach((function(e){var t=i;if(g.object(t.config.classNames[e]))Object.keys(t.config.classNames[e]).forEach((function(t){let n={};n[i.config.classNames[e][t]]=!0,i.config.classNames[e][t]=D(n)}));else{let t={};t[i.config.classNames[e]]=!0,i.config.classNames[e]=D(t)}})),this.config.selectors.controls.wrapper=".".concat(D({ejs__controls:!0})),this.config.selectors.container=".".concat(D({ejs:!0})),this.system=this.config.system,this.elements={container:null,buttons:{},display:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}},dialogs:{gamepad:null,loading:null,netplay:null},widgets:{}},this.fullscreen={active:!1},this.config.mute=!0,this.eventListeners=[],this.listeners=new Je(this),this.storage=new Z(this,"ejs_settings"),this.game.emulator=this,g.element(this.elements.container)||(this.elements.container=P("div"),M(this.game,this.elements.container));var s=P("div",{class:D({ejs__widgets:!0})});this.elements.container.appendChild(s),s=P("div",{class:D({ejs__dialogs:!0})});this.elements.container.appendChild(s),le.addStyleHook.call(this),Ge.setup.call(this),le.build.call(this),this.listeners.container(),this.listeners.global(),this.fullscreen=new We(this),Ae.create.call(this),n(this)}.bind(this))}$e.defaults={},t.default=$e}]).default;