---
layout: default
title: Язык awk - основные особенности, общая структура программы, типичные задачи. Язык awk - типы данных, переменные, управляющие конструкции.
---

# 17. Язык awk - основные особенности, общая структура программы, типичные задачи. Язык awk - типы данных, переменные, управляющие конструкции.

AWK — C-подобный скриптовый язык построчного разбора и обработки входного потока (например, текстового файла) по заданным шаблонам (регулярным выражениям). Может использоваться в сценариях командной строки.

Название AWK складывается из инициалов разработчиков языка: Alfred V. Aho, Peter J. Weinberger (англ.)русск. и Brian W. Kernighan. Первая версия AWK была написана в 1977 в AT&T Bell Laboratories.


## Структура программы

AWK рассматривает входной поток как список записей. Каждая запись делится на поля. На основе этой информации выполняется некоторый определённый программистом алгоритм обработки. По умолчанию разделителем записей является символ новой строки (то есть записи — это то же самое, что строки), разделителем полей — символ пробела или табуляции, или последовательность таких символов. Символы-разделители можно явно определить в программе. Символ-разделитель полей можно определить и в командной строке.

AWK-программа состоит из операторов (правил), имеющих вид:

шаблон {действие}

шаблон {действие}

. . .

Каждая запись поочерёдно сравнивается со всеми шаблонами, и каждый раз когда она соответствует шаблону, выполняется указанное действие. Если шаблон не указан, то действие выполняется для любой записи. Если не указано действие, то запись выводится. В AWK также существует 2 предопределённых шаблона BEGIN и END. BEGIN выполняется до начала обработки входного потока. END — после обработки последней записи входного потока.

Действие может состоять из последовательности операторов, разделяемой точкой с запятой, переводом строки или закрывающей скобкой.

## Конструкции языка

Условия

if(условие)
then
  {
   Список действий 1
  }
else
  {
   Список действий 2
  }

Циклы

do

do{

    Тело цикла
    
}while (условие)

while

while(условие){

    Тело цикла
    
}


for (индексная форма)

Цикл for в форме, ориентированной на обработку индексных массивов, имеет вид:

for(секция инициализации;секция условия;секция обновления итератора){

    Тело цикла
    
}
for (ассоциативная форма)

Цикл for в форме, ориентированной на обработку ассоциативных массивов, имеет вид:

for(итератор in массив){

    Тело цикла
    
}

Встроенные переменные

Переменная	Содержание	Значение по умолчанию

* ARGC	Число аргументов командной строки	-
* ARGV	Массив аргументов командной строки	-
* ENVIRON	Массив, содержащий переменные окружения	-
* FILENAME	Обрабатываемый входной файл	-
* FNR	Номер записи в текущем файле	-
* FS	Разделитель полей записи на вводе	пробел(ы) и/или табуляция
* NF	Число полей в текущей записи	-
* NR	Номер записи (общее число считанных записей)	-
* OFMT	Формат распечатки чисел	%.6g
* OFS	Разделитель полей записи на выводе (символ)	пробел(ы) и/или табуляция
* ORS	Разделитель записей на выводе AWK-программы (символ)	\0
* RS	Разделитель записей на вводе (символ)	\0
* RSTART	Позиция начала подстроки, найденной функцией match	-
* RLENGTH	Длина подстроки, найденной функцией match	-
* SUBSEP	Разделитель индексов в многомерных массивах	\034

Встроенные функции
Примеры

«Hello world!»

BEGIN{print "Hello World!"; exit}

Печать длины самой длинной строки:

{ if (length($0) > max) max = length($0) }

END { print max }

Печать всех строк длиннее 80 символов:

{ if (length($0) > 80) print $0 }

Печать всех строк, имеющих хотя бы одно поле:

NF > 0

Печать количества строк в файле:

END { print NR }

Печать строк, номера которых кратны 3:

{ if (FNR%3==0) print $0 }
Печать остатка входной строки, следующего за первыми тремя полями:

{
   # поиск начала 4-го поля...
   match($0,/[ \t]*[^ \t]*[ \t]*[^ \t]*[ \t]*[^ \t]*[ \t]*/)
   # ...печать остатка входной строки с найденной позиции
   print substr($0,1+RLENGTH)
}

1.2.2 Значения переменных
Переменные могут интерпретироваться как числовые или строковые. Они принимают значения в зависимости от контекста, например:
x = 1, x воспринимается как число;

x = " ", x - строка;

x + "abc" - результат операции интерпретируется как число независимо от того, было ли х числом или строкой. Если строка не может быть интерпретирована как число ("abc"), то ее значение становится 0.

Строка может содержать максимально до 256 символов.