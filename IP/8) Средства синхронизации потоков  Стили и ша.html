<html>
<head>
  <title>8) Средства синхронизации потоков / Стили и шаблоны в WPF</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/274061; Windows/6.3.9600;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="931"/>
<h1>8) Средства синхронизации потоков / Стили и шаблоны в WPF</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><b>Средства синхронизации потоков</b><div>При использовании многопоточности естественным образом возникает проблема синхронизации потоков, то есть координации их действий для получения предсказуемого результата. Чтобы сделать код потокобезопасным, необходимо гарантировать выполнение операторов, составляющих тело метода, только одним потоком в любой момент времени. Такие блоки кода называются критическими секциями. Для организации критических секций платформа .NET предлагает статический класс System.Threading.Monitor. Метод Monitor.Enter() определяет вход в критическую секцию, а метод Monitor.Exit() – выход из секции. Вход и выход должны выполняться в одном и том же потоке.<br/></div><div>Класс System.Threading.Mutex (мьютекс) подобен классу Monitor, но позволяет организовать критическую секцию для нескольких процессов. Применяя Mutex, нужно вызвать метод WaitOne() для входа в критическую секцию, а метод ReleaseMutex() – для выхода из неё. Типичный пример использования мьютекса – создание приложения, которое можно запустить только в одном экземпляре.<br/></div><div>Семафор – это объект синхронизации, позволяющий войти в заданный участок кода не более чем N потокам (N – ёмкость семафора). Аналогией семафора является охранник у входа в клуб с фиксированным количеством мест. Новые посетители попадают в заполненный клуб, только если из него кто-то ушёл. Се- мафор с ёмкостью, равной единице, аналогичен монитору или мьютексу, однако получение и снятие блокировки в случае семафора может выполняться из разных потоков. Для организации есть классы Semaphore и SemaphoreSlim из пространства имён System.Threading. Первый класс применяется для синхронизации между процессами, второй работает только в рамках одного процесса. Метод Wait() этих классов выполняет получение блокировки, а метод Release() – снятие блокировки. </div><div><hr/><b>Стили и шаблоны в WPF</b></div><div>Стиль – это коллекция значений свойств, которые могут быть применены к элементу. В WPF стили играют ту же роль, которую CSS играет в HTML-разметке. Подобно CSS, стили WPF позволяют определять общий набор характеристик форматирования и применять их по всему приложению для обеспечения согласованности. Стили могут работать автоматически, предназначаться для элементов конкретного типа и каскадироваться через дерево элементов. Рассмотрение стилей начнём с конкретного примера, в котором определяется и применяется стиль для кнопок.</div><div>&lt;StackPanel Orientation=&quot;Horizontal&quot; Margin=&quot;30&quot;&gt;<br/>
&lt;StackPanel.Resources&gt;<br/>
&lt;Style x:Key=&quot;buttonStyle&quot;&gt;<br/>
&lt;Setter Property=&quot;Button.FontSize&quot; Value=&quot;22&quot; /&gt;<br/>
&lt;Setter Property=&quot;Button.Background&quot; Value=&quot;Purple&quot; /&gt;<br/>
&lt;/Style&gt;<br/>
&lt;/StackPanel.Resources&gt;<br/>
&lt;Button Style=&quot;{StaticResource buttonStyle}&quot;&gt;1&lt;/Button&gt;<br/>
&lt;/StackPanel&gt;<br/></div><div>Любой стиль в WPF – это объект класса System.Windows.Style. Основным свойством стиля является коллекция Setters (свойство содержимого), в которой каждый элемент задаёт значение для некоторого свойства зависимостей (стили работают только со свойствами зависимостей). Чтобы задать значение для свойства зависимостей, нужно указать имя этого свойства. В нашем примере имя включает префикс – класс элемента. Если требуется применить один стиль к визуальным элементам разных типов, для префикса используется имя общего типа-предка:</div><div>&lt;Style x:Key=&quot;controlStyle&quot;&gt;<br/>
Определяя стиль, можно построить его на основе стиля-предка. Для этого следует воспользоваться свойством стиля BasedOn. Стили также могут содержать локальные логические ресурсы (коллекция Resources):<br/>
BasedOn=&quot;{StaticResource baseStyle}</div><div>Рассмотрим применение триггеров при описании стиля. У триггера настраиваются: имя свойства, с которым связан триггер; значение свойства, которое задаёт условие старта триггера; коллекция Setters, описывающая действие триггера. перемещении над кнопкой указателя мыши происходил поворот кнопки:<br/></div><div>&lt;Style x:Key=&quot;buttonStyle&quot; TargetType=&quot;Button&quot;&gt;<br/>
&lt;Style.Triggers&gt;<br/>
&lt;Trigger Property=&quot;IsMouseOver&quot; Value=&quot;True&quot;&gt;<br/>
&lt;Setter Property=&quot;Foreground&quot; Value=&quot;Black&quot; /&gt;<br/>
&lt;Setter Property=&quot;RenderTransform&quot;&gt;<br/>
&lt;Setter.Value&gt;<br/>
&lt;RotateTransform Angle=&quot;10&quot; /&gt;<br/>
&lt;/Setter.Value&gt;<br/>
&lt;/Setter&gt;<br/>
&lt;/Trigger&gt;<br/>
&lt;/Style.Triggers&gt;<br/>
&lt;/Style&gt;<br/></div><div>Шаблоны – фундаментальная концепция технологии WPF. Шаблоны обеспечивают настраиваемое представление (внешний вид) для элементов управления и произвольных объектов, отображаемых как содержимое элементов. Большинство элементов управления имеют внешний вид и поведение. Рассмотрим кнопку: внешним видом является область для нажатия, а поведением – событие Click. WPF разделяет внешний вид и поведение, благодаря концепции шаблона элемента управления. Шаблон элемента управления – это экземпляр класса System.Windows.ControlTemplate. Основным свойством шаблона является свойство содержимого VisualTree, которое содержит визуальный элемент, определяющий внешний вид шаблона. В элементах управления ссылка на шаблон устанавливается через свойство Template.(примеры в методе)<br/>
&lt;Button Content=&quot;Sample&quot; Width=&quot;120&quot; Height=&quot;80&quot; Padding=&quot;15&quot;&gt;<br/>
&lt;Button.Template&gt;<br/>
&lt;ControlTemplate&gt;<br/>
&lt;Border BorderBrush=&quot;Blue&quot; BorderThickness=&quot;4&quot;<br/>
CornerRadius=&quot;2&quot; Background=&quot;Gold&quot; /&gt;<br/>
&lt;/ControlTemplate&gt;<br/>
&lt;/Button.Template&gt;<br/>
&lt;/Button&gt;<br/>
Шаблон данных – механизм для настройки отображения объектов заданного типа. Любой шаблон данных – это объект System.Windows.DataTemplate. Основное свойство шаблона данных – VisualTree. Оно содержит визуальный элемент, определяющий внешний вид шаблона. При формировании VisualTree обычно используется привязка данных для извлечения информации из объекта, для которого применяется шаблон. Сам шаблон данных, как правило, размещают в ресурсах окна или приложения.</div></div>
</div></body></html> 